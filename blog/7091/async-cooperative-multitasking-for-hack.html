<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:url" content="http://hhvm-cn.com/blog/7091/async-cooperative-multitasking-for-hack" />
  <meta property="og:site_name" content="HHVM"/>
  <meta property="og:title" content="Async - Cooperative Multitasking for Hack" />
  <meta property="og:image" content="http://hhvm-cn.com/static/og_image.png" />
  <meta property="og:description" content="For several months now, Hack has had a feature available called async which enables writing code that cooperatively multitasks. This is somewhat similar to t..." />

  <link rel="stylesheet" href="/css/main.css" media="screen">
  <link rel="icon" href="/static/favicon.png" type="image/x-icon">
  

  <title>Async - Cooperative Multitasking for Hack | HHVM</title>
  <meta name="description" content="For several months now, Hack has had a feature available called async which enables writing code that cooperatively multitasks. This is somewhat similar to t...">

  <link rel="canonical" href="http://hhvm-cn.com/blog/7091/async-cooperative-multitasking-for-hack">
  <link rel="alternate" type="application/rss+xml" title="HHVM" href="http://hhvm-cn.com/feed.xml" />
</head>

  <body class="docsNavVisible">
    <div id="fixed_header" class="fixedHeaderContainer visible">
  <div class="headerWrapper wrapper">
    <header>
      <a href="http://hhvm-cn.com/">
        <img src="/static/logo.svg">
        <h2>HHVM</h2>
      </a>

      <div class="navigationWrapper navigationFull" id="flat_nav">
        <nav class="navigation">
          <ul>
            
              <li class="navItem">
                
                  <a href="https://docs.hhvm-cn.com/hhvm/getting-started/getting-started">安装</a>
                
              </li>
            
              <li class="navItem navItemActive">
                
                  <a href="/blog/">博客</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://docs.hhvm-cn.com/hhvm/">文档</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://github.com/facebook/hhvm">GitHub</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://hacklang-cn.org/">Hack</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="https://www.facebook.com/hhvm/">Facebook</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="https://twitter.com/HipHopVM">Twitter</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://webchat.freenode.net/?channels=hhvm">IRC</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://hhvm.h4cc.de/">模块支持</a>
                
              </li>
            
            
          </ul>
        </nav>
      </div>
      <div class="navigationWrapper navigationSlider" id="navigation_wrap">
        <div id="header_nav">
  <div class="navSlideout">
    <i class="menuExpand" id="header_nav_expander"><span></span><span></span><span></span></i>
  </div>
  <nav class="slidingNav">
    <ul>
      
      <li class="navItem">
        <a href="https://docs.hhvm-cn.com/hhvm/getting-started/getting-started" target="_blank">安装</a>
      </li>
      
      <li class="navItem">
        <a href="/blog/">博客</a>
      </li>
      
      <li class="navItem">
        <a href="http://docs.hhvm-cn.com/hhvm/" target="_blank">文档</a>
      </li>
      
      <li class="navItem">
        <a href="http://github.com/facebook/hhvm" target="_blank">GitHub</a>
      </li>
      
      <li class="navItem">
        <a href="http://hacklang-cn.org/" target="_blank">Hack</a>
      </li>
      
      <li class="navItem">
        <a href="https://www.facebook.com/hhvm/" target="_blank">Facebook</a>
      </li>
      
      <li class="navItem">
        <a href="https://twitter.com/HipHopVM" target="_blank">Twitter</a>
      </li>
      
      <li class="navItem">
        <a href="http://webchat.freenode.net/?channels=hhvm" target="_blank">IRC</a>
      </li>
      
      <li class="navItem">
        <a href="http://hhvm.h4cc.de/" target="_blank">模块支持</a>
      </li>
      
      
    </ul>
  </nav>
</div>
<script>
  var event = document.createEvent('Event');
  event.initEvent('slide', true, true);
  document.addEventListener('slide', function (e) {
    document.body.classList.toggle('sliderActive');
  }, false);
  var headerNav = document.getElementById('header_nav');
  var headerNavExpander = document.getElementById('header_nav_expander');
  headerNavExpander.addEventListener('click', function(e) {
    headerNav.classList.toggle('navSlideoutActive');
    document.dispatchEvent(event);
  }, false);
</script>
      </div>
    </header>
  </div>
</div>

    <div class="navPusher">
      <div class="docMainWrapper wrapper">
      <div class="docsNavContainer">
  <nav class="toc" id="doc_nav">
    <div class="toggleNav" id="collection_nav">
      <section class="navWrapper wrapper">
        <div class="navBreadcrumb wrapper">
          <div class="navToggle" id="collection_nav_toggler">
            <i></i>
          </div>
          <h2>
            <a href="/blog/">Blog</a>
            
          </h2>
        </div>
        <div class="navGroups">
          
            
            
            <div class="navGroup navGroupActive navGroupCurrent">
  <h3><i>+</i><span>All Posts</span></h3>
  <ul>
    
      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/05/04/hhvm-4.56.html">HHVM 4.56</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/30/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/29/hhvm-4.55.html">HHVM 4.55</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/21/hhvm-4.54.html">HHVM 4.54</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/13/hhvm-4.53.html">HHVM 4.53</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/07/hhvm-4.52.html">HHVM 4.52</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/31/hhvm-4.51.html">HHVM 4.51</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/24/hhvm-4.50.html">HHVM 4.50</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/18/hhvm-4.49.html">HHVM 4.49</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/09/hhvm-4.48.html">HHVM 4.48</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/03/hhvm-4.47.html">HHVM 4.47</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/24/hhvm-4.46.html">HHVM 4.46</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/20/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/19/hhvm-4.45.html">HHVM 4.45</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/10/hhvm-4.44.html">HHVM 4.44</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/03/hhvm-4.43.html">HHVM 4.43</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/27/hhvm-4.42.html">HHVM 4.42</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/21/hhvm-4.41.html">HHVM 4.41</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/13/hhvm-4.40.html">HHVM 4.40</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/07/hhvm-4.39.html">HHVM 4.39</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/02/hhvm-4.38.html">HHVM 4.38</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/12/17/cancelling-hhvm-4.37.html">Holiday schedule: cancelling HHVM 4.37</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/12/16/hhvm-4.36.html">HHVM 4.36</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/12/10/hhvm-4.35.html">HHVM 4.35</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/12/02/hhvm-4.34.html">HHVM 4.34</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/25/hhvm-4.33.html">HHVM 4.33</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/19/hhvm-4.32.html">HHVM 4.32 (LTS)</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/19/distribution-support.html">Support lifecycle for older distributions</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/11/hhvm-4.31.html">HHVM 4.31.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/06/hhvm-4.30.html">HHVM 4.30.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/29/hhvm-4.29.html">HHVM 4.29.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/28/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/23/hhvm-4.28.html">HHVM 4.28</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/14/hhvm-4.27.0.html">HHVM 4.27.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/09/hhvm-4.26.0.html">HHVM 4.26.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/01/deprecating-references.html">Deprecating &$references</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/30/hhvm-4.25.0.html">HHVM 4.25.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/25/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/23/hhvm-4.24.0.html">HHVM 4.24.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/17/hhvm-4.23.0.html">HHVM 4.23.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/09/hhvm-4.22.0.html">HHVM 4.22.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/03/the-hhvm-4.21.0.html">HHVM 4.21.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/03/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/27/hhvm-4.20.0.html">HHVM 4.20.0 and 4.20.1</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/19/hhvm-4.19.0.html">HHVM 4.19.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/14/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/12/hhvm-4.18.0.html">HHVM 4.18.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/07/bugfixes.html">Bugfixes for 3.30, 4.8, and 4.12-17</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/05/hhvm-4.17.0.html">HHVM 4.17.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/29/hhvm-4.16.0.html">HHVM 4.16.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/22/hhvm-4.15.0.html">HHVM 4.15.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/15/hhvm-4.14.0.html">HHVM 4.14.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/09/hhvm-4.13.0.html">HHVM 4.13.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/01/hhvm-4.12.0.html">HHVM 4.12.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/24/hhvm-4.11.0.html">HHVM 4.11.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/18/hhvm-4.10.0.html">HHVM 4.10.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/13/hhvm-4.9.1.html">HHVM 4.9.1, repository changes</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/10/hhvm-4.9.0.html">HHVM 4.9.0, and security updates for 3.30, and 4.3-4.7</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/03/hhvm-4.8.0.html">HHVM 4.8.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/05/28/hhvm-4.7.0.html">HHVM 4.7.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/05/21/hhvm-4.6.0.html">HHVM 4.6.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/05/13/hhvm-4.5.0.html">HHVM 4.5.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/05/06/hhvm-4.4.0.html">HHVM 4.4.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/04/30/hhvm-4.3.0.html">HHVM 4.3.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/04/23/hhvm-4.2.0.html">HHVM 4.2.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/04/09/hhvm-4.1.0.html">HHVM 4.1.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/04/03/hhvm-4.0.4.html">HHVM 4.0.4, 3.30.5, and 3.27.8</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/28/hhvm-4.0.3.html">HHVM 4.0.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/19/hhvm-4.0.2.html">HHVM 4.0.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/14/hhvm-4.0.1.html">HHVM 4.0.1, 3.30.4, and 3.27.7: CVE-2019-3552</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/11/hhvm-4.0.0.html">HHVM 4.0.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/01/hhvm-3.30.3.html">HHVM 3.30.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/01/14/hhvm-3.30.2.html">HHVM 3.30.2 and 3.27.6</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/12/18/hhvm-3.30.1.html">HHVM 3.30.1 and 3.27.5</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/12/17/hhvm-3.30.html">HHVM 3.30</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/10/30/hhvm-3.29.1.html">HHVM 3.29.1 and 3.27.4</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/10/22/hhvm-3.29.html">HHVM 3.29</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/10/01/hhvm-3.28.3.html">HHVM 3.28.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/09/28/hhvm-3.28.2.html">HHVM 3.28.2 and 3.27.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/09/26/introducing-hacktest.html">Introducing HackTest</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/09/12/end-of-php-support-future-of-hack.html">Ending PHP Support, and The Future Of Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/08/30/hhvm-3.28.1.html">HHVM 3.28.1</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/08/28/hhvm-3.28.0.html">HHVM 3.28.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/08/15/hhvm-3.27.2.html">HHVM 3.27.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/07/19/hhvm-3.27.1.html">HHVM 3.27.1 and 3.24.8</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/06/18/hhvm-3.27.0.html">HHVM 3.27.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/24/hhvm-3.26.3.html">HHVM 3.26.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/15/hhvm-3.26.2.html">HHVM 3.26.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/11/hhvm-3.26.1.html">HHVM 3.26.1</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/07/hhvm-3.26.html">HHVM 3.26 - Introducing HackC</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/04/hhvm-3.25.3.html">HHVM 3.25.3, HHVM 3.24.7, and 3.21.11</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/04/11/relicensing-hack.html">Relicensing Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/03/30/hhvm-3.25.2.html">HHVM 3.25.2, HHVM 3.24.6, and 3.21.10 (CVE-2018-6334)</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/03/22/hhvm-3.25.1.html">HHVM 3.25.1, HHVM 3.24.5, and 3.21.9</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/03/15/hhvm-3.25.html">HHVM 3.25.0, 3.24.4, and 3.21.8</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/03/02/hhvm-3.24.3.html">HHVM 3.24.3 and 3.21.7</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/02/07/hhvm-3.24.2.html">HHVM 3.24.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/01/30/hhvm-3.24.1.html">HHVM 3.24.1, 3.21.6, and 3.18.8</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/01/16/hhvm-3.24.html">HHVM 3.24</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/01/12/hhvm-3.23.4.html">HHVM 3.23.4, 3.21.5, and 3.18.7</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/01/02/hhvm-3.23.3.html">HHVM 3.23.3, 3.21.4, and 3.18.6</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/11/17/hhvm-3-23.html">HHVM 3.23</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/11/14/gpg-key-migration.html">GPG Key Migration</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/10/26/the-hack-standard-library-1-0.html">The Hack Standard Library: v1.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/09/26/hhvm-3-22.html">HHVM 3.22</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/09/18/the-future-of-hhvm.html">The Future of HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/08/02/hhvm-3-21.html">HHVM 3.21</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/06/07/hhvm-3-20.html">HHVM 3.20</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/04/13/hhvm-3-19.html">HHVM 3.19</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/03/23/concurrent-jit-compilation.html">Concurrent JIT Compilation</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/03/09/how-the-cyber-elephant-got-his-arm.html">How the Cyber-Elephant Got His ARM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/02/17/region-jit.html">HHVM's Profile-guided Region JIT</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/02/15/hhvm-3-18.html">HHVM 3.18</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/01/26/new-year-new-me.html">New Year, New Me</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/11711/hhvm-3-15">HHVM 3.15</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10925/improved-user-documentation">Improved User Documentation</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10859/php-7-support">PHP 7 Support</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10649/improving-arrays-in-hack">Improving Arrays in Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10205/llvm-code-generation-in-hhvm">LLVM Code Generation in HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10379/hhvm-3-10-0">HHVM 3.10.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10043/experimental-mac-os-x-support">Experimental Mac OS X Support</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9995/hhvm-3-9-0">HHVM 3.9.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9803/hhvm-3-8-0">HHVM 3.8.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9773/cve-2015-4663">CVE-2015-4663</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9581/trait-and-interface-requirements-in-hack">Trait and interface requirements in Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9293/lockdown-results-and-hhvm-performance">Lockdown Results and HHVM Performance</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9215/covariance-contravariance-and-super-type-constraints">Covariance, Contravariance, and super Type Constraints</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9089/hhvm-lockdown">HHVM Lockdown</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9059/hhvm-3-7-0">HHVM 3.7.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8981/announcing-our-book-hack-hhvm">Announcing our book: “Hack & HHVM”</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8939/etsys-transition-to-hhvm">Etsy's Transition to HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8849/hhvm-3-6-0">HHVM 3.6.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8537/announcing-a-specification-for-hack">Announcing a Specification for Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8405/coming-soon-in-hhvm">Coming Soon in HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/7637/hhvm-3-5-0">HHVM 3.5.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/7205/wikipedia-on-hhvm">Wikipedia on HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/7349/lts-updates">LTS Updates</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/7091/async-cooperative-multitasking-for-hack">Async - Cooperative Multitasking for Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6989/wp-engine-and-box-now-use-hhvm">WP Engine and Box now use HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6899/hhvm-3-4-0">HHVM 3.4.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6863/announcing-the-hack-transpiler">Announcing the Hack Transpiler</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6473/hack-overriding-constructors-new-static-and-__consistentconstruct">Hack: Overriding Constructors, "new static", and __ConsistentConstruct</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6767/hhvm-3-3-1">HHVM 3.3.1</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6515/using-xhp-with-bootstrap">Using XHP with Bootstrap</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6443/hack-recent-updates">Hack: Recent Updates</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6323/the-journey-of-a-thousand-bytecodes">The Journey of a Thousand Bytecodes</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6239/hhvm-3-3-0">HHVM 3.3.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6083/hhvm-long-term-support">HHVM Long Term Support</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6005/hack-community-roundup-3">Hack Community Roundup #3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5723/announcing-a-specification-for-php">Announcing a specification for PHP</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5609/hhvm-3-2-0">HHVM 3.2.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5399/faster-github-commits">Faster GitHub Commits</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5429/hack-community-roundup-2">Hack Community Roundup #2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5195/hhvm-3-1-0">HHVM 3.1.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4811/hack-community-roundup">Hack Community Roundup</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4841/compatibility-update">Compatibility Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4685/hack-developer-day-2014-keep-hacking">Hack Developer Day 2014: Keep Hacking</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4601/debug-packages">Debug Packages</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4349/hhvm-3-0-0">HHVM 3.0.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4325/hacking-hack-on-heroku">Hacking Hack on Heroku</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4223/introducing-hack-a-programming-language-for-hhvm">Introducing Hack - A Programming Language for HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4103/hhvm-2-4-2">HHVM 2.4.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3611/tracking-parity">Tracking Parity</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3689/implementing-mysqli">Implementing MySQLi</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3743/hhvm-the-next-six-months">HHVM: The Next Six Months</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3287/hhvm-2-4-0">HHVM 2.4.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3203/nightly-packages">Nightly Packages</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2813/we-are-the-98-5-and-the-16">We are the 98.5% (and the 16%)</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/1817/fastercgi-with-hhvm">FasterCGI with HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2393/hhvm-2-3-0-and-travis-ci">HHVM 2.3.0 and Travis CI</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2027/faster-and-cheaper-the-evolution-of-the-hhvm-jit">Faster and Cheaper: The Evolution of the hhvm JIT</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/1499/locking-down-for-performance-and-parity">Locking Down for Performance and Parity </a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/1379/hhvm-on-heroku">HHVM on Heroku</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/1301/hhvm-2-2-0">HHVM 2.2.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/875/wow-hhvm-is-fast-too-bad-it-doesnt-run-my-code">Wow HHVM is fast...too bad it doesn’t run my code</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/713/hhvm-optimization-tips">HHVM Optimization Tips</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/575/joining-retirement-testing-and-bankruptcy">Joining, Retirement, Testing, and Bankruptcy</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/521/the-adminserver">The AdminServer</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/431/on-garbage-collection">On Garbage Collection</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/401/spammers-are-still-a-thing-it-seems">Spammers are still a thing, it seems</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/311/adding-an-opcode-to-hhbc">Adding an opcode to HHBC</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4061/go-faster">Go Faster!</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3095/getting-wordpress-running-on-hhvm">Getting WordPress running on HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3089/wordpress-3-4-2-running-on-hiphop-hhvm">WordPress 3.4.2 running on HHVM</a></li>

      
    
  </ul>
</div>
          
        </div>
      </section>
    </div>
  </nav>
</div>
<script>
  var docsevent = document.createEvent('Event');
  docsevent.initEvent('docs_slide', true, true);
  document.addEventListener('docs_slide', function (e) {
    document.body.classList.toggle('docsSliderActive');
  }, false);

  var collectionNav = document.getElementById('collection_nav');
  var collectionNavToggler = 
    document.getElementById('collection_nav_toggler');
  collectionNavToggler.addEventListener('click', function(e) {
    collectionNav.classList.toggle('toggleNavActive');
    document.dispatchEvent(docsevent);
  });

  var groups = document.getElementsByClassName('navGroup');
  for(var i = 0; i < groups.length; i++) {
    var thisGroup = groups[i];
    thisGroup.onclick = function() {
      for(var j = 0; j < groups.length; j++) {
        var group = groups[j];
        group.classList.remove('navGroupActive');
      }
      this.classList.add('navGroupActive');
    }
  }
</script>


      <div class="mainContainer blogContainer postContainer">
  <div id="main_wrap" class="wrapper mainWrapper">
    <div class="lonePost">
<div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title">Async - Cooperative Multitasking for Hack</h1>
    <p class="post-meta">Posted December 05, 2014</p>
  </header>

  <article class="post-content">
  
    <p>For several months now, Hack has had a feature available called <code class="highlighter-rouge">async</code> which enables writing code that cooperatively multitasks. This is somewhat similar to threading, in that multiple code paths are executed in parallel, however it avoids the lock contention issues common to multithreaded code by only actually executing one section at any given moment.</p>

<!--truncate-->

<p>“What’s the use of that?”, I hear you ask.  You’re still bound to one CPU, so it should take the same amount of time to execute your code, right?  Well, that’s technically true, but script code execution isn’t the only thing causing latency in your application.  The biggest piece of it probably comes from waiting for backend databases to respond to queries.</p>

<p>When you call <code class="highlighter-rouge">$zuck = file_get_contents('https://graph.facebook.com/4');</code>, the runtime essentially pauses execution while it waits for network packets to cross the internet, query a database for an answer, and come back.  About 350ms from my house, more than 200 of which is just to negotiate TLS. 350ms is practically an eternity on the scale of a web request.</p>

<p>That’s where cooperative multitasking comes in.  While your https call is busy sitting on its hands waiting for a response, there’s no reason you shouldn’t be able to do other things, maybe even fire off more requests.  The same goes for database queries, which can take just as long, or even filesystem access which is faster than network, but can still introduce lag times of several milliseconds, and those all add up!</p>

<p>So how do we write code that can cooperate with other code?  Hack’s solution for that, as I said earlier, is <code class="highlighter-rouge">async</code>, and its sibling structures <code class="highlighter-rouge">await</code>, <code class="highlighter-rouge">WaitHandle</code>, and <code class="highlighter-rouge">Awaitable</code>.  Let’s take a look at a simplified example; a single task which can run in all the glorious parallelism of lone execution.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?</span><span class="nx">hh</span>

<span class="nx">async</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">()</span><span class="o">:</span> <span class="nx">Awaitable</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">"Hello World"</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nx">hello</span><span class="p">();</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">getWaitHandle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">join</span><span class="p">());</span>

<span class="c1">// Object(HH\StaticWaitHandle)#1 (0) {
// }
// string(11) "Hello World"
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Immediately of notice is that returning from a function (or method) marked as “<code class="highlighter-rouge">async</code>” doesn’t actually return that value, it returns a instance of a WaitHandle object (in this case, an <code class="highlighter-rouge">HH\StaticWaitHandle</code>, but we’ll see other types).  We don’t see the actual value until, as the caller, we’ve told the underlying async layer “wait until this task has done all its work, then give me the value”.  This is because, like a generator, the async function is designed to be pauseable and resume execution at a later time.</p>

<p>Most places in an async code base, that will be done by invoking <code class="highlighter-rouge">$result = await $waitHandle;</code> because that leaves the CPU free to run through other async functions<code class="highlighter-rouge">, however at the top-most point, where there's nothing else to share processing time with, we use a hard-block in the form of </code>$handle-&gt;join();`  Which effectively says “Deal with all your pending handles, then give me the end result.”  Let’s try adding a line to this function:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?</span><span class="nx">hh</span>

<span class="nx">async</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">()</span><span class="o">:</span> <span class="nx">Awaitable</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">RescheduleWaitHandle</span><span class="o">::</span><span class="na">create</span><span class="p">(</span>
    <span class="nx">RescheduleWaitHandle</span><span class="o">::</span><span class="na">QUEUE_DEFAULT</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
  <span class="p">);</span>
  <span class="k">return</span> <span class="s2">"Hello World"</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This function produces the same results, but this time we’ve used <code class="highlighter-rouge">RescheduleWaitHandle</code> to say “If there’s any other async function trying to run right now, let it have some fun, come back to me when you’ve got nothing better to do.” Again, because we’re inside of an async function, we use <code class="highlighter-rouge">await</code>, rather than <code class="highlighter-rouge">join()</code>, because we’re probably sharing the stage with some other async function somewhere else, so we don’t want the hard block which comes from <code class="highlighter-rouge">join()</code>.  Similarly, we could schedule a sleep to wait an arbitrary amount of time:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?</span><span class="nx">hh</span>

<span class="nx">async</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">()</span><span class="o">:</span> <span class="nx">Awaitable</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">SleepWaitHandle</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="cm">/* 1000us, aka 1ms */</span>
  <span class="k">return</span> <span class="s2">"Hello World"</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>But those uses are all pretty silly, especially considering that we only have one task to perform which will ultimately have to block on the -&gt;join() call anyway. How can we do more than one thing? Enter <code class="highlighter-rouge">AwaitAllWaitHandle</code> which organizes execution of an arbitrary number of WaitHandles passed to it as an array, Map, or Vector.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?</span><span class="nx">hh</span>

<span class="nx">async</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">()</span><span class="o">:</span> <span class="nx">Awaitable</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">"Hello World"</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">async</span> <span class="k">function</span> <span class="nf">goodbye</span><span class="p">()</span><span class="o">:</span> <span class="nx">Awaitable</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">"Goodbye, everybody!"</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">async</span> <span class="k">function</span> <span class="nf">run</span><span class="p">(</span>
  <span class="k">array</span><span class="o">&lt;</span><span class="nx">WaitHandle</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;&gt;</span> <span class="nv">$handles</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">Awaitable</span><span class="o">&lt;</span><span class="k">array</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">AwaitAllWaitHandle</span><span class="o">::</span><span class="na">fromArray</span><span class="p">(</span><span class="nv">$handles</span><span class="p">);</span>
  <span class="k">return</span> <span class="nb">array_map</span><span class="p">(</span><span class="nv">$handle</span> <span class="o">==&gt;</span> <span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">result</span><span class="p">(),</span> <span class="nv">$handles</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nx">run</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nx">hello</span><span class="p">(),</span> <span class="nx">goodbye</span><span class="p">()))</span><span class="o">-&gt;</span><span class="na">getWaitHandle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">join</span><span class="p">();</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$results</span><span class="p">);</span>
<span class="c1">// Array
// (
//  [0] =&gt; Hello World
//  [1] =&gt; Goodbye, everybody!
// )
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">AwaitAllWaitHande::fromArray()</code> (and its Collection cousins <code class="highlighter-rouge">AwaitAllWaitHandle::fromVector()</code> and <code class="highlighter-rouge">AwaitAllWaitHandle::fromMap()</code>) don’t actually yield values, instead they queue execution of their children such that when the <code class="highlighter-rouge">AwaitAllWaitHandle</code> yields, all of its handles will be done (as we could test with <code class="highlighter-rouge">-&gt;isFinished()</code>).  Subsequent calls to <code class="highlighter-rouge">-&gt;result()</code> will return each handle’s value, just as if we had called <code class="highlighter-rouge">-&gt;join()</code>.</p>

<p>So that’s great and all, but none of this is blocking code, and we still haven’t seen an advantage over just executing them in series. In fact, they are effectively executed in series because it’s just cooperative multitasking, not multi-threading. So let’s add in the simplest kind of blocking call, an http fetch using cURL. The work-horse of this feature is the following builtin function:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">async</span> <span class="k">function</span> <span class="nf">curl_multi_await</span><span class="p">(</span>
  <span class="nx">resource</span> <span class="nv">$curlMultiHandle</span><span class="p">,</span>
  <span class="nx">float</span> <span class="nv">$timeout</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">Awaitable</span><span class="o">&lt;</span><span class="nx">int</span><span class="o">&gt;</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This allows us to “await” on the only part of a curl request which actually needs to block. It’s a bit unhelpful all by itself, so let’s make a simple wrapper for it:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?</span><span class="nx">hh</span>
<span class="nx">async</span> <span class="k">function</span> <span class="nf">curl_exec_await</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$url</span><span class="p">)</span><span class="o">:</span> <span class="nx">Awaitable</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

  <span class="nv">$mh</span> <span class="o">=</span> <span class="nb">curl_multi_init</span><span class="p">();</span>
  <span class="nb">curl_multi_add_handle</span><span class="p">(</span><span class="nv">$mh</span><span class="p">,</span> <span class="nv">$ch</span><span class="p">);</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="nv">$active</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="nv">$status</span> <span class="o">=</span> <span class="nb">curl_multi_exec</span><span class="p">(</span><span class="nv">$mh</span><span class="p">,</span> <span class="nv">$active</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">==</span> <span class="nx">CURLM_CALL_MULTI_PERFORM</span><span class="p">);</span>
    <span class="nv">$select</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">curl_multi_await</span><span class="p">(</span><span class="nv">$mh</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$select</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">===</span> <span class="nx">CURLM_OK</span><span class="p">);</span>
  <span class="nv">$content</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span><span class="nb">curl_multi_getcontent</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
  <span class="nb">curl_multi_remove_handle</span><span class="p">(</span><span class="nv">$mh</span><span class="p">,</span> <span class="nv">$ch</span><span class="p">);</span>
  <span class="nb">curl_multi_close</span><span class="p">(</span><span class="nv">$mh</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>During lulls in network activity, the <code class="highlighter-rouge">await curl_multi_async($mh);</code> allows us to pass control to another <code class="highlighter-rouge">WaitHandle</code> (perhaps another curl request, perhaps something else), meanwhile the rest of the execution performs non-blocking actions, like calling <code class="highlighter-rouge">curl_multi_exec()</code>. Armed with this helper, and our lessons from earlier, we can combine this all into multiple parallelized fetches:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?</span><span class="nx">hh</span>
<span class="k">include</span> <span class="s2">"curl-exec-await.php"</span><span class="p">;</span>

<span class="nv">$results</span> <span class="o">=</span> <span class="nx">run</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
  <span class="nx">curl_exec_await</span><span class="p">(</span><span class="s2">"https://graph.facebook.com/4"</span><span class="p">),</span>
  <span class="nx">curl_exec_await</span><span class="p">(</span><span class="s2">"http://www.example.om"</span><span class="p">),</span>
  <span class="nx">curl_exec_await</span><span class="p">(</span><span class="s2">"http://www.hhvm.com"</span><span class="p">),</span>
<span class="p">))</span><span class="o">-&gt;</span><span class="na">getWaitHandle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">join</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you’re still paying attention, then you’re probably wondering why we couldn’t just pass multiple easy handles into one multi handle and use the curl-multi interface that PHP’s known and loved for years. And you’d be right to wonder. If the only operation we were performing were cURL calls, then we could certainly get by with the existing curl-multi interface. Where async really starts to shine is when you combine other awaitable resources into the picture. Imagine something like this:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?</span><span class="nx">hh</span>

<span class="nx">async</span> <span class="k">function</span> <span class="nf">fibonacci_gen</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$num</span><span class="p">)</span><span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
  <span class="nv">$n1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$n2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$n3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$num</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$n3</span> <span class="o">=</span> <span class="nv">$n1</span> <span class="o">+</span> <span class="nv">$n2</span><span class="p">;</span>
    <span class="nv">$n1</span> <span class="o">=</span> <span class="nv">$n2</span><span class="p">;</span>
    <span class="nv">$n2</span> <span class="o">=</span> <span class="nv">$n3</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// Give other tasks a chance to do something
</span>      <span class="c1">// every 100th iteration
</span>      <span class="nx">await</span> <span class="nx">RescheduleWaitHandle</span><span class="o">::</span><span class="na">create</span><span class="p">(</span>
        <span class="nx">RescheduleWaitHandle</span><span class="o">::</span><span class="na">QUEUE_DEFAULT</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$n3</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nx">run</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
  <span class="s2">"web"</span>  <span class="o">=&gt;</span> <span class="nx">curl_exec_await</span><span class="p">(</span><span class="s2">"http://example.com"</span><span class="p">),</span>
  <span class="s2">"sql"</span>  <span class="o">=&gt;</span> <span class="nx">mysql_async_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="s2">"SELECT * FROM user"</span><span class="p">),</span>
  <span class="s2">"disk"</span> <span class="o">=&gt;</span> <span class="nx">file_async_contents</span><span class="p">(</span><span class="s2">"/var/log/access.log"</span><span class="p">),</span>
  <span class="s2">"mc"</span>   <span class="o">=&gt;</span> <span class="nx">memcached_async_get</span><span class="p">(</span><span class="s2">"somekey"</span><span class="p">),</span>
  <span class="s2">"fib"</span>  <span class="o">=&gt;</span> <span class="nx">fibonacci_gen</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span>
<span class="p">))</span><span class="o">-&gt;</span><span class="na">getWaitHandle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">join</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now we’re combining multiple kinds of blocking operations (and one expensive bit of pure script code) in a single coordination framework without having to know, from the callsite, how to block on the underlying file descriptors or when.</p>

<p>For now, there’s no streams, mysql, or memcached APIs for async blocking, but streams should arrive soon (it’s currently up for review), and memcached/webscalesql support are hot on its heels. Watch this space for those.</p>

<blockquote>
  <p>As you can see from the paragraph above, async is still in active development, so you’ll need HHVM 3.5.0 (which may not exist at the time of this reading) or a nightly to get the curl support.  Check out <a href="https://github.com/facebook/hhvm/wiki/Prebuilt-packages-on-Ubuntu-14.10">installing nightlies on Ubuntu</a> or elsewhere in the HHVM wiki for more info on how to do that.</p>
</blockquote>

    
      
      
        
          <h3> Comments </h3>
          <br/>
          <ul>
          
        
        <li><b>Carl G</b>: This is cool. But, going a little off-topic, I'm really starting to wonder why you've even released Hack to the public.

I'm a professional, and using a new language puts a dent in my productivity for a while.

Going backwards from an advanced IDE like phpStorm to a text editor and package of CLI tools is another huge productivity hit.

Those combined mean I'll never be able to adopt Hack unless you get us some IDE support.

I know most other devs are in the same boat. You're basically talking to yourselves until you release FBIDE or a plugin for phpStorm, Netbeans, or some other PHP-loving IDE.

These new features are nice, but maybe you could hit the breaks for a (few?) weeks and just get the IDE out.</li>
      
        
        <li><b>Vincent DM</b>: @Carl G: I can only agree! I don't want to whine, and I sincerely appreciate all the time and effort Facebook and its people are investing into hack, but it's almost tragic how the language is closely watched by many but used by relatively few. Proper IDE support is a vital step to kickstart the community, I think. Until then, I'm sticking with PHP and some nodejs for async stuff...</li>
      
        
        <li><b>Sara Golemon</b>: AIUI, several editor projects and their communities are working on hack plugins.  IMO these should be in the hands of developers who actually use these tools as they're the best ones for that task.

As for FBIDE... yeah... I wish the team responsible for that would get on releasing it too...</li>
      
        
        <li><b>Paul Moss</b>: So when it the memcached&#47;webscale support due, for 3.5 or 3.6?

Would this also include memcached which comes with mysql 5.6?

Finally, does webscale mean mysql 5.6 client as well?

Essentially, I would love to parallelise my requests for memcached and mysql.  Can't wait really.</li>
      
        
        <li><b>Jeroen De Dauw</b>: Another +1 to this. I've been wanting to do some katas in Hack for months now, yet can't bring myself to start without proper IDE support. I want to take a step forewards without taking one or two backwards first.</li>
      
        
        <li><b>ip512</b>: Guzzle has already asynchonous response management (http:&#47;&#47;guzzle.readthedocs.org&#47;en&#47;latest&#47;clients.html#asynchronous-response-handling)
In which case this asynchronous approach can be preferable over using Guzzle ?</li>
      
        
        <li><b>Brice</b>: Yes, it would be great to have validation and syntax highlighting working in eclipse with vi + emacs as well.

IMO -- Eclipse support is the priority as it's the official base of PDT. The commerical projects like intellij, storm, &amp;c could base their support from there.

Totally excited about hack &amp; hvvm in general! Keep it up.</li>
      
        
        <li><b>Sara Golemon</b>: memcached looks like it'll be relatively soon, though I can't guarantee it'll be in by 3.5.  We'll be using mcrouter as the underlying client library (as libmemcached doesn't have a good async interface), but it should work against anything that supports the memcached protocol...

"webscale" means the async support will require libwebscalesqlclient on the *client* side.  The actual server can be WebscaleSQL, MySQL, MariaDB, or anything which speaks the mysql protocol.

I can't wait to round out the DB async support either!  Very exciting. :)</li>
      
        
        <li><b>Sara Golemon</b>: I don't know Guzzle well, but glancing through that link, it looks like it's only for http(s) requests.  Hack-Async covers that (via async-curl), but also includes many other types of blocking requests as well.  So personally, I would prefer using Hack-Async, but in the end you want to go for whatever makes sense for your application and your developer(s).</li>
      
        
        <li><b>Asynchronous PHP ~ ma.ttias.be</b>: [&#8230;] A really cool feature landed in HHVM, providing async PHP calls. [&#8230;]</li>
      
        
        <li><b>Hack Blog: Async &#8211; Cooperative Multitasking for Hack - Reader</b>: [&#8230;] the Hack blog there&#8217;s a new post talking about async, a feature in Hack that allows for code to &#8220;cooperatively multitask&#8221;. This gives the [&#8230;]</li>
      
        
        <li><b>Paul Moss</b>: Sarah, thanks for the reply and the clarification!

You and the guys who work on this totally rock!

Yes, its very exciting, I can't wait! :)</li>
      
        
        <li><b>Fred Emmott</b>: It would be possible to build this async approach into guzzle.

As well as async&#47;await giving a single approach to any kind of blocking request (which will become more useful as we release more), we generally feel that the async&#47;await flow is easier to work with than callbacks, which tend to lead to spaghetti code.</li>
      
        
        <li><b>FractalizeR</b>: I wonder, how this will be transpiled into PHP? (https:&#47;&#47;code.facebook.com&#47;posts&#47;398235553660954&#47;announcing-the-hack-transpiler&#47;)</li>
      
        
        <li><b>Jesse Cascio</b>: NOOO!!! you took my blog post haha, I just did this on Dec 1 and it took me so long to figure out how to do it.  

http:&#47;&#47;jessesnet.com&#47;development-notes&#47;2014&#47;hacklang-async-processing&#47;

Thanks for sharing, I'm going to go through this in more detail and see what I could have done better.</li>
      
        
        <li><b>Stefan Parker</b>: I've been converting my project to use async in all the memcache-fetching (as in, combining memcache gets) code paths, and I've noticed anecdotally that the web request actually takes longer now. Because this is all locally my data-fetching is essentially 0ms, but is it true that execution time with an async structure is actually (noticeably) slower than without?</li>
      
        
        <li><b>Vincent</b>: What was the reasoning behind this style of implementation for async, as opposed to the function callback style?</li>
      
        
        <li><b>Jan Oravec</b>: async&#47;await makes it possible to structure asynchronous code in the same way as if it was implemented synchronously, resulting in significantly shorter and more readable code.</li>
      
        
        <li><b>PHP Annotated Monthly &ndash; January 2015 | JetBrains PhpStorm Blog</b>: [&#8230;] Golemon posted about cooperative multitasking in HHVM. Similar to threading, it allows multiple code paths to execute in parallel, yet only one section [&#8230;]</li>
      
        
        <li><b>Episode 34: &#47;dev&#47;hell Mashup | PHP Podcasts</b>: [&#8230;] Hack&rsquo;s Async stuff [&#8230;]</li>
      
        
        <li><b>Terry Cullen</b>: Is there a list somewhere of what works asynchronously and what doesn't?  Am I correct in thinking that all regular PHP can run async but code that calls extensions (like pdo, redis) needs the extension to be updated to run async?  What about the all the different wrappers in http:&#47;&#47;php.net&#47;manual&#47;en&#47;wrappers.php ?  Can things like file_get_contents() be called async?</li>
      
        
        <li><b>Aftab Naveed</b>: if it still uses one CPU core to process the request,  my question is how come it passes control to next task when that core is still busy and waiting for the request to finish? is there any other example which can elaborate this ?</li>
      
        
        <li><b>Episode 54: Phil is Still Wrong | PHP Podcasts</b>: [&#8230;] Hack&#8217;s Async stuff [&#8230;]</li>
      
        
        <li><b>Guilherme Cardoso</b>: Mongodb, that would be a great implementation!</li>
      
        
        <li><b>Multitasking in Hack mit async-Feature - entwickler.de</b>: [&#8230;] der Einsatz von async in der Praxis aussehen kann, beschreibt Sara Golemon ausf&uuml;hrlich und mit zahlreichen Code-Beispielen im HHVM-Blog. Derzeit befindet sich das Feature noch in der aktiven Entwicklung und soll mit HHVM [&#8230;]</li>
      
        
        <li><b>hhvm-rocks</b>: ...await curl_multi_async($mh); allows us to pass control to another...

just a small correction; it should be "await curl_multi_await($mh);"</li>
      
        
        <li><b>Aftab Naveed</b>: Sorry I wanted to clarify my question here as that sounds really stupid, comparing to Google Golang concurrency which uses the same core but switches control to another core if required, was wondering if HACK async does similar kind of thing?</li>
      
        
        <li><b>Aftab Naveed</b>: Are there any async implementations planned for Guzzle?</li>
      
        
        <li><b>Fred Emmott</b>: That's really up to the Guzzle developers; we don't plan on creating a fork.

We do provide async curl and stream primitives.</li>
      
        
        <li><b>HHVM Class Undefined SleepWaitHandle - HTML CODE</b>: [&#8230;] i tried running demo http:&#47;&#47;hhvm.com&#47;blog&#47;7091&#47;async-cooperative-multitasking-for-hack [&#8230;]</li>
      
        
        <li><b>Fred Emmott</b>: This blog post is very old; the modern approach is documented here: https:&#47;&#47;docs.hhvm.com&#47;hack&#47;async&#47;utility-functions</li>
      
      
        </ul>
        <br/>
      
    
  
  
    <div class="fb-like pluginWrapper likeButtonWrapper" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>
<script>
  window.fbAsyncInit = function() {
  FB.init({
    appId      : '1615782811974223',
    xfbml      : true,
    version    : 'v2.3'
  });
  };

  (function(d, s, id){
   var js, fjs = d.getElementsByTagName(s)[0];
   if (d.getElementById(id)) {return;}
   js = d.createElement(s); js.id = id;
   js.src = "//connect.facebook.net/en_US/sdk.js";
   fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
    <div class="pluginWrapper twitterSharePlugin">
  <a href="https://twitter.com/share" class="twitter-share-button" data-hashtags="HHVM">Tweet</a>
</div>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  
  </article>
</div>

</div>
  </div>
</div>


      </div>
      <div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <div class="footerBlocks">
      <div id="fb_oss" class="footerSection fbOpenSourceFooter">
          <svg class="facebookOSSLogoSvg" viewBox="0 0 1133.9 1133.9" x="0px" y="0px">
            <g>
              <path class="logoRing outerRing" d="M 498.3 3.7 c 153.6 88.9 307.3 177.7 461.1 266.2 c 7.6 4.4 10.3 9.1 10.3 17.8 c -0.3 179.1 -0.2 358.3 0 537.4 c 0 8.1 -2.4 12.8 -9.7 17.1 c -154.5 88.9 -308.8 178.1 -462.9 267.5 c -9 5.2 -15.5 5.3 -24.6 0.1 c -153.9 -89.2 -307.9 -178 -462.1 -266.8 C 3 838.8 0 833.9 0 825.1 c 0.3 -179.1 0.2 -358.3 0 -537.4 c 0 -8.6 2.6 -13.6 10.2 -18 C 164.4 180.9 318.4 92 472.4 3 C 477 -1.5 494.3 -0.7 498.3 3.7 Z M 48.8 555.3 c 0 79.9 0.2 159.9 -0.2 239.8 c -0.1 10 3 15.6 11.7 20.6 c 137.2 78.8 274.2 157.8 411 237.3 c 9.9 5.7 17 5.7 26.8 0.1 c 137.5 -79.8 275.2 -159.2 412.9 -238.5 c 7.4 -4.3 10.5 -8.9 10.5 -17.8 c -0.3 -160.2 -0.3 -320.5 0 -480.7 c 0 -8.8 -2.8 -13.6 -10.3 -18 C 772.1 218 633.1 137.8 494.2 57.4 c -6.5 -3.8 -11.5 -4.5 -18.5 -0.5 C 336.8 137.4 197.9 217.7 58.8 297.7 c -7.7 4.4 -10.2 9.2 -10.2 17.9 C 48.9 395.5 48.8 475.4 48.8 555.3 Z" />
              <path class="logoRing middleRing" d="M 184.4 555.9 c 0 -33.3 -1 -66.7 0.3 -100 c 1.9 -48 24.1 -86 64.7 -110.9 c 54.8 -33.6 110.7 -65.5 167 -96.6 c 45.7 -25.2 92.9 -24.7 138.6 1 c 54.4 30.6 108.7 61.5 162.2 93.7 c 44 26.5 67.3 66.8 68 118.4 c 0.9 63.2 0.9 126.5 0 189.7 c -0.7 50.6 -23.4 90.7 -66.6 116.9 c -55 33.4 -110.8 65.4 -167.1 96.5 c -43.4 24 -89 24.2 -132.3 0.5 c -57.5 -31.3 -114.2 -64 -170 -98.3 c -41 -25.1 -62.9 -63.7 -64.5 -112.2 C 183.5 621.9 184.3 588.9 184.4 555.9 Z M 232.9 556.3 c 0 29.5 0.5 59.1 -0.1 88.6 c -0.8 39.2 16.9 67.1 50.2 86.2 c 51.2 29.4 102.2 59.2 153.4 88.4 c 31.4 17.9 63.6 18.3 95 0.6 c 53.7 -30.3 107.1 -61.2 160.3 -92.5 c 29.7 -17.5 45 -44.5 45.3 -78.8 c 0.6 -61.7 0.5 -123.5 0 -185.2 c -0.3 -34.4 -15.3 -61.5 -44.9 -79 C 637.7 352.6 583 320.8 527.9 290 c -27.5 -15.4 -57.2 -16.1 -84.7 -0.7 c -56.9 31.6 -113.4 64 -169.1 97.6 c -26.4 15.9 -40.7 41.3 -41.1 72.9 C 232.6 491.9 232.9 524.1 232.9 556.3 Z" />
              <path class="logoRing innerRing" d="M 484.9 424.4 c 69.8 -2.8 133.2 57.8 132.6 132 C 617 630 558.5 688.7 484.9 689.1 c -75.1 0.4 -132.6 -63.6 -132.7 -132.7 C 352.1 485 413.4 421.5 484.9 424.4 Z M 401.3 556.7 c -3.4 37.2 30.5 83.6 83 84.1 c 46.6 0.4 84.8 -37.6 84.9 -84 c 0.1 -46.6 -37.2 -84.4 -84.2 -84.6 C 432.2 472.1 397.9 518.3 401.3 556.7 Z" />
            </g>
          </svg>
        <h2>Facebook Open Source</h2>
      </div>
      <div class="footerSection">
        <a class="footerLink" href="https://code.facebook.com/projects/" target="_blank">开源项目</a>
        <a class="footerLink" href="https://github.com/facebook/" target="_blank">GitHub</a>
        <a class="footerLink" href="https://twitter.com/fbOpenSource" target="_blank">Twitter</a>
      </div>
      <div class="footerSection rightAlign">
        <a class="footerLink" href="https://github.com/hhvm-cn/hhvm-cn.com" target="_blank">帮助我们翻译</a>
      </div>
    </div>
  </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49208336-2', 'auto');
  ga('send', 'pageview');
</script>

    </div>
  </body>
</html>
