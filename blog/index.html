<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:url" content="http://hhvm-cn.com/blog/" />
  <meta property="og:site_name" content="HHVM"/>
  <meta property="og:title" content="Blog" />
  <meta property="og:image" content="http://hhvm-cn.com/static/og_image.png" />
  <meta property="og:description" content="HHVM 中文社区和 HHVM/Hack 的博客" />

  <link rel="stylesheet" href="/css/main.css" media="screen">
  <link rel="icon" href="/static/favicon.png" type="image/x-icon">
  

  <title>Blog | HHVM</title>
  <meta name="description" content="HHVM 中文社区和 HHVM/Hack 的博客">

  <link rel="canonical" href="http://hhvm-cn.com/blog/">
  <link rel="alternate" type="application/rss+xml" title="HHVM" href="http://hhvm-cn.com/feed.xml" />
</head>

  <body class="docsNavVisible">
    <div id="fixed_header" class="fixedHeaderContainer visible">
  <div class="headerWrapper wrapper">
    <header>
      <a href="http://hhvm-cn.com/">
        <img src="/static/logo.svg">
        <h2>HHVM</h2>
      </a>

      <div class="navigationWrapper navigationFull" id="flat_nav">
        <nav class="navigation">
          <ul>
            
              <li class="navItem">
                
                  <a href="https://docs.hhvm-cn.com/hhvm/getting-started/getting-started">安装</a>
                
              </li>
            
              <li class="navItem navItemActive">
                
                  <a href="/blog/">博客</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://docs.hhvm-cn.com/hhvm/">文档</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://github.com/facebook/hhvm">GitHub</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://hacklang-cn.org/">Hack</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="https://www.facebook.com/hhvm/">Facebook</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="https://twitter.com/HipHopVM">Twitter</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://webchat.freenode.net/?channels=hhvm">IRC</a>
                
              </li>
            
              <li class="navItem">
                
                  <a href="http://hhvm.h4cc.de/">模块支持</a>
                
              </li>
            
            
          </ul>
        </nav>
      </div>
      <div class="navigationWrapper navigationSlider" id="navigation_wrap">
        <div id="header_nav">
  <div class="navSlideout">
    <i class="menuExpand" id="header_nav_expander"><span></span><span></span><span></span></i>
  </div>
  <nav class="slidingNav">
    <ul>
      
      <li class="navItem">
        <a href="https://docs.hhvm-cn.com/hhvm/getting-started/getting-started" target="_blank">安装</a>
      </li>
      
      <li class="navItem">
        <a href="/blog/">博客</a>
      </li>
      
      <li class="navItem">
        <a href="http://docs.hhvm-cn.com/hhvm/" target="_blank">文档</a>
      </li>
      
      <li class="navItem">
        <a href="http://github.com/facebook/hhvm" target="_blank">GitHub</a>
      </li>
      
      <li class="navItem">
        <a href="http://hacklang-cn.org/" target="_blank">Hack</a>
      </li>
      
      <li class="navItem">
        <a href="https://www.facebook.com/hhvm/" target="_blank">Facebook</a>
      </li>
      
      <li class="navItem">
        <a href="https://twitter.com/HipHopVM" target="_blank">Twitter</a>
      </li>
      
      <li class="navItem">
        <a href="http://webchat.freenode.net/?channels=hhvm" target="_blank">IRC</a>
      </li>
      
      <li class="navItem">
        <a href="http://hhvm.h4cc.de/" target="_blank">模块支持</a>
      </li>
      
      
    </ul>
  </nav>
</div>
<script>
  var event = document.createEvent('Event');
  event.initEvent('slide', true, true);
  document.addEventListener('slide', function (e) {
    document.body.classList.toggle('sliderActive');
  }, false);
  var headerNav = document.getElementById('header_nav');
  var headerNavExpander = document.getElementById('header_nav_expander');
  headerNavExpander.addEventListener('click', function(e) {
    headerNav.classList.toggle('navSlideoutActive');
    document.dispatchEvent(event);
  }, false);
</script>
      </div>
    </header>
  </div>
</div>

    <div class="navPusher">
      <div class="docMainWrapper wrapper">
      <div class="docsNavContainer">
  <nav class="toc" id="doc_nav">
    <div class="toggleNav" id="collection_nav">
      <section class="navWrapper wrapper">
        <div class="navBreadcrumb wrapper">
          <div class="navToggle" id="collection_nav_toggler">
            <i></i>
          </div>
          <h2>
            <a href="/blog/">Blog</a>
            
          </h2>
        </div>
        <div class="navGroups">
          
            
            
            <div class="navGroup navGroupActive navGroupCurrent">
  <h3><i>+</i><span>All Posts</span></h3>
  <ul>
    
      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/05/04/hhvm-4.56.html">HHVM 4.56</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/30/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/29/hhvm-4.55.html">HHVM 4.55</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/21/hhvm-4.54.html">HHVM 4.54</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/13/hhvm-4.53.html">HHVM 4.53</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/04/07/hhvm-4.52.html">HHVM 4.52</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/31/hhvm-4.51.html">HHVM 4.51</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/24/hhvm-4.50.html">HHVM 4.50</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/18/hhvm-4.49.html">HHVM 4.49</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/09/hhvm-4.48.html">HHVM 4.48</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/03/03/hhvm-4.47.html">HHVM 4.47</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/24/hhvm-4.46.html">HHVM 4.46</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/20/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/19/hhvm-4.45.html">HHVM 4.45</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/10/hhvm-4.44.html">HHVM 4.44</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/02/03/hhvm-4.43.html">HHVM 4.43</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/27/hhvm-4.42.html">HHVM 4.42</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/21/hhvm-4.41.html">HHVM 4.41</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/13/hhvm-4.40.html">HHVM 4.40</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/07/hhvm-4.39.html">HHVM 4.39</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2020/01/02/hhvm-4.38.html">HHVM 4.38</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/12/17/cancelling-hhvm-4.37.html">Holiday schedule: cancelling HHVM 4.37</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/12/16/hhvm-4.36.html">HHVM 4.36</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/12/10/hhvm-4.35.html">HHVM 4.35</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/12/02/hhvm-4.34.html">HHVM 4.34</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/25/hhvm-4.33.html">HHVM 4.33</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/19/hhvm-4.32.html">HHVM 4.32 (LTS)</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/19/distribution-support.html">Support lifecycle for older distributions</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/11/hhvm-4.31.html">HHVM 4.31.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/11/06/hhvm-4.30.html">HHVM 4.30.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/29/hhvm-4.29.html">HHVM 4.29.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/28/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/23/hhvm-4.28.html">HHVM 4.28</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/14/hhvm-4.27.0.html">HHVM 4.27.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/09/hhvm-4.26.0.html">HHVM 4.26.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/10/01/deprecating-references.html">Deprecating &$references</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/30/hhvm-4.25.0.html">HHVM 4.25.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/25/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/23/hhvm-4.24.0.html">HHVM 4.24.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/17/hhvm-4.23.0.html">HHVM 4.23.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/09/hhvm-4.22.0.html">HHVM 4.22.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/03/the-hhvm-4.21.0.html">HHVM 4.21.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/09/03/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/27/hhvm-4.20.0.html">HHVM 4.20.0 and 4.20.1</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/19/hhvm-4.19.0.html">HHVM 4.19.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/14/security-update.html">Security Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/12/hhvm-4.18.0.html">HHVM 4.18.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/07/bugfixes.html">Bugfixes for 3.30, 4.8, and 4.12-17</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/08/05/hhvm-4.17.0.html">HHVM 4.17.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/29/hhvm-4.16.0.html">HHVM 4.16.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/22/hhvm-4.15.0.html">HHVM 4.15.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/15/hhvm-4.14.0.html">HHVM 4.14.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/09/hhvm-4.13.0.html">HHVM 4.13.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/07/01/hhvm-4.12.0.html">HHVM 4.12.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/24/hhvm-4.11.0.html">HHVM 4.11.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/18/hhvm-4.10.0.html">HHVM 4.10.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/13/hhvm-4.9.1.html">HHVM 4.9.1, repository changes</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/10/hhvm-4.9.0.html">HHVM 4.9.0, and security updates for 3.30, and 4.3-4.7</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/06/03/hhvm-4.8.0.html">HHVM 4.8.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/05/28/hhvm-4.7.0.html">HHVM 4.7.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/05/21/hhvm-4.6.0.html">HHVM 4.6.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/05/13/hhvm-4.5.0.html">HHVM 4.5.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/05/06/hhvm-4.4.0.html">HHVM 4.4.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/04/30/hhvm-4.3.0.html">HHVM 4.3.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/04/23/hhvm-4.2.0.html">HHVM 4.2.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/04/09/hhvm-4.1.0.html">HHVM 4.1.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/04/03/hhvm-4.0.4.html">HHVM 4.0.4, 3.30.5, and 3.27.8</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/28/hhvm-4.0.3.html">HHVM 4.0.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/19/hhvm-4.0.2.html">HHVM 4.0.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/14/hhvm-4.0.1.html">HHVM 4.0.1, 3.30.4, and 3.27.7: CVE-2019-3552</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/11/hhvm-4.0.0.html">HHVM 4.0.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/02/01/hhvm-3.30.3.html">HHVM 3.30.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2019/01/14/hhvm-3.30.2.html">HHVM 3.30.2 and 3.27.6</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/12/18/hhvm-3.30.1.html">HHVM 3.30.1 and 3.27.5</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/12/17/hhvm-3.30.html">HHVM 3.30</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/10/30/hhvm-3.29.1.html">HHVM 3.29.1 and 3.27.4</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/10/22/hhvm-3.29.html">HHVM 3.29</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/10/01/hhvm-3.28.3.html">HHVM 3.28.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/09/28/hhvm-3.28.2.html">HHVM 3.28.2 and 3.27.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/09/26/introducing-hacktest.html">Introducing HackTest</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/09/12/end-of-php-support-future-of-hack.html">Ending PHP Support, and The Future Of Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/08/30/hhvm-3.28.1.html">HHVM 3.28.1</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/08/28/hhvm-3.28.0.html">HHVM 3.28.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/08/15/hhvm-3.27.2.html">HHVM 3.27.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/07/19/hhvm-3.27.1.html">HHVM 3.27.1 and 3.24.8</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/06/18/hhvm-3.27.0.html">HHVM 3.27.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/24/hhvm-3.26.3.html">HHVM 3.26.3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/15/hhvm-3.26.2.html">HHVM 3.26.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/11/hhvm-3.26.1.html">HHVM 3.26.1</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/07/hhvm-3.26.html">HHVM 3.26 - Introducing HackC</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/05/04/hhvm-3.25.3.html">HHVM 3.25.3, HHVM 3.24.7, and 3.21.11</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/04/11/relicensing-hack.html">Relicensing Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/03/30/hhvm-3.25.2.html">HHVM 3.25.2, HHVM 3.24.6, and 3.21.10 (CVE-2018-6334)</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/03/22/hhvm-3.25.1.html">HHVM 3.25.1, HHVM 3.24.5, and 3.21.9</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/03/15/hhvm-3.25.html">HHVM 3.25.0, 3.24.4, and 3.21.8</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/03/02/hhvm-3.24.3.html">HHVM 3.24.3 and 3.21.7</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/02/07/hhvm-3.24.2.html">HHVM 3.24.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/01/30/hhvm-3.24.1.html">HHVM 3.24.1, 3.21.6, and 3.18.8</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/01/16/hhvm-3.24.html">HHVM 3.24</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/01/12/hhvm-3.23.4.html">HHVM 3.23.4, 3.21.5, and 3.18.7</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2018/01/02/hhvm-3.23.3.html">HHVM 3.23.3, 3.21.4, and 3.18.6</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/11/17/hhvm-3-23.html">HHVM 3.23</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/11/14/gpg-key-migration.html">GPG Key Migration</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/10/26/the-hack-standard-library-1-0.html">The Hack Standard Library: v1.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/09/26/hhvm-3-22.html">HHVM 3.22</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/09/18/the-future-of-hhvm.html">The Future of HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/08/02/hhvm-3-21.html">HHVM 3.21</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/06/07/hhvm-3-20.html">HHVM 3.20</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/04/13/hhvm-3-19.html">HHVM 3.19</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/03/23/concurrent-jit-compilation.html">Concurrent JIT Compilation</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/03/09/how-the-cyber-elephant-got-his-arm.html">How the Cyber-Elephant Got His ARM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/02/17/region-jit.html">HHVM's Profile-guided Region JIT</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/02/15/hhvm-3-18.html">HHVM 3.18</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2017/01/26/new-year-new-me.html">New Year, New Me</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/11711/hhvm-3-15">HHVM 3.15</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10925/improved-user-documentation">Improved User Documentation</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10859/php-7-support">PHP 7 Support</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10649/improving-arrays-in-hack">Improving Arrays in Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10205/llvm-code-generation-in-hhvm">LLVM Code Generation in HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10379/hhvm-3-10-0">HHVM 3.10.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/10043/experimental-mac-os-x-support">Experimental Mac OS X Support</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9995/hhvm-3-9-0">HHVM 3.9.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9803/hhvm-3-8-0">HHVM 3.8.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9773/cve-2015-4663">CVE-2015-4663</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9581/trait-and-interface-requirements-in-hack">Trait and interface requirements in Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9293/lockdown-results-and-hhvm-performance">Lockdown Results and HHVM Performance</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9215/covariance-contravariance-and-super-type-constraints">Covariance, Contravariance, and super Type Constraints</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9089/hhvm-lockdown">HHVM Lockdown</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/9059/hhvm-3-7-0">HHVM 3.7.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8981/announcing-our-book-hack-hhvm">Announcing our book: “Hack & HHVM”</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8939/etsys-transition-to-hhvm">Etsy's Transition to HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8849/hhvm-3-6-0">HHVM 3.6.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8537/announcing-a-specification-for-hack">Announcing a Specification for Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/8405/coming-soon-in-hhvm">Coming Soon in HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/7637/hhvm-3-5-0">HHVM 3.5.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/7205/wikipedia-on-hhvm">Wikipedia on HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/7349/lts-updates">LTS Updates</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/7091/async-cooperative-multitasking-for-hack">Async - Cooperative Multitasking for Hack</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6989/wp-engine-and-box-now-use-hhvm">WP Engine and Box now use HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6899/hhvm-3-4-0">HHVM 3.4.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6863/announcing-the-hack-transpiler">Announcing the Hack Transpiler</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6473/hack-overriding-constructors-new-static-and-__consistentconstruct">Hack: Overriding Constructors, "new static", and __ConsistentConstruct</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6767/hhvm-3-3-1">HHVM 3.3.1</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6515/using-xhp-with-bootstrap">Using XHP with Bootstrap</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6443/hack-recent-updates">Hack: Recent Updates</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6323/the-journey-of-a-thousand-bytecodes">The Journey of a Thousand Bytecodes</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6239/hhvm-3-3-0">HHVM 3.3.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6083/hhvm-long-term-support">HHVM Long Term Support</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/6005/hack-community-roundup-3">Hack Community Roundup #3</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5723/announcing-a-specification-for-php">Announcing a specification for PHP</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5609/hhvm-3-2-0">HHVM 3.2.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5399/faster-github-commits">Faster GitHub Commits</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5429/hack-community-roundup-2">Hack Community Roundup #2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/5195/hhvm-3-1-0">HHVM 3.1.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4811/hack-community-roundup">Hack Community Roundup</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4841/compatibility-update">Compatibility Update</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4685/hack-developer-day-2014-keep-hacking">Hack Developer Day 2014: Keep Hacking</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4601/debug-packages">Debug Packages</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4349/hhvm-3-0-0">HHVM 3.0.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4325/hacking-hack-on-heroku">Hacking Hack on Heroku</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4223/introducing-hack-a-programming-language-for-hhvm">Introducing Hack - A Programming Language for HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4103/hhvm-2-4-2">HHVM 2.4.2</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3611/tracking-parity">Tracking Parity</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3689/implementing-mysqli">Implementing MySQLi</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3743/hhvm-the-next-six-months">HHVM: The Next Six Months</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3287/hhvm-2-4-0">HHVM 2.4.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3203/nightly-packages">Nightly Packages</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2813/we-are-the-98-5-and-the-16">We are the 98.5% (and the 16%)</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/1817/fastercgi-with-hhvm">FasterCGI with HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2393/hhvm-2-3-0-and-travis-ci">HHVM 2.3.0 and Travis CI</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/2027/faster-and-cheaper-the-evolution-of-the-hhvm-jit">Faster and Cheaper: The Evolution of the hhvm JIT</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/1499/locking-down-for-performance-and-parity">Locking Down for Performance and Parity </a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/1379/hhvm-on-heroku">HHVM on Heroku</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/1301/hhvm-2-2-0">HHVM 2.2.0</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/875/wow-hhvm-is-fast-too-bad-it-doesnt-run-my-code">Wow HHVM is fast...too bad it doesn’t run my code</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/713/hhvm-optimization-tips">HHVM Optimization Tips</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/575/joining-retirement-testing-and-bankruptcy">Joining, Retirement, Testing, and Bankruptcy</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/521/the-adminserver">The AdminServer</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/431/on-garbage-collection">On Garbage Collection</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/401/spammers-are-still-a-thing-it-seems">Spammers are still a thing, it seems</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/311/adding-an-opcode-to-hhbc">Adding an opcode to HHBC</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/4061/go-faster">Go Faster!</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3095/getting-wordpress-running-on-hhvm">Getting WordPress running on HHVM</a></li>

      
      <li class="navListItem"><a class="navItem" href="http://hhvm-cn.com/blog/3089/wordpress-3-4-2-running-on-hiphop-hhvm">WordPress 3.4.2 running on HHVM</a></li>

      
    
  </ul>
</div>
          
        </div>
      </section>
    </div>
  </nav>
</div>
<script>
  var docsevent = document.createEvent('Event');
  docsevent.initEvent('docs_slide', true, true);
  document.addEventListener('docs_slide', function (e) {
    document.body.classList.toggle('docsSliderActive');
  }, false);

  var collectionNav = document.getElementById('collection_nav');
  var collectionNavToggler = 
    document.getElementById('collection_nav_toggler');
  collectionNavToggler.addEventListener('click', function(e) {
    collectionNav.classList.toggle('toggleNavActive');
    document.dispatchEvent(docsevent);
  });

  var groups = document.getElementsByClassName('navGroup');
  for(var i = 0; i < groups.length; i++) {
    var thisGroup = groups[i];
    thisGroup.onclick = function() {
      for(var j = 0; j < groups.length; j++) {
        var group = groups[j];
        group.classList.remove('navGroupActive');
      }
      this.classList.add('navGroupActive');
    }
  }
</script>


      <div class="mainContainer blogContainer postContainer">
  <div id="main_wrap" class="wrapper mainWrapper">
    <div class="posts">
  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/05/04/hhvm-4.56.html">HHVM 4.56</a></h1>
    <p class="post-meta">发布于 2020 年 5 月 4 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.56 发布了！这个版本是 LTS 长期支持版本，因此:</p>

<ul>
  <li>这个版本将提供大约 48 个星期的支持；</li>
  <li>下一个 LTS 版本将在大约 24 个星期内发布；</li>
  <li>我们将继续支持 HHVM 4.32 (LTS) 和 HHVM 4.51–4.55 版本；</li>
  <li>我们已结束对 HHVM 4.8 (LTS) 版本的支持。</li>
</ul>

<p>HHVM 4.56 是最新版本，支持多个较旧的 Linux 发行版和 MacOS 系统。需要注意的是，我们希望这将是最后一次支持 Ubuntu 16.04 (Xenial)，Debian 8 (Jessie) 和 Debian 9 (Stretch) 系统的更新。如果你想了解详细的信息，请阅读下文中的「更新计划」部分。</p>

<h1 id="亮点聚焦">亮点聚焦</h1>

<ul>
  <li>现在已经将 <code class="highlighter-rouge">apc_fetch()</code> 的过期时间推迟到看到过期结果的第一个请求结束的时候；这个请求会返回 <code class="highlighter-rouge">false</code>，但是在第一个请求完成之前，并发请求得到的都是旧值。这个更新的目的是减少当多个请求同时尝试刷新一个 hot key 时引起的<a href="https://zh.wikipedia.org/wiki/%E6%83%8A%E7%BE%A4%E9%97%AE%E9%A2%98">「惊群问题」</a>。</li>
</ul>

<h1 id="重大改动">重大改动</h1>

<ul>
  <li>HHI 的定义中已经移除了 <code class="highlighter-rouge">\HH\INCORRECT_TYPE&lt;T&gt;</code>。</li>
  <li>从 HHVM 和语法分析器中已经移除了对 <code class="highlighter-rouge">__get</code>，<code class="highlighter-rouge">__set</code>，<code class="highlighter-rouge">__isset</code>，和 <code class="highlighter-rouge">__unset</code> 的支持。但是实现了新的内置类，可以通过固定属性名调用它们。</li>
  <li>已经移除了 Redis 拓展。这个扩展不包含任何原生代码，所以可以从旧的 HHVM 版本中提取出来，尽管我们不建议把它作为一个独立的库进行更新，但是如果需要的话，你也可以这样做。</li>
</ul>

<h1 id="更新计划">更新计划</h1>

<p><a href="https://hhvm-cn.com/blog/2019/11/19/distribution-support.html">正如11月宣布的那样</a>，
我们正在改变我们对各种系统支持的生命周期，从 Nightly 版本到下一次更新发布过程中：</p>

<ul>
  <li>MacOS：我们的目标是支持最新稳定版本的系统 —— 当前为 Catalina（版本10.15）。当新版本的 MacOS 发布后，我们计划在接下来的6个月中同时支持这两个版本的系统。</li>
  <li>Debian：我们的目标是支持 Debian 稳定版。当新版本成为稳定版本后，我们计划在接下来的6个月中同时支持这两个版本的系统。</li>
  <li>Ubuntu LTS：我们的目标是支持当前的 LTS 版本（20.04）；当新版本的 Ubuntu LTS 发布后，我们计划在接下来的6个月中同时支持这两个版本的系统。</li>
  <li>Ubuntu「临时」版本：我们计划和 Canonical 支持它们的时间一样，在9个月内支持这些版本。</li>
</ul>

<p>在官方原始仓库中提供了依赖项之后，我们计划先打包 <code class="highlighter-rouge">x.y.0</code> 版本，然后针对其他 Linux 发行版打包成 <code class="highlighter-rouge">x.y.z</code> 发布；如果我们有 MacOS 系统的版本，我们也会为 MacOS 打包。</p>

<p>具体而言，这意味着我们不再继续支持以下版本的系统：</p>

<ul>
  <li>Debian 8 (Jessie)</li>
  <li>Debian 9 (Stretch)</li>
  <li>Ubuntu 16.04 (Xenial)</li>
  <li>MacOS 10.14 (Mojave)</li>
</ul>

<p>如果这些我们不再支持的系统可以继续运行，并且不会阻碍我们的开发，我们也会继续为它们构建软件包。也就是说，从 4.57 版本开始，我们将会立即停止对以下包含 GCC6 或更低版本系统的支持：</p>

<ul>
  <li>Debian 8 (Jessie)</li>
  <li>Debian 9 (Stretch).</li>
  <li>Ubuntu 16.04 (Xenial)</li>
</ul>

<p>其他我们不再支持的发行版可能会在没有通知的情况下，从以后更新的版本中移除。</p>

<hr />

<blockquote>
  <p><em>本文由 <a href="https://github.com/Evilran">Evilran</a> 翻译</em></p>
</blockquote>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/04/30/security-update.html">Security Update</a></h1>
    <p class="post-meta">发布于 2020 年 4 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A security update has been released for all supported HHVM versions. Please
update to one of the following versions to make sure you’re secure:</p>

<ul>
  <li>4.8.8</li>
  <li>4.32.2</li>
  <li>4.49.1</li>
  <li>4.50.1</li>
  <li>4.51.1</li>
  <li>4.52.2</li>
  <li>4.53.1</li>
  <li>4.54.1</li>
  <li>4.55.1</li>
</ul>

<p>This security update addresses the following vulnerabilities:</p>

<ul>
  <li>If the
<a href="https://github.com/facebook/hhvm/commit/c59a087967633a37c8cd2389d38a0fb7904428e1">GlobalDocument</a>
request routing mode is used, it is possible to infer
the existence of arbitrary source code directories.
This issue doesn’t affect HHVM 4.8, since it doesn’t support GlobalDocument.</li>
</ul>

<p>The following were originally reported as PHP vulnerabilities, but HHVM is also affected:</p>

<ul>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9638">CVE-2019-9638</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9639">CVE-2019-9639</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9640">CVE-2019-9640</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11034">CVE-2019-11034</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11038">CVE-2019-11038</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11041">CVE-2019-11041</a></li>
  <li>possible buffer overrun in <code class="highlighter-rouge">exif_read_data()</code></li>
  <li>possible buffer overrun in <code class="highlighter-rouge">socket_sendto()</code></li>
  <li><code class="highlighter-rouge">sodium_crypto_generichash_init()</code>
<a href="https://bugs.php.net/bug.php?id=78510">leaks data</a> from uninitialized memory</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/04/29/hhvm-4.55.html">HHVM 4.55</a></h1>
    <p class="post-meta">发布于 2020 年 4 月 29 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.55 is released! This release marks the end of support for 4.49;
HHVM 4.50–4.54 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>We now also build binary packages for Ubuntu 20.04.</li>
  <li>Improved typechecker error messages for various cases where a subclass
incorrectly overrides a method or property from a parent class.</li>
  <li>Fixed a bug that would cause the typechecker to report some instance variables
or static variables as uninitialized, even if they are nullable.
    <ul>
      <li>Instance/class variables
must be initialized either as part of the variable’s declaration or inside
the class’ constructor, but only if they are non-nullable. The typechecker
would previously not correctly detect all nullable variables when generics
or type aliases were involved.</li>
    </ul>
  </li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Comparing Hack arrays (<code class="highlighter-rouge">vec</code>, <code class="highlighter-rouge">dict</code>, <code class="highlighter-rouge">keyset</code>) to <code class="highlighter-rouge">true</code>, <code class="highlighter-rouge">false</code>, and <code class="highlighter-rouge">null</code>
with the “fuzzy” equality operators (<code class="highlighter-rouge">==</code>, <code class="highlighter-rouge">!=</code>) now considers non-empty Hack arrays <code class="highlighter-rouge">== true</code>, and empty Hack arrays <code class="highlighter-rouge">== false</code> and <code class="highlighter-rouge">== null</code>.
    <ul>
      <li>In HHVM 4.49 to 4.54, the INI option
<code class="highlighter-rouge">hhvm.hack_arr_empty_based_bool_eq_cmp=true</code> can be used to enable this
behavior.</li>
      <li>The new behavior is consistent with legacy arrays, making it easier to
migrate to Hack arrays.</li>
    </ul>
  </li>
  <li>The typechecker no longer completely ignores arguments of calls on values of type
<a href="https://docs.hhvm.com/hack/built-in-types/nothing"><code class="highlighter-rouge">nothing</code></a>. As before, any number/types of arguments are allowed (due to <code class="highlighter-rouge">nothing</code> being Hack’s bottom
type), but previously ignored nonsensical arguments like <code class="highlighter-rouge">1 + 'foo'</code> are now rejected.</li>
  <li>The <code class="highlighter-rouge">%s</code> placeholder in <code class="highlighter-rouge">printf()</code> now expects an <code class="highlighter-rouge">?arraykey</code> argument instead
of <code class="highlighter-rouge">mixed</code>.
    <ul>
      <li>In the future, we expect implicit string casts on arrays and objects to
raise exceptions. This change should make it easier to find such dangerous
casts earlier.</li>
      <li><code class="highlighter-rouge">Str\format()</code> is unchanged, it has always expected a <code class="highlighter-rouge">string</code> argument.</li>
    </ul>
  </li>
  <li>Boolean <code class="highlighter-rouge">.hhconfig</code> options now treat the value <code class="highlighter-rouge">2</code> (as well as any other
value except <code class="highlighter-rouge">1</code>/<code class="highlighter-rouge">true</code>/<code class="highlighter-rouge">yes</code>/<code class="highlighter-rouge">on</code>) as <code class="highlighter-rouge">false</code>. Previously, the behavior was
not consistent across all boolean options, sometimes all positive numbers
were treated as <code class="highlighter-rouge">true</code>.
    <ul>
      <li>This is most likely to affect options that previously had <code class="highlighter-rouge">2</code> as a valid
value, but later became boolean options (a somewhat common pattern).</li>
    </ul>
  </li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/04/21/hhvm-4.54.html">HHVM 4.54</a></h1>
    <p class="post-meta">发布于 2020 年 4 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.54 is released! This release marks the end of support for 4.48;
HHVM 4.49–4.53 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li><code class="highlighter-rouge">inout</code> parameters on async functions now only raise a parse error, instead
of a parse error and a NastCheck error.</li>
  <li>improved accuracy of line numbers for errors or backtraces within <code class="highlighter-rouge">concurrent</code>
blocks</li>
  <li>The <code class="highlighter-rouge">ignored_fixme_codes</code> (errors that can not be suppresed) hack option is
no longer respected for HHI files; this allows projects to use a stricter
list than is compatible with builtins.</li>
  <li>If using CLI server mode, a warning is now logged if the CLI client does not
recognize a command sent to the CLI server. We <strong>strongly</strong> recommend using
the <code class="highlighter-rouge">hhvm.check_cli_client_commands=2</code> INI setting to raise an error instead:
these warnings indicate a bug in HHVM, and can not be safely recovered from.
If you see this warning, please file a bug report. It can also be set to <code class="highlighter-rouge">0</code>
to disable the warnings. Any value other than <code class="highlighter-rouge">2</code> leads to undefined behavior
in this error case.</li>
  <li>Increased the efficiency of <code class="highlighter-rouge">idx()</code> and array access on empty containers.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Containers are now more consistently checked for valid <code class="highlighter-rouge">arraykey</code>s; this
behavior can be enabled on old releases with the
<code class="highlighter-rouge">disallow_invalid_arraykey=true</code> <code class="highlighter-rouge">.hhconfig</code> setting.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>The <code class="highlighter-rouge">hhvm.check_cli_client_commands</code> INI setting will default to <code class="highlighter-rouge">2</code> (error)
in a future release.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/04/13/hhvm-4.53.html">HHVM 4.53</a></h1>
    <p class="post-meta">发布于 2020 年 4 月 13 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.53 is released! This release marks the end of support for 4.47;
HHVM 4.48–4.52 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>We now build binary packages for Ubuntu 19.10. Packages for Ubuntu 20.04
should become available after its final release.</li>
  <li>The type-checker now provides more helpful error messages when cyclic shape
type aliases are detected, pointing out both the invalid type alias and the
cause of the cycle.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">?&gt;</code> can no longer be used to terminate <code class="highlighter-rouge">//</code> comments (<code class="highlighter-rouge">?&gt;</code> for all other
purposes was removed in HHVM 4.52)</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/04/07/hhvm-4.52.html">HHVM 4.52</a></h1>
    <p class="post-meta">发布于 2020 年 4 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.52 is released! This release marks the end of support for 4.46;
HHVM 4.47–4.51 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<p>HHVM 4.52.1 fixes a regression introduced in 4.52.0, which made the typechecker
report Hack parse errors in PHP code, instead of ignoring actual PHP source
files.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>fixed crash in <code class="highlighter-rouge">ext_soap</code> if a SoapServer’s handler class does not exist.</li>
  <li><code class="highlighter-rouge">?&gt;</code> and <code class="highlighter-rouge">&lt;?=</code> are no longer recognized by the parser; this has replaced
dedicated errors with parse errors.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>it is now a type error to <code class="highlighter-rouge">use</code> the same trait twice in the same class; using
the same trait in related classes (e.g. subclasses and parents) is still
permitted.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>Runtime support for casting objects to strings via <code class="highlighter-rouge">__toString</code> will be
removed shortly; this includes <code class="highlighter-rouge">(string) $obj</code>, <code class="highlighter-rouge">print($obj)</code>,
<code class="highlighter-rouge">sprintf('%s', $obj)</code> among others. The
<code class="highlighter-rouge">hhvm.notice_on_implicit_invoke_to_string</code> INI setting can be used to find
calls that will break.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/03/31/hhvm-4.51.html">HHVM 4.51</a></h1>
    <p class="post-meta">发布于 2020 年 3 月 31 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.51 is released! This release marks the end of support for 4.45;
HHVM 4.46–4.50 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>A new method <code class="highlighter-rouge">getEnumUnderlyingType()</code> was added to <code class="highlighter-rouge">ReflectionClass</code>. It
returns the underlying type of the enum’s values (usually <code class="highlighter-rouge">HH\int</code> or
<code class="highlighter-rouge">HH\string</code>, but can also be the name of another enum, type alias, or
<code class="highlighter-rouge">HH\arraykey</code>).
    <ul>
      <li>If the <code class="highlighter-rouge">ReflectionClass</code> instance doesn’t represent an enum, the method
throws.</li>
    </ul>
  </li>
  <li>Improved optimization of async tail calls (<code class="highlighter-rouge">return await ...</code>) can
significantly improve performance of code that uses a lot of such calls.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Using the array-appending operator <code class="highlighter-rouge">[]</code> on a <code class="highlighter-rouge">Map</code> object
(<code class="highlighter-rouge">$map[] = Pair {$key, $value};</code>) is now a type-checker error.
    <ul>
      <li>Use <code class="highlighter-rouge">$map[$key] = $value;</code> instead.</li>
      <li>The runtime still allows both variants, so <code class="highlighter-rouge">HH_FIXME</code> can be used
temporarily, to help migrating code. Runtime support will likely be removed
in a future release.</li>
    </ul>
  </li>
  <li>The type-checker no longer supports the
<a href="https://www.php.net/manual/en/language.oop5.overloading.php#object.call">“magic method” <code class="highlighter-rouge">__call</code></a>,
so calling any method that is not explicitly declared is now a type-checker
error.
    <ul>
      <li>Runtime behavior is unchanged, so <code class="highlighter-rouge">HH_FIXME</code> can be used temporarily, to
help migrating code. Runtime support will likely be removed in a future
release.</li>
      <li>In the long term, we recommend migrating any affected code to only call
explicitly declared methods.</li>
    </ul>
  </li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>We expect the removed type-checker features listed above to also be removed
from the runtime in a future release.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/03/24/hhvm-4.50.html">HHVM 4.50</a></h1>
    <p class="post-meta">发布于 2020 年 3 月 24 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.50 is released! This release marks the end of support for 4.44;
HHVM 4.45–4.49 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<p>Additionally, we are no longer building binary packages for MacOS High Sierra
for any version of HHVM, as High Sierra is no longer offered by our build
infrastructure provider.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>added the <code class="highlighter-rouge">hhvm.hack_arr_is_shape_tuple_notices</code> INI setting, which raises
a notice on <code class="highlighter-rouge">$dict is shape()</code> and <code class="highlighter-rouge">$vec is tuple()</code>; these are currently
always false, but may be true in the future, so are unsafe to depend on.</li>
  <li><code class="highlighter-rouge">HH\BuiltinEnum&lt;T&gt;</code> is now covariant.</li>
  <li>Improve hackfmt’s range formatting when suppressions outside the requested
range affect code within the requested range.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>magic methods (<code class="highlighter-rouge">__get</code>, <code class="highlighter-rouge">__set</code>, <code class="highlighter-rouge">__isset</code>, <code class="highlighter-rouge">__unset</code>) have been removed from
the typechecker definitions of builtins, such as the XMLReader, Imagick,
DateTime, and SimpleXML extensions.</li>
  <li>it is now a type error to use argument unpacking when invoking a default
constructor. It was already an error to make a variadic call to functions that
take exactly zero arguments, and as default constructors always have exactly
zero arguments, this makes the behavior consistent. This was previously
a runtime error.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li><code class="highlighter-rouge">array()</code> literals will be removed; the <code class="highlighter-rouge">hhvm.hack.lang.disable_array=true</code>
INI setting can be used to enable a runtime fatal when they are used, in
addition to the preexisting <code class="highlighter-rouge">disallow_array_literal=true</code> <code class="highlighter-rouge">.hhconfig</code> option.</li>
  <li>The magic methods on builtins that were removed from the typechecker in this
release will be removed from the runtime in a future release.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/03/18/hhvm-4.49.html">HHVM 4.49</a></h1>
    <p class="post-meta">发布于 2020 年 3 月 18 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.49 is released! This release marks the end of support for 4.43;
HHVM 4.44–4.48 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>New <code class="highlighter-rouge">.hhconfig</code> option <code class="highlighter-rouge">disable_modes</code> (previously <code class="highlighter-rouge">disable_partial</code>) will
cause the typechecker to treat all files as strict (comments after <code class="highlighter-rouge">&lt;?hh</code>
no longer have special meaning).
    <ul>
      <li>The default value will be <code class="highlighter-rouge">false</code> for the foreseeable future.</li>
    </ul>
  </li>
  <li>New <code class="highlighter-rouge">hackfmt</code> flag <code class="highlighter-rouge">--format-generated-code</code> can be used to format generated
and partially generated files.</li>
  <li>Fixed a bug that could cause part of <code class="highlighter-rouge">hackfmt</code> output to be missing when
formatting partially generated files, and other minor fixes and improvements
for <code class="highlighter-rouge">hackfmt</code>.</li>
  <li>Fixed a bug that could prevent the “go to type” IDE feature from working
inside async functions.</li>
  <li>Improved various typechecker error messages, e.g. when accessing an optional
shape field it now recommends using <code class="highlighter-rouge">Shapes::idx</code> instead of <code class="highlighter-rouge">??</code>.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Comparing (<code class="highlighter-rouge">&lt;</code>, <code class="highlighter-rouge">&gt;</code>, <code class="highlighter-rouge">&lt;=</code>, <code class="highlighter-rouge">&gt;=</code>, <code class="highlighter-rouge">&lt;=&gt;</code>) a legacy PHP array with a non-array
now throws <code class="highlighter-rouge">InvalidOperationException</code> (previously only raised a Notice). It
had already been a typechecker error.</li>
  <li>It is now a runtime error if <code class="highlighter-rouge">class_meth</code> is used with arguments that are not
a <code class="highlighter-rouge">::class</code> and a string literal (a string literal as the 1st argument will
also not cause a runtime error, but <code class="highlighter-rouge">::class</code> literal is recommended). It had
already been a typechecker error.
    <ul>
      <li>If a dynamic pointer is required, annotate the method with
<code class="highlighter-rouge">&lt;&lt;__DynamicallyCallable&gt;&gt;</code> and use <code class="highlighter-rouge">HH\dynamic_class_meth()</code>.</li>
    </ul>
  </li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>We are working towards deprecating (and eventually removing from the language)
<a href="https://www.php.net/manual/en/language.oop5.magic.php">“magic methods”</a>
such as <code class="highlighter-rouge">__call</code> or <code class="highlighter-rouge">__get</code>. Currently, you can use the INI option
<code class="highlighter-rouge">hhvm.no_use_magic_methods=true</code> to trigger warnings whenever a magic method
is invoked, e.g. when an undefined method is called on a class that has the
<code class="highlighter-rouge">__call</code> magic method.</li>
  <li>Comparing Hack arrays to <code class="highlighter-rouge">true</code>, <code class="highlighter-rouge">false</code>, and <code class="highlighter-rouge">null</code> with the “fuzzy” equality
operators (<code class="highlighter-rouge">==</code>, <code class="highlighter-rouge">!=</code>) will be changed so that non-empty Hack arrays are
<code class="highlighter-rouge">== true</code> and empty Hack arrays are <code class="highlighter-rouge">== false</code> and <code class="highlighter-rouge">== null</code>.
    <ul>
      <li>The INI option <code class="highlighter-rouge">hhvm.hack_arr_empty_based_bool_eq_cmp=true</code> can be used to
enable this behavior now.</li>
      <li>The new behavior is consistent with legacy arrays, making it easier to
migrate to Hack arrays.</li>
    </ul>
  </li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/03/09/hhvm-4.48.html">HHVM 4.48</a></h1>
    <p class="post-meta">发布于 2020 年 3 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.48 is released! This release marks the end of support for 4.42;
HHVM 4.43–4.47 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>If a non-abstract class contains an abstract method, report the error at the
location of the class name (where the <code class="highlighter-rouge">abstract</code> modifier should be), instead
of at the function declaration.</li>
  <li>Some error code suppressions apply to line ranges, instead of nodes. <code class="highlighter-rouge">hackfmt</code>
will now ignore any code in such a range, as formatting it could un-suppress
errors.</li>
  <li>If a file generated by <code class="highlighter-rouge">hack-codegen</code> is partially generated, <code class="highlighter-rouge">hackfmt</code> will
only format the manual sections.</li>
  <li><code class="highlighter-rouge">hackfmt</code> will not modify files containing <code class="highlighter-rouge">@generated</code>.</li>
  <li>Updated and clarified error message for private methods - now “must be public
or protected”, previously (incorrectly) “Access type […] must be omitted”.</li>
  <li><code class="highlighter-rouge">hh_client lsp --config</code> now accepts <code class="highlighter-rouge">.hhconfig</code> settings, in addition to
<code class="highlighter-rouge">hh.conf</code> (system-wide) settings.</li>
  <li>Error for unitialized members now suggest making the property “nullable”
instead of “optional”, to avoid confusion with shape terminology.</li>
  <li>Suggest using <code class="highlighter-rouge">$x is SomeEnum</code> if an exhaustive switch statement contains a
<code class="highlighter-rouge">default:</code> block.</li>
  <li>The CLI client/server protocol version has changed; if you have configured
CLI client/server and deploy them separately, this may lead to fallback to
standalone CLI mode.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>It is again an error to have a default case in exhaustive <code class="highlighter-rouge">switch ($enum)</code>
blocks; while the enum is not enforced at runtime, we feel this behavior is
better as it raises an error when the enum is expanded but switch statements
are not. Note that a switch statement that does not match (no matching case,
no <code class="highlighter-rouge">default</code>) are still expected to throw an exception in a future release, or
now with the <code class="highlighter-rouge">hhvm.throw_on_non_exhaustive_switch=2</code> setting.</li>
  <li><code class="highlighter-rouge">HHVM_VERSION_ID</code> is of the form <code class="highlighter-rouge">XXYYYZZ</code> instead of <code class="highlighter-rouge">XXYYZZ</code>; if you are
extracting parts, please use the <code class="highlighter-rouge">HHVM_VERSION_MAJOR</code>, <code class="highlighter-rouge">HHVM_VERSION_MINOR</code>,
and <code class="highlighter-rouge">HHVM_VERSION_PATCH</code> constants instead.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>added <code class="highlighter-rouge">disable_partial</code> (will be renamed <code class="highlighter-rouge">disable_modes</code> shortly) - a boolean flag that disables partial mode (and all other modes!) from Hack completely. Comments after the <code class="highlighter-rouge">&lt;?hh</code> are just comments, and non-hhi files are inherently strict. The default value will be false for the foreseeable future.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/03/03/hhvm-4.47.html">HHVM 4.47</a></h1>
    <p class="post-meta">发布于 2020 年 3 月 3 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.47 is released! This release marks the end of support for 4.41;
HHVM 4.42–4.46 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>We’re looking to help people migrate towards strictness! Part of that is a
series of <code class="highlighter-rouge">.hhconfig</code> flags:
    <ul>
      <li><code class="highlighter-rouge">ignored_fixme_codes</code>: a comma delimited list of error codes (4110, 2071,
etc.) that allow you to gradually forbid HH_FIXMEs in your codebase. Hack
will ignore any HH_FIXME or HH_IGNORE_ERROR with the specified codes. An
empty list is the default, meaning only the hardcoded unfixmeable codes (see
<a href="https://github.com/facebook/hhvm/blob/master/hphp/hack/src/errors/errors.ml#L702">default_ignored_fixme_codes in errors.ml</a>)
are forbidden.</li>
      <li><code class="highlighter-rouge">disallowed_decl_fixmes</code>: a comma delimited list of error codes (4110,
2071, etc.) that allow you to gradually forbid HH_FIXMEs in your codebase.
Hack will ignore any HH_FIXME or HH_IGNORE_ERROR outside of the body of a
function with the specified codes. Declaration-level FIXMEs tend to
obscure more errors than intended, so tend to be more important to fix up.</li>
      <li><code class="highlighter-rouge">error_codes_treated_strictly</code>: a comma delimited list of error codes
(4110, 2071, etc.) that allow you to gradually forbid HH_FIXMEs in your
codebase. Partial mode files accept a number of errors that are not
allowed in strict mode. If an error is in this list, we will report it as
an error—even in a partial mode file. Not every error and position
can be reported clearly though. Certain errors (like missing types) can
cascade into other code, yielding other error codes or being hidden by
partial mode. Still, this list can provide a means to incrementally fix
things in partial mode files without strictifying the whole file. The
default is an empty list, which uses the normal partial/strict modes.</li>
    </ul>
  </li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Trying to declare a function, constant, or enum type with the same name as a
preceeding <code class="highlighter-rouge">use function</code>, <code class="highlighter-rouge">use const</code>, or <code class="highlighter-rouge">use type</code> declaration is now a
parser error.
    <ul>
      <li>It had already been a runtime error.</li>
      <li>This makes the behavior consistent with classes, where it was already a
parser error.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">namespace</code> is now a reserved keyword, trying to use it as an identifier will
result in a parser error.
    <ul>
      <li>It had already been a runtime error.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">HHVM_VERSION_ID</code> is now <code class="highlighter-rouge">XXYYYZZ</code> instead of <code class="highlighter-rouge">XXYYZZ</code>.
    <ul>
      <li>This preserves compatibility for comparisons using <code class="highlighter-rouge">&lt;</code>/<code class="highlighter-rouge">&gt;</code>, but breaks any
code trying to parse <code class="highlighter-rouge">HHVM_VERSION_ID</code> into individual parts.</li>
      <li>Use the new constants <code class="highlighter-rouge">HHVM_VERSION_MAJOR</code>, <code class="highlighter-rouge">HHVM_VERSION_MINOR</code>,
<code class="highlighter-rouge">HHVM_VERSION_PATCH</code> (added in HHVM 4.42) instead of parsing the value.</li>
    </ul>
  </li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>Support for XHP <code class="highlighter-rouge">children</code> declarations will be removed.
    <ul>
      <li>The <code class="highlighter-rouge">XHPChildValidation</code> trait from
<a href="https://github.com/hhvm/xhp-lib/releases/tag/v3.1.1">xhp-lib v3.1</a>
should be used instead, see
<a href="https://hhvm.com/blog/2020/02/24/hhvm-4.46.html#future-changes">HHVM 4.46 release notes</a>
for more information and migration instructions.</li>
      <li>New <code class="highlighter-rouge">.hhconfig</code> option <code class="highlighter-rouge">disable_xhp_children_declarations=true</code> can be used
to get the future behavior now.</li>
    </ul>
  </li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/02/24/hhvm-4.46.html">HHVM 4.46</a></h1>
    <p class="post-meta">发布于 2020 年 2 月 24 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.46 is released! This release marks the end of support for 4.40;
HHVM 4.41–4.45 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>clearer error message for unsuitably different expression types in
<code class="highlighter-rouge">case foo_expr:</code> vs <code class="highlighter-rouge">switch(bar_expr)</code></li>
  <li>removed typechecker error for ‘exhaustive’ enum switch statements with a
<code class="highlighter-rouge">default</code> case; as enums are not enforced at runtime, these defaults are
not strictly unreachable.</li>
  <li>added <code class="highlighter-rouge">HH\autoload_get_paths()</code>, returning a list of all files known to the
autoloader.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>Support for XHP <code class="highlighter-rouge">children</code> declarations will be removed; special syntax is no
longer required to support this feature, and allows more easily making it
compatible with the main XHP type system.
    <ul>
      <li><a href="https://github.com/hhvm/xhp-lib/releases/tag/v3.1.0">xhp-lib v3.1</a> provides
the new implementation, via two traits:
        <ul>
          <li><code class="highlighter-rouge">XHPChildDeclarationConsistencyValidation</code> requires that the new and old
forms of child declaration are equivalent</li>
          <li><code class="highlighter-rouge">XHPChildValidation</code> requires that only a new declaration is present</li>
        </ul>
      </li>
      <li><a href="https://github.com/hhvm/hhast/releases/tag/v4.33.7">hhast-migrate v4.33.7</a>
adds <code class="highlighter-rouge">--add-xhp-children-declaration-method</code> and
<code class="highlighter-rouge">--remove-xhp-child-declarations</code></li>
    </ul>
  </li>
  <li>After support for XHP <code class="highlighter-rouge">children</code> declarations is completely removed, we expect
to remove support for XHP <code class="highlighter-rouge">category</code> declarations: they are only used with
children declarations, and by moving children declarations to standard Hack
code, they can be replaced with normal interfaces.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/02/20/security-update.html">Security Update</a></h1>
    <p class="post-meta">发布于 2020 年 2 月 20 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A security update has been released for all supported HHVM versions. Please
update to one of the following versions to make sure you’re secure:</p>

<ul>
  <li>4.8.7</li>
  <li>4.32.1</li>
  <li>4.38.1</li>
  <li>4.39.1</li>
  <li>4.40.1</li>
  <li>4.41.1</li>
  <li>4.42.1</li>
  <li>4.43.1</li>
  <li>4.44.1</li>
  <li>4.45.1</li>
</ul>

<p>This security update addresses vulnerabilies in JSON decoding:</p>

<ul>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1888">CVE-2020-1888</a>:
Insufficient boundary checks when decoding JSON in handleBackslash reads out
of bounds memory, potentially leading to DOS.</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1892">CVE-2020-1892</a>:
Insufficient boundary checks when decoding JSON in JSON_parser allows read
access to out of bounds memory, potentially leading to information leak and
DOS.</li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1893">CVE-2020-1893</a>:
Insufficient boundary checks when decoding JSON in TryParse reads out of
bounds memory, potentially leading to DOS.</li>
</ul>

<p>The new packages also include updates to some of the bundled dependencies:</p>

<ul>
  <li>backported patch for
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14107">CVE-2017-14107</a>
in the bundled <code class="highlighter-rouge">libzip</code> library</li>
  <li>updated the bundled <code class="highlighter-rouge">libsqlite3</code> library from 3.23.1 to 3.30.1, as the older
version might be affected by multiple published vulnerabilities</li>
</ul>

<p>Note that the bundled dependencies are only used on systems that don’t already
provide those libraries.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/02/19/hhvm-4.45.html">HHVM 4.45</a></h1>
    <p class="post-meta">发布于 2020 年 2 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.45 is released! This release marks the end of support for 4.38 and 4.39
(some versions were supported for longer than usual because
<a href="https://hhvm.com/blog/2019/12/17/cancelling-hhvm-4.37.html">4.37 was skipped</a>);
HHVM 4.40–4.44 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Fixed the type refinement done by <code class="highlighter-rouge">is_array($value)</code> to be less restrictive.
The type-checker now understands the refined type to be the intersection of
<code class="highlighter-rouge">$value</code>’s original type and <code class="highlighter-rouge">varray_or_darray</code>, instead of always rewriting
the type to <code class="highlighter-rouge">varray_or_darray</code>.
    <ul>
      <li>For example, after passing a <code class="highlighter-rouge">darray</code> value to <code class="highlighter-rouge">is_array</code>, the type-checker
no longer rewrites <code class="highlighter-rouge">$value</code>’s type to <code class="highlighter-rouge">varray_or_darray</code> but keeps treating
it as a <code class="highlighter-rouge">darray</code>.</li>
    </ul>
  </li>
  <li>New built-in functions <code class="highlighter-rouge">HH\autoload_type_to_path()</code>,
<code class="highlighter-rouge">HH\autoload_function_to_path()</code> and <code class="highlighter-rouge">HH\autoload_constant_to_path()</code> can be
used to look up entries in the autoload map (e.g. for debugging).</li>
  <li><code class="highlighter-rouge">hh_client --type-at-pos</code> now returns additional information about how the
type was determined.</li>
  <li>Various small clarifications in type-checker error messages (e.g. “missing
property” instead of “missing member”).</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Empty <code class="highlighter-rouge">switch</code> statements are no longer allowed. They now produce a
type-checker error as well as a fatal error at runtime, and in the future will
be treated as a parsing error.</li>
  <li>The type-checker now raises an error for any lambda functions whose types
cannot be inferred. This can reveal
<a href="https://hhvm.com/blog/2020/02/10/hhvm-4.44.html#new-lambda-inference">previously hidden type errors</a>.
    <ul>
      <li>In previous HHVM versions, the <code class="highlighter-rouge">new_inference_lambda=true</code> option in
<code class="highlighter-rouge">.hhconfig</code> enables this behavior.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">array_key_exists()</code> now throws an <code class="highlighter-rouge">InvalidArgumentException</code> if the provided
key is <code class="highlighter-rouge">null</code>.
    <ul>
      <li>In HHVM 4.44, the <code class="highlighter-rouge">hhvm.hack_arr_compat_check_null_hack_array_key=true</code> and
<code class="highlighter-rouge">hhvm.hack_arr_compat_notices=true</code> INI options can be used to raise a
notice.</li>
    </ul>
  </li>
  <li>The <a href="https://www.php.net/manual/en/class.arrayaccess.php"><code class="highlighter-rouge">ArrayAccess</code></a>
interface no longer provides its “magic” behavior. The interface still exists
but its methods now need to be called directly (e.g. <code class="highlighter-rouge">$stack-&gt;push(42)</code>
instead of <code class="highlighter-rouge">$stack[] = 42;</code>).</li>
  <li>When attempting to override a <code class="highlighter-rouge">final</code> method, the type-checker now raises an
error in the child class instead of the parent class. This doesn’t introduce
any new errors but may require some <code class="highlighter-rouge">HH_FIXME</code>s to be moved.
    <ul>
      <li>The same change was made for class properties declared with <code class="highlighter-rouge">&lt;&lt;__Const&gt;&gt;</code> or
<code class="highlighter-rouge">&lt;&lt;__LateInit&gt;&gt;</code>.</li>
    </ul>
  </li>
  <li>Using a type constant via <code class="highlighter-rouge">this</code> as a reified generic type parameter in a
type annotation (e.g. <code class="highlighter-rouge">ClassWithReifiedGeneric&lt;this::T&gt; $arg</code>) is now a
type-checker error.
    <ul>
      <li>It is still allowed in function calls (<code class="highlighter-rouge">foo&lt;this::T&gt;()</code>) including
constructor calls (<code class="highlighter-rouge">new ClassWithReifiedGeneric&lt;this::T&gt;()</code>).</li>
    </ul>
  </li>
  <li>We no longer build packages for Ubuntu 18.10 (its official support ended in
July 2019).</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li><code class="highlighter-rouge">array()</code> literals will be removed; use <code class="highlighter-rouge">vec</code>/<code class="highlighter-rouge">dict</code>/<code class="highlighter-rouge">keyset</code> instead if
possible, otherwise <code class="highlighter-rouge">varray</code> or <code class="highlighter-rouge">darray</code>.
    <ul>
      <li>Automated migration is available in
<a href="https://github.com/hhvm/hhast/releases/tag/v4.33.6">HHAST 4.33.6</a>:
<code class="highlighter-rouge">hhast-migrate --php-arrays</code></li>
    </ul>
  </li>
  <li>The runtime will be changed to throw an exception for any <code class="highlighter-rouge">switch</code> statements
where none of the cases matched the provided value.
    <ul>
      <li>A <code class="highlighter-rouge">default</code> branch should be added to any <code class="highlighter-rouge">switch</code> statements that
intentionally don’t cover all possible cases.</li>
      <li>Use the <code class="highlighter-rouge">hhvm.throw_on_non_exhaustive_switch=2</code> INI option to enable this
behavior now (or set the value to <code class="highlighter-rouge">1</code> to raise a warning instead of throwing
an exception).</li>
    </ul>
  </li>
  <li>Upper bounds on generic type parameters will be enforced at runtime. For
example, passing <code class="highlighter-rouge">true</code> to a function declared as
<code class="highlighter-rouge">function takes_arraykey&lt;T as arraykey&gt;(T $arg)</code> will be a runtime error in
the future.
    <ul>
      <li>Any such violations already raise type-checker errors, but this could reveal
new errors in code without full type coverage.</li>
      <li>It is enforced regardless of where the generic parameter appears (function
parameter and return types, class properties, etc).</li>
      <li>Use the INI options <code class="highlighter-rouge">hhvm.emit_generics_ub=true</code> with
<code class="highlighter-rouge">hhvm.enforce_generics_ub=2</code> to enable this behavior now (or set the latter
value to <code class="highlighter-rouge">1</code> to raise a warning instead of a fatal error).</li>
    </ul>
  </li>
  <li>The behavior of <code class="highlighter-rouge">is_array()</code> will likely be changed to also return <code class="highlighter-rouge">true</code> for
Hack arrays (<code class="highlighter-rouge">vec</code>, <code class="highlighter-rouge">dict</code> and <code class="highlighter-rouge">keyset</code>).
    <ul>
      <li>Currently it only returns <code class="highlighter-rouge">true</code> for legacy arrays (<code class="highlighter-rouge">array</code>, <code class="highlighter-rouge">varray</code> and
<code class="highlighter-rouge">darray</code>). This change should make it easier to migrate from legacy arrays
to Hack arrays.</li>
      <li>New built-in function <code class="highlighter-rouge">HH\is_php_array()</code> was added in this release, which
only returns <code class="highlighter-rouge">true</code> for legacy arrays (the current behavior of
<code class="highlighter-rouge">is_array()</code>). You can replace any calls to <code class="highlighter-rouge">is_array()</code> with this function
to guarantee no behavior changes in the future.</li>
      <li>You can use <code class="highlighter-rouge">HH\is_any_array()</code> to preemptively migrate any <code class="highlighter-rouge">is_array()</code>
calls to the future behavior.</li>
    </ul>
  </li>
  <li>Comparing Hack arrays (<code class="highlighter-rouge">vec</code>, <code class="highlighter-rouge">dict</code> and <code class="highlighter-rouge">keyset</code>) with boolean values using
the “fuzzy” comparison operators <code class="highlighter-rouge">==</code> and <code class="highlighter-rouge">!=</code> will be changed to consider
empty arrays equal to <code class="highlighter-rouge">false</code> and non-empty arrays to <code class="highlighter-rouge">true</code>.
    <ul>
      <li>This is consistent with how fuzzy comparisons work for other types,
including legacy arrays (<code class="highlighter-rouge">array</code>, <code class="highlighter-rouge">varray</code>, <code class="highlighter-rouge">darray</code>). It should make it
easier to migrate from legacy arrays to Hack arrays.</li>
      <li>Strict equality operators <code class="highlighter-rouge">===</code> and <code class="highlighter-rouge">!==</code> are not affected, they will
always evaluate to <code class="highlighter-rouge">false</code> when comparing values of different types. It is
highly recommended to use these strict operators for comparisons and
use <code class="highlighter-rouge">C\is_empty()</code> for checking the emptiness of arrays instead.</li>
      <li>Use the <code class="highlighter-rouge">hhvm.hack_arr_compat_hack_arr_cmp_notices=1</code> INI option to raise a
notice whenever Hack arrays are compared with boolean values, and therefore
the result may be affected by this future change.</li>
    </ul>
  </li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/02/10/hhvm-4.44.html">HHVM 4.44</a></h1>
    <p class="post-meta">发布于 2020 年 2 月 10 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.44 is released!
HHVM 4.38–4.43 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>the <code class="highlighter-rouge">__Deprecated</code> attribute is no longer permitted on any types, such as
classes, enums, or type aliases; it had no effect in these positions.</li>
  <li><code class="highlighter-rouge">(int) NAN</code> is now consistently the minimum 64-bit signed integer, instead of
    <ol>
      <li>In previous releases, this behavior could differ at runtime compared to
when constant-folding.</li>
    </ol>
  </li>
  <li>square bracket literals for PHP arrays (e.g. <code class="highlighter-rouge">['foo', 'bar']</code>) are now a
parse error. <code class="highlighter-rouge">array()</code> is still supported, but will be removed in the
near future. Ideally, use <code class="highlighter-rouge">vec</code>/<code class="highlighter-rouge">dict</code>/<code class="highlighter-rouge">keyset</code> instead, but <code class="highlighter-rouge">varray</code> and
<code class="highlighter-rouge">darray</code> remain supported.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>comparison operations (e.g. <code class="highlighter-rouge">&lt;</code>, <code class="highlighter-rouge">&lt;=</code>, <code class="highlighter-rouge">&lt;=&gt;</code> etc) will be changed
to throw when a PHP array is compared with a non-array. This operation
currently raises a typechecker error, and raises a notice if
<code class="highlighter-rouge">hhvm.hack_arr_compat_notices=true</code> and
<code class="highlighter-rouge">hhvm.hack_arr_compat_check_compare_non_any_array=true</code> INI options are set.
The behavior of <code class="highlighter-rouge">!==</code>, and <code class="highlighter-rouge">===</code> will not change.</li>
  <li><code class="highlighter-rouge">array_key_exists()</code> will change to throw an exception if the specified key is
null. A notice is raised if the
<code class="highlighter-rouge">hhvm.hack_arr_compat_check_null_hack_array_key=true</code> and
<code class="highlighter-rouge">hhvm.hack_arr_compat_notices=true</code> INI options are set.</li>
  <li>lambda type inference is being changed in the next release; the new behavior
can be enabled now with the <code class="highlighter-rouge">new_inference_lambda=true</code> <code class="highlighter-rouge">.hhconfig</code> setting;
this can lead to the detection of additional type errors (example below)</li>
  <li>string casts of <code class="highlighter-rouge">Stringish</code> objects will change to raise a runtime exception;
the <code class="highlighter-rouge">hhvm.notice_on_implicit_invoke_to_string</code> option can be used to detect
this.
    <ul>
      <li>this includes both explicit <code class="highlighter-rouge">(string)</code> casts, and various forms of implicit
casting (e.g. concatenation, comparisons, printfs, and interpolation);
searching for <code class="highlighter-rouge">(string)</code> will not find all problematic code.</li>
    </ul>
  </li>
  <li>empty switch blocks ( <code class="highlighter-rouge">switch ($foo) { /* empty */ }</code>) will become a parse
error.</li>
  <li><code class="highlighter-rouge">array()</code> literals will be removed; use <code class="highlighter-rouge">vec</code>/<code class="highlighter-rouge">dict</code>/<code class="highlighter-rouge">keyset</code> instead if
possible, otherwise <code class="highlighter-rouge">varray</code> or <code class="highlighter-rouge">darray</code>.</li>
</ul>

<h2 id="new-lambda-inference">New lambda inference</h2>

<p>If the type can not be inferred in a usable way, the typechecker will now raise
an error instead of assuming the behavior is safe.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>function just_return_it&lt;T&gt;((function(T): void) $f):(function(T): void) {
  return $f;
}

function break_it():void {
  // No error here
  $g = just_return_it($y ==&gt; $y-&gt;this_method_does_not_exist());
  // Can even try and invoke it on a string
  $g('ohno');
}
</pre></td></tr></tbody></table></code></pre></div></div>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/02/03/hhvm-4.43.html">HHVM 4.43</a></h1>
    <p class="post-meta">发布于 2020 年 2 月 3 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.43 is released! This release marks the end of support for 4.36;
HHVM 4.37–4.42 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>We are now building Homebrew packages for MacOS 10.15 Catalina. Please report
MacOS-specific issues in the
<a href="https://github.com/hhvm/homebrew-hhvm/issues/new">homebrew-hhvm</a>
repository.</li>
  <li>Extending an undefined parent class no longer produces a redundant typechecker
error 4123 (“Class has a non-&lt;?hh grandparent”), it now only produces the
relevant error 2049 (“Unbound name”).</li>
  <li>Improved typechecker error message when attempting to declare the type of a
local variable (<code class="highlighter-rouge">int $x = 42;</code>).</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Built-in functions <code class="highlighter-rouge">json_decode</code>, <code class="highlighter-rouge">str_split</code>, <code class="highlighter-rouge">array_fill</code>,
<code class="highlighter-rouge">class_implements</code>, <code class="highlighter-rouge">class_uses</code>, <code class="highlighter-rouge">class_parents</code> now return <code class="highlighter-rouge">darray</code> instead
of the legacy <code class="highlighter-rouge">array</code> type. This change should be largely transparent, as
<code class="highlighter-rouge">darray</code> and <code class="highlighter-rouge">array</code> are interchangeable at runtime, but the change might be
observable by <code class="highlighter-rouge">serialize</code>, <code class="highlighter-rouge">var_dump</code> or similar functions.</li>
  <li>The <code class="highlighter-rouge">contains</code> method on <code class="highlighter-rouge">Set</code>, <code class="highlighter-rouge">ImmSet</code> and <code class="highlighter-rouge">ConstSet</code> is now declared to
take an <code class="highlighter-rouge">arraykey</code> argument instead of <code class="highlighter-rouge">mixed</code>. The method would already throw
at runtime when called with any non-<code class="highlighter-rouge">arraykey</code> value.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/01/27/hhvm-4.42.html">HHVM 4.42</a></h1>
    <p class="post-meta">发布于 2020 年 1 月 27 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.42 is released! This release marks the end of support for 4.35;
HHVM 4.36–4.41 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Bugs in the typechecker’s AST handling now result in error <code class="highlighter-rouge">4361</code>, instead of
an exception. This error code should never be suppressed - please <a href="https://github.com/facebook/hhvm/issues/new/choose">file a bug
report</a> if you see this
error code.</li>
  <li>Fix escaping of variables autocomplete snippets - e.g. <code class="highlighter-rouge">Foo::bar|</code> can
now autocomplete to <code class="highlighter-rouge">Foo::bar($id)</code>.</li>
  <li>Added <code class="highlighter-rouge">HHVM_VERSION_MAJOR</code>, <code class="highlighter-rouge">HHVM_VERSION_MINOR</code>, and <code class="highlighter-rouge">HHVM_VERSION_PATCH</code>
constants; these should be used instead of parsing the <code class="highlighter-rouge">HHVM_VERSION</code> or
<code class="highlighter-rouge">HHVM_VERSION_ID</code> constants. <code class="highlighter-rouge">HHVM_VERSION_ID</code> is recommended for direct
comparisons, e.g. with <code class="highlighter-rouge">&gt;=</code>.</li>
  <li>Added <code class="highlighter-rouge">\HH\enumname&lt;T&gt;</code> type to the runtime; this is similar to
<code class="highlighter-rouge">classname&lt;T&gt;</code>, for Hack enums.</li>
  <li>Fixed crash in <code class="highlighter-rouge">readdir()</code> and <code class="highlighter-rouge">rewinddir()</code> if the directory is already
closed; <code class="highlighter-rouge">false</code> will be returned instead.</li>
  <li>Improved error message for <code class="highlighter-rouge">() ==&gt; async {}</code> (returning an async block);
it now suggests <code class="highlighter-rouge">async () ==&gt; { }</code> instead (an async lambda).</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>If an interface defines a constructor, the typechecker now requires that
classes that implement the interface are either abstract, or implement the
constructor in accordance with the interface, matching the behavior for other
methods.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>We will stop building any binaries for MacOS High Sierra on March 23rd, as our
provider is ending support for this operating system version. We will continue
to build packages for Mojave (which are usable on Catalina), and expect to
begin building packages specifically for Catalina from early February.</li>
  <li><code class="highlighter-rouge">HHVM_VERSION_ID</code> will change from <code class="highlighter-rouge">XX.YY.ZZ</code> to <code class="highlighter-rouge">XX.YYY.ZZ</code>, to support the
expected release of HHVM 4.100 later this year; if using standard comparison
operators to compare two version IDs, this should not be a significant change,
unless checking for <code class="highlighter-rouge">&lt; 50000</code> or similar - replace that check with
<code class="highlighter-rouge">HHVM_VERSION_MAJOR === 4</code>. If you’re converting to/from human-readable form,
consider migrating to the new <code class="highlighter-rouge">HHVM_VERSION_MAJOR</code>, <code class="highlighter-rouge">HHVM_VERSION_MINOR</code>, and
<code class="highlighter-rouge">HHVM_VERSION_PATCH</code> or existing <code class="highlighter-rouge">HHVM_VERSION</code> (string “x.y.z”) constants.</li>
  <li>The special behavior of <code class="highlighter-rouge">ArrayAccess</code> objects is being removed.
    <ul>
      <li>this is already a typechecker error.</li>
      <li>this includes <code class="highlighter-rouge">$x['foo']</code> for both read and write (replace with explicit
<code class="highlighter-rouge">offsetSet</code> or <code class="highlighter-rouge">offsetGet</code> calls)</li>
      <li>this also includes <code class="highlighter-rouge">isset($x['foo'])</code> (<code class="highlighter-rouge">$x-&gt;offsetExists('foo')</code>) and
<code class="highlighter-rouge">unset($x['foo'])</code> (<code class="highlighter-rouge">$x-&gt;offsetUnset('foo'</code>).</li>
      <li>the <code class="highlighter-rouge">hhvm.notice_on_array_access_use=true</code> INI setting can be used to raise
notices for this behavior at runtime.</li>
    </ul>
  </li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/01/21/hhvm-4.41.html">HHVM 4.41</a></h1>
    <p class="post-meta">发布于 2020 年 1 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.41 is released! This release marks the end of support for 4.34;
HHVM 4.35–4.40 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>A new type alias, <code class="highlighter-rouge">HH\enumname&lt;TEnum&gt;</code>, represents the name of the enum type
<code class="highlighter-rouge">TEnum</code> (similarly to <code class="highlighter-rouge">classname&lt;TClass&gt;</code>).</li>
  <li>A new function, <code class="highlighter-rouge">HH\type_structure_for_alias</code>, returns the <code class="highlighter-rouge">TypeStructure</code> of
the specified type alias (similarly to <code class="highlighter-rouge">HH\type_structure</code> for type constants
in classes).
    <ul>
      <li>Note that the <code class="highlighter-rouge">TypeStructure</code> API remains experimental and may be changed or
removed in the future.</li>
    </ul>
  </li>
  <li>Builtin functions <code class="highlighter-rouge">usort</code>, <code class="highlighter-rouge">uasort</code>, <code class="highlighter-rouge">uksort</code> now accept callbacks that return
any <code class="highlighter-rouge">num</code> value (<code class="highlighter-rouge">int</code> or <code class="highlighter-rouge">float</code>), allowing for more convenient sorting of
<code class="highlighter-rouge">float</code> arrays.
    <ul>
      <li>Note that these functions return
<a href="https://docs.hhvm.com/hack/built-in-types/arrays#php-arrays-array-varray-and-darray">legacy arrays</a>
which are deprecated. Prefer
<a href="https://docs.hhvm.com/hsl/reference/function/HH.Lib.Vec.sort/"><code class="highlighter-rouge">Vec\sort</code></a>,
<a href="https://docs.hhvm.com/hsl/reference/function/HH.Lib.Dict.sort/"><code class="highlighter-rouge">Dict\sort</code></a>,
<a href="https://docs.hhvm.com/hsl/reference/function/HH.Lib.Keyset.sort/"><code class="highlighter-rouge">Keyset\sort</code></a>.</li>
    </ul>
  </li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Fixed a bug that allowed XHP children declarations to contain undefined types.
This may reveal many previously ignored errors.
    <ul>
      <li>XHP children declarations can now only contain defined, non-aliased,
non-generic Hack types, XHP category names (<code class="highlighter-rouge">%foo</code>), and the special values
<code class="highlighter-rouge">pcdata</code>, <code class="highlighter-rouge">any</code> and <code class="highlighter-rouge">empty</code> (case-sensitive).</li>
      <li>Note that only the children declaration is type-checked, not the actual
children where the XHP element is used. A library such as
<a href="https://github.com/hhvm/xhp-lib">xhp-lib</a> must be used for that.</li>
    </ul>
  </li>
  <li>Typechecker errors due to assigning a value of the wrong type to an
<a href="https://docs.hhvm.com/hack/functions/inout-parameters">inout parameter</a> are
now reported at the location where the inout parameter is declared. This may
require some <code class="highlighter-rouge">HH_FIXME</code>s to be moved.</li>
  <li>Typechecker errors due to incorrect use of the argument unpacking operator
(<code class="highlighter-rouge">...$args</code>) were updated to provide more information in different cases. In
some cases this results in changed error numbers, but it shouldn’t result in
any new errors.</li>
  <li>The method <code class="highlighter-rouge">returnsReference</code> was removed from <code class="highlighter-rouge">ReflectionFunction</code> and
<code class="highlighter-rouge">ReflectionMethod</code>. It always returned <code class="highlighter-rouge">false</code> since HHVM
<a href="https://hhvm.com/blog/2019/10/01/deprecating-references.html">no longer supports references</a>.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/01/13/hhvm-4.40.html">HHVM 4.40</a></h1>
    <p class="post-meta">发布于 2020 年 1 月 13 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.40 is released! This release marks the end of support for 4.33;
hhvm 4.34–4.39 remain supported, as do the 4.8 and 4.32 LTS releases.</p>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>specifying the same XHP attribute twice (<code class="highlighter-rouge">&lt;foo x="1" x="2" /&gt;</code>) is now
a syntax error</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<p>A change last year unintentionally made the parser accept arbitrary types
for XHP <code class="highlighter-rouge">children</code> declarations, however:</p>
<ul>
  <li>this remains unsupported by the XHP class library.</li>
  <li>the typechecker does not validate children.</li>
  <li>this can lead to impossible-to-satisfy children declarations, such as
references to undefined types.</li>
</ul>

<p><strong>We are changing the typechecker to verify that XHP children declarations do
not refer to undefined types</strong>; in the context of XHP children declarations, the
following types will be considered valid <em>by the typechecker</em>:</p>
<ul>
  <li>the case-sensitive special values <code class="highlighter-rouge">pcdata</code>, <code class="highlighter-rouge">any</code>, or <code class="highlighter-rouge">empty</code>.</li>
  <li>XHP category names, such as <code class="highlighter-rouge">%foo</code>.</li>
  <li>a defined, non-aliased, non-generic Hack type, such as a class name, XHP
classname, or interface.</li>
</ul>

<p>We expect this change to be included in 4.41.</p>

<p>There are some additional things to be aware of:</p>
<ul>
  <li>only the declaration is validated; the typechecker will not verify that
provided children actually match the declaration. This will remain a
runtime-only check, which must be supported by the XHP class library.</li>
  <li>there are no typechecker checks for XHP categories in children declarations.</li>
  <li>types other than XHP class names - such as standard classes or interfaces - 
may not be fully supported by the XHP class library.</li>
  <li>type aliases are not permitted.</li>
</ul>

<p>Additionally, this release includes disabled support for <code class="highlighter-rouge">xhp class foo {}</code>
as an alternative syntax to <code class="highlighter-rouge">class :foo {}</code>; this is to unblock future work on
improving interactions between XHP and namespaces - usage is not recommended at
this time.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/01/07/hhvm-4.39.html">HHVM 4.39</a></h1>
    <p class="post-meta">发布于 2020 年 1 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.39 is released! Since the 4.32 release has long term support, it remains
supported, as do the 4.8 LTS and 4.33–4.38 releases.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Removed redundant typechecker output for some errors related to type constants
(such as the second part of “Expected ClassName::T / resulting from expanding
the type constant ClassName::T”).</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Improved typechecker output for errors related to mismatches between <code class="highlighter-rouge">int</code>,
<code class="highlighter-rouge">float</code>, <code class="highlighter-rouge">num</code> and
<a href="https://docs.hhvm.com/hack/built-in-types/dynamic"><code class="highlighter-rouge">dynamic</code></a>. In rare cases
this may result in a typechecker error moving to a different location, e.g.
from where a value is assigned to where it is used.</li>
  <li>The callback passed to <code class="highlighter-rouge">set_pre_timeout_handler()</code> must now accept a nullable
wait handle argument (<code class="highlighter-rouge">?Awaitable&lt;mixed&gt;</code>). The wait handle will have a value
when the callback is invoked right after a wait handle had finished. The wait
handle is required in order to get a good backtrace. This is a similar
behavior to the wait handle that is returned in the
<a href="https://docs.hhvm.com/hack/reference/class/IntervalTimer/"><code class="highlighter-rouge">IntervalTimer</code></a>
class.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2020/01/02/hhvm-4.38.html">HHVM 4.38</a></h1>
    <p class="post-meta">发布于 2020 年 1 月 2 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.38 is released! This release marks the end of support for 4.31;
4.32–4.36 remain supported, as does the 4.8 LTS release.</p>

<p>The <a href="https://hhvm.com/blog/2019/12/17/cancelling-hhvm-4.37.html">4.37 release was skipped</a>
due to the holiday season.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Added <code class="highlighter-rouge">SA_RESTART</code> to <code class="highlighter-rouge">SIGVTALARM</code> flags, allowing operations such as <code class="highlighter-rouge">flock</code>
to continue when interrupted by some profiling tools, instead of failing
with <code class="highlighter-rouge">EINTR</code>.</li>
  <li>Changed typechecker definitions of base64/url/rawurl encode/decode
functions to return <code class="highlighter-rouge">string</code>, rather than untyped data. They already always
returned strings in the runtime.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>building with readline now requires <code class="highlighter-rouge">-DNON_DISTRIBUTABLE_BUILD=ON</code> to be
passed to <code class="highlighter-rouge">cmake</code>; editline remains supported as the default implementation,
and this does not affect our builds. In custom builds, <code class="highlighter-rouge">hphpd</code> and the PHP
readline-related functions may switch to using editline instead of readline.</li>
  <li>using assignments as an expression is now a typechecker error. This can
temporarily be disabled by setting the <code class="highlighter-rouge">disable_lval_as_an_expression=false</code>
<code class="highlighter-rouge">.hhconfig</code> option; this option will be removed in a future release.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/12/17/cancelling-hhvm-4.37.html">Holiday schedule: cancelling HHVM 4.37</a></h1>
    <p class="post-meta">发布于 2019 年 12 月 17 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We have decided to cancel next week’s release of HHVM 4.37, and expect to delay
4.38 until Thursday, the 2nd of January. HHVM 4.31 will be supported until the
release of HHVM 4.38 or above. As HHVM 4.32 has long-term-support (LTS), it is
unaffected by this change.</p>

<p>Our usual schedule is to release on Mondays or Tuesdays, and we expect many
people - both at Facebook, and among our users - to be on vacation for Tuesday
and Wednesday for the next two weeks. We
believe that releasing new versions with breaking changes at this time would not
be in the best interests of our users, especially as we would be less able to
support them during this time.</p>

<p>We look forward to continuing the evolution of Hack and HHVM in 2020.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/12/16/hhvm-4.36.html">HHVM 4.36</a></h1>
    <p class="post-meta">发布于 2019 年 12 月 16 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.36 is released! This release marks the end of support for 4.30;
4.31–4.35 remain supported, as does the 4.8 LTS release.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Statically links <a href="http://jemalloc.net/">jemalloc</a> 5 if the system version is
older. HHVM requires 2MB-aligned 2MB allocations; older versions of jemalloc
will give a 4MB allocation, leading to request OOMs. Some old versions of HHVM
detected the 4MB allocation and attempted to use it, but did not do so
correctly.</li>
  <li>Symbol search in IDEs now finds namespaced symbols again.</li>
  <li>Fixed the “Unbound name” typechecker error (2049) to correctly report the type
of the missing entity (“an object type”, “a global function”, etc.).
Previously it would incorrectly say “an object type” in most cases.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>It is now a runtime error to declare multiple constants with the same name.
It had already been a typechecker error, but only a notice at runtime.</li>
  <li>It is now a typechecker error for a static method to use a reified generic
type parameter from the encompassing class. The generic type parameter must
instead be reified at the static method itself.</li>
  <li>Fixed a bug causing the typechecker to not report missing generic type
parameters for class constants.</li>
  <li>Fixed incorrect typehints for some built-in sorting functions (<code class="highlighter-rouge">asort</code>,
<code class="highlighter-rouge">arsort</code>, <code class="highlighter-rouge">krsort</code>, <code class="highlighter-rouge">uasort</code>, <code class="highlighter-rouge">uksort</code>). These functions may change the type
of the passed-in container (e.g. <code class="highlighter-rouge">vec</code> to <code class="highlighter-rouge">dict</code>), which the original
typehints didn’t account for. This change may reveal new type errors in code
that uses these functions.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/12/10/hhvm-4.35.html">HHVM 4.35</a></h1>
    <p class="post-meta">发布于 2019 年 12 月 10 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.35 is released! This release marks the end of support for 4.29;
4.30–4.34 remain supported, as does the 4.8 LTS release.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>resolving recursive type structure now raises a fatal error, instead of HHVM
infinitely recursing.</li>
  <li>improved error messages for unsatisfiable constructor constraints, e.g.
<code class="highlighter-rouge">__construct(classname&lt;T&gt; $f) where T = nothing</code>.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">__halt_compiler()</code> and <code class="highlighter-rouge">__COMPILER_HALT_OFFSET__</code> have been removed.</li>
  <li><code class="highlighter-rouge">require extends T;</code> and <code class="highlighter-rouge">... extends T {}</code> now consistently raise naming
errors (2049); previously, <code class="highlighter-rouge">extend T</code> was a naming error, while
<code class="highlighter-rouge">require extends T</code> raised a type error (4026). This may require modifying
FIXMEs in unsafe/invalid Hack code.</li>
  <li>it is no longer possible to completely disable the checking of return type
hints: if <code class="highlighter-rouge">hhvm.check_return_type_hints</code> is less than 2, an <code class="highlighter-rouge">E_WARNING</code> will
be raised. If set to 2, an <code class="highlighter-rouge">E_RECOVERABLE_ERROR</code> will be raised for hard type.
hints, and <code class="highlighter-rouge">E_WARNING</code> for soft.</li>
  <li>split list and tuple destructuring errors out to new codes; this may require
modifying FIXMEs (4110 to 4105 or 4357) in unsafe/invalid Hack code.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/12/02/hhvm-4.34.html">HHVM 4.34</a></h1>
    <p class="post-meta">发布于 2019 年 12 月 2 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.34 is released! This release marks the end of support for 4.28;
4.29–4.33 remain supported, as does the 4.8 LTS release.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Added <code class="highlighter-rouge">hh_client --concatenate-all path/ [morepaths/ ...]</code>, which creates a
single-file version of a Hack project. This respects required inclusion order
(e.g. parent classes before child classes), and resolves syntax issues such as
namespace declarations and potentially conflicting <code class="highlighter-rouge">use</code> statements. Example
usage:
    <ul>
      <li><code class="highlighter-rouge">hh_client --concatenate-all src/</code> for a library</li>
      <li><code class="highlighter-rouge">hh_client --concatenate-all src/ vendor/ bin/foo.hack</code> for an executable</li>
    </ul>
  </li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>It is now always a type error to use <code class="highlighter-rouge">self::abstractStaticMethod()</code> to call an
abstract static method <strong>inside a trait</strong>. Previously, this was only a type
error if any classes used the trait without implementing the respective
method. The new behavior is consistent with abstract classes, where calling
<code class="highlighter-rouge">self::abstractStaticMethod()</code> was already an error. Use
<code class="highlighter-rouge">static::abstractStaticMethod()</code> instead (note that this may change the
behavior in some cases, but most likely the new behavior better captures the
original intent of the code).</li>
  <li>Type errors about incorrectly overridden type constants are now reported in
the child class that overrides the constant, not in the parent class that
declares it. This may require some <code class="highlighter-rouge">HH_FIXME</code>s to be moved from a parent class
to its child classes.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/11/25/hhvm-4.33.html">HHVM 4.33</a></h1>
    <p class="post-meta">发布于 2019 年 11 月 25 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.33 is released! This release marks the end of support for 4.27;
4.28–4.32 remain supported, as does the 4.8 LTS release.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>For developers working on the implementation of Hack itself (in rust/ocaml):
    <ul>
      <li>the test suite now passes in open source builds</li>
      <li>the code generation tools for updating the parser and rust/ocaml FFI are now
usable in opensource builds</li>
    </ul>
  </li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Fixed issue where some FIXMEs had no effect on the code they were attached to
instead having action-at-a-distance. This could lead to errors being reported
in the wrong file. This bugfix may require fixmes to be added or moved.</li>
  <li>An error is now raised if a reified function call is made without all required
generics; for example, <code class="highlighter-rouge">foo&lt;vec&gt;()</code> now raises an error, as <code class="highlighter-rouge">vec</code> requires
a generic type</li>
  <li>Type structures for type aliases are now keyed by opaqueness and the alias
name. In previous versions, if multiple types/type aliases resolved to the
same concrete type, the wrong type structure would sometimes be returned - for
example,
with <code class="highlighter-rouge">newtype FOO = int;</code>, it was previously unpredicable if the type stucture
for <code class="highlighter-rouge">new MyClass&lt;FOO&gt;()</code> would return the type alias information
or not, and <code class="highlighter-rouge">new MyClass&lt;int&gt;()</code> could return <code class="highlighter-rouge">FOO</code>’s type alias
information. The correct type structure will now consistently be returned.
This only affects classes with reified generics - functions using reified
generics are unaffected</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/11/19/hhvm-4.32.html">HHVM 4.32 (LTS)</a></h1>
    <p class="post-meta">发布于 2019 年 11 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.32 is released! This release has long term support, so:</p>

<ul>
  <li>this release will be supported for approximately 48 weeks</li>
  <li>the next LTS will be released in approximately 24 weeks</li>
  <li>HHVM 4.8 and HHVM 4.27–4.31 remain supported</li>
  <li>support ends for HHVM 3.30, the last HHVM release compatible with PHP</li>
</ul>

<p>See also the new
<a href="https://hhvm.com/blog/2019/11/19/distribution-support.html">support lifecycle for older distributions</a>.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Fixed an issue where some built-in functions, available at runtime, were not
recognized by the typechecker (e.g. <code class="highlighter-rouge">fb_intercept2</code>, <code class="highlighter-rouge">fb_serialize</code>,
<code class="highlighter-rouge">xhprof_enable</code>). See
<a href="https://github.com/facebook/hhvm/blob/HHVM-4.32/hphp/hack/hhi/builtins_fb.hhi">header file</a>
for the full list.</li>
  <li>For developers: You can now use <code class="highlighter-rouge">source $BUILD/hphp/hack/dev_env.sh</code> to set up
the correct environment for all OCaml tools (dune/cargo/opam/ocamlformat/…).</li>
  <li>The HTTP server bundled with HHVM (Proxygen) now allows the <code class="highlighter-rouge">MOVE</code> method.</li>
  <li>The type <code class="highlighter-rouge">varray_or_darray</code> (a helper type, only existing in the typechecker,
for migrating from legacy arrays) now has two generic type parameters.
    <ul>
      <li>For backwards compatibility, it can still be used with a single generic type
parameter, where <code class="highlighter-rouge">varray_or_darray&lt;T&gt;</code> is implied to mean
<code class="highlighter-rouge">varray_or_darray&lt;arraykey, T&gt;</code>.</li>
      <li>See
<a href="https://docs.hhvm.com/hack/built-in-types/arrays#migrating-from-legacy-arrays">recently updated guide</a>
for more information about legacy array migration types.</li>
    </ul>
  </li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>All types that can be iterated with <code class="highlighter-rouge">foreach</code> now extend a single
<code class="highlighter-rouge">Traversable</code> interface.
    <ul>
      <li>Fully qualified name is <code class="highlighter-rouge">\HH\Traversable</code>, but since this is an
“autoimported” type, the fully qualified name should never be
needed.</li>
      <li>Previously, there were two separate interfaces, <code class="highlighter-rouge">\Traversable</code> and
<code class="highlighter-rouge">\HH\Traversable</code>, with most (but not all!) types implementing
<code class="highlighter-rouge">\HH\Traversable</code> (an example exception is <code class="highlighter-rouge">DOMNodeList</code> which only
implemented <code class="highlighter-rouge">\Traversable</code>).</li>
      <li>The <code class="highlighter-rouge">\Traversable</code> and <code class="highlighter-rouge">\Iterator</code> interfaces (inherited from PHP) have been
removed in favor of <code class="highlighter-rouge">\HH\Traversable</code> and <code class="highlighter-rouge">\HH\Iterator</code>. Hack code that
refers to <code class="highlighter-rouge">Traversable</code> and <code class="highlighter-rouge">Iterator</code> with no leading backslash will
continue to work unchanged, but code that had <code class="highlighter-rouge">\Traversable</code> or <code class="highlighter-rouge">\Iterator</code>
needs to either remove the leading backslash or add <code class="highlighter-rouge">\HH</code> (note that this
changes the behavior of the affected code, making it refer to a much larger
set of iterable types).</li>
    </ul>
  </li>
  <li>Using <code class="highlighter-rouge">HH\BuiltinEnum</code> outside of built-in header files is once again
disallowed by the typechecker (error 2053). This restriction had recently been
lifted (in <a href="https://hhvm.com/blog/2019/10/23/hhvm-4.28.html">HHVM 4.28</a>), but
it is being reintroduced because we discovered some new runtime issues when
the type is used.</li>
  <li>The runtime config option <code class="highlighter-rouge">hhvm.php7.int_semantics</code> has been removed.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/11/19/distribution-support.html">Support lifecycle for older distributions</a></h1>
    <p class="post-meta">发布于 2019 年 11 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We currently package for Debian 8 (Jessie) from 2015, and Ubuntu 16.04; this
constrains us in several ways, such as:</p>

<ul>
  <li>supporting building with older system libraries, especially
OpenSSL 1.0 (1.1+ includes many breaking changes)</li>
  <li>supporting older GCC versions, runtimes, and C++ ABIs</li>
  <li>maintaining internal test infrastructure for these old distributions</li>
</ul>

<p>To allow more time to be spent on improving Hack itself, in the future, we will
be more aggressive about removing support for older distributions.</p>

<p>HHVM 4.32 - due to be announced later today - will be an LTS release; 4.56 will
be the next LTS release, and is due in 24 weeks (week of 2020-05-04). 4.56 will
be the last release that supports:</p>
<ul>
  <li>MacOS Mojave</li>
  <li>Debian 8 Jessie</li>
  <li>Debian 9 Stretch</li>
  <li>Ubuntu 16.04</li>
</ul>

<p>In HHVM 4.57 and above, we will aim to support:</p>
<ul>
  <li>MacOS: the latest stable release (currently Catalina). If the release has been
stable for less than 6 months, we will also aim to support the previous stable
version (currently Mojave)</li>
  <li>Debian: <code class="highlighter-rouge">stable</code> (currently Buster). If the current <code class="highlighter-rouge">stable</code> was released in
the last 6 months, we will also aim to support <code class="highlighter-rouge">oldstable</code> (currently
Stretch). We are open to investigating support for Debian <code class="highlighter-rouge">testing</code> (currently
Bullseye), but are not currently doing so.</li>
  <li>Ubuntu:
    <ul>
      <li>the current LTS release (18.04); if the LTS is less than 6 months old, the
previous LTS will also be supported</li>
      <li>non-LTS (‘interim’) releases will be supported for 9 months from their
release; this matches the length of time that they are supported by
Canonical</li>
    </ul>
  </li>
</ul>

<h2 id="what-ending-support-means">What ending support means</h2>

<p>In general, we do not intend to proactively stop testing/packaging for
distributions as soon as they become ‘unsupported’; however:</p>

<ul>
  <li>when we want to upgrade our internal test infrastructure or update the minimum
versions of our dependencies, the versions provided by unsupported
distributions will not be a factor in that decision</li>
  <li>if our packaging starts failing on supported distributions, we may stop
building for them instead of fixing it</li>
</ul>

<p>Given we want to remove support for OpenSSL 1.0 and for systems using the C++5
ABI, we expect to stop building packages for several distributions - especially
Debian 8 Jessie and Ubuntu 16.04 very shortly after the release of HHVM 4.56.</p>

<h2 id="bugfix-and-security-updates">Bugfix and security updates</h2>

<p>If we build a package for a distribution for a x.y.0 release, we intend to build
packages for that distribution for any x.y.z releases - as long as the
distribution itself continues to receive security updates from the distribution
vendor.</p>

<p>In other words, dropping support for a distribution in a new release does not
affect support for that distribution in past verisons of HHVM.</p>

<p>For example:</p>
<ul>
  <li>4.56.0 will support Debian 8 Jessie and Ubuntu 16.04</li>
  <li>if a 4.56.1 release is made mid-June 2020, it would still support Debian 8 and
Ubuntu 16.04 - even if 4.57 has been released without support for those
distributions</li>
  <li>if a 4.56.2 release is made in July 2020, it would still support Ubuntu 16.04,
but it would not support Debian 8, as Debian 8 reaches end of life on June
30th, 2020</li>
</ul>

<h2 id="using-unsupported-distributions">Using unsupported distributions</h2>

<p>We <strong>strongly</strong> recommend using a supported distribution instead. That said,
there are several options:</p>

<ul>
  <li>run HHVM via Docker or other containerization techniques</li>
  <li>install/build updated versions of any required dependencies (likely to include
GCC and OpenSSL), then build/package HHVM yourself</li>
  <li>send pull requests to fix builds on unsupported distributions - though we will
not accept pull requests that increase the burden on developers; for example,
once folly drops support for OpenSSL 1.0, we will not accept pull requests
that re-add it</li>
</ul>

<p>If you are using a current version of a distribution that we do not package for
at all (e.g. CentOS), we would appreciate pull requests to add support to
<a href="https://github.com/hhvm/packaging">our packaging infrastructure</a>; any new
packaging should be:</p>
<ul>
  <li>reproducible. For example, fetching <code class="highlighter-rouge">master</code> of a dependency from github is
not acceptable</li>
  <li>following the distribution’s best practices for packaging as much as possible.
For example, this could mean using <code class="highlighter-rouge">rpmbuild</code> or <code class="highlighter-rouge">debuild</code> or similiar instead
of manually building a package from binaries created separately</li>
</ul>

<p>The HHVM support lifecycle for any other distributions would likely be similar
to our support lifecycle for Debian and Ubuntu, aiming to provide some upgrade
window while allowing us to frequently update the minimum versions of
dependencies.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/11/11/hhvm-4.31.html">HHVM 4.31.0</a></h1>
    <p class="post-meta">发布于 2019 年 11 月 11 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.31 is released! This release marks the end of support for 4.25;
4.26–4.30 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Added new <code class="highlighter-rouge">HH\Lib\SQL\Query</code> object, and <code class="highlighter-rouge">AsyncMysqlConnection::queryAsync()</code>
method; this is an alternative to <code class="highlighter-rouge">::queryf()</code>. <code class="highlighter-rouge">Query</code> objects:
    <ul>
      <li>are constructed with a <code class="highlighter-rouge">queryf</code>-style format string and a list of parameters</li>
      <li>accept <code class="highlighter-rouge">vec&lt;&gt;</code>s instead of <code class="highlighter-rouge">Vector&lt;&gt;</code>s</li>
      <li>add support for the <code class="highlighter-rouge">%Q</code> placeholder, which accepts another <code class="highlighter-rouge">Query</code> object;
this allows much more flexibility, such as concatenating queries with
<code class="highlighter-rouge">$ab = new Query('%Q %Q', $a, $b)</code></li>
    </ul>
  </li>
  <li>Fixed incorrect ‘out of memory’ errors in <code class="highlighter-rouge">hh_server</code> when <code class="highlighter-rouge">posix_fallocate</code>
fails with <code class="highlighter-rouge">EINTR</code></li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Removed typechecker special-casing of <code class="highlighter-rouge">HH\Tuple\from_async()</code> and
<code class="highlighter-rouge">HH\Asio\va()</code>; ideally, these should be replaced with <code class="highlighter-rouge">concurrent</code> blocks,
or, if a tuple is actually desired, <code class="highlighter-rouge">tuple(await foo(), await bar())</code> can be
used instead</li>
  <li>Removed <code class="highlighter-rouge">HH\Asio\va()</code>’s typechecker definition as it is no longer useful</li>
  <li><code class="highlighter-rouge">ldap_mod_(del|replace|modify)</code> now take a <code class="highlighter-rouge">darray</code> entry argument</li>
  <li>the <code class="highlighter-rouge">(unset)</code> cast has been removed. Use the <code class="highlighter-rouge">null</code> literal instead</li>
  <li><code class="highlighter-rouge">unserialize()</code>ing a PHP array will now create a <code class="highlighter-rouge">varray</code> or <code class="highlighter-rouge">darray</code></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/11/06/hhvm-4.30.html">HHVM 4.30.0</a></h1>
    <p class="post-meta">发布于 2019 年 11 月 6 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.30 is released! This release marks the end of support for 4.24;
4.25–4.29 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>fixed handling of parsing errors in the <code class="highlighter-rouge">mailparse</code> extension (issue
<a href="https://github.com/facebook/hhvm/issues/8532">#8532</a>)</li>
  <li>the typechecker now considers most built-in “auto-imported” types
to be in the <code class="highlighter-rouge">HH</code> namespace (<code class="highlighter-rouge">HH\dict</code>, <code class="highlighter-rouge">HH\Container</code>, etc.), consistently
with how the runtime already treated them
    <ul>
      <li>previously, the typechecker incorrectly considered them to belong to the
root namespace, so this fixes cases where the typechecker would report
errors in correct code (<code class="highlighter-rouge">HH\dict</code>), or not report errors in code that would
fail at runtime (<code class="highlighter-rouge">\dict</code>)</li>
      <li>that said, as these types are auto-imported, it is never necessary, and not
recommended, to refer to them using their fully qualified names (use <code class="highlighter-rouge">dict</code>
instead of <code class="highlighter-rouge">HH\dict</code>, etc.)</li>
      <li>specific types fixed in the current release: <code class="highlighter-rouge">vec</code>, <code class="highlighter-rouge">dict</code>, <code class="highlighter-rouge">keyset</code>,
<code class="highlighter-rouge">Container</code>, <code class="highlighter-rouge">KeyedContainer</code>, <code class="highlighter-rouge">Traversable</code>, <code class="highlighter-rouge">KeyedTraversable</code>,
<code class="highlighter-rouge">Iterable</code>, <code class="highlighter-rouge">KeyedIterable</code>, <code class="highlighter-rouge">Iterator</code>, <code class="highlighter-rouge">KeyedIterator</code>, <code class="highlighter-rouge">AsyncIterator</code>,
<code class="highlighter-rouge">AsyncKeyedIterator</code>, <code class="highlighter-rouge">AsyncGenerator</code></li>
    </ul>
  </li>
</ul>

<h1 id="breaking-changes">Breaking changes</h1>

<ul>
  <li>it is no longer possible to override built-in types using <code class="highlighter-rouge">use</code> statements
(<code class="highlighter-rouge">use MyVector as Vector</code>, <code class="highlighter-rouge">use MyType as string</code>, etc.)</li>
  <li>fixed a few remaining places where built-in types were still treated as
case-insensitive (should not affect most users, as they were already treated
as case-sensitive almost everywhere)</li>
</ul>

<h1 id="future-changes">Future changes</h1>

<ul>
  <li>we are starting to work on deprecating PHP-style anonymous functions
(<code class="highlighter-rouge">function($num) { return $num * 2; }</code>) in favor of lambdas
(<code class="highlighter-rouge">$num ==&gt; $num * 2</code>)
    <ul>
      <li>you can test this by adding <code class="highlighter-rouge">error_php_lambdas=true</code> to your <code class="highlighter-rouge">.hhconfig</code>
(this will likely become the default behavior in the future)</li>
    </ul>
  </li>
  <li>we are working on extending
<a href="https://docs.hhvm.com/hack/reference/function/fb_serialize/"><code class="highlighter-rouge">fb_serialize()</code></a>
to correctly distinguish between all the different array-like types (<code class="highlighter-rouge">vec</code>,
<code class="highlighter-rouge">dict</code>, <code class="highlighter-rouge">keyset</code>, <code class="highlighter-rouge">varray</code>, <code class="highlighter-rouge">darray</code>, <code class="highlighter-rouge">array</code>)
    <ul>
      <li>these changes should be backwards compatible, generally hidden behind new
flags</li>
    </ul>
  </li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/10/29/hhvm-4.29.html">HHVM 4.29.0</a></h1>
    <p class="post-meta">发布于 2019 年 10 月 29 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.29 is released! This release marks the end of support for 4.23;
4.24–4.28 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Error messages now strip <code class="highlighter-rouge">HH\</code> from names that are automatically imported into
every namespace</li>
  <li>Fixed <code class="highlighter-rouge">.hack</code> files not being correctly indexed by some IDE features</li>
  <li>Shape key autocomplete now detects pre-existing quotes, avoiding completions
such as <code class="highlighter-rouge">$someshape['somekey'']</code> with two apostrophes; this was most common
with IDEs configured to automatically insert matching quotation marks.</li>
  <li>Added <code class="highlighter-rouge">RuntimeOption::CheckIntOverflow</code> option:
    <ul>
      <li>if 0 (the default), overflows will silently wrap; this setting has the best
performance</li>
      <li>if 1, overflows will wrap and warn</li>
      <li>if 2, overflows will throw an exception</li>
    </ul>
  </li>
  <li>Autocomplete now downranks magic methods and functions/methods with
<code class="highlighter-rouge">DO_NOT_USE</code> in the name</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">$c-&gt;toVector()</code>, <code class="highlighter-rouge">$c-&gt;toSet()</code>, <code class="highlighter-rouge">$c-&gt;toMap()</code> have been removed from Hack
collections; use <code class="highlighter-rouge">new Vector($c)</code> etc or Hack Arrays instead; this is because
they are not type-safe, as variance checks were added for generics</li>
  <li>auto-imported reserved names (e.g. ‘self’) are now case-sensitive at runtime</li>
  <li><code class="highlighter-rouge">Set::zip()</code> now returns <code class="highlighter-rouge">Set&lt;nothing&gt;</code>, as pairs can not be stored in Sets;
this could lead to new type errors in code that would previously fail at
runtime. Similar changes have been made to <code class="highlighter-rouge">ImmSet</code> and other related classes</li>
  <li><code class="highlighter-rouge">unserialize()</code> no longer creates references; if old serialized data
containing references is used, the referenced value will be copied instead</li>
  <li>references are no longer supported by the parser</li>
  <li>the runtime and typechecker now agree that <code class="highlighter-rouge">Awaitable</code>’s fully-qualified name
is <code class="highlighter-rouge">HH\Awaitable</code>; it remains autoimported. In previous releases, the
runtime considered it to be <code class="highlighter-rouge">HH\Awaitable</code>, but the typechecker considered it
to be <code class="highlighter-rouge">\Awaitable</code></li>
  <li>it is now an error to pass a superglobal as <code class="highlighter-rouge">inout</code></li>
  <li><code class="highlighter-rouge">array</code> (without generics) is now considered to be the union of <code class="highlighter-rouge">array&lt;_&gt;</code>
(a.k.a <code class="highlighter-rouge">varray</code>) and <code class="highlighter-rouge">array&lt;_, _&gt;</code> (a.k.a. <code class="highlighter-rouge">darray</code>); this can lead to
stricter handling of key (<a href="https://github.com/hhvm/user-documentation/commit/20b292e">example 1</a>,
<a href="https://github.com/hhvm/type-assert/commit/597b0f9">example 2</a>)</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/10/28/security-update.html">Security Update</a></h1>
    <p class="post-meta">发布于 2019 年 10 月 28 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A security update has been released for all supported HHVM versions. Please
update to one of the following versions to make sure you’re secure:</p>

<ul>
  <li>4.28.2</li>
  <li>4.27.1</li>
  <li>4.26.1</li>
  <li>4.25.1</li>
  <li>4.24.1</li>
  <li>4.23.2</li>
  <li>4.8.6</li>
  <li>3.30.12</li>
</ul>

<p>This security update addresses multiple potential vulnerabilies, mostly found by
running a new fuzzer over the HHVM codebase.</p>

<p>More information can be found in the respective CVEs:</p>

<ul>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11930">CVE-2019-11930</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11934">CVE-2019-11934</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11935">CVE-2019-11935</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11936">CVE-2019-11936</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/10/23/hhvm-4.28.html">HHVM 4.28</a></h1>
    <p class="post-meta">发布于 2019 年 10 月 23 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.28 is released! This release marks the end of support for 4.22;
4.23–4.27 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<p>Release 4.28.1 fixes some minor bugs that were introduced in 4.28.0.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>New implementation of auto-completion for LSP-based editors, fixing issues
with namespaces.</li>
  <li>A new function,
<a href="https://docs.hhvm.com/hack/reference/function/set_pre_timeout_handler/"><code class="highlighter-rouge">set_pre_timeout_handler</code></a>,
was added. The pre-timeout handler allows cheaper debugging of timeouts by
invoking analysis code a few seconds prior to requests timing out. It also
allows re-registering a new pre-timeout callback much like the memory
threshold callbacks.</li>
  <li>Fixed a bug that would cause <code class="highlighter-rouge">hackfmt</code> to reformat code in a way that breaks
<code class="highlighter-rouge">HH_FIXME</code> comments in some cases.</li>
  <li>It is no longer a type error to reference the built-in type
<code class="highlighter-rouge">HH\BuiltinEnum</code>—the parent type of all <code class="highlighter-rouge">enum</code>s (previously error 2053).</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Declaring a type with the same name as a built-in type (e.g. <code class="highlighter-rouge">int</code>, <code class="highlighter-rouge">Vector</code>,
<code class="highlighter-rouge">Awaitable</code>) will no longer override the built-in type. Such types can now
only be referenced using their namespaced name (e.g. <code class="highlighter-rouge">MyNamespace\Vector</code>, or
<code class="highlighter-rouge">namespace\Vector</code> if in the same namespace).</li>
  <li>It is now a type error to <code class="highlighter-rouge">use</code> multiple traits that declare <code class="highlighter-rouge">__construct()</code>
from the same class.</li>
  <li>Trying to call a non-static method “statically” will now always
trigger a fatal error. This was already true in most cases, except some
special cases where it was previously only a warning (e.g. using a non-static
method in <code class="highlighter-rouge">array_map(['ClassName', 'nonStaticMethodName'], $arr)</code>).</li>
  <li>It is now a type error to pass a value of type <code class="highlighter-rouge">array</code> where a tuple is
expected or vice-versa (previously, this was only an error if the
<code class="highlighter-rouge">disallow_array_as_tuple</code> flag was enabled). Note that this change only
affects <code class="highlighter-rouge">array</code>s with a missing generic type, which would already be an error
in strict mode.</li>
  <li>It is now a type error to call <code class="highlighter-rouge">unset</code> on an element of an <code class="highlighter-rouge">array</code> or <code class="highlighter-rouge">varray</code>
(previously, this was only an error if the <code class="highlighter-rouge">disallow_unset_on_varray</code> flag was
enabled). It can only be called on <code class="highlighter-rouge">dict</code> and <code class="highlighter-rouge">darray</code> elements now.</li>
  <li>The following <code class="highlighter-rouge">.hhconfig</code> flags were removed:
    <ul>
      <li><code class="highlighter-rouge">coercion_from_dynamic</code> (see
<a href="https://docs.hhvm.com/hack/built-in-types/dynamic#coercion">documentation</a>
for current coercion rules for <code class="highlighter-rouge">dynamic</code> values)</li>
      <li><code class="highlighter-rouge">coercion_from_union</code></li>
      <li><code class="highlighter-rouge">safe_array</code> (it is now always a type error to use <code class="highlighter-rouge">array</code> where <code class="highlighter-rouge">array&lt;T&gt;</code>
is expected, which had already been the default behavior)</li>
      <li><code class="highlighter-rouge">safe_vector_array</code> (it is now always a type error to use <code class="highlighter-rouge">array&lt;Tv&gt;</code> where
<code class="highlighter-rouge">array&lt;Tk, Tv&gt;</code> is expected, which had already been the default behavior)</li>
      <li><code class="highlighter-rouge">disallow_array_as_tuple</code> (this changes the default behavior, see above)</li>
      <li><code class="highlighter-rouge">disallow_unset_on_varray</code> (also changes the default behavior)</li>
    </ul>
  </li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/10/14/hhvm-4.27.0.html">HHVM 4.27.0</a></h1>
    <p class="post-meta">发布于 2019 年 10 月 14 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.27 is released! This release marks the end of support for 4.21;
4.22–4.26 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Clearer typechecker error message when a function does not explicitly
return a value in all branches</li>
  <li>Added ‘jump-to-definition’ for overridden methods in LSP-based editors
(e.g. Visual Studio Code)</li>
  <li>go-to-implementation (“textDocument/implementation”) is now implemented in
LSP-based editors for common situations.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">register_postsend_function()</code> and <code class="highlighter-rouge">register_shutdown_function()</code> now take
a single <code class="highlighter-rouge">function(): T</code> argument, instead of a callable and variadic
arguments</li>
  <li><code class="highlighter-rouge">break</code> and <code class="highlighter-rouge">continue</code> with a level (e.g. <code class="highlighter-rouge">break 3;</code>) is now a parse error;
previously, a typechecker error was raised</li>
  <li>usage of abstract type constants now raises a type error in some places where
they do not have meaning (e.g.
<code class="highlighter-rouge">abstract class C { abstract const type T; } function foo(C::T $x)</code>)</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>We aim to drop support for MacOS High Sierra (10.13) and introduce support for
MacOS Catalina (10.15) as soon as Catalina is available from our build
infrastructure provider</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/10/09/hhvm-4.26.0.html">HHVM 4.26.0</a></h1>
    <p class="post-meta">发布于 2019 年 10 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.26 is released! This release marks the end of support for 4.20;
4.21–4.25 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>various IDE integration improvements (better autocompletion, more contextual
information on hover)</li>
  <li>values with
<a href="https://docs.hhvm.com/hack/built-in-types/dynamic"><code class="highlighter-rouge">dynamic</code> type</a> can now be
used in more places (inside XHP, <code class="highlighter-rouge">unset</code> statements)</li>
  <li>it is no longer a Hack error to declare a method with the same name as its
encompassing class (previously error 3007, which was added to prevent
confusion due to the fact that these methods would act as constructors in HHVM
versions prior to 4.0)</li>
  <li>closing an SQLite connection when there are unfinalized prepared statements
will now schedule the connection to be
<a href="https://www.sqlite.org/c3ref/close.html">closed later</a>, instead of returning
an error</li>
  <li>an experimental new syntax was added for union types <code class="highlighter-rouge">(Cat | Dog)</code> and
intersection types <code class="highlighter-rouge">(FourLegged &amp; Mammal)</code> – this is an early
experimental prototype not meant for general use (it is entirely possible that
the prototype will <em>never</em> make it to a final release, depending on, for
example, how it affects typechecking performance in various scenarios), but if
you want to experiment with it, add <code class="highlighter-rouge">union_intersection_type_hints=true</code> to
your <code class="highlighter-rouge">.hhconfig</code></li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>most built-in types (e.g. <code class="highlighter-rouge">int</code>, <code class="highlighter-rouge">vec</code>, <code class="highlighter-rouge">Vector</code>, <code class="highlighter-rouge">Traversable</code>, <code class="highlighter-rouge">Awaitable</code>)
are now case-sensitive at runtime (previously only the typechecker treated
them as case-sensitive)</li>
  <li>magic methods (e.g. <code class="highlighter-rouge">__get</code>, <code class="highlighter-rouge">__call</code>) can no longer have
<a href="https://docs.hhvm.com/hack/functions/inout-parameters">inout parameters</a></li>
  <li>all remaining <code class="highlighter-rouge">&amp;$reference</code> parameters in built-in functions were migrated to
inout parameters or removed – from those, the following ones are not
backwards compatible:
    <ul>
      <li>previously optional argument is now required:
        <ul>
          <li><code class="highlighter-rouge">flock</code> (use <code class="highlighter-rouge">hhast-migrate --ref-to-inout</code> for automated migration)</li>
          <li><code class="highlighter-rouge">SplFileObject::flock</code></li>
        </ul>
      </li>
      <li>previously optional argument was completely removed:
        <ul>
          <li><code class="highlighter-rouge">NumberFormatter::parse</code> (use <code class="highlighter-rouge">parseWithPosition</code> when the optional
argument is needed)</li>
          <li><code class="highlighter-rouge">IntlDateFormatter::parse</code> (use <code class="highlighter-rouge">parseWithPosition</code>)</li>
          <li><code class="highlighter-rouge">Memcached::get</code> (use <code class="highlighter-rouge">getWithCasToken</code>)</li>
          <li><code class="highlighter-rouge">Memcached::getByKey</code> (use <code class="highlighter-rouge">getByKeyWithCasToken</code>)</li>
          <li><code class="highlighter-rouge">Memcached::getMulti</code> (use <code class="highlighter-rouge">getMultiWithCasTokens</code>)</li>
          <li><code class="highlighter-rouge">Memcached::getMultiByKey</code> (use <code class="highlighter-rouge">getMultiByKeyWithCasTokens</code>)</li>
        </ul>
      </li>
      <li>the following functions were completely removed because they used reference
parameters in undesirable ways:
        <ul>
          <li><code class="highlighter-rouge">current_ref</code> (use <code class="highlighter-rouge">current</code> which returns the same value, but takes a
non-reference argument)</li>
          <li><code class="highlighter-rouge">key_ref</code> (use <code class="highlighter-rouge">key</code>)</li>
          <li><code class="highlighter-rouge">xml_set_object_ref</code> (use <code class="highlighter-rouge">xml_set_object</code>)</li>
          <li><code class="highlighter-rouge">PDOStatement::bindParam</code> (use <code class="highlighter-rouge">bindValue</code> instead)</li>
          <li><code class="highlighter-rouge">PDOStatement::bindColumn</code> (use <code class="highlighter-rouge">bindValue</code>)</li>
          <li><code class="highlighter-rouge">SQLite3Stmt::bindparam</code> (use <code class="highlighter-rouge">bindvalue</code>)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<p>With all <code class="highlighter-rouge">&amp;$references</code> in built-in functions gone, we expect that references
will be completely removed from the Hack language within the next few releases.
See <a href="https://hhvm.com/blog/2019/10/01/deprecating-references.html">detailed blog post</a>.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/1405460721/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Daniel Neiter</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/10/01/deprecating-references.html">Deprecating &$references</a></h1>
    <p class="post-meta">发布于 2019 年 10 月 1 日</p>
  </header>

  <article class="post-content">
  
    
      <p>PHP-style references (<code class="highlighter-rouge">&amp;$variable</code>) have been a source of confusion and
unsoundness in the Hack type system (read on to learn why). After a long
effort, we are now finally ready to remove them from the Hack language.</p>

<p><strong>We expect to remove support for PHP-style references from HHVM in about
2–4 weeks.</strong></p>

<h2 id="migrating-your-code">Migrating your code</h2>

<p>By far the most common use case for PHP references is passing function arguments
by reference.
<a href="https://docs.hhvm.com/hack/functions/inout-parameters">Inout parameters</a> are
built to address this use case without relying on PHP references. See also
<a href="https://docs.hhvm.com/hack/functions/inout-parameters#references-deprecated__migrating-to-inout-parameters">Migrating to inout parameters</a>.</p>

<p>We have updated all built-in functions with reference parameters (such as
<code class="highlighter-rouge">sort()</code>, <code class="highlighter-rouge">array_pop()</code>, or <code class="highlighter-rouge">preg_match()</code> with a <code class="highlighter-rouge">&amp;$matches</code> argument) to use
inout parameters instead. In some cases, the function that takes an inout
argument has a new name (e.g. <code class="highlighter-rouge">preg_match_with_matches()</code>). You can migrate your
calls automatically using HHAST v4.21.7 or newer:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>hhast-migrate --ref-to-inout
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For references other than function parameters, the
<a href="https://docs.hhvm.com/hsl/reference/class/HH.Lib.Ref/"><code class="highlighter-rouge">Ref</code></a> class can be used
to explicitly achieve reference semantics when necessary. A common example is
needing to share mutable state between a lambda and enclosing function:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="nf">sort_and_count_comparisons</span><span class="p">(</span><span class="nx">inout</span> <span class="nx">vec</span><span class="o">&lt;</span><span class="nx">int</span><span class="o">&gt;</span> <span class="nv">$a</span><span class="p">)</span><span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
  <span class="nv">$comparisons</span> <span class="o">=</span> <span class="nx">Ref</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="nx">\usort</span><span class="p">(</span>
    <span class="nx">inout</span> <span class="nv">$a</span><span class="p">,</span>
    <span class="p">(</span><span class="nv">$left</span><span class="p">,</span> <span class="nv">$right</span><span class="p">)</span> <span class="o">==&gt;</span> <span class="p">{</span>
      <span class="nv">$comparisons</span><span class="o">-&gt;</span><span class="na">value</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span> <span class="nv">$left</span> <span class="o">-</span> <span class="nv">$right</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">);</span>
  <span class="k">return</span> <span class="nv">$comparisons</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="what-are-php-references">What are PHP references?</h2>

<p>PHP references allow the same variable to be accessed using multiple different
names. Changes done via one reference are visible through all references to the
same variable. Let’s look at a simple example (all examples use PHP7 unless
noted otherwise, as Hack no longer supports most of reference behaviors):</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="nv">$var</span> <span class="o">=</span> <span class="s1">'abc'</span><span class="p">;</span>
<span class="nv">$other_var</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$var</span><span class="p">;</span>          <span class="c1">// $other_var is now an alias to $var
</span><span class="nv">$one_more_var</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$other_var</span><span class="p">;</span> <span class="c1">// $one_more_var is also an alias to $var
</span><span class="nv">$arr</span><span class="p">[</span><span class="s1">'key'</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$var</span><span class="p">;</span>         <span class="c1">// references can be stored inside arrays
</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">prop</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$var</span><span class="p">;</span>          <span class="c1">// and in object properties
</span>
<span class="nv">$other_var</span> <span class="o">=</span> <span class="s1">'def'</span><span class="p">;</span>          <span class="c1">// $var, $other_var, $arr['key'] and $obj-&gt;prop now contain 'def'
</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>       <span class="c1">// iterate over array by reference
</span>  <span class="o">++</span><span class="nv">$x</span><span class="p">;</span>                      <span class="c1">// modifying $x modifies $arr elements
</span><span class="p">}</span>

<span class="k">function</span> <span class="o">&amp;</span><span class="nf">returns_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nv">$arr</span><span class="p">[</span><span class="s1">'key'</span><span class="p">];</span>        <span class="c1">// references can be returned from functions
</span><span class="p">}</span>
<span class="c1">// functions can take parameters by reference
</span><span class="k">function</span> <span class="nf">increment</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$value</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>References are widely used in PHP standard library—<code class="highlighter-rouge">sort()</code>,
<code class="highlighter-rouge">array_pop()</code>, <code class="highlighter-rouge">preg_match()</code> to name a few most frequently used examples.</p>

<h2 id="references-can-be-confusing">References can be confusing</h2>

<p>Let’s look at another example:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$v</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$v</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>What is the produced output, and more importantly why does it work this way?
(<a href="https://3v4l.org/Bi4c0">Spoilers</a>).</p>

<p>This is almost never intended behavior, and the resulting issue is very easy to
miss. As part of deprecating foreach-by-reference support at Facebook we have
discovered multiple bugs, following this pattern.</p>

<h2 id="references-are-unsound">References are unsound</h2>

<p>PHP references are a major blocker for making the Hack type system sound (i.e.
reaching the point where Hack typechecker is correct about types 100% of time).
PHP references were designed for a dynamically typed language and they cannot
be modeled in Hack type system without significantly restricting their power.</p>

<p>The unsoundness problem is best illustrated by another example
(<a href="https://3v4l.org/A2gKE">3v4l</a>):</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
  <span class="k">public</span> <span class="nv">$prop</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>

<span class="nv">$str</span> <span class="o">=</span> <span class="s1">'abc'</span><span class="p">;</span>          <span class="c1">// $str is a string
</span><span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">prop</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$str</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">prop</span><span class="p">);</span>  <span class="c1">// "abc"
</span>
<span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">prop</span> <span class="o">=</span> <span class="nv">$arr</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">prop</span><span class="p">);</span>  <span class="c1">// array()
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>        <span class="c1">// array() - surprise! $str is now an array
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="hhvm-wins">HHVM wins</h2>

<p>PHP references are a significant source of complexity and performance overhead
in HHVM. Moreover, references make it possible for Hack code to observe a number
of runtime implementation details (e.g. reference counting), blocking HHVM team
from exploring more efficient alternatives.</p>

<p>Multiple efforts in HHVM have already taken advantage of references removal. All
of these provided significant measurable CPU improvements when we deployed them
to Facebook servers:</p>

<ul>
  <li><a href="https://hhvm.com/blog/2019/04/09/hhvm-4.1.0.html#property-type-enforcement">Property type enforcement</a>—binding
references to typed properties is disallowed</li>
  <li><a href="https://docs.hhvm.com/hack/built-in-types/arrays">Hack arrays</a>—references
to Hack array elements are disallowed</li>
  <li>improvements around handling function calls in HHVM internals—made
possible by requiring reference (and inout) parameters to be annotated at call
sites</li>
</ul>

<p>With references removal now complete, we expect more wins down the line.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/09/30/hhvm-4.25.0.html">HHVM 4.25.0</a></h1>
    <p class="post-meta">发布于 2019 年 9 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.25 is released! This release marks the end of support for 4.19;
4.20-4.24 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Corrected stack trace file names and line numbers for inlined functions;
previously, the file name and line number from the first non-inlined frame
 would be used instead.</li>
  <li>It is no longer a type error for a disposable to implement a non-disposable
interface.</li>
  <li><code class="highlighter-rouge">@param</code> documentation is now shown in IDE signature help.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>The <code class="highlighter-rouge">getAttributeRecursive</code> and <code class="highlighter-rouge">getAttributesRecursive</code> reflection methods
have been removed; they were previously marked as <code class="highlighter-rouge">__Deprecated</code>.</li>
  <li>Many functions and methods have had their by-ref parameters replaced
with <code class="highlighter-rouge">inout</code> parameters:
    <ul>
      <li><code class="highlighter-rouge">natsort()</code>, <code class="highlighter-rouge">natcasesort()</code>, <code class="highlighter-rouge">sort()</code>, <code class="highlighter-rouge">rsort()</code>, <code class="highlighter-rouge">asort()</code>, <code class="highlighter-rouge">arsort()</code>,
<code class="highlighter-rouge">ksort()</code>, <code class="highlighter-rouge">krsort()</code>, <code class="highlighter-rouge">usort()</code>, <code class="highlighter-rouge">uasort()</code>, and <code class="highlighter-rouge">uksort()</code></li>
      <li><code class="highlighter-rouge">array_pop()</code>, <code class="highlighter-rouge">array_push()</code>, <code class="highlighter-rouge">array_shift()</code>, <code class="highlighter-rouge">array_splice()</code>,
<code class="highlighter-rouge">array_unshift()</code>, and <code class="highlighter-rouge">shuffle()</code></li>
      <li><code class="highlighter-rouge">IntlTimeZone::getOffset()</code></li>
      <li><code class="highlighter-rouge">pagelet_server_task_result()</code>, <code class="highlighter-rouge">xbox_send_message()</code>, and
<code class="highlighter-rouge">xbox_task_result()</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">call_user_method()</code> and <code class="highlighter-rouge">call_user_method_array()</code> have been removed - they
have been deprecated since PHP4.</li>
  <li>the runtime no longer recognizes the aliases <code class="highlighter-rouge">double</code>, <code class="highlighter-rouge">real</code>, <code class="highlighter-rouge">integer</code>, and
<code class="highlighter-rouge">boolean</code>; use <code class="highlighter-rouge">float</code>, <code class="highlighter-rouge">int</code>, and <code class="highlighter-rouge">bool</code> instead. These aliases were
previously typechecker errors.</li>
  <li>Added return types to many Async MySQL methods; this may lead to new type
errors.</li>
</ul>

<p><code class="highlighter-rouge">hhast-migrate --ref-to-inout</code> can be used for many of the reference-to-inout
changes.</p>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>references will be completely removed from the language and runtime; we will
be publishing details in a separate post.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/09/25/security-update.html">Security Update</a></h1>
    <p class="post-meta">发布于 2019 年 9 月 25 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A security update has been released for all supported HHVM versions. Please
update to one of the following versions to make sure you’re secure:</p>

<ul>
  <li>4.24.0</li>
  <li>4.23.1</li>
  <li>4.22.1</li>
  <li>4.21.1</li>
  <li>4.20.3</li>
  <li>4.19.2</li>
  <li>4.18.3</li>
  <li>4.8.5</li>
  <li>3.30.11</li>
</ul>

<p>This security update addresses a possible memory overflow in the
<code class="highlighter-rouge">number_format()</code> function.</p>

<p>More information can be found in the respective CVE:</p>

<ul>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11929">CVE-2019-11929</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/09/23/hhvm-4.24.0.html">HHVM 4.24.0</a></h1>
    <p class="post-meta">发布于 2019 年 9 月 23 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.24 is released! This release marks the end of support for 4.18;
4.19-4.23 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>We are now building packages for Debian 10 (Buster). Debian 10 support is currently experimental, please <a href="https://github.com/hhvm/packaging/issues/new">open an issue</a> if you notice any problems.</li>
  <li>Fixed a bug that could cause segfaults in JIT internals (i.e., not while executing code) on Ubuntu 19.04 (Disco Dingo).</li>
  <li>Parser error handling has been rewritten from OCaml to Rust. This should cause no user-facing changes, but please <a href="https://github.com/facebook/hhvm/issues/new">open an issue</a> if you notice any problems. This can be disabled by adding <code class="highlighter-rouge">hhvm.hack.lang.hack_compiler_use_rust_parser_errors</code> to <code class="highlighter-rouge">hhvm.ini</code>.</li>
  <li>Fixed misleading error message when <code class="highlighter-rouge">await</code> was used on the right side of a pipe <code class="highlighter-rouge">|&gt;</code> operator.</li>
  <li><code class="highlighter-rouge">fun()</code> and <code class="highlighter-rouge">class_meth()</code> can now be used inside constant expressions (this can be disabled by adding <code class="highlighter-rouge">disallow_func_ptrs_in_constants=true</code> to <code class="highlighter-rouge">.hhconfig</code>).</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="nx">const</span> <span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span><span class="p">)</span> <span class="nx">FUNCTION</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">(</span><span class="s1">'time'</span><span class="p">);</span>
  <span class="k">private</span> <span class="k">static</span> <span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span><span class="p">)</span> <span class="nv">$method</span> <span class="o">=</span> <span class="nx">class_meth</span><span class="p">(</span><span class="s1">'Foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>casting to <code class="highlighter-rouge">object</code> (<code class="highlighter-rouge">(object)$value</code>) is no longer supported by the runtime (it was already a type checker error in strict mode)</li>
  <li>the built-in function <code class="highlighter-rouge">pg_fetch_object</code> was removed (use <code class="highlighter-rouge">pg_fetch_assoc</code> instead)</li>
  <li>the following built-in functions had an optional passed-by-reference parameter <strong>removed</strong>:
    <ul>
      <li><code class="highlighter-rouge">str_replace</code> (use <code class="highlighter-rouge">str_replace_with_count</code> instead when needed)</li>
      <li><code class="highlighter-rouge">str_ireplace</code> (use <code class="highlighter-rouge">str_ireplace_with_count</code>)</li>
      <li><code class="highlighter-rouge">headers_sent</code> (use <code class="highlighter-rouge">headers_sent_with_file_line</code>)</li>
      <li><code class="highlighter-rouge">openssl_encrypt</code> (use <code class="highlighter-rouge">openssl_encrypt_with_tag</code>)</li>
      <li><code class="highlighter-rouge">array_multisort</code> was removed completely (use <code class="highlighter-rouge">array_multisort1</code>, <code class="highlighter-rouge">array_multisort2</code>, etc. depending on the number of arguments you need to pass in—up to <code class="highlighter-rouge">array_multisort9</code>)</li>
      <li>use <code class="highlighter-rouge">hhast-migrate --ref-to-inout</code> to automatically migrate your calls</li>
    </ul>
  </li>
  <li>the following built-in functions that previously had optional passed-by-reference parameters, now have <strong>non-optional</strong> <a href="https://docs.hhvm.com/hack/functions/inout-parameters"><code class="highlighter-rouge">inout</code> parameters</a>:
    <ul>
      <li>string functions: <code class="highlighter-rouge">similar_text</code>, <code class="highlighter-rouge">parse_str</code></li>
      <li>multi-byte string functions: <code class="highlighter-rouge">mb_convert_variables</code>, <code class="highlighter-rouge">mb_ereg</code>, <code class="highlighter-rouge">mb_eregi</code>, <code class="highlighter-rouge">mb_parse_str</code></li>
      <li>image functions: <code class="highlighter-rouge">getimagesize</code>, <code class="highlighter-rouge">exif_thumbnail</code></li>
      <li>IPC functions: <code class="highlighter-rouge">msg_send</code>, <code class="highlighter-rouge">msg_receive</code></li>
      <li>LDAP functions: <code class="highlighter-rouge">ldap_parse_result</code>, <code class="highlighter-rouge">ldap_control_paged_result_response</code></li>
      <li>exec-family functions: <code class="highlighter-rouge">exec</code>, <code class="highlighter-rouge">passthru</code>, <code class="highlighter-rouge">system</code></li>
      <li>socket functions: <code class="highlighter-rouge">fsockopen</code>, <code class="highlighter-rouge">pfsockopen</code>, <code class="highlighter-rouge">socket_server</code>, <code class="highlighter-rouge">stream_socket_accept</code>, <code class="highlighter-rouge">stream_socket_server</code>, <code class="highlighter-rouge">stream_socket_client</code>, <code class="highlighter-rouge">stream_socket_recvfrom</code>, <code class="highlighter-rouge">socket_getpeername</code>, <code class="highlighter-rouge">socket_getsockname</code>, <code class="highlighter-rouge">socket_recvfrom</code></li>
      <li>network functions: <code class="highlighter-rouge">dns_get_record</code>, <code class="highlighter-rouge">dns_get_mx</code>, <code class="highlighter-rouge">getmxrr</code></li>
      <li>OpenSSL functions: <code class="highlighter-rouge">openssl_random_pseudo_bytes</code></li>
      <li>use <code class="highlighter-rouge">hhast-migrate --ref-to-inout</code> to automatically migrate your calls</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">AsyncMysqlConnectionPool::connect(): Awaitable&lt;AsyncMysqlConnection&gt;</code> now declares a return type (previously untyped)</li>
  <li><code class="highlighter-rouge">hh_client --typed-full-fidelity-json</code> is no longer supported (it has been producing incorrect results in most cases)</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>The <code class="highlighter-rouge">hhvm.ini</code> option <code class="highlighter-rouge">hhvm.hack.lang.hack_compiler_use_rust_parser_errors</code> (see above) is expected to be removed in the next release (HHVM 4.25).</li>
  <li>The <code class="highlighter-rouge">.hhconfig</code> option <code class="highlighter-rouge">coercion_from_dynamic</code> will be removed soon. See <a href="https://docs.hhvm.com/hack/built-in-types/dynamic">documentation</a> for detailed coercion rules for the <code class="highlighter-rouge">dynamic</code> type.</li>
  <li>The default values for the <code class="highlighter-rouge">hhvm.ini</code> options <code class="highlighter-rouge">hhvm.check_prop_type_hints</code> and <code class="highlighter-rouge">hhvm.check_return_type_hints</code> will soon be changed to <code class="highlighter-rouge">3</code> (fatal error) and the options should be removed soon after that.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/09/17/hhvm-4.23.0.html">HHVM 4.23.0</a></h1>
    <p class="post-meta">发布于 2019 年 9 月 17 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.23 is released! This release marks the end of support for 4.17;
4.18-4.22 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>fixed runtime error calling static methods with reified generics on dynamic
class names, e.g. <code class="highlighter-rouge">$class::foo&lt;int&gt;()</code></li>
  <li>clearer typechecker error messages for invalid method and property access</li>
  <li>clearer runtime error when calling an undefined method with <code class="highlighter-rouge">inout</code> parameters</li>
  <li>if the admin server is enabled with a password, it is now possible to allow
access to statistics without the password with the
<code class="highlighter-rouge">hhvm.admin_server.stats_need_password</code> INI setting.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Fix variance checks for <code class="highlighter-rouge">where</code> constraints with generics</li>
  <li>It is now a typechecker error to have multiple <code class="highlighter-rouge">default:</code> cases in a <code class="highlighter-rouge">switch</code>;
this was previously a runtime error</li>
  <li>A typechecker error is now raised if a <code class="highlighter-rouge">default:</code> case is present in a
<code class="highlighter-rouge">switch</code> but is not the last case.</li>
  <li>Deleted temporary APIs for reified generics:
    <ul>
      <li><code class="highlighter-rouge">HH\ReifiedGenerics\getTypeStructure()</code>: use
<code class="highlighter-rouge">HH\ReifiedGenerics\get_type_structure()</code> instead</li>
      <li><code class="highlighter-rouge">HH\ReifiedGenerics\getClassname()</code>: use
<code class="highlighter-rouge">HH\ReifiedGenerics\get_classname()</code> instead</li>
    </ul>
  </li>
  <li>Accessing <code class="highlighter-rouge">$GLOBALS</code> without a subcript is now a parse error. Use
<code class="highlighter-rouge">HH\global_keys()</code> instead if you need to enumarate the full list.</li>
  <li>The XML, memcache, memcached, and PCRE extensions have been migrated from
taking parameters by reference to taking <code class="highlighter-rouge">inout</code> parameters; in many cases
this is just a change to the calling convention, however there are
more significant changes, due to <code class="highlighter-rouge">inout</code> parameters not permitting default
values; in particular:
    <ul>
      <li><code class="highlighter-rouge">Memcache::get()</code> and <code class="highlighter-rouge">memcache_get()</code> no longer take a <code class="highlighter-rouge">&amp;$flags</code> parameter;
this parameter previously had no effect in HHVM.</li>
      <li><code class="highlighter-rouge">preg_replace_callback()</code> no longer has an optional <code class="highlighter-rouge">$count</code> parameter;
call <code class="highlighter-rouge">preg_replace_callback_with_count()</code> if a count is required.</li>
      <li>the <code class="highlighter-rouge">$position</code> parameter for <code class="highlighter-rouge">NumberFormatter::parseCurrency()</code> is no longer
optional</li>
      <li>the <code class="highlighter-rouge">$isSystemID</code> parameter for <code class="highlighter-rouge">IntlTimeZone::getCanonicalID()</code> is no longer
optional</li>
      <li>the <code class="highlighter-rouge">$issuesFound</code> parameters for <code class="highlighter-rouge">SpoofChecker::areConfusable()</code> and
<code class="highlighter-rouge">SpoofChecker::isSuspicious()</code> are no longer optional</li>
      <li>the <code class="highlighter-rouge">ereg()</code> and <code class="highlighter-rouge">eregi()</code> functions have been removed</li>
      <li>the <code class="highlighter-rouge">array_walk()</code> and <code class="highlighter-rouge">array_walk_recursive()</code> functions have been removed</li>
      <li><code class="highlighter-rouge">idn_to_ascii()</code>, <code class="highlighter-rouge">idn_to_utf8()</code>, and <code class="highlighter-rouge">idn_to_unicode()</code> no longer take an
optional <code class="highlighter-rouge">&amp;$info</code> parameter</li>
    </ul>
  </li>
</ul>

<p><a href="https://github.com/hhvm/hhast"><code class="highlighter-rouge">hhast-migrate --ref-to-inout</code></a> can be used to
automatically migrate many of these cases.</p>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>We will shortly be switching to an improved implementation of autocomplete
for editors that use LSP, such as Visual Studio Code or Vim with ALE. This
can be trialled now by starting <code class="highlighter-rouge">hh_server</code> with
<code class="highlighter-rouge">--config symbolindex_search_provider=SqliteIndex</code></li>
  <li>The optional <code class="highlighter-rouge">&amp;$cas_token</code> parameters for various memcached functions will
be removed; we recommend moving to the <code class="highlighter-rouge">inout</code> versions of these functions.</li>
  <li>The optional <code class="highlighter-rouge">&amp;$position</code> parameters for <code class="highlighter-rouge">NumberFormatter::parse()</code> and
<code class="highlighter-rouge">IntlDateFormatter::parse()</code> will be removed; use
<code class="highlighter-rouge">::parseWithPosition()</code> instead.</li>
  <li>The following functions and methods that depend on references will be removed:
    <ul>
      <li><code class="highlighter-rouge">call_user_method()</code></li>
      <li><code class="highlighter-rouge">call_user_method_array()</code></li>
      <li><code class="highlighter-rouge">PDO::bindParam()</code></li>
      <li><code class="highlighter-rouge">PDO::bindColumn()</code></li>
      <li><code class="highlighter-rouge">SQLite3::bindparam()</code></li>
    </ul>
  </li>
</ul>

<p><a href="https://github.com/hhvm/hhast"><code class="highlighter-rouge">hhast-migrate --ref-to-inout</code></a> can be used to
automatically migrate many of these cases.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/09/09/hhvm-4.22.0.html">HHVM 4.22.0</a></h1>
    <p class="post-meta">发布于 2019 年 9 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.22 is released! This release marks the end of support for 4.16;
4.17-4.21 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>The Hack language parser has been rewritten in Rust (previously OCaml). In the
previous two HHVM versions, using the new parser was optional, but this
release completely removes the old parser and the new parser is now always
used. This should not cause any user-facing changes, but if you see any
differences in behavior or other issues, please
<a href="https://github.com/facebook/hhvm/issues/new">open a GitHub issue</a>.</li>
  <li>Fixed various bugs at <a href="https://docs.hhvm.com/">docs.hhvm.com</a>
(wrong namespaces, missing links, etc.)</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>fixed a bug that allowed arbitrary values to be coerced to <code class="highlighter-rouge">?dynamic</code></li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="nf">foo</span><span class="p">()</span><span class="o">:</span> <span class="o">?</span><span class="nx">dynamic</span> <span class="p">{</span>
  <span class="k">return</span> <span class="mi">42</span><span class="p">;</span>  <span class="c1">// now an error
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>it is now a typechecker error to specify generic type parameters for <code class="highlighter-rouge">dynamic</code> (previously they were simply ignored)</li>
  <li>fixed a bug that prevented the typechecker from correctly detecting conflicting <code class="highlighter-rouge">use const</code> declarations in some cases</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">use</span> <span class="k">const</span> <span class="no">Foo</span><span class="nx">\A</span> <span class="k">as</span> <span class="nx">A</span><span class="p">;</span>
<span class="o">...</span>
<span class="k">use</span> <span class="k">const</span> <span class="no">Foo</span><span class="nx">\B</span> <span class="k">as</span> <span class="nx">A</span><span class="p">;</span>  <span class="c1">// now an error, previously not always an error
</span></pre></td></tr></tbody></table></code></pre></div></div>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/09/03/the-hhvm-4.21.0.html">HHVM 4.21.0</a></h1>
    <p class="post-meta">发布于 2019 年 9 月 3 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.21 is released! This release marks the end of support for 4.15;
4.16-4.20 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>This release includes the
<a href="https://hhvm.com/blog/2019/09/03/security-update.html">security patch</a>
that was also applied to all supported older releases.</li>
  <li>We are rewriting parts of our code from OCaml to Rust. This should not cause
any user-facing changes. In the previous release (HHVM 4.20), a new parser
written in Rust was added. It is now enabled by default, but you can still
disable it by adding <code class="highlighter-rouge">hack.lang.hack_compiler_use_rust_parser=0</code> to
<code class="highlighter-rouge">hhvm.ini</code>. If you see any differences in behavior or other issues, please
<a href="https://github.com/facebook/hhvm/issues/new">open a GitHub issue</a>.</li>
  <li>A new command <code class="highlighter-rouge">hh_client --rewrite-parameter-types &lt;filename&gt;</code> is now
available to help with migration from partial to strict mode. It adds
<code class="highlighter-rouge">&lt;&lt;__Soft&gt;&gt;</code> type annotations based on inferred parameter types.</li>
  <li>Class constants in a subclass can now be declared with a subtype of their type
in the parent class (previously the exact same type was required).</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span> <span class="k">const</span> <span class="no">arraykey</span> <span class="nx">C</span> <span class="o">=</span> <span class="s1">'string'</span><span class="p">;</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">B</span> <span class="k">extends</span> <span class="nx">A</span> <span class="p">{</span> <span class="k">const</span> <span class="no">int</span> <span class="nx">C</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>Fixed a bug that prevented <code class="highlighter-rouge">await</code> from working inside <code class="highlighter-rouge">echo</code> and <code class="highlighter-rouge">unset</code>
statements in some cases.</li>
  <li>Fixed a bug that prevented the documentation for many built-in functions from
being correctly parsed. As a result, many more functions are now documented at
<a href="https://docs.hhvm.com/">docs.hhvm.com</a>.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>An optional passed-by-reference argument was <strong>removed</strong> from the following
functions. For most of them, a replacement with the old signature is
available. For <code class="highlighter-rouge">preg_match</code> and <code class="highlighter-rouge">preg_match_all</code>, automated migration is
available in HHAST 4.15.5 (runs on HHVM 4.18-4.20) and 4.21.2 (runs on
HHVM 4.21).
    <ul>
      <li><code class="highlighter-rouge">icu_match</code> (use <code class="highlighter-rouge">icu_match_with_matches</code> instead)</li>
      <li><code class="highlighter-rouge">idn_to_ascii</code> (no replacement available)</li>
      <li><code class="highlighter-rouge">idn_to_unicode</code> (no replacement available)</li>
      <li><code class="highlighter-rouge">idn_to_utf8</code> (no replacement available)</li>
      <li><code class="highlighter-rouge">is_callable</code> (use <code class="highlighter-rouge">is_callable_with_name</code> instead)</li>
      <li><code class="highlighter-rouge">preg_match</code> (use <code class="highlighter-rouge">preg_match_with_matches</code> instead)</li>
      <li><code class="highlighter-rouge">preg_match_all</code> (use <code class="highlighter-rouge">preg_match_all_with_matches</code> instead)</li>
    </ul>
  </li>
  <li>The last argument (passed by reference) was <strong>changed from optional to
required</strong> in the following functions.
    <ul>
      <li><code class="highlighter-rouge">apc_dec</code> (last 2 arguments)</li>
      <li><code class="highlighter-rouge">apc_inc</code> (last 2 arguments)</li>
      <li><code class="highlighter-rouge">curl_multi_info_read</code></li>
      <li><code class="highlighter-rouge">datefmt_parse</code></li>
      <li><code class="highlighter-rouge">grapheme_extract</code></li>
      <li><code class="highlighter-rouge">IntlTimeZone::getCanonicalID</code></li>
      <li><code class="highlighter-rouge">intltz_get_canonical_id</code></li>
      <li><code class="highlighter-rouge">NumberFormatter::parseCurrency</code></li>
      <li><code class="highlighter-rouge">numfmt_parse</code></li>
      <li><code class="highlighter-rouge">numfmt_parse_currency</code></li>
      <li><code class="highlighter-rouge">SpoofChecker::areConfusable</code></li>
      <li><code class="highlighter-rouge">SpoofChecker::isSuspicious</code></li>
    </ul>
  </li>
  <li>Fixed a bug where the last argument of the following functions was incorrectly
declared as optional. It was already a runtime error to omit the argument, but
now it is also a typechecker error.
    <ul>
      <li><code class="highlighter-rouge">apc_fetch</code></li>
      <li><code class="highlighter-rouge">datefmt_localtime</code></li>
      <li><code class="highlighter-rouge">IntlDateFormatter::localtime</code></li>
    </ul>
  </li>
  <li>Fixed a bug that allowed an abstract constant to remain undefined when
<a href="https://github.com/facebook/hhvm/blob/b7716973c15ccb5e31951beaa7ecb48e2c7475e7/hphp/hack/test/typecheck/tconst/abstract_type_in_concrete_class_with_trait.php">a trait with <code class="highlighter-rouge">require extends</code></a>
is used.</li>
</ul>

<h1 id="future-changes">Future changes</h1>

<ul>
  <li>In HHVM 4.22 (the next release), the old parser will be removed and the Rust
parser will become the only one available.</li>
  <li>The last argument (passed by reference) of <code class="highlighter-rouge">NumberFormatter::parse</code> will be
removed in the next release. Any calls that require this argument can be
migrated to <code class="highlighter-rouge">NumberFormatter::parseWithPosition</code> which has the old signature.</li>
  <li>Soon, it will be an error to use a built-in attribute in an invalid location.
You can enable this behavior now by adding
<code class="highlighter-rouge">check_attribute_locations=true</code> to <code class="highlighter-rouge">.hhconfig</code>.</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;</span><span class="err">&lt;</span><span class="na">__Memoize</span><span class="nt">&gt;</span>&gt; class C { ... }  // invalid!
<span class="nt">&lt;</span><span class="err">&lt;</span><span class="na">__ConsistentConstruct</span><span class="nt">&gt;</span>&gt; function f() { ... }  // invalid!
</pre></td></tr></tbody></table></code></pre></div></div>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/09/03/security-update.html">Security Update</a></h1>
    <p class="post-meta">发布于 2019 年 9 月 3 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A security update has been released for all supported HHVM versions. Please
update to one of the following versions to get the update:</p>

<ul>
  <li>4.21.0 (new version being released today)</li>
  <li>4.20.2</li>
  <li>4.19.1</li>
  <li>4.18.2</li>
  <li>4.17.3</li>
  <li>4.16.4</li>
  <li>4.15.3</li>
  <li>4.8.4</li>
  <li>3.30.10</li>
</ul>

<p>This security update addresses a possible memory overflow in the GD extension
when a carefully constructed invalid JPEG input is passed in.</p>

<p>More information can be found in the respective CVEs:</p>

<ul>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11925">CVE-2019-11925</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11926">CVE-2019-11926</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/08/27/hhvm-4.20.0.html">HHVM 4.20.0 and 4.20.1</a></h1>
    <p class="post-meta">发布于 2019 年 8 月 27 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.20 is released! This release marks the end of support for 4.14;
4.15-4.19 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<p>HHVM 4.20.1 was released to fix a build issue related to the new Rust parser on
Mac OS X. All Linux builds for 4.20.1 are identical to 4.20.0.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>We are rewriting parts of our code from OCaml to Rust. This should not cause
any user-facing changes. The 4.20 release adds a new parser written in Rust,
which you can test by adding <code class="highlighter-rouge">hack.lang.hack_compiler_use_rust_parser=1</code> to
<code class="highlighter-rouge">hhvm.ini</code>. If you see any differences in behavior or other issues, please
<a href="https://github.com/facebook/hhvm/issues/new">open a GitHub issue</a>.</li>
  <li>A new command <code class="highlighter-rouge">hh_client --rewrite-return-type &lt;filename&gt;</code> is now available to
help with migration from partial to strict mode. It adds <code class="highlighter-rouge">&lt;&lt;__Soft&gt;&gt;</code> type
annotations based on inferred return types.</li>
  <li>Invalid method calls on reified generic types now throw a
<code class="highlighter-rouge">BadMethodCallException</code> instead of causing a fatal error.</li>
  <li>A new function
<a href="https://github.com/facebook/hhvm/blob/eafc93691184c201ab5a07f40f88531ccc161829/hphp/runtime/ext/fb/ext_fb.php#L79"><code class="highlighter-rouge">fb_intercept2()</code></a>
was added as a replacement for <code class="highlighter-rouge">fb_intercept()</code>.</li>
  <li>A new function
<a href="https://github.com/facebook/hhvm/blob/9ff2c8c4ef3e5d116f36a96808d6daa0078592cd/hphp/runtime/ext/std/ext_std_function.php#L108"><code class="highlighter-rouge">fun_get_function()</code></a>
was added.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">HH_FIXME[4110]</code> has been replaced with several new, more specific error
codes. HHAST 4.15.2 provides an automated migration:
<code class="highlighter-rouge">hhast-migrate --migrate-fixme-4110 &lt;path&gt;</code> (this migration adds the new
<code class="highlighter-rouge">FIXME</code>s without removing the old ones - after upgrading to HHVM 4.20, the old
<code class="highlighter-rouge">FIXME</code>s can be removed with <code class="highlighter-rouge">hh_client --remove-dead-fixmes</code>). The Hack
Standard Library and other Hack libraries all provide a new release that works
on both HHVM 4.20 and previous HHVM versions.</li>
  <li>Using attributes on variadic arguments (<code class="highlighter-rouge">&lt;&lt;Attrib&gt;&gt; ...$arg</code>) is now a parser
error.</li>
  <li>We are no longer building packages for Ubuntu 14.04 (Trusty Tahr).</li>
</ul>

<h1 id="future-changes">Future changes</h1>

<ul>
  <li>In HHVM 4.21, the new Rust parser will be enabled by default (with the option
to opt-out).</li>
  <li>In HHVM 4.22, the old parser will be removed and the Rust parser will become
the only one available.</li>
  <li>Using <code class="highlighter-rouge">unset()</code> on a class constant will soon be a parser error (previously,
such calls did nothing). You can enable this behavior now by adding
<code class="highlighter-rouge">disable_unset_class_const=true</code> to <code class="highlighter-rouge">.hhconfig</code>.</li>
  <li>Calling <code class="highlighter-rouge">class_meth()</code> with arguments that are not string literals will soon
trigger a runtime warning (it is already a typechecker error). You can enable
this behavior now by running HHVM with
<code class="highlighter-rouge">-vEval.EmitFuncPointers=1 -vEval.EmitClsMethPointers=1 -vEval.WarnOnNonLiteralClsMeth=1</code></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/08/19/hhvm-4.19.0.html">HHVM 4.19.0</a></h1>
    <p class="post-meta">发布于 2019 年 8 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.19 is released! This release marks the end of support for 4.13;
4.14-4.18 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Added the <code class="highlighter-rouge">&lt;&lt;__Explicit&gt;&gt;</code> attribute, requiring that generics are specified;
for example, <code class="highlighter-rouge">function foo&lt;T&gt;(T $a, T $b) {}</code> <code class="highlighter-rouge">foo(123, 'abc').</code> is valid,
as <code class="highlighter-rouge">mixed</code> is a valid type for <code class="highlighter-rouge">T</code>; however, for
<code class="highlighter-rouge">function foo&lt;&lt;&lt;__Explicit&gt;&gt; T&gt;(T $a, T $b) {}</code>, <code class="highlighter-rouge">foo&lt;int&gt;(123, 456)</code> is
valid, but <code class="highlighter-rouge">foo&lt;int&gt;(123, 'abc')</code> is not.</li>
  <li>Added <code class="highlighter-rouge">ReflectionFunctionAbstract::getReifiedTypeParamInfo()</code></li>
  <li>As a migration aid, <code class="highlighter-rouge">dict</code>s are now callable in the runtime; this will raise
a typechecker error, and is not suitable for use in new code.</li>
  <li>As a migration aid, added <code class="highlighter-rouge">current_ref()</code>, <code class="highlighter-rouge">key_ref()</code>, and
<code class="highlighter-rouge">xml_set_object_ref()</code>, in preparation for modifying <code class="highlighter-rouge">current()</code>, <code class="highlighter-rouge">key()</code>,
and <code class="highlighter-rouge">xml_set_object()</code> to not take their parameters by-reference.</li>
  <li>Added <code class="highlighter-rouge">openssl_encrypt_with_tag()</code>, as optional inout arguments are not
supported, in preparation for removing the optional byref tag argument from
<code class="highlighter-rouge">openssl_encrypt()</code></li>
  <li>Added TLS client certificate authentication support to the proxygen server;
this can be configured via the <code class="highlighter-rouge">hhvm.server.ssl_client_ca_file</code> and
<code class="highlighter-rouge">hhvm.server.ssl_client_auth_level</code> options; level 0 is disabled,
1 is optional, 2 is mandatory. If level is not 0, the CA file must be
specified.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Added typechecker error for unsafe calls to generic static methods via
 <code class="highlighter-rouge">classname&lt;T&gt;</code> variables.</li>
  <li>Removed support for <code class="highlighter-rouge">"${foo}"</code>-style string interpolation; use <code class="highlighter-rouge">"{$foo}"</code>
instead. <code class="highlighter-rouge">hhast-migrate --dollar-brace-interpolation</code> can be used to update
code as needed, and the <code class="highlighter-rouge">disable_outside_dollar_str_interp=true</code> <code class="highlighter-rouge">.hhconfig</code>
option can be used on previous versions to find problem cases.</li>
  <li><code class="highlighter-rouge">usort()</code>, <code class="highlighter-rouge">uasort()</code>, and <code class="highlighter-rouge">uksort()</code> now specify the type of the callback,
instead of taking <code class="highlighter-rouge">mixed</code>.</li>
  <li><code class="highlighter-rouge">final interface</code> and <code class="highlighter-rouge">final trait</code> are now parse errors.</li>
  <li>A typechecker error is now raised if abstract properties are declared on
non-abstract classes.</li>
  <li>It is now a parse error to attempt to use the return value of a function
by-reference.</li>
  <li>Added typechecker errors where builtin attributes are used in unsupported
places; for example, it is now an error to attach the <code class="highlighter-rouge">&lt;&lt;__EntryPoint&gt;&gt;</code>
attribute to a class.</li>
  <li>Fixed variance checks for generic variadics.</li>
  <li>It is now a parse error to declare a property using the PHP <code class="highlighter-rouge">var</code> keyword.</li>
  <li>The <code class="highlighter-rouge">Stringish</code> interface is deprecated, and can not be converted to a string
without a typechecker error. As a temporary aid, it may be useful to define a
function like the following:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>function stringish_cast(mixed $value): string {
    return is_object($value) &amp;&amp; $value is Stringish
      /* HH_IGNORE_ERROR[4128] This is intentionally deprecated */
      ? $value-&gt;__toString()
      : (string)$value;
}
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="future-changes">Future changes</h1>

<ul>
  <li>Error messages will be improved for use of <code class="highlighter-rouge">Stringish</code></li>
  <li>The 4110 (type/unification error) code will be split into multiple error
codes; this will need changes to <code class="highlighter-rouge">HH_FIXME[4110]</code> and similar suppressions.
These changes can be found now with the <code class="highlighter-rouge">use_new_type_errors=true</code> option in
<code class="highlighter-rouge">.hhconfig</code>.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/08/14/security-update.html">Security Update</a></h1>
    <p class="post-meta">发布于 2019 年 8 月 14 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A security update has been released for all supported HHVM versions. Please
update to one of the following versions to get the update:</p>

<ul>
  <li>4.18.1</li>
  <li>4.17.2</li>
  <li>4.16.3</li>
  <li>4.15.2</li>
  <li>4.14.2</li>
  <li>4.13.2</li>
  <li>4.12.2</li>
  <li>4.8.3</li>
  <li>3.30.9</li>
</ul>

<p>This security update addresses a HTTP/2 Deny-of-Service vulnerability in the
Proxygen library bundled with HHVM.</p>

<p>More information can be found in the respective CVEs:</p>

<ul>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9512">CVE-2019-9512</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9513">CVE-2019-9513</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9514">CVE-2019-9514</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9515">CVE-2019-9515</a></li>
</ul>

<p>Note that these vulnerabilities are not specific to HHVM or Proxygen, so keep an
eye out for updates to other HTTP/2 server and client packages.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/08/12/hhvm-4.18.0.html">HHVM 4.18.0</a></h1>
    <p class="post-meta">发布于 2019 年 8 月 12 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.18 is released! This release marks the end of support for 4.12;
4.13-4.17 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<p>This release only contains minor improvements/cleanups, but there is one notable
future change to be aware of.</p>

<h1 id="future-changes">Future changes</h1>

<ul>
  <li>Typechecker error code 4110 (currently covering almost all “type mismatch”
errors) will soon be replaced with several more specific error codes. This
will not cause any runtime changes, but any code that uses <code class="highlighter-rouge">HH_FIXME[4110]</code>
may need to be updated to avoid typechecker errors.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/08/07/bugfixes.html">Bugfixes for 3.30, 4.8, and 4.12-17</a></h1>
    <p class="post-meta">发布于 2019 年 8 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.30.8, 4.8.2, 4.12.1, 4.13.1, 4.14.1, 4.15.1, 4.16.2, and 4.17.1 are now
available; these are non-urgent bugfix releases, containing fixes backported
from later releases.</p>

<table>
  <thead>
    <tr>
      <th>Versions</th>
      <th>Issue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4.16, 4.17</td>
      <td>Fixed a bug where HackC would access shared memory (unneeded by HackC), leading to an exception being thrown.</td>
    </tr>
    <tr>
      <td>3.30, 4.8, 4.12-4.14</td>
      <td>Fixed a bug when using CLI server mode that could lead to CLI clients hanging forever when the script is finished.</td>
    </tr>
    <tr>
      <td>4.8</td>
      <td>Improve reliability when Xenon is enabled by using <code class="highlighter-rouge">SIGPROF</code> instead of <code class="highlighter-rouge">SIGVTALRM</code>, and by ignoring Xenon signals if received extremely early in HHVM startup</td>
    </tr>
    <tr>
      <td>4.8</td>
      <td>Fix crash when attempting to use repo-authorititative mode on MacOS</td>
    </tr>
  </tbody>
</table>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/08/05/hhvm-4.17.0.html">HHVM 4.17.0</a></h1>
    <p class="post-meta">发布于 2019 年 8 月 5 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.17 is released! This release marks the end of support for 4.11;
4.12-4.16 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<p><strong>Reified generics</strong> are now supported. See
<a href="https://docs.hhvm.com/hack/generics/reified-generics">full documentation</a> and
<a href="https://docs.hhvm.com/hack/generics/reified-generics-migration">migration guide</a>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="nf">foo</span><span class="o">&lt;</span><span class="nx">reify</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">T</span> <span class="nv">$arg</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="nx">foo</span><span class="o">&lt;</span><span class="nx">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="nx">foo</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>  <span class="c1">// now a runtime error
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Reified generic types can be used in the function code:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">BaseClass</span> <span class="p">{</span>
  <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Before:
</span><span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">classname</span><span class="o">&lt;</span><span class="nx">BaseClass</span><span class="o">&gt;</span> <span class="nv">$classname</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
  <span class="nv">$classname</span><span class="o">::</span><span class="na">foo</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// After:
</span><span class="k">function</span> <span class="nf">bar</span><span class="o">&lt;</span><span class="nx">reify</span> <span class="nx">T</span> <span class="k">as</span> <span class="nx">BaseClass</span><span class="o">&gt;</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
  <span class="nx">T</span><span class="o">::</span><span class="na">foo</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Also see how to
<a href="https://docs.hhvm.com/hack/generics/reified-generics#reified-generics__type-testing-and-assertion-with-is-and-as-expressions">test and assert</a>
reified generic types and how to
<a href="https://docs.hhvm.com/hack/generics/reified-generics#reified-generics__creating-an-instance-of-a-class-with-new">create <code class="highlighter-rouge">new</code> instances</a>
of reified generic classes.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001052236684/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Ján</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/07/29/hhvm-4.16.0.html">HHVM 4.16.0</a></h1>
    <p class="post-meta">发布于 2019 年 7 月 29 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.16 is released! This release marks the end of support for 4.10;
4.11-4.15 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>typechecker error messages now suggest similar methods and variables</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>fixed a bug that would incorrectly typecheck most files containing XHP in partial mode instead of strict</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>class :a {
  attribute string foo;
  public function bar($baz): void {}
  //                  ^ previously undetected missing type annotation
}
</pre></td></tr></tbody></table></code></pre></div></div>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/07/22/hhvm-4.15.0.html">HHVM 4.15.0</a></h1>
    <p class="post-meta">发布于 2019 年 7 月 22 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.15 is released! This release marks the end of support for 4.9;
4.10-4.14 remain supported, as do the LTS releases 3.30 and 4.8.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>IDE integrations now show docblocks for namespaced functions.</li>
  <li>Fixed an issue that could lead to CLI server clients hanging on exit in some
Linux environments.</li>
  <li>Improved typing of <code class="highlighter-rouge">noreturn</code> methods.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Untyped variadics now raise type errors; replace with <code class="highlighter-rouge">mixed ...$foo</code>.</li>
  <li><code class="highlighter-rouge">inout</code> parameter types are now invariant - both co- and contra- variant.
They were previously incorrectly treated as contravariant.</li>
  <li><code class="highlighter-rouge">instanceof</code> is now a parse error. In 4.14.x, it was not a parser error, but
no longer refined types. In HHAST 4.14.x, <code class="highlighter-rouge">hhast-migrate --instanceof-is</code> can
be used to replace expressions of the form <code class="highlighter-rouge">$x instanceof Foo</code> with
<code class="highlighter-rouge">$x is Foo</code>, and expressions of the form <code class="highlighter-rouge">$x instanceof $some_expression</code> with
<code class="highlighter-rouge">\is_a($x, $some_expression)</code>.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>In a future release, all support for calling functions by-reference will be
removed. Typechecker enforcement can be enabled now with the
<code class="highlighter-rouge">disallow_byref_calls=true</code> <code class="highlighter-rouge">.hhconfig</code> option.</li>
  <li>Support for <code class="highlighter-rouge">"${foo}"</code> will be removed, and can be replaced with <code class="highlighter-rouge">"{$foo}"</code>;
<code class="highlighter-rouge">hhast-migrate --dollar-brace-variable-migration</code> can be used to migrate
code, and the <code class="highlighter-rouge">disable_outside_dollar_str_interp=true</code> <code class="highlighter-rouge">.hhconfig</code> setting can
be used to enforce this immediately.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/07/15/hhvm-4.14.0.html">HHVM 4.14.0</a></h1>
    <p class="post-meta">发布于 2019 年 7 月 15 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.14 is released! As 4.8 has long term support, it remains supported, as do
3.30 and 4.9-4.13.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>The typechecker is now able to track intersections - i.e. when a variable is
known to have multiple supertypes, not one of multiple.</li>
  <li><code class="highlighter-rouge">instanceof</code> no longer refines types; use <code class="highlighter-rouge">is</code> expressions instead.
<code class="highlighter-rouge">hhast-migrate --instanceof-is</code> can be used to automatically convert
expressions of the form <code class="highlighter-rouge">$x instanceof SomeType</code> to expressions of the form
<code class="highlighter-rouge">$x is SomeType</code>, <code class="highlighter-rouge">$x is SomeType&lt;_&gt;</code>, <code class="highlighter-rouge">$x is SomeType&lt;_, _&gt;</code> etc.
If the RHS of an <code class="highlighter-rouge">instanceof</code> is not a classname in sourcecode, but rather
an expression, HHAST4.14.4 and up will migrate to a <code class="highlighter-rouge">\is_a()</code> call. This does not
refine the variable on the LHS for the typechecker.</li>
  <li>Regexp literals can now nest brace-like delimiters; for example, <code class="highlighter-rouge">re"(())"</code>
is now handled correctly.</li>
  <li>Improved error messages, autocompletion, and fixed several crashes in the
VSDebug server implementation.</li>
  <li>Improved namespace support for autocompletion.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">instanceof</code> no longer refines types.</li>
  <li><code class="highlighter-rouge">$this</code> is no longer allowed in PHP-style static closures, e.g.
 <code class="highlighter-rouge">$x = static function () { $this-&gt;foo(); }</code>.</li>
  <li>the fatal errors for subclassing or using <code class="highlighter-rouge">new</code> on <code class="highlighter-rouge">Closure</code> are now
case-insensitive to match the runtime behavior.</li>
  <li><code class="highlighter-rouge">DateTime::COOKIE</code> and <code class="highlighter-rouge">DATE_COOKIE</code> now use the correct format for cookies.
The old value is available as <code class="highlighter-rouge">DATE_RFC850</code>. This replaces full day-of-week
(e.g. ‘Monday’) with 3-letter abbreviations (e.g. ‘Mon’).</li>
  <li><code class="highlighter-rouge">$shape['somefield'] ?? null</code> is now a type error if <code class="highlighter-rouge">'somefield'</code> is known
not to exist; it is still permitted if <code class="highlighter-rouge">'somefield'</code> /may/ exist.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>visibility modifiers for class constants are currently banned by the type
checker, but permitted-and-ignored by the runtime. We expect them to be
permitted and enforced by both the typechecker and runtime in a future
release.</li>
</ul>

<h1 id="intersection-types">Intersection Types</h1>

<p>The typechecker is now able to track multiple type constraints for the same
variable, creating intersection types; they can not be
declared in source code.</p>

<p>For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>function f(Foo $x): void {
  // $x is Foo
  if ($x is IBar) {
    // before: $x is IBar
    // now: $x is Foo &amp; IBar (intersection)
    expects_an_IBar($x); // correctly works in both
    expects_a_Foo($x); // no longer an error!
  }
  // before: $x is Foo | IBar (union)
  // now: $x is Foo
  expects_an_IBar($x); // correctly an error in both
  expects_a_Foo($x); // no longer an error!
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>As well as allowing more valid code to be understood by the typechecker, this
can exposed via hover type information and via error messages.</p>

<p>An expression is of type <code class="highlighter-rouge">(A &amp; B)</code> if it is <strong>both</strong> of type <code class="highlighter-rouge">A</code> and of type
<code class="highlighter-rouge">B</code>, which is the case inside the if statement above. Intersections are in some
ways similar to type *unions *(denoted by |), which allow tracking types through
control flow and are also internal to the typechecker (they can not be declared
in source code). Having both intersections and unions allows us to greatly
improve type refinement in Hack, leading to a more intuitive experience.</p>

<p>As part of this work, tracking for unions has also been improved:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>function f(mixed $x): void {
  if ($x is int || $x is string) {
    // before: $x is mixed
    // now: $x is int | string
    expects_an_arraykey($x); // no longer an error!
  }
  // both: $x is mixed
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Previously, it was common to work around this limitation with temporary
variables or type assertions:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>function f(Foo $x): void {
  $x_for_hack = $x; // now unnecessary
  if ($x_for_hack is IBar) {
    expects_an_IBar($x_for_hack);
    expects_a_Foo($x);
  }
  expects_a_Foo($x as Foo); // "as" no longer needed
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>These workarounds can now be removed:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>function f(Foo $x): void {
  if ($x is IBar) {
    expects_an_IBar($x);
    expects_a_Foo($x);
  }
  expects_a_Foo($x);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="intersections-vs-unions">intersections vs unions</h2>

<p>The difference between type /intersections/ and type /unions/ is essentially the
same as the one between the logical ‘AND’ and the logical ‘OR’.</p>

<p>Something is an intersection type <code class="highlighter-rouge">(I1 &amp; I2)</code> if it is <strong>both</strong> <code class="highlighter-rouge">I1</code> and <code class="highlighter-rouge">I2</code>.
Intersections are obtained with refinements:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>function f(I1 $x): void {
  if ($x is I2) {
    // here $x is both an I1 and I2, and gets type (I1 &amp; I2)
  }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Something is a union type <code class="highlighter-rouge">(A | B)</code> if it is <strong>either</strong> <code class="highlighter-rouge">A</code> or <code class="highlighter-rouge">B</code>; the
type system does not know which one it actually is.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>if (something()) {
  $x = new A();
} else {
  $x = new B();
}

// here $x is either A or B and has type (A | B)

$v = vec[new A(), new B()];
$y = $v[$i]

// $y is either A or B and has type (A | B)
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="instanceof-refinement"><code class="highlighter-rouge">instanceof</code> Refinement</h1>

<p>In previous versions of Hack/HHVM, expressions of the form <code class="highlighter-rouge">$x instanceof Foo</code>
would inform the typechecker that <code class="highlighter-rouge">$x</code> is of type <code class="highlighter-rouge">Foo</code>; this is no longer the
case, replaced by <code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> expressions. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>class Foo {}
function takes_foo(Foo $_): void {}

function do_stuff(mixed $in): void {
  if ($in instanceof Foo) {
    takes_foo($in); // valid in 4.13, but not in 4.14
  }
  if ($in is Foo) {
    takes_foo($in); // valid in 3.28+, including 4.14
  }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">is</code> expressions require matching generics; for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>class NoGenerics {}
class OneGeneric&lt;T&gt; {}
class TwoGenerics&lt;Ta, Tb&gt; {}

function do_stuff(mixed $in, classname&lt;SomeType&gt; $what): void {
  if ($in is NoGenerics) { }
  if ($in is OneGeneric&lt;_&gt;) { }
  if ($in is TwoGenerics&lt;_, _&gt;) { }
  if (is_a($in, $what)){ /*$in is still mixed here*/ }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">hhast-migrate --instanceof-is</code> can be used in
<a href="https://github.com/hhvm/hhast/releases/tag/v4.13.0">HHAST 4.13</a> to
automatically convert these expressions.</p>

<p>The old behavior of <code class="highlighter-rouge">instanceof</code> can also be disabled on 4.13 by setting
<code class="highlighter-rouge">disable_instanceof_refinement=true</code> in <code class="highlighter-rouge">.hhconfig</code>.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/07/09/hhvm-4.13.0.html">HHVM 4.13.0</a></h1>
    <p class="post-meta">发布于 2019 年 7 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.13 is released! This release marks the end of support for the 4.7.x
series.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Fixed positions (incorrect ‘PRIMARY ERROR POSITION IS NOT IN CURRENT FILE’)
for certain await expression that were implicitly rewritten as <code class="highlighter-rouge">concurrent</code>
statements.</li>
  <li>improved performance for <code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> expressions with wildcard generics
when not using repo-authoritative mode (~ 5x in some tests).</li>
  <li>added <code class="highlighter-rouge">hhvm.trust_autoloader_path</code> option (defaults to false); if true, the
autoloader will not invoke <code class="highlighter-rouge">realpath</code>.</li>
  <li>improved subtyping of shapes.</li>
  <li>calling undefined functions now only raises an unbound function typechecker
error, instead of both an unbound function and unbound global constant error.</li>
  <li>null checks in <code class="highlighter-rouge">if</code> statements now refine the type in both the <code class="highlighter-rouge">if</code> block and
<code class="highlighter-rouge">else</code> block.</li>
  <li>when Xenon is enabled, fix race condition that can lead to the HHVM process
being terminated during startup.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">zend_logo_guid()</code>, <code class="highlighter-rouge">zend_thread_id()</code>, and <code class="highlighter-rouge">zend_version()</code> have been
removed.</li>
  <li>it is now a parse error to declare or invoke constructors with by-reference
parameters.</li>
  <li>removed <code class="highlighter-rouge">HH\global_get_safe()</code> as it functioned identically to
<code class="highlighter-rouge">HH\global_get()</code>.</li>
  <li>improved shape subtyping can lead to needing to suppress error 4110 (type
error) where error 4166 (unknown field) is currently suppressed.</li>
  <li>assignments in ternary expressions can now assign type information - for
example, after <code class="highlighter-rouge">($foo ? $x = 1 : $x = 2)</code>, <code class="highlighter-rouge">$x</code> is an int. This is expected
to reduce the number of errors for safe code, but may raise new errors in
some situations.</li>
  <li><code class="highlighter-rouge">Shapes::keyExists($shape, 'field')</code> now refines the type in the same way as
<code class="highlighter-rouge">$shape is shape('field' =&gt; mixed, ...)</code>. This is expected to reduce the
number of errors for safe code, but may raise new errors in some situations.</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>To remove conflicts with other planned syntax changes, the syntax for soft
type hints will be changing from <code class="highlighter-rouge">@sometype $foo</code> to
<code class="highlighter-rouge">&lt;&lt;__Soft&gt;&gt; sometype $foo</code>; this new syntax is supported for experimental use.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/07/01/hhvm-4.12.0.html">HHVM 4.12.0</a></h1>
    <p class="post-meta">发布于 2019 年 7 月 1 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.12 is released! This release marks the end of support for the 4.6.x
series.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Abstract methods are now able to be overridden by other abstract methods.</li>
  <li>Improved error messages for inappropriate usage of the <code class="highlighter-rouge">async</code> keyword, e.g.
abstract methods and interfaces.</li>
  <li>Methods with the same name as the class are no longer parsed as constructors.</li>
  <li>XBox tasks now execute <code class="highlighter-rouge">&lt;&lt;__EntryPoint&gt;&gt;</code> functions.</li>
  <li>Fixed assertion failure when building repo-authoritative bytecode repositories
with HHVM built against libc++ instead of libstdc++ (e.g. MacOS).</li>
  <li>Autocomplete docblocks are now sent to IDEs as markdown.</li>
  <li>If using CLI server mode, PSP is now ran before exit.</li>
  <li>Fixed a segmentation fault when using vsdebug as a REPL.</li>
  <li>Improved response time when IDEs request docblocks.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">hh_client --retries</code> is now a synonym of <code class="highlighter-rouge">--timeout</code></li>
  <li>The optional <code class="highlighter-rouge">&amp;$output_headers</code> argument has been removed from
<code class="highlighter-rouge">SoapClient::__soapcall</code>, as optional <code class="highlighter-rouge">inout</code> parameters are not supported.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/06/24/hhvm-4.11.0.html">HHVM 4.11.0</a></h1>
    <p class="post-meta">发布于 2019 年 6 月 24 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.11 is released! This release marks the end of support for the 4.5.x
series.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>improved error locations for <code class="highlighter-rouge">inst_meth()</code>/<code class="highlighter-rouge">class_meth()</code> with
private or protected methods.</li>
  <li>added an admin server endpoint to remove units from the unit cache; for
example: <code class="highlighter-rouge">curl 'http://localhost:8003/invalidate-units?path=/my/file.php&amp;path=/my/other/file.php'</code></li>
  <li>type mismatch errors (4110) now report the full types</li>
  <li>PHP sort functions are now annotated as <code class="highlighter-rouge">inout</code> instead of by-reference in the
HHIs; both <code class="highlighter-rouge">inout</code> and references continue to work at runtime.</li>
  <li>added <code class="highlighter-rouge">hh_client --extract-standalone</code>, to create self-contained files
containing a function and all recursive dependencies.</li>
  <li>bytecode is no longer regenerated for source files that are touched but
have an unchanged SHA.</li>
  <li>if, at runtime, a class uses multiple traits that declare the same method,
the error message now includes the trait names.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>the key generic for the <code class="highlighter-rouge">darray</code> type and the <code class="highlighter-rouge">HH\darray()</code> function
(autoimported) is now required to be an <code class="highlighter-rouge">arraykey</code>.</li>
  <li>PHP7-style anonymous function <code class="highlighter-rouge">use()</code> clause positioning is now a parser
error; Hack requires <code class="highlighter-rouge">use()</code> after the return type, while PHP7 has <code class="highlighter-rouge">use()</code>
before the return type.</li>
  <li><code class="highlighter-rouge">dict()</code>, <code class="highlighter-rouge">vec()</code>, and <code class="highlighter-rouge">keyset()</code> are now in the <code class="highlighter-rouge">HH\</code> namespace; they remain
autoimported, so this change only breaks fully-qualified references.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/06/18/hhvm-4.10.0.html">HHVM 4.10.0</a></h1>
    <p class="post-meta">发布于 2019 年 6 月 18 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.10 is released! This release marks the end of support for the 4.4.x
series.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Callable properties can now be invoked by parenthesizing,
e.g. <code class="highlighter-rouge">($foo-&gt;bar)()</code>.</li>
  <li>await expressions are now supported in XHP contexts, e.g.
<code class="highlighter-rouge">&lt;foo bar={await baz()}&gt;{await foo()}&lt;/foo&gt;</code>.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>runtime support for alternate control-flow syntax (<code class="highlighter-rouge">if: else: endif;</code>) has
been removed; this was previously banned by the typechecker in hack files, but
supported at runtime.</li>
  <li>warnings are now raised when arguments to builtin Hack functions are coerced
to match the type.</li>
  <li>by-ref assignemnts (<code class="highlighter-rouge">$x = &amp;$y</code>) are no longer supported by the parser.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/06/13/hhvm-4.9.1.html">HHVM 4.9.1, repository changes</a></h1>
    <p class="post-meta">发布于 2019 年 6 月 13 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.9.1 is released, fixing a performance regression on MacOS. There are no
significant changes on other platforms.</p>

<p>We have added additional apt distributions to make it easier to update
to releases that are not the latest, but are still supported: for 4.3-4.9, we
have added <code class="highlighter-rouge">DISTRIBUTION-MAJOR.MINOR</code> apt distributions. For example, if your
<code class="highlighter-rouge">/etc/apt/sources.list</code> currently contains
<code class="highlighter-rouge">deb https://dl.hhvm.com/ubuntu bionic main</code>, you can replace <code class="highlighter-rouge">bionic</code> with
<code class="highlighter-rouge">bionic-4.3</code>, <code class="highlighter-rouge">bionic-4.4</code> etc through to <code class="highlighter-rouge">bionic-4.9</code>.</p>

<p>Given all new releases have overlapping support, we are no longer handling
LTS releases specially in apt; for example, the 4.8 series is available through
<code class="highlighter-rouge">bionic-4.8</code>. We have not changed the distribution names for past releases, so
3.30 remains available through <code class="highlighter-rouge">bionic-lts-3.30</code> instead of <code class="highlighter-rouge">bionic-3.30</code>.</p>

<p>We have also made similar changes to our MacOS bottles:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ brew tap hhvm/hhvm
$ brew install hhvm # install the latest release
$ brew install hhvm-nightly # install the latest nightly build
$ brew install hhvm-4.8 # install the lastest 4.8.x
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We have not renamed past releases, so 3.30 remains available as <code class="highlighter-rouge">hhvm@3.30-lts</code>
in homebrew.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/06/10/hhvm-4.9.0.html">HHVM 4.9.0, and security updates for 3.30, and 4.3-4.7</a></h1>
    <p class="post-meta">发布于 2019 年 6 月 10 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.9 is released! Additionally, 3.30.6, 4.3.1, 4.4.1, 4.5.1, 4.6.1, 4.7.1,
and 4.8.1 are released with security updates. This release marks the end of
support for the 4.3.x series.</p>

<p>In 4.9, it is no longer possible to enable PHP support, and various conditional
behaviors have been unified, especially in the parser. For example, the lexer
no longer special-cases PHP files for different behavior.</p>

<p>Additionally, the <code class="highlighter-rouge">mysqli</code> extension has been removed in favor of Hack’s
async MySQL extension. Users of the mysqli extension may find it useful to use
the 4.8 release while migrating, which is an LTS release.</p>

<h1 id="security-updates">Security Updates</h1>

<ul>
  <li>CVE-2019-3569: FastCGI interface. By default prior versions of HHVM would
listen for FactCGI connections on all interfaces. This behavior may have been
unexpected, and new releases change to listen on <code class="highlighter-rouge">localhost</code> by default. This
behavior can be controlled by the <code class="highlighter-rouge">hhvm.server.ip</code> INI setting. The HTTP
server mode (Proxygen) continues to listen on all interfaces by default.</li>
  <li>CVE-2019-3570: Heap corruption in <code class="highlighter-rouge">scrypt_enc()</code>; heap corruption was possible
if the scrypt parameters (N, r, and p) were configurable by an attacker - for
example, by providing the output of <code class="highlighter-rouge">scrypt_enc()</code> in a context where Hack/PHP
code would attempt to verify it by re-running <code class="highlighter-rouge">scrypt_enc()</code> with the same
parameters. This has been resolved by changing <code class="highlighter-rouge">scrypt_enc()</code> to use
libsodium’s implementation, and <code class="highlighter-rouge">scrypt_enc()</code> now requires that HHVM was
built with libsodium support. In 4.9, we consider <code class="highlighter-rouge">scrypt_enc()</code> deprecated,
and it will be removed in a future release.</li>
</ul>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Xenon now uses SIGPROF, and is usable in CLI mode.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>The MySQLi extension has been removed.</li>
  <li>the lexer now lexes all files as Hack files; collection literals are
always recognized, XHP is always enabled, and many smaller changes.</li>
  <li>the <code class="highlighter-rouge">this</code> type is now enforced at runtime by default; this behavior can
currently be controlled via the <code class="highlighter-rouge">hhvm.this_type_hint_level</code> INI setting:
4.9 defaults to <code class="highlighter-rouge">3</code>, and prior release default to <code class="highlighter-rouge">0</code>.</li>
  <li>if HHVM is asked to invoke a <code class="highlighter-rouge">.php</code> file, it <em>must</em><code class="highlighter-rouge"> start with </code>&lt;?hh`; the
previous behavior of outputting leading content verbatim has been removed.</li>
  <li>incrementing or decrementing non-numeric strings (e.g. <code class="highlighter-rouge">$a = 'a'; ++$a</code>) now
raises a notice.</li>
  <li><code class="highlighter-rouge">array_fill_keys()</code> will now raise an error if used with non-arraykey keys;
<code class="highlighter-rouge">array_fill_keys()</code> has different coercion rules than actual array access,
which can lead to subtle bugs.</li>
  <li>duplicate cookies are no longer permitted; this can be controlled by the
<code class="highlighter-rouge">hhvm.server.allow_duplicate_cookies</code> INI setting.</li>
  <li><code class="highlighter-rouge">array_multisort()</code> is now limited to 9 arguments, to allow the removal of
byref-variadics from the runtime.</li>
  <li>variadic by-ref parameters are no longer supported.</li>
  <li>accessing a container with an invalid key now raises an error instead of a
notice. This was already the case for Hack arrays.</li>
  <li>it is now a parse error to attempt to nest declarations in partial files - for
example, by declaring a class inside a function.</li>
  <li><code class="highlighter-rouge">type_structure()</code>, various Xenon functions, and ASIO monitoring functions
are now in the <code class="highlighter-rouge">HH</code> namespaces; these functions are autoimported in both
4.9 and prior versions, so the leading backslash can be removed.</li>
  <li>The <code class="highlighter-rouge">hhvm.force_hh</code> INI setting now defaults to true; as all files are now
handled as Hack files, this only controls some smaller behaviors which are
not to PHP vs Hack:
    <ul>
      <li>additional warnings are raised for many edge cases</li>
      <li><code class="highlighter-rouge">json_encode()</code> now returns <code class="highlighter-rouge">false</code> if used for an unsupported type</li>
      <li>if <code class="highlighter-rouge">JSON_PARTIAL_OUTPUT_ON_ERROR</code> is set, <code class="highlighter-rouge">json_encode()</code> will use <code class="highlighter-rouge">null</code>
to represent unsupported types.</li>
      <li><code class="highlighter-rouge">shell_exec()</code> returns <code class="highlighter-rouge">""</code> instead of <code class="highlighter-rouge">null</code> on failure</li>
      <li>the string of <code class="highlighter-rouge">-0.0</code> is now <code class="highlighter-rouge">"0"</code> instead of <code class="highlighter-rouge">"-0"</code></li>
    </ul>
  </li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li><code class="highlighter-rouge">scrypt_enc()</code> will be removed in a future release.</li>
  <li>support for incrementing and decrementing non-numeric strings will be removed;
this currently raises a notice.</li>
  <li>the <code class="highlighter-rouge">hhvm.force_hh</code> INI setting will be removed in a future release.</li>
</ul>

<h1 id="migrating-from-scrypt_enc">Migrating from <code class="highlighter-rouge">scrypt_enc()</code></h1>

<p>We recommend migrating password storage to:</p>
<ul>
  <li><code class="highlighter-rouge">sodium_crypto_pwhash_str()</code></li>
  <li><code class="highlighter-rouge">sodium_crypto_pwhash_str_verify()</code></li>
  <li><code class="highlighter-rouge">sodium_crypto_pwhash_str_needs_rehash()</code></li>
</ul>

<p>For migration purposes, it is possible to verify <code class="highlighter-rouge">scrypt_enc()</code> hashes using
the sodium extension:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>function verify_scrypt_enc(string $password, string $stored): bool {
	list($_, $algo, $n, $r, $p, $salt, $stored_hash) = Str\split($stored, '$');
	invariant($algo === 's', 'did not get an scrypt result');
	$salt = \base64_decode($salt);
	$stored_hash = \base64_decode($stored_hash);

	$opslimit = (1 &lt;&lt; $n) * $r * $p * 4;
	$memlimit = (1 &lt;&lt; $n) * $r * 128;
	$password_hash = sodium_crypto_pwhash_scryptsalsa208sha256(
		Str\length($stored_hash),
		$password,
		$salt,
		$opslimit,
		$memlimit,
	);
	return \hash_equals($password_hash, $stored_hash);
}
</pre></td></tr></tbody></table></code></pre></div></div>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/06/03/hhvm-4.8.0.html">HHVM 4.8.0</a></h1>
    <p class="post-meta">发布于 2019 年 6 月 3 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.8 is released! This release has long term support, so:</p>
<ul>
  <li>this release will be supported for approximately 48 weeks</li>
  <li>the next LTS will be released in approximately 24 weeks</li>
  <li>HHVM 3.30 and HHVM 4.3-4.7 remain supported</li>
  <li>HHVM 3.27 and HHVM 4.2 are no longer supported</li>
</ul>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>XHP attributes can now be marked <code class="highlighter-rouge">@lateinit</code>, to indicate that an attribute
is required, but may be set via <code class="highlighter-rouge">-&gt;setAttribute()</code>. This is currently
equivalent to <code class="highlighter-rouge">@required</code>, however if the <code class="highlighter-rouge">check_xhp_attribute</code> option is set
in <code class="highlighter-rouge">.hhconfig</code>, an error is raised if a <code class="highlighter-rouge">@required</code> attribute is ommitted at
instantiation; for example, <code class="highlighter-rouge">class :a { attribute string b @required; } &lt;a /&gt;</code>
will raise a typechecker error because of <code class="highlighter-rouge">b</code> not being specified, however
<code class="highlighter-rouge">class :c { attribute string d @lateinit; } &lt;c /&gt;</code> will raise a runtime error
if <code class="highlighter-rouge">-&gt;setAttribute('d', 'someValue')</code> is not called before render, but will
not raise a typechecker error. This new behavior will not be optional in a
future release.</li>
  <li>The <code class="highlighter-rouge">.hhconfig</code> options <code class="highlighter-rouge">disable_unsafe_expr</code> and <code class="highlighter-rouge">disable_unsafe_block</code> are
now supported, removing support for <code class="highlighter-rouge">// UNSAFE</code> and <code class="highlighter-rouge">/* UNSAFE_EXPR */</code>; we
recommend using <code class="highlighter-rouge">hhast-migrate --add-fixmes</code> then using <code class="highlighter-rouge">sed</code> or similar to
remove the <code class="highlighter-rouge">UNSAFE</code> and <code class="highlighter-rouge">UNSAFE_EXPR</code> comments. This behavior will not be
optional in a future release.</li>
  <li>HSL v4.7.0
<a href="https://github.com/hhvm/hsl/releases/tag/v4.7.0">adds a <code class="highlighter-rouge">Ref&lt;T&gt;</code> class</a>,
to wrap values in objects.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>The typechecker will now raise errors if it can identify that an expression
being used in a boolean context is falsey, but not actually the boolean value
<code class="highlighter-rouge">false</code>; for example, <code class="highlighter-rouge">$x = null; if ($x) { /* ... */ }</code>.</li>
  <li>The <code class="highlighter-rouge">and</code>, <code class="highlighter-rouge">or</code>, and <code class="highlighter-rouge">xor</code> operators have been removed from the runtime; they
previously raised typechecker errors. Use <code class="highlighter-rouge">$a &amp;&amp; $b</code>, <code class="highlighter-rouge">$a || $b</code>, or
 <code class="highlighter-rouge">(bool) $a !== (bool) $b</code> instead.</li>
  <li>By-reference properties are now a parse error.</li>
  <li>Fix some unsoundness issues when using <code class="highlighter-rouge">is</code> or <code class="highlighter-rouge">instanceof</code> with generics;
this may lead to the typechecker raising errors in more places.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/05/28/hhvm-4.7.0.html">HHVM 4.7.0</a></h1>
    <p class="post-meta">发布于 2019 年 5 月 28 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.7 is released! This release will be supported for 6 weeks, and HHVM 4.2+
remain supported. This release marks the end of support for HHVM 4.1.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>the typechecker has a new type inference engine; this leads to errors being
raised in more cases due to better type information. If code is intentionally
unsafe, this can also lead to errors moving, so suppression comments may need
to be moved.</li>
  <li>added <code class="highlighter-rouge">\HH\global_keys()</code> and <code class="highlighter-rouge">\HH\global_key_exists()</code>; in these can be used
in combination with <code class="highlighter-rouge">\HH\global_get()</code> and <code class="highlighter-rouge">\HH\global_set()</code> as a replacement
for <code class="highlighter-rouge">$_GLOBALS</code>; these are currently undocumented, and we aim to resolve this
shortly.</li>
  <li>await-as-an-expression is now supported in XHP expressions</li>
  <li>improved handling of EINTR in hhvm-hackc and hh_client-hh_server communication</li>
  <li>added HHI definition for various request tracing functions in the
<code class="highlighter-rouge">HH\rqtrace</code> namespace</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>the typechecker’s new inference can lead to more errors, or errors in
different locations.</li>
  <li>Corrected capitalization of <code class="highlighter-rouge">DOMDocument::createAttributeNS</code></li>
  <li><code class="highlighter-rouge">declare()</code> and <code class="highlighter-rouge">enddeclare()</code> are no longer supported</li>
  <li>it is no longer possible to reference type <code class="highlighter-rouge">Ta::Tb</code> if <code class="highlighter-rouge">Ta</code> is nullable.</li>
  <li><code class="highlighter-rouge">empty()</code> is no longer supported; <code class="highlighter-rouge">hhast-migrate --empty-expression</code> can be
used to replace <code class="highlighter-rouge">empty($expr)</code> with <code class="highlighter-rouge">(!$expr ?? false)</code> in HHAST 4.6.1 under
HHVM 4.6</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/05/21/hhvm-4.6.0.html">HHVM 4.6.0</a></h1>
    <p class="post-meta">发布于 2019 年 5 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.6 is released! This release will be supported for 6 weeks, and HHVM
4.1+ remain supported.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li><code class="highlighter-rouge">await</code> is now supported in many expressions.</li>
  <li>added <code class="highlighter-rouge">concurrent {}</code> blocks as a more readable replacement for
<code class="highlighter-rouge">HH\Lib\Tuple\from_async()</code> and <code class="highlighter-rouge">\HH\Asio\va()</code>.</li>
  <li>added <code class="highlighter-rouge">hh_client --file-dependents foo.hack [bar.hack ...]</code> to provide a list
of files that are known to dependent on the specified files.</li>
  <li>generics are now included in typechecker error messages that involve types.</li>
  <li>Improved typechecker errors for bad uses of <code class="highlighter-rouge">Shapes::idx()</code> and <code class="highlighter-rouge">Shapes::at()</code></li>
  <li>If <code class="highlighter-rouge">$c</code> has type errors, do not raise additional errors for <code class="highlighter-rouge">$c::f()</code>, to
reduce noise.</li>
  <li><code class="highlighter-rouge">hackfmt</code> now provides information on the problem if it encounters a parse
error.</li>
  <li>Increased performance and reduced memory usage for <code class="highlighter-rouge">json_decode()</code> when string
keys are already present as literals in the source code.</li>
  <li>Parser exceptions are now reported as parser errors.</li>
  <li>Improved performance of <code class="highlighter-rouge">type_structure()</code></li>
</ul>

<h2 id="await-as-an-expression"><code class="highlighter-rouge">await</code>-as-an-expression</h2>

<p>For example, <code class="highlighter-rouge">$sum = await x() + await y();</code> is now valid Hack; for details, see
<a href="https://docs.hhvm.com/hack/asynchronous-operations/await-as-an-expression">the documentation</a>.</p>

<h2 id="concurrent"><code class="highlighter-rouge">concurrent</code></h2>

<p>Concurrent blocks provide a more readable alternative to
<code class="highlighter-rouge">HH\Lib\Tuple\from_async()</code> and <code class="highlighter-rouge">HH\Asio\va()</code>; we expect these functions to be
removed in a future release of HHVM and the HSL.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>// Old style:
list($x, $y) = await Tuple\from_async(foo(), bar());
// New style:
concurrent {
  $x = await foo();
  $y = await bar();
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For details, see
<a href="https://docs.hhvm.com/hack/asynchronous-operations/concurrent">the documentation</a>.</p>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>To allow <code class="highlighter-rouge">await</code> as an expression, the precedence has changed.
<code class="highlighter-rouge">hhast-migrate --await-precedence</code> can be used with HHVM 4.5 and HHAST 4.5 to
parenthesize affected expresisons.</li>
  <li>Removed support for variadic references in <code class="highlighter-rouge">sscanf()</code> and <code class="highlighter-rouge">fscanf()</code>.</li>
  <li>By-reference access to class static variables is no longer supported.</li>
  <li>By-reference access to pipe variables is no longer supported.</li>
  <li>The <code class="highlighter-rouge">(real)</code> cast has been removed; use <code class="highlighter-rouge">(float)</code> instead.</li>
  <li><code class="highlighter-rouge">func_num_args()</code> is no longer supported; use variadics instead.</li>
  <li>PHP4-style constructors (<code class="highlighter-rouge">class Foo { function Foo() {} }</code>) are no longer
supported. Use <code class="highlighter-rouge">function __construct() {}</code> instead.</li>
  <li>If <code class="highlighter-rouge">hh_parse</code> encounters errors, it will now report them and exit non-0,
unless another behavior is specified with CLI arguments.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/05/13/hhvm-4.5.0.html">HHVM 4.5.0</a></h1>
    <p class="post-meta">发布于 2019 年 5 月 13 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.5 is released! This release will be supported for 6 weeks, and HHVM
4.1+ remain supported.</p>

<p>This weeks’s release is focused on performance improvements and increased
consistency between typechecker and runtime errors.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Adds <code class="highlighter-rouge">Shapes::at()</code>, which is similar to <code class="highlighter-rouge">Shapes::idx()</code>, but throws if the
field is not set. This is useful for optional fields.</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>Dynamic method invocations (<code class="highlighter-rouge">$foo-&gt;$bar()</code>) and property access (<code class="highlighter-rouge">$foo-&gt;$bar</code>)
now raise a typechecker error unless <code class="highlighter-rouge">$foo</code> is <code class="highlighter-rouge">dynamic</code>.</li>
  <li>A typechecker error is now raised for contravariant or covariance in method
and function type parameters. This was previously a runtime error.</li>
  <li>It is now a runtime error to invoke static methods as if they were instance
methods (e.g. <code class="highlighter-rouge">$foo-&gt;someStaticMethod()</code>). This was previously a typechecker
error.</li>
  <li>Deprecation notices are now raised at runtime for invoking instance methods
statically. This was previously a typechecker error.</li>
</ul>

<h1 id="other-notes">Other Notes</h1>

<ul>
  <li>Raise a clearer error when the type of a Hack array literal contains typos</li>
  <li>Improved compatibility with hhbbc and GCC 9.1</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<ul>
  <li>we plan to remove support for <code class="highlighter-rouge">UNSAFE</code>, <code class="highlighter-rouge">UNSAFE_BLOCK</code>, and <code class="highlighter-rouge">UNSAFE_EXPR</code>
comments in a future release, in favor of more explicit <code class="highlighter-rouge">HH_FIXME[code]</code>
comments and future language features. The behavior of <code class="highlighter-rouge">UNSAFE</code> comments
can be disabled with the <code class="highlighter-rouge">disable_unsafe_expr</code> and <code class="highlighter-rouge">disable_unsafe_block</code>
options in <code class="highlighter-rouge">.hhconfig</code></li>
</ul>

<h1 id="new-features-in-hsl-experimental">New features in HSL-Experimental</h1>

<p>HSL-Experimental 4.5.0 adds advanced async helper classes, including
<code class="highlighter-rouge">Async\Poll</code> and <code class="highlighter-rouge">Async\Semaphore</code> among others. We <strong>strongly</strong> recommend
avoiding <code class="highlighter-rouge">Async\Poll</code> when alternatives exist.</p>

<p>For details, see <a href="https://github.com/hhvm/hsl-experimental/releases/tag/v4.5.0">the release notes</a>.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/05/06/hhvm-4.4.0.html">HHVM 4.4.0</a></h1>
    <p class="post-meta">发布于 2019 年 5 月 6 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.4 is released! This release will be supported for 6 weeks, and HHVM
4.1+ remain supported.</p>

<p>This weeks’ work was mostly performance improvements, bug fixes, and work on
future features.</p>

<h1 id="highlights">Highlights</h1>

<ul>
  <li>Improved error messages for variadic functions that are not passed enough
arguments</li>
  <li>Fix support for <code class="highlighter-rouge">hh_server --config</code>, allowing overriding hhconfig options
via the CLI</li>
</ul>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li><code class="highlighter-rouge">__callStatic()</code> is no longer supported; if manual analysis is not practical
for migration, we recommend adding logging wrappers while using a previous
version of HHVM.</li>
  <li><code class="highlighter-rouge">ext_session</code> and the <code class="highlighter-rouge">$_SESSION</code> superglobal have been removed</li>
</ul>

<h1 id="other-notes">Other Notes</h1>

<ul>
  <li>The <code class="highlighter-rouge">hhvm.jit_profile_interp_requests</code> option has been removed, as it no
has any effect</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/04/30/hhvm-4.3.0.html">HHVM 4.3.0</a></h1>
    <p class="post-meta">发布于 2019 年 4 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.3 is released! This release will be supported for 6 weeks, and HHVM
4.1+ remain supported.</p>

<h2 id="improvements-and-new-features">Improvements and New Features</h2>

<ul>
  <li>Fixed some cases where typechecker errors would be missing position data</li>
  <li>Fixed potential bugs when using <code class="highlighter-rouge">__LateInit</code> in repo-authoritative mode</li>
  <li>Autocomplete for <code class="highlighter-rouge">parent::</code> now includes instance methods, not just static
methods</li>
  <li>VSDebug no longer intercepts STDERR when attaching to HHVM in server mode</li>
  <li>Improved typechecker error for <code class="highlighter-rouge">isset()</code> usage</li>
</ul>

<h2 id="breaking-changes">Breaking Changes</h2>

<ul>
  <li>Improved consistency of raising errors for traits or interfaces that define
constructors with parameter promotion; this is not supported.</li>
  <li>Errors are now raised if an XHP class contains multiple child or category
declarations; the first declaration would always be used. Muiltiple children
and categories are still supported, but they must be in a single declaration.</li>
  <li>Builtin function parameters will no longer be coerced - instead, an exception
is thrown. On prior versions, warnings can be enabled on coercion with the
<code class="highlighter-rouge">hhvm.warn_on_coerce_builtin_params</code> INI setting</li>
  <li>Removed the <code class="highlighter-rouge">&lt;&gt;</code> operator; this can be replaced with <code class="highlighter-rouge">!=</code>, and is supported
by <code class="highlighter-rouge">hhast-migrate --hhvm-4.2-to-4.3</code> or <code class="highlighter-rouge">hhast-migrate --ltgt-to-ne</code></li>
  <li>Type errors are now raised if <code class="highlighter-rouge">parent::__construct()</code> is called with
parameters that violate <code class="highlighter-rouge">where</code> constraints</li>
  <li>Division by zero now throws an exception; this can be controlled with the
<code class="highlighter-rouge">hhvm.forbid_division_by_zero</code> ini setting.</li>
  <li>The typechecker is no longer aware of <code class="highlighter-rouge">ext_session</code></li>
</ul>

<h1 id="other-notes">Other Notes</h1>

<ul>
  <li>Removed the <code class="highlighter-rouge">hhvm.jit_profile_interp_requests</code> INI setting as other changes
made it unused</li>
  <li>Removed the <code class="highlighter-rouge">disable_optional_and_unknown_shape_fields</code> experimental hhconfig
option from 3.23.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/04/23/hhvm-4.2.0.html">HHVM 4.2.0</a></h1>
    <p class="post-meta">发布于 2019 年 4 月 23 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.2 is released! This release will be supported for 6 weeks, and HHVM 4.1
remains supported.</p>

<p>This is the first release on an accelerated schedule; we now aim to make new
releases every monday, each supported for 6 weeks. There is no planned change
to the LTS cycle.</p>

<p>4.1’s release branch was cut in late March, so 4.2 contains approximately a
month’s changes; 4.2 and future releases do not have the same branch cut system,
so 4.3 and above should be expected to contain approximately one weeks’ changes.</p>

<h2 id="new-features">New Features</h2>

<ul>
  <li>Added a <code class="highlighter-rouge">statcache-clear</code> admin server command</li>
  <li>Added the <code class="highlighter-rouge">CURLPROXY_HTTPS</code> constant</li>
  <li>Added context to typechecker error output; the previous output is available
with <code class="highlighter-rouge">--error-format=raw</code> for scripting/automation</li>
  <li><code class="highlighter-rouge">$x is MyAbstractFinalClass</code> now raises a typechecker error, as it is
impossible for any <code class="highlighter-rouge">$x</code> to be an instance of an uninstantiable class</li>
</ul>

<h2 id="breaking-changes">Breaking Changes</h2>

<ul>
  <li>The typechecker now requires an argument to <code class="highlighter-rouge">get_class()</code></li>
  <li>The <code class="highlighter-rouge">settype()</code> function has been removed</li>
  <li>Static locals have been removed</li>
  <li>User-defined stream wrappers and filters have been removed</li>
  <li>Support for PHP anonymous classes have been removed from the runtime; these
were not supported in Hack.</li>
  <li>int-like-strings are no longer converted to ints when used as PHP array
keys. To help migration, this behavior can be tested on 4.1 with the
<code class="highlighter-rouge">hhvm.enable_intish_cast=0</code> option.</li>
  <li><code class="highlighter-rouge">&lt;&lt;__UNSAFE_Construct&gt;&gt;</code> has been removed.</li>
  <li>The runtime now requires that all keywords (e.g. <code class="highlighter-rouge">if</code>) to be lowercase; this
was previously only required by the typechecker.</li>
  <li>Calls to undefined functions are now fatal errors.</li>
  <li><code class="highlighter-rouge">filter_has_var()</code>, <code class="highlighter-rouge">filter_input()</code>, and <code class="highlighter-rouge">filter_input_array()</code> have been
removed.</li>
  <li>Attempting to store a reference in <code class="highlighter-rouge">$GLOBALS</code> will result in a runtime error.</li>
  <li>Callback support has been removed from <code class="highlighter-rouge">Memcached::get()</code> and
<code class="highlighter-rouge">Memcached::getbykey()</code></li>
  <li>classes must be declared at the top level, or directly inside a namespace
block. For example, they can no longer be defined conditionally, or inside
a function.</li>
</ul>

<h2 id="other-changes">Other Changes</h2>

<ul>
  <li>Corrected reflection for <code class="highlighter-rouge">inout</code> parameters.</li>
  <li>All <code class="highlighter-rouge">array</code>-like kinds are now valid <code class="highlighter-rouge">Keyed{Traversable,Container}</code> (without
generics).</li>
  <li>Improved typing of <code class="highlighter-rouge">$x['foo'] ?? $bar</code> where <code class="highlighter-rouge">$x['foo']</code> is not a valid
field.</li>
  <li>Hack (and related ocaml tools) are now built using Dune instead of ocamlbuild.</li>
  <li><code class="highlighter-rouge">make hack_test</code> now runs Hack’s tests; previously it built various test
utilities, but did not run the tests.</li>
  <li>The option to have ints overflow to floats has been removed.</li>
  <li>the <code class="highlighter-rouge">hhvm.hard_type_hints</code> option has been removed; type-hint violations now
always raise runtime errors, unless they are explicit soft type hints. This
option was primarily useful for enabling stricter enforcement of parameter
types for PHP5 code.</li>
  <li>Improved <code class="highlighter-rouge">hackfmt</code>’s handling of empty function bodies (e.g. HHI definitions).
This does not affect abstract or interface methods.</li>
  <li>If numa is supported and not explicitly disabled, threads will always use
local memory; this was previously the default in server mode only.</li>
</ul>

<h2 id="future-changes">Future Changes</h2>

<ul>
  <li><code class="highlighter-rouge">instanceof</code> will be removed, in favor of the <code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> operators. It
can be disabled with the <code class="highlighter-rouge">disable_instanceof=true</code> <code class="highlighter-rouge">.hhconfig</code> and
<code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_instanceof</code> HHVM INI settings.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/04/09/hhvm-4.1.0.html">HHVM 4.1.0</a></h1>
    <p class="post-meta">发布于 2019 年 4 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.1 is released! This release will be supported for 8 weeks; we aim to
start publishing weekly releases shortly, however this will not change the
lifecycle for HHVM 4.1.</p>

<h2 id="new-features">New Features</h2>

<ul>
  <li>added the <code class="highlighter-rouge">null</code> type; this allows <code class="highlighter-rouge">$foo is null</code> as an alternative
to <code class="highlighter-rouge">$foo === null</code>, consistent with <code class="highlighter-rouge">$foo is nonnull</code>.</li>
  <li>added the <code class="highlighter-rouge">nothing</code> (bottom/empty) type.</li>
  <li><code class="highlighter-rouge">.hh</code> and <code class="highlighter-rouge">.hack</code> files are now supported in repo-authoritiative mode. We
recommend using <code class="highlighter-rouge">.hack</code> files.</li>
  <li>user attributes are now supported on type constants</li>
  <li>IDE integrations now better support <code class="highlighter-rouge">.hack</code> files</li>
  <li>added the <code class="highlighter-rouge">disable_unsafe_block</code> <code class="highlighter-rouge">.hhconfig</code> option to ban <code class="highlighter-rouge">// UNSAFE</code></li>
  <li><code class="highlighter-rouge">ReflectionProperty::getAttribute()</code> and <code class="highlighter-rouge">::getAttributes()</code> are now supported</li>
  <li>Anonymous functions with <code class="highlighter-rouge">inout</code> parameters are now supported in async
functions</li>
  <li>shape string keys can now start with integers, as long as they are not
entirely integers</li>
</ul>

<h2 id="breaking-changes">Breaking Changes</h2>

<p>These changes are mostly working towards removing references from the language,
and removing support for functions that can inspect or modify the caller, such
as <code class="highlighter-rouge">compact()</code> or <code class="highlighter-rouge">extract()</code></p>

<ul>
  <li><code class="highlighter-rouge">&lt;?hh</code> is no longer valid by itself; replace with <code class="highlighter-rouge">&lt;?hh // partial</code>;
<code class="highlighter-rouge">hhast-migrate --explicit-partial-mode</code> can be used for this change.</li>
  <li>the <code class="highlighter-rouge">assume_php</code> <code class="highlighter-rouge">.hhconfig</code> option has been removed; it is always false.</li>
  <li><code class="highlighter-rouge">global</code> statements (e.g. <code class="highlighter-rouge">global $foo</code>) are no longer supported</li>
  <li>the <code class="highlighter-rouge">disallow_array_cell_pass_by_ref</code> and <code class="highlighter-rouge">disallow_assign_by_ref</code> options
have been removed; these behaviors are now errors</li>
  <li>it is now both a runtime error and a type error to access superglobals by
reference, e.g. <code class="highlighter-rouge">&amp;$_SERVER</code> or <code class="highlighter-rouge">&amp;$GLOBALS['foo']</code></li>
  <li>by-ref use clauses for anonymous functions (e.g. <code class="highlighter-rouge">function () use (&amp;$foo) {}</code>)
are no longer supported</li>
  <li><code class="highlighter-rouge">is_array()</code>, <code class="highlighter-rouge">is_object()</code> and similar functions are no longer auto-imported
to every namespace; use <code class="highlighter-rouge">hhast-migrate --no-namespace-fallback</code></li>
  <li>support for PHP files is disabled by default</li>
  <li>markup sections are no longer supported</li>
  <li>variable variables (<code class="highlighter-rouge">$$foo</code>) are no longer supported in the runtime.</li>
  <li><code class="highlighter-rouge">get_magic_quotes_gpc()</code>, <code class="highlighter-rouge">get_magic_quotes_runtime()</code>, and
<code class="highlighter-rouge">set_magic_quotes_runtime()</code> have been removed.</li>
  <li>The <code class="highlighter-rouge">hhvm.enable_zend_sorting</code> option has been removed; when the sort order
was undefined, this option would make HHVM match PHP5’s behavior, but this
would use a slower algorithm</li>
  <li>the WDDX extension has been removed</li>
  <li><code class="highlighter-rouge">.phpt</code> (PHP template) files are no longer supported in repo-authoritative
mode.</li>
  <li>destructors are no longer supported or called</li>
  <li>a warning is now raised if too many arguments are passed to non-variadic
functions</li>
  <li>an exception is thrown if functions are called with too few arguments</li>
  <li>invoking <code class="highlighter-rouge">forward_static_call()</code> now raises an error</li>
  <li><code class="highlighter-rouge">define()</code> has been removed</li>
  <li>the execution (backtick) operator is no longer supported</li>
  <li>Variance is now enforced for <code class="highlighter-rouge">where</code> constraints</li>
  <li><code class="highlighter-rouge">this::</code> is no longer used in <code class="highlighter-rouge">is</code> or <code class="highlighter-rouge">as</code> constraints at generics make it
unsafe</li>
  <li><code class="highlighter-rouge">stdClass</code> is now final</li>
  <li><code class="highlighter-rouge">__PHP_Incomplete_Class</code> is now final, does not typecheck, and is no longer
directly instantiable</li>
  <li><code class="highlighter-rouge">func_get_args()</code>, <code class="highlighter-rouge">func_get_arg()</code>, and <code class="highlighter-rouge">func_num_args()</code> have been removed.</li>
  <li><code class="highlighter-rouge">get_defined_vars()</code> has been removed</li>
  <li><code class="highlighter-rouge">get_called_class()</code> has been removed</li>
  <li><code class="highlighter-rouge">KeyedContainer</code> keys must now be <code class="highlighter-rouge">arraykey</code>; this affects <code class="highlighter-rouge">Map</code>, <code class="highlighter-rouge">ImmMap</code>,
<code class="highlighter-rouge">Set</code>, and <code class="highlighter-rouge">ImmSet</code>.</li>
  <li>variables called <code class="highlighter-rouge">$php_errormsg</code> or <code class="highlighter-rouge">$http_response_header</code> are no longer
special</li>
  <li>Calling instance methods statically or static methods as instance methods
now raises a warning.</li>
  <li><code class="highlighter-rouge">array_keys()</code> now only takes one argument</li>
  <li>undefined constants (‘barewords’) now always raise an error</li>
  <li>the <code class="highlighter-rouge">phar</code> extension has been removed, as HHVM does not support building
phars and was no longer able to execute PHP phars.</li>
  <li>integers now wrap instead of overflowing to floats</li>
  <li><code class="highlighter-rouge">Closure::bindTo</code> and <code class="highlighter-rouge">Closure::call</code> have been removed; these were already
typechecker errors</li>
  <li><code class="highlighter-rouge">record</code> is a reserved word in preparation for a new data structure type.</li>
  <li>functions must be declared at the top level, or directly inside a namespace
block. For example, they can no longer be defined conditionally, or inside
another function.</li>
</ul>

<h3 id="php-files">PHP Files</h3>

<p><code class="highlighter-rouge">&lt;?php</code> now raises a runtime error; while PHP is no longer supported by HHVM,
it is still possible to allow the <code class="highlighter-rouge">&lt;?php</code> tag by setting the
<code class="highlighter-rouge">hhvm.enable_php=true</code> INI setting.</p>

<p>We disabled it by default as executing PHP files with HHVM 4 tends to give
confusing and misleading error messages due to changes around references;
disabling support allows a much clearer error message to be provided.</p>

<h3 id="markup-sections">Markup Sections</h3>

<p>The parser no longer understands markup sections; they are both typechecker
and runtime errors. Relatedly, <code class="highlighter-rouge">?&gt;</code> is no longer recognized.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>This is a leading markup section
&lt;?php
// foo
?&gt;
This is a markup section, but not a leading markup section
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Shebang lines (e.g. <code class="highlighter-rouge">#!/usr/bin/env hhvm</code>) are still permitted as the first
line of a file.</p>

<h2 id="future-changes">Future Changes</h2>

<ul>
  <li>in 4.2, <code class="highlighter-rouge">&lt;?hh</code> will imply strict mode, instead of being an error</li>
  <li><code class="highlighter-rouge">filter_input()</code> and <code class="highlighter-rouge">filter_array()</code> will be removed in a future release</li>
  <li>the IPC and extension will be removed in a future release</li>
  <li>the session extension and <code class="highlighter-rouge">$_SESSION</code> will be removed in a future release</li>
  <li><code class="highlighter-rouge">declare()</code> will be removed in a future release</li>
  <li>user streams and stream filters will be removed in a future release</li>
  <li>static locals will be removed in HHVM 4.2; a type checker error can be raised
by setting the <code class="highlighter-rouge">disable_static_local_variables=true</code> option in .hhconfig</li>
  <li>property types will be enforced in a future release</li>
  <li>The <code class="highlighter-rouge">hhvm.hard_type_hints</code> option will be removed; type hints will always
be enforced (this has been the default behavior for some time).</li>
  <li>static closures will be removed in a future release; the
<code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_static_closures</code> INI setting can be used to
disable support in 4.0</li>
  <li>Calling instance methods statically or static methods as instance methods will
be an error in a future release. In 4.0, this raises a warning.</li>
  <li>Removed <code class="highlighter-rouge">hackificator</code>, <code class="highlighter-rouge">augmented_types</code>, <code class="highlighter-rouge">remove_soft_types</code>, and
<code class="highlighter-rouge">compare_coverage.py</code> as they have been unmaintained for some time.</li>
  <li>Dynamic calls will not be allowed to take by-reference parameters; this can
be currently be enforced with the <code class="highlighter-rouge">disallow_byref_dynamic_calls</code> <code class="highlighter-rouge">.hhconfig</code>
option</li>
</ul>

<h3 id="static-locals">Static Locals</h3>

<p>Static local variables will no longer be supported - for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>function foo(): void {
  static $foo = null;
  // ...
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>There are several approaches for replacing them:</p>
<ul>
  <li>replace with <code class="highlighter-rouge">&lt;&lt;__Memoize&gt;&gt;</code> or <code class="highlighter-rouge">&lt;&lt;__MemoizeLSB&gt;&gt;</code></li>
  <li>use instance properties</li>
  <li>use static properties; care is needed to make sure that <code class="highlighter-rouge">self::</code> or <code class="highlighter-rouge">static::</code>
is used correctly; the behavior of static local variables dependeded on the
caller, so this could not be inferred.</li>
</ul>

<p>If the function is potentially recursive, you may need to copy the property
into a local, so that deeper calls do not affect the value in their callers.</p>

<h3 id="property-type-enforcement">Property Type Enforcement</h3>

<p>The <code class="highlighter-rouge">hhvm.check_prop_type_hints</code> INI setting can be used to enable runtime
enforcement of property types. This enables additional optimizations.</p>

<p>Valid values are:</p>
<ul>
  <li>1: raise a warning</li>
  <li>2: raise a recoverable error</li>
  <li>3: raises a non-recoverable error</li>
</ul>

<p>We expect property type enforcement to be mandatory in a future version.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/04/03/hhvm-4.0.4.html">HHVM 4.0.4, 3.30.5, and 3.27.8</a></h1>
    <p class="post-meta">发布于 2019 年 4 月 3 日</p>
  </header>

  <article class="post-content">
  
    
      <p>These releases address CVE-2019-3561; it was previously possible to read
unintended memory locations if invalid offsets were passed to <code class="highlighter-rouge">strrpos</code>.</p>

<p>Additionally, 3.30.5 makes it possible to configure <code class="highlighter-rouge">hackfmt</code> behavior via
<code class="highlighter-rouge">.hhconfig</code>, such as:</p>
<ul>
  <li><code class="highlighter-rouge">hackfmt.add_trailing_commas</code></li>
  <li><code class="highlighter-rouge">hackfmt.indent_width</code></li>
  <li><code class="highlighter-rouge">hackfmt.tabs</code></li>
  <li><code class="highlighter-rouge">hackfmt.line_width</code></li>
</ul>

<p>These options were already supported in 4.0.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/02/28/hhvm-4.0.3.html">HHVM 4.0.3</a></h1>
    <p class="post-meta">发布于 2019 年 2 月 28 日</p>
  </header>

  <article class="post-content">
  
    
      <p>This release is fixes some IDE features in <code class="highlighter-rouge">.hack</code> files, especially in
<code class="highlighter-rouge">.hack</code> files which contain the string <code class="highlighter-rouge">&lt;?hh</code> such as code generators.</p>

<p>Unfortunately, fixing this required breaking the same IDE features for PHP
files that contain leading markup (content before the <code class="highlighter-rouge">&lt;?</code>) - for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span><span class="cp">&lt;?php echo htmlspecialchars(get_page_title(); ?&gt;</span><span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
...
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Files that start with <code class="highlighter-rouge">&lt;?</code> or a shebang line (e.g. <code class="highlighter-rouge">#!/usr/bin/env hhvm</code>)
immediately followed by <code class="highlighter-rouge">&lt;?</code> at the start of the second line are not affected.</p>

<p>Additionally, our MacOS packages have been rebuilt to workaround some
incompatibilities with recent versinos of dependencies, and to require
Sandybridge-or-newer processors. Requiring Sandybridge provides a 19x speedup
over Homebrew’s defaults for some real-world workloads.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/02/19/hhvm-4.0.2.html">HHVM 4.0.2</a></h1>
    <p class="post-meta">发布于 2019 年 2 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.0.2 is released! This release:</p>
<ul>
  <li>fixes some issues with the <code class="highlighter-rouge">.hhconfig</code> <code class="highlighter-rouge">default_mode</code> option being
inconsistently applied</li>
  <li>supports <code class="highlighter-rouge">.hack</code> files as HTTP request entrypoints by default; previously,
the <code class="highlighter-rouge">hhvm.php_file.extensions[hack]=1</code> INI setting was required.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/02/14/hhvm-4.0.1.html">HHVM 4.0.1, 3.30.4, and 3.27.7: CVE-2019-3552</a></h1>
    <p class="post-meta">发布于 2019 年 2 月 14 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.0.1, 3.30.4, and 3.27.7 are released; these issues fix CVE-2019-3552,
a potential denial of service if Thrift is used to process untrusted input.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/02/11/hhvm-4.0.0.html">HHVM 4.0.0</a></h1>
    <p class="post-meta">发布于 2019 年 2 月 11 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 4.0 is released! This release adds support for <code class="highlighter-rouge">.hack</code> files, non-experimental support for HSL regular expressions, and removes several PHP behaviors.</p>

<h2 id="php-is-unsupported">PHP Is Unsupported</h2>

<p>With this release, we no longer aim to be compatible with PHP. While this release does not ban <code class="highlighter-rouge">&lt;?php</code> and similar tags, various changes make HHVM unable to execute most PHP projects. PHP-incompatible changes in this release mostly fit in to one of three goals:</p>

<ul>
  <li>remove behavior that exists in PHP Arrays but not Hack Arrays or Hack Collections.</li>
  <li>deprecation of references</li>
  <li>removal of functions (or ways to invoke functions) that need to inspect or alter the caller frame such as <code class="highlighter-rouge">compact()</code>, <code class="highlighter-rouge">extract()</code>, <code class="highlighter-rouge">get_declared_variables()</code>, <code class="highlighter-rouge">func_get_args()</code>, or <code class="highlighter-rouge">parse_str()</code> with a single argument.</li>
</ul>

<p>We are considering removing support for <code class="highlighter-rouge">&lt;?php</code> in the next release: the primary benefit would be a clearer error message (such as “HHVM no longer supports PHP code”) rather than more-specific messages such as parse errors which may be less useful. We welcome feedback on this via IRC, <a href="https://www.facebook.com/groups/hhvm.general/">Facebook</a>, or <a href="https://twitter.com/hiphopvm">Twitter</a>.</p>

<h2 id="using-composer">Using Composer</h2>

<p>HHVM is no longer able to execute Composer; Composer 1.8.4 includes support for identifying the HHVM version when executing via PHP, which is how we currently recommend installing dependencies for Hack projects.</p>

<p>We are currently working to move to a package manager that fully supports multiple languages.</p>

<h2 id="new-release-schedule">New Release Schedule</h2>

<p>HHVM 4.1 will be released and supported following the current release schedule (i.e. released in 8 weeks, and then supported for 8 weeks). 4.2 will be released 1 week later, and mark the start of a weekly release schedule.</p>

<p>Each weekly release will receive security support for 6 weeks, and we are keeping the current long-term-release cycle: every 24 weeks, a release is made that will be supported for 48 weeks. This means that there will be up to 8 releases concurrently supported.</p>

<p>We recommend updating weekly, but holding back if a release is particularly painful. We decided on 6 weeks to also make monthly upgrades a workable option.</p>

<h2 id="new-features">New Features</h2>

<h3 id="hack-file-extension"><code class="highlighter-rouge">.hack</code> File Extension</h3>

<p>We now recommend using the <code class="highlighter-rouge">.hack</code> file extension if your editor/IDE support it; files with this extension are <strong>always</strong> strict, and do not require or allow a <code class="highlighter-rouge">&lt;?</code> header line. For example, this is a complete <code class="highlighter-rouge">.hack</code> file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>#!/usr/bin/env hhvm

&lt;&lt;__EntryPoint&gt;&gt;
function main(): noreturn {
  print("Hello, world!\n");
  exit(0);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Other extensions such as <code class="highlighter-rouge">.php</code> and <code class="highlighter-rouge">.hh</code> remain supported, and require the <code class="highlighter-rouge">&lt;?hh</code> header. We recommend only using these temporarily, for existing code - not for new projects.</p>

<p>It’s important to note that this means that HHVM will attempt to execute any <code class="highlighter-rouge">.hack</code> files that users can request, even if they do not include ‘<code class="highlighter-rouge">&lt;?</code>’.</p>

<h3 id="hhlibregex-is-no-longer-experimental">HH\lib\Regex is No Longer Experimental</h3>

<p>The <code class="highlighter-rouge">HH\Lib\Regex</code> namespace is no longer part of hsl-experimental, and is now part of the main HSL project. <a href="https://hhvm.com/blog/2018/09/28/hhvm-3.28.2.html">The 3.28.2 release notes</a> provide an overview of this feature.</p>

<h2 id="breaking-changes">Breaking changes</h2>

<ul>
  <li>return-by-reference is no longer supported</li>
  <li>Using references in combination with array_map, array_reduce, array_walk, array_walk_recursive, or array_filter has differing behavior in some edge cases, especially when the reference is mutated while iterating.</li>
  <li>ASP tags (<code class="highlighter-rouge">&lt;% %&gt;</code>) are no longer supported</li>
  <li>Functions that depend on the old C++ lexer and parser (instead of HackC) have been removed. This includes <code class="highlighter-rouge">token_get_all()</code>, <code class="highlighter-rouge">token_name()</code>, <code class="highlighter-rouge">php_strip_whitespace()</code>, <code class="highlighter-rouge">show_source()</code>, <code class="highlighter-rouge">highlight_file()</code>, and <code class="highlighter-rouge">highlight_string()</code>; these functions have been unable to fully handle Hack code since 3.27.</li>
  <li><code class="highlighter-rouge">create_function()</code> has been removed; use lambdas or closures instead.</li>
  <li>Our Docker images are now based on Ubuntu 18.04 instead of Ubuntu 16.04.</li>
  <li>Generators no longer auto-prime; they should ideally be accessed via <code class="highlighter-rouge">foreach</code>. For manual iteration, <code class="highlighter-rouge">-&gt;next()</code> must be called before accessing the values.</li>
  <li>All by-ref parameters must be marked with <code class="highlighter-rouge">&amp;</code> at the callsite. This was previously a typechecker error, and is now also a runtime error.</li>
  <li>Variable-variables (<code class="highlighter-rouge">$$foo</code>) are no longer supported</li>
  <li><code class="highlighter-rouge">parse_str()</code> now requires two arguments</li>
  <li><code class="highlighter-rouge">assert()</code> will no longer evaluate string arguments</li>
  <li><code class="highlighter-rouge">extract()</code> has been removed</li>
  <li><code class="highlighter-rouge">compact()</code> has been removed</li>
</ul>

<h2 id="future-changes">Future Changes</h2>

<ul>
  <li>With the exception of <code class="highlighter-rouge">.hack</code> files, specifying a mode will be required; for example, <code class="highlighter-rouge">&lt;?hh // strict</code> will remain valid, but <code class="highlighter-rouge">&lt;?hh</code> by itself will not. We recommend moving to <code class="highlighter-rouge">.hack</code> files if possible, otherwise <code class="highlighter-rouge">&lt;?hh // strict</code>. If neither is immediately practical, <code class="highlighter-rouge">&lt;?hh</code> can be replaced with <code class="highlighter-rouge">&lt;?hh // partial</code>. You can enable this behavior with the “<code class="highlighter-rouge">default_mode=error</code>” <code class="highlighter-rouge">.hhconfig</code> option.</li>
  <li>Non-top-level declarations will no longer be supported. For example, it will no longer be possible to declare classes or functions from other functions, or from <code class="highlighter-rouge">if</code> statements. In 4.0, you can disable support via the <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_nontoplevel_declarations</code> INI setting.</li>
  <li>The operator precedence of <code class="highlighter-rouge">await</code> will be changing, to allow <code class="highlighter-rouge">await</code> to be used as an expression. You can enable the new precedence with the <code class="highlighter-rouge">hhvm.hack.lang.enable_stronger_await_binding=true</code> INI setting - in problematic cases, this will lead to await being parsed as an expression, which will currently raise an error. We expect this to mostly affect await statements using the ternary operator, such as <code class="highlighter-rouge">await $foo ? $bar : $baz</code>; currently, this is parsed as <code class="highlighter-rouge">await ($foo ? $bar : $baz)</code>, but in future releases it will be parsed as <code class="highlighter-rouge">(await $foo) ? $bar : $baz</code>. <code class="highlighter-rouge">hhast-migrate --await-precedence</code> can be used to add parentheses automatically.</li>
  <li>Support for the <code class="highlighter-rouge">hhvm.enable_zend_sorting</code> option will be removed. This option makes HHVM use a slower, PHP-compatible sorting algorithm, which has different behavior in edge cases such as when elements compare as equal.</li>
  <li>Reference assignment (<code class="highlighter-rouge">$x =&amp; $y</code>) will be removed. The <code class="highlighter-rouge">disallow_assign_by_ref</code> typechecker option can be used to opt-in to this behavior now.</li>
  <li>It will no longer be possible to take references to superglobals in 4.1, e.g. <code class="highlighter-rouge">some_function(&amp;$_GET)</code></li>
  <li>The <code class="highlighter-rouge">global</code> keyword will be removed, e.g. <code class="highlighter-rouge">function foo() { global $bar; }</code></li>
  <li>Support for static locals will be removed by 4.2 (<code class="highlighter-rouge">function f() { static $foo = 42; return ++$foo; }</code>); we plan to provide an optional ban in 4.1</li>
  <li><code class="highlighter-rouge">func_num_args</code>, <code class="highlighter-rouge">func_get_args</code>, and <code class="highlighter-rouge">func_get_arg</code> will be removed in 4.1. Use variadics instead.</li>
  <li>Providing too few or too many arguments to a function will be an error</li>
  <li><code class="highlighter-rouge">get_defined_vars()</code> will be removed</li>
  <li><code class="highlighter-rouge">get_class()</code> will require an argument.</li>
  <li><code class="highlighter-rouge">get_called_class()</code> will be removed.</li>
  <li><code class="highlighter-rouge">get_class_vars()</code> will be removed.</li>
  <li>Passing the wrong types to builtins will throw, instead of returning false or null. You can enable logging for this with the <code class="highlighter-rouge">hhvm.warn_on_coerce_builtin_params</code> INI setting.</li>
  <li>Builtins will respect method visibility when invoking array callbacks - e.g. <code class="highlighter-rouge">array_map([$this, 'privateFunc'], $arr)</code> will fail as array_map is not part of the class.</li>
  <li>Type parameters will no longer be able to shadow global type names; for example, <code class="highlighter-rouge">class T&lt;T&gt; {}</code> will be invalid.</li>
  <li>Several behaviors will be removed from PHP arrays; the general principle is that PHP arrays should work as “vec or dict”. Notices can be enabled for these behaviors by setting both the <code class="highlighter-rouge">hhvm.hack_arr_compat_notices</code> option and the associated notice options listed below:
    <ul>
      <li>Int-like string keys will not be converted to integers. Set <code class="highlighter-rouge">hhvm.hack_arr_compat_check_intish_cast</code> to raise notices.</li>
      <li>Binding references to array elements will not be permitted. Set <code class="highlighter-rouge">hhvm.hack_arr_compat_check_ref_bind</code> to raise notices.</li>
      <li>The values <code class="highlighter-rouge">null</code>, <code class="highlighter-rouge">false</code>, or uninitialized variables will not be able to be treated as arrays. Set <code class="highlighter-rouge">hhvm.hack_arr_compat_check_falsey_promote</code> to raise notices.</li>
      <li>Empty strings will not be able to be treated as arrays. Set <code class="highlighter-rouge">hhvm.hack_arr_compat_check_empty_string_promote</code> to raise notices.</li>
      <li>Arrays will not be able to be compared to non-arrays. Setting <code class="highlighter-rouge">hhvm.hack_arr_compat_check_compare</code> will raise notices for ordering comparisons between arrays and non-arrays (scalars and objects) and for equality comparisons between arrays and Hack arrays. For example, <code class="highlighter-rouge">[] &gt; 3</code> or <code class="highlighter-rouge">[] === vec[]</code></li>
      <li>Non-<code class="highlighter-rouge">arraykey</code> values will not be able to be used as array keys and will not be automatically coerced. Set <code class="highlighter-rouge">hhvm.hack_arr_compat_check_array_key_cast</code> to raise notices. For example, <code class="highlighter-rouge">false</code> will no longer be converted to 0, <code class="highlighter-rouge">null</code> will not be converted to <code class="highlighter-rouge">""</code>, and <code class="highlighter-rouge">1.23</code> will no longer be automatically converted to <code class="highlighter-rouge">1</code> or <code class="highlighter-rouge">"1.23"</code> depending on the context.</li>
      <li>Arrays will not be able to be used with the plus (<code class="highlighter-rouge">+</code>) operator. Set <code class="highlighter-rouge">hhvm.hack_arr_compat_check_array_plus</code> to raise notices.</li>
    </ul>
  </li>
</ul>

<p>Additionally, several ‘future changes’ that were announced with 3.30 are still planned:</p>

<ul>
  <li>ints will wrap in future releases, instead of being converted to floats, allowing the type of <code class="highlighter-rouge">int + int</code> to be <code class="highlighter-rouge">int</code>, instead of <code class="highlighter-rouge">int + int = num</code>. This behavior can be enabled with the <code class="highlighter-rouge">hhvm.hack.lang.ints_overflow_to_ints</code> INI setting</li>
  <li>PHP-style anonymous functions will no longer support by-ref <code class="highlighter-rouge">use()</code> parameters. This restriction can be enabled in the typechecker by adding the <code class="highlighter-rouge">disallow_anon_use_capture_by_ref</code> <code class="highlighter-rouge">.hhconfig</code> option</li>
  <li><code class="highlighter-rouge">goto</code> will no longer be supported in Hack files. This restriction can be enabled in the type-checker by adding the <code class="highlighter-rouge">disallow_goto</code><code class="highlighter-rouge">.hhconfig</code> option</li>
  <li>Runtime namespace fallback support for constants will be removed (<code class="highlighter-rouge">hhvm.hack.lang.phpism.undefined_const_fallback</code>)</li>
  <li>Undefined constants will no longer be converted to strings (‘barewords’ - <code class="highlighter-rouge">hhvm.hack.lang.phpism.undefined_const_as_string</code>)</li>
  <li>Variables called <code class="highlighter-rouge">$php_errormsg</code> or <code class="highlighter-rouge">$http_response_header</code> will no longer be special (<code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_reserved_variables</code>)</li>
  <li>Casting objects to strings will no longer be supported (<code class="highlighter-rouge">hhvm.fatal_on_convert_object_to_string</code>); this includes removal of support for <code class="highlighter-rouge">__toString()</code></li>
  <li>Array-access on non-builtins will no longer be supported (a notice will be raised if <code class="highlighter-rouge">hhvm.notice_on_array_access_use</code> is enabled)</li>
  <li>Several functions with special runtime behavior will be removed:
    <ul>
      <li><code class="highlighter-rouge">constant()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_constant</code></li>
      <li><code class="highlighter-rouge">define()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_define</code></li>
      <li><code class="highlighter-rouge">forward_static_call()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_forward_static_call</code></li>
      <li><code class="highlighter-rouge">forward_static_call_array()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_forward_static_call_array</code></li>
      <li><code class="highlighter-rouge">call_user_func()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_call_user_func</code></li>
      <li><code class="highlighter-rouge">call_user_func_array()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_call_user_func_array</code></li>
    </ul>
  </li>
</ul>


    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/02/01/hhvm-3.30.3.html">HHVM 3.30.3</a></h1>
    <p class="post-meta">发布于 2019 年 2 月 1 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.30.3 is released; this release contains several bugfixes:</p>
<ul>
  <li>Fix default options for single-core computers or virtual machines</li>
  <li>Fix an issue in hhbbc that could lead to a segfault when building for
repo-authoritative mode</li>
  <li>Fix support for <code class="highlighter-rouge">#</code> comments in IDE integration - previously these would be
rendered as markdown headings.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2019/01/14/hhvm-3.30.2.html">HHVM 3.30.2 and 3.27.6</a></h1>
    <p class="post-meta">发布于 2019 年 1 月 14 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.30.2 and 3.27.6 are released; these releases address:</p>
<ul>
  <li>CVE-2018-6345: data corruption in <code class="highlighter-rouge">number_format()</code> error cases</li>
  <li>CVE-2019-3557: out of bounds read in <code class="highlighter-rouge">stream_get_line()</code> and bz2 reads</li>
  <li>3.30.2 fixes a regression in in <code class="highlighter-rouge">HH\Asio\curl_exec()</code> which was introduced in
3.30.0</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/12/18/hhvm-3.30.1.html">HHVM 3.30.1 and 3.27.5</a></h1>
    <p class="post-meta">发布于 2018 年 12 月 18 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.30.1 and 3.27.5 are released; these releases address CVE-2018-6340, a
stack read overflow in Memcache::getExtendedStats(). Exploiting this requires
control over memcached server hostnames and/or ports.</p>

<p>Additionally:</p>
<ul>
  <li>3.27.5 includes a fix for type coverage IDE support</li>
  <li>our Mac binaries have been rebuilt to require sandybridge (model year 2011 or
later). This provides a 10x performance improvement on some common workloads.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/12/17/hhvm-3.30.html">HHVM 3.30</a></h1>
    <p class="post-meta">发布于 2018 年 12 月 17 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.30 is released! This release has long term support, ending in November 2019.</p>

<p>This release is the final release where we aim to support PHP code, and as such, contains several opt-in changes that break compatibility; as well as the specific options below (which we expect to remove during the next few releases), a <code class="highlighter-rouge">hhvm.enable_php=false</code> option is available, which disables support for files that begin with <code class="highlighter-rouge">&lt;?php</code>. We do not anticipate removing this option in the immediate future - the primary purpose is to enable testing to make sure that Hack projects do not have hidden PHP dependencies.</p>

<h2 id="new-features">New Features</h2>

<ul>
  <li>list destructuring of class constants is now supported (e.g. when the class constant is a tuple)</li>
  <li>improved performance of <code class="highlighter-rouge">C\first</code>, <code class="highlighter-rouge">C\first_key</code>, <code class="highlighter-rouge">C\last</code>, and <code class="highlighter-rouge">C\last_key</code> on containers</li>
  <li>traits may now implement sealed interfaces</li>
</ul>

<h2 id="usability">Usability</h2>

<ul>
  <li>the type-checker error for <code class="highlighter-rouge">$shape-&gt;foo</code> now suggests <code class="highlighter-rouge">$shape['foo']</code></li>
  <li>added type-checker error for importing the same method from multiple traits (previously a runtime error)</li>
  <li>added type-checker error for overriding non-abstract interface constants (previously a runtime error)</li>
  <li>added type-checker error for is/as on traits (previously a runtime error)</li>
  <li>added type-checker error when calling parent::__construct() if parent does not have a defined constructor (previously a runtime error)</li>
</ul>

<h2 id="breaking-changes">Breaking Changes</h2>

<ul>
  <li><code class="highlighter-rouge">is_int()</code> and similar can no longer be used to refine primitive types. Use <code class="highlighter-rouge">is int</code> etc instead (<code class="highlighter-rouge">hhast-migrate --is-refinement</code> applies this change)</li>
  <li>the <code class="highlighter-rouge">&lt;&lt;__Entrypoint&gt;&gt;</code> attribute is now <code class="highlighter-rouge">&lt;&lt;__EntryPoint&gt;&gt;</code>; we consider the syntax stable, however the required function signature is not yet final. We recommend using <code class="highlighter-rouge">function(): noreturn</code> or<code class="highlighter-rouge"> function(): Awaitable&lt;noreturn&gt;</code> for now, to provide the greatest compatibility for potential future changes</li>
  <li>added typechecker error when checking truthiness of <code class="highlighter-rouge">Traversable</code>s; this is not a safe/meaningful test given that generators are Traversables</li>
</ul>

<h2 id="future-changes">Future Changes</h2>

<ul>
  <li>
    <p>ints will wrap in future releases, instead of being converted to floats, allowing the type of <code class="highlighter-rouge">int + int</code> to be <code class="highlighter-rouge">int</code>, instead of <code class="highlighter-rouge">int + int = num</code>. This behavior can be enabled with the <code class="highlighter-rouge">hhvm.hack.lang.ints_overflow_to_ints</code> INI setting</p>
  </li>
  <li>
    <p>Generators will no longer auto-prime; they should ideally be accessed via <code class="highlighter-rouge">foreach</code>. For manual iteration, <code class="highlighter-rouge">-&gt;next()</code> must be called before accessing the values. This behavior can be enabled with the <code class="highlighter-rouge">hhvm.hack.lang.autoprime_generators</code> INI setting</p>
  </li>
  <li>returning by reference will be completely unsupported. This behavior can be enabled with the <code class="highlighter-rouge">hhvm.disable_return_by_reference=1</code> INI setting</li>
  <li>byref parameters will throw if the callsite is not annotated. This is currently a warning. Throwing can be enabled with the <code class="highlighter-rouge">hhvm.throw_on_call_by_ref_annotation_mismatch=1</code> INI setting</li>
  <li>PHP-style anonymous functions will no longer support by-ref <code class="highlighter-rouge">use()</code> parameters. This restriction can be enabled in the typechecker by adding the <code class="highlighter-rouge">disallow_anon_use_capture_by_ref</code> <code class="highlighter-rouge">.hhconfig</code> option</li>
  <li><code class="highlighter-rouge">goto</code> will no longer be supported in Hack files. This restriction can be enabled in the type-checker by adding the <code class="highlighter-rouge">disallow_goto</code> <code class="highlighter-rouge">.hhconfig</code> option</li>
  <li>Support for variable-variables (<code class="highlighter-rouge">$$foo</code>) will be removed (<code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_variable_variables</code>)</li>
  <li>Runtime namespace fallback support for constants will be removed (<code class="highlighter-rouge">hhvm.hack.lang.phpism.undefined_const_fallback</code>)</li>
  <li>Undefined constants will no longer be converted to strings (‘barewords’ - <code class="highlighter-rouge">hhvm.hack.lang.phpism.undefined_const_as_string</code>)</li>
  <li><code class="highlighter-rouge">parse_str()</code> will require multiple arguments (<code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_parse_str_single_arg</code>)</li>
  <li>backticks will no longer be supported for process execution (<code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_execution_operator</code>)</li>
  <li>Variables called <code class="highlighter-rouge">$php_errormsg</code> or <code class="highlighter-rouge">$http_response_header</code> will no longer be special (<code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_reserved_variables</code>)</li>
  <li>Casting objects to strings will no longer be supported (<code class="highlighter-rouge">hhvm.fatal_on_convert_object_to_string</code>); this includes removal of support for <code class="highlighter-rouge">__toString()</code></li>
  <li>A notice will be raised on the use of <code class="highlighter-rouge">ArrayAccess</code> on non-builtin types (<code class="highlighter-rouge">hhvm.notice_on_array_access_use</code>)</li>
  <li>several functions with special runtime behavior will be removed:
    <ul>
      <li><code class="highlighter-rouge">assert()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_assert</code></li>
      <li><code class="highlighter-rouge">define()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_define</code></li>
      <li><code class="highlighter-rouge">constant()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_constant</code></li>
      <li><code class="highlighter-rouge">compact()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_compact</code></li>
      <li><code class="highlighter-rouge">extract()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_extract</code></li>
      <li><code class="highlighter-rouge">forward_static_call()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_forward_static_call</code></li>
      <li><code class="highlighter-rouge">forward_static_call_array()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_forward_static_call_array</code></li>
      <li><code class="highlighter-rouge">call_user_func()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_call_user_func</code></li>
      <li><code class="highlighter-rouge">call_user_func_array()</code>: <code class="highlighter-rouge">hhvm.hack.lang.phpism.disable_call_user_func_array</code></li>
    </ul>
  </li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/10/30/hhvm-3.29.1.html">HHVM 3.29.1 and 3.27.4</a></h1>
    <p class="post-meta">发布于 2018 年 10 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.29.1 and 3.27.4 are released! These releases contain bugfixes and improvements:</p>

<h1 id="3291">3.29.1</h1>

<ul>
  <li>Fix reversed assignment when lambdas have multiple <code class="highlighter-rouge">inout</code> parameters</li>
  <li>This release is available for Ubuntu 18.10 Cosmic</li>
  <li>Significantly reduced lock contention when not running in repo-authoritative mode</li>
  <li>Fix incorrect results for experimental HSL regex when combined with offset capture</li>
  <li>Support building on systems where <code class="highlighter-rouge">$PATH</code> includes spaces</li>
</ul>

<h1 id="3274">3.27.4</h1>

<ul>
  <li>Fix reversed assignment when lambdas have multiple <code class="highlighter-rouge">inout</code> parameters</li>
  <li>Support <code class="highlighter-rouge">stream_await()</code> on FDs when using CLI server (included in 3.29.0)</li>
  <li><code class="highlighter-rouge">stream_await()</code> will throw an <code class="highlighter-rouge">InvalidOperationException</code> if called on an unawaitable file descriptor. This includes actual on-disk files on Linux, as they are not supported by epoll. We recommend that callers attempt to <code class="highlighter-rouge">stream_await()</code>, and handle this exception if neccessary. The stream metadata can not be used to identify whether or not a stream is awaitable - for example, <code class="highlighter-rouge">hhvm foo.php</code> has an awaitable <code class="highlighter-rouge">STDIN</code>, but <code class="highlighter-rouge">hhvm foo.php &lt; myfile</code> has an awaitable <code class="highlighter-rouge">STDIN</code> on MacOS (kqueue) but not on Linux (epoll). In prior releases, behavior varied; the most common result was writing an error to <code class="highlighter-rouge">STDOUT</code>, and the awaitable not resolving, with request timeout eventually being reached (included in 3.29.0).</li>
</ul>

<p>The last issue is technically a BC break; we have included it in this release as the usual
behavior without that patch is to hang forever; throwing immediately seems likely to be an
improvement in the vast majority of cases.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/10/22/hhvm-3.29.html">HHVM 3.29</a></h1>
    <p class="post-meta">发布于 2018 年 10 月 22 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.29 is released! This release has a large amount of changes in the
typechecker; these mostly are now raising type errors for situations that
already failed at runtime, or banning rare cases that make the type system
unsound.</p>

<h1 id="breaking-changes">Breaking Changes</h1>

<ul>
  <li>[typechecker] correct inferred types for variables assigned in loops</li>
  <li>[typechecker] ban using traits in interfaces (previously failed at runtime, but typechecked fine)</li>
  <li>[typechecker] ban generic static properties, as the generic is unresolved until the class is instantiated</li>
  <li>[typechecker] keywords are case sensitive again (e.g. <code class="highlighter-rouge">new</code> is valid, <code class="highlighter-rouge">NEW</code> is not)</li>
  <li>[typechecker] ban using various keywords as identifiers, e.g. <code class="highlighter-rouge">class true {}</code> is not valid</li>
  <li>[typechecker] improved typing of array append - e.g. <code class="highlighter-rouge">$x = vec[]; $x[] = 'a string';</code> now gets you a <code class="highlighter-rouge">vec&lt;string&gt;</code></li>
  <li>[typechecker] ban instance methods on abstract final classes</li>
  <li>[typechecker] the <code class="highlighter-rouge">Throwable</code> class is now sealed to the <code class="highlighter-rouge">Exception</code> and <code class="highlighter-rouge">Error</code> classes</li>
  <li>[typechecker] ban <code class="highlighter-rouge">await</code> in pseudomains</li>
  <li>[typechecker] ban constructor parameter promotion in traits and interfaces</li>
  <li>[typechecker] re-ban anonymous classes; was un-banned by parser replacement</li>
  <li>[typechecker] ban the empty string as a shape key</li>
  <li>[typechecker] make sure that properties are consistently static or non-static across the hierarchy. Previously a runtime error.</li>
  <li>[typechecker] ban taking references to array literals. Previously a runtime error.</li>
  <li>[typechecker] ban taking references to expressions including <code class="highlighter-rouge">?-&gt;</code> operator. Previously a runtime error.</li>
  <li>[typechecker] ban <code class="highlighter-rouge">::class</code> on the RHS of <code class="highlighter-rouge">instanceof</code> expressions; uneeded.</li>
  <li>[typechecker] require visibility specifiers for properties again; was un-banned by parser replacement</li>
  <li>[typechecker] ban <code class="highlighter-rouge">await</code> in non-async lambdas. Previously a runtime error.</li>
  <li>[typechecker] ban truthiness checks on objects that are not <code class="highlighter-rouge">Container</code>s or <code class="highlighter-rouge">SimpleXMLElement</code>s</li>
  <li>[typechecker] ban impossible types (e.g. <code class="highlighter-rouge">abstract final</code> classes) as shape field types</li>
  <li>[typechecker] fix typechecking of <code class="highlighter-rouge">case</code> statements that are after a <code class="highlighter-rouge">default</code> statement</li>
  <li>[typechecker] ban the <code class="highlighter-rouge">(object)</code> cast (convert to <code class="highlighter-rouge">stdClass</code>) in strict mode</li>
  <li>[typechecker+HackC] ban the <code class="highlighter-rouge">&lt;&gt;</code> operator in Hack -the equivalent <code class="highlighter-rouge">!=</code> operator is still available- migration included in <a href="https://github.com/hhvm/hhast/">HHAST</a>: <code class="highlighter-rouge">hhast-migrate --ltgt-to-ne</code></li>
  <li>[typechecker] ban methods without a name. Previously a runtime error.</li>
  <li>[typechecker] infer better types for <code class="highlighter-rouge">Shapes::toDict()</code>, in the same way as <code class="highlighter-rouge">Shapes::toArray()</code> - for example, if all the fields are strings, you can get a <code class="highlighter-rouge">dict&lt;string, string&gt;</code></li>
  <li>[runtime] removed support for <code class="highlighter-rouge">/e</code> modifier (eval) for <code class="highlighter-rouge">preg_replace()</code>. Deprecated in PHP 5.5, removed from 7.0. Use <code class="highlighter-rouge">preg_replace_callback()</code> instead.</li>
  <li>[runtime] <code class="highlighter-rouge">stream_await()</code> will throw an <code class="highlighter-rouge">InvalidOperationException</code> if called on an unawaitable file descriptor. This includes actual on-disk files on Linux, as they are not supported by epoll. We recommend that callers attempt to <code class="highlighter-rouge">stream_await()</code>, and handle this exception if neccessary. The stream metadata can not be used to identify whether or not a stream is awaitable - for example, <code class="highlighter-rouge">hhvm foo.php</code> has an awaitable <code class="highlighter-rouge">STDIN</code>, but <code class="highlighter-rouge">hhvm foo.php &lt; myfile</code> has an awaitable <code class="highlighter-rouge">STDIN</code> on MacOS (kqueue) but not on Linux (epoll). In prior releases, behavior varied; the most common result was writing an error to <code class="highlighter-rouge">STDOUT</code>, and the awaitable not resolving, with request timeout eventually being reached.</li>
  <li>[hackc] ban variable variables (<code class="highlighter-rouge">$$foo</code>) in Hack code (previously required by the typechecker)</li>
  <li>[hackc] colons are now required again after ‘case’ and ‘default’ labels (previously required by the typechecker)</li>
</ul>

<h1 id="features">Features</h1>

<ul>
  <li>[hackfmt] added support for <code class="highlighter-rouge">// hackfmt-ignore</code> comments, to turn off formatting for a node</li>
  <li>[typechecker] null checks on <code class="highlighter-rouge">Shapes::idx()</code> results now refine the type of the shape</li>
  <li>add support for typed user attributes</li>
</ul>

<h2 id="typed-user-attributes">Typed User Attributes</h2>

<p>Currently, <code class="highlighter-rouge">&lt;&lt;Attributes&gt;&gt;</code> are unchecked, except if they start with <code class="highlighter-rouge">__</code> (indicating a builtin), and can contain any amount of static expressions of any type; it was possible to whitelist valid attribute names via <code class="highlighter-rouge">user_attributes=foo,bar</code>, but not to provide any additional checking.</p>

<p>We have addressed these problems by introducing typed user attributes, where attributes are represented by classes and objects; the parameters of an attribute must be valid for the class constructor, and the objects can be retrived via reflection.</p>

<p>For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>&lt;?hh // strict

namespace MyTestFramework {
  final class DataProvider implements \HH\MethodAttribute {
    public function __construct(public string $function) {
    }
  }
}

namespace MyThingBeingTested {
  use type MyTestFramework\DataProvider;
  
  final class MyTest extends MyTestFramework\TestCase {
    &lt;&lt;DataProvider('provideFoo')&gt;&gt;
    public function testFoo(): void {
    }
    
    &lt;&lt;DataProvider(123)&gt;&gt; // type error, not a string
    public function testBar(): void {
    }
    
    &lt;&lt;DataProvider('foo', 'bar')&gt;&gt; // type error, too many arguments
    public function testBaz(): void {
    }
  }
  
  &lt;&lt;DataProvider('foo')&gt;&gt; // type error, can't use DataProvider on functions, only methods
  function doStuff(): void {
  }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Attributes can be retrieved via reflection:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>&lt;?hh
$rc = new ReflectionClass('C');
$my_attr = $rc-&gt;getAttributeClass(MyAttribute::class);
invariant($my_attr is MyAttribute, 'we get an instance of the class');
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Attribute classes implement at least one of these interfaces:</p>
<ul>
  <li><code class="highlighter-rouge">ClassAttribute</code></li>
  <li><code class="highlighter-rouge">EnumAttribute</code></li>
  <li><code class="highlighter-rouge">TypeAliasAttribute</code></li>
  <li><code class="highlighter-rouge">FunctionAttribute</code></li>
  <li><code class="highlighter-rouge">MethodAttribute</code></li>
  <li><code class="highlighter-rouge">InstancePropertyAttribute</code></li>
  <li><code class="highlighter-rouge">StaticPropertyAttribute</code></li>
  <li><code class="highlighter-rouge">ParameterAttribute</code></li>
</ul>

<p>In 3.29, it is possible to declare attributes with this form, and if done, they were validated. In 3.30, declaring all attributes will be required, and it is possible to require this in 3.29 by setting an empty whitelist in <code class="highlighter-rouge">.hhconfig</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>user_attributes=
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="other-highlights">Other Highlights</h1>

<ul>
  <li>[typechecker] correct handling of <code class="highlighter-rouge">is</code> expressions in pipe expressions</li>
  <li>[typechecker] fix handling of <code class="highlighter-rouge">as</code> expressions in <code class="highlighter-rouge">list</code> assignments, e.g. <code class="highlighter-rouge">list($a, $b) = $mixed as (int, int);</code></li>
  <li>[typechecker+HackC] support unambiguous <code class="highlighter-rouge">as</code> expressions in <code class="highlighter-rouge">foreach</code>, e.g. <code class="highlighter-rouge">foreach(f($x as nonnull) as $y)</code></li>
  <li>[runtime] async curl functions are now natively async again</li>
  <li>[runtime] handle EINTR (e.g. Xenon) while invoking HackC</li>
  <li>[runtime] <code class="highlighter-rouge">&lt;&lt;__LateInit&gt;&gt;</code> now works correctly for private properties on abstract classes</li>
</ul>

<h1 id="upcoming-changes">Upcoming Changes</h1>

<ul>
  <li>[typechecker] remove support for type refinement via <code class="highlighter-rouge">is_bool()</code>, <code class="highlighter-rouge">is_int()</code> etc. This is currently opt-in via the <code class="highlighter-rouge">disable_primitive_refinement</code> <code class="highlighter-rouge">.hhconfig</code> option</li>
  <li>typed user attributes will be required. This is currently opt-in via the <code class="highlighter-rouge">user_attributes=</code> <code class="highlighter-rouge">.hhconfig</code> option</li>
</ul>


    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/10/01/hhvm-3.28.3.html">HHVM 3.28.3</a></h1>
    <p class="post-meta">发布于 2018 年 10 月 1 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.28.3 is released, containing two bugfixes:</p>

<ul>
  <li>the regex support introduced in 3.28.2 no longer requires a typechecker
option (though the feature is still experimental)</li>
  <li>allow combining list assignment with <code class="highlighter-rouge">as</code> expressions, e.g.
<code class="highlighter-rouge">list($a, $b) = $foo as (int, int)</code></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/09/28/hhvm-3.28.2.html">HHVM 3.28.2 and 3.27.3</a></h1>
    <p class="post-meta">发布于 2018 年 9 月 28 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.28.2 contains bugfixes, and several features that weren’t quite ready for 3.28.0:</p>

<h2 id="bugfixes">Bugfixes</h2>

<ul>
  <li>3.27.3 and 3.28.2: handle EINTR when using HackC (common when using Xenon) - thanks to Keith Adams.</li>
  <li>3.27.3 and 3.28.2:  fix namespace resolution in anonymous classes when using HackC</li>
  <li>3.28.2: Support single-line <code class="highlighter-rouge">if</code> statements in hackfmt</li>
</ul>

<h2 id="features-and-improvements">Features and Improvements</h2>

<ul>
  <li>3.27.3 and 3.28.2: provide better information on mouse hover in LSP editors and IDEs</li>
  <li>3.28.2: Experimental: add <code class="highlighter-rouge">&lt;&lt;__Entrypoint&gt;&gt;</code>, removing the need for pseudo-mains.
<em>Update</em>: as of 3.30, this is now <code class="highlighter-rouge">&lt;&lt;__EntryPoint&gt;&gt;</code></li>
  <li>3.28.2: Experimental: add regular expression support as a native type</li>
</ul>

<h2 id="__entrypoint">«__Entrypoint»</h2>

<p>This is a new attribute, marking a single function in a file as being the ‘main’ function for this file:</p>

<p><em>Update: as of 3.30, this attribute is now called <code class="highlighter-rouge">&lt;&lt;__EntryPoint&gt;&gt;</code></em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>&lt;?hh // strict

&lt;&lt;__Entrypoint&gt;&gt;
function main(): noreturn {
  exit(0);
}

// ... or ...
&lt;&lt;__Entrypoint&gt;&gt;
async function main(): Awaitable&lt;noreturn&gt; {
  exit(0);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Entrypoint functions will be automatically executed if they are in the top-level file; they will not be automatically executed if the file is included via include, require, or the autoloader.</p>

<p>Like other functions in Hack, the function names must be unique within your project - i.e. projects with multiple entrypoints can not call both ‘main’.</p>

<h3 id="open-issues">Open Issues</h3>

<ul>
  <li>We have not yet finalized the signature of these functions; no parameters are passed, and the return value (if any) is ignored. We are likely to require <code class="highlighter-rouge">noreturn</code> or <code class="highlighter-rouge">Awaitable&lt;noreturn&gt;</code> in a future release, and we recommend using these types for now.</li>
  <li>We have not yet established a Hack API for accessing request data or argv; for now, we recommend using partial-mode Hack wrappers around existing PHP interfaces, such as <code class="highlighter-rouge">$_GLOBALS['argv']</code>; in a later release, we are likely to expose this via a function, possibly called <code class="highlighter-rouge">HH\Request\argv()</code>; we welcome feedback and suggestions for this API</li>
</ul>

<h2 id="regular-expressions">Regular Expressions</h2>

<p>This feature is a combination of a new language feature, and new library functions; the library functions are currently in the <a href="https://github.com/hhvm/hsl-experimental/">hsl-experimental</a> package, and we expect them to move to the main HSL package in a future release.</p>

<p>Regular expressions take advantage of a new Hack feature called <em>prefix strings</em>. Prefix strings allow the user to tag string literals, giving the typechecker more information.</p>

<p>In the <code class="highlighter-rouge">Regex\</code> namespace, a regular expression is represented by the <code class="highlighter-rouge">Pattern</code> type instead of a string. A <code class="highlighter-rouge">Pattern</code> is obtained by using a <code class="highlighter-rouge">re</code>-prefixed string literal:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$pattern = re"/foo(bar)?/";
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now, the typechecker knows that the string is a regular expression! This means that it can warn us at typecheck time if we have written a malformed pattern:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>$pattern = re"I am not a regular expression";
// ERROR: Bad regex pattern; Missing delimiter(s). (Typing[4275])

$pattern = re"/(no closing paren/";
// ERROR: Bad regex pattern; Missing ) [17]. (Typing[4275])
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Furthermore, the <code class="highlighter-rouge">Pattern</code> type has a type parameter which represents the shape of a match (containing positional and named capture groups), and the <code class="highlighter-rouge">Regex\</code> APIs return this shape. This means that the keys of the shape are also known at typecheck time:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>use namespace HH\Lib\Regex;

$match = Regex\first_match(
  $some_string,
  re"/^(positional)and(?&lt;named&gt;foo)$/"
);

if ($match is nonnull) {
  $match[0]; // OK, full matched string
  $match[1]; // OK, first positional group
  $match['named']; // OK, named group
  $match['nonexistent']; // ERROR: The field nonexistent is undefined (Typing[4108])
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If a capture group isn’t matched in the input string, the value for its key will be set to the empty string.</p>

<p>Regular expressions matches are supported by existing IDE features, such as
type-on-hover and shape key autocomplete:</p>

<p><img src="/static/images/posts/2018-09-28-regex-types.png" alt="type-on-hover example, showing a nullable shape keyed by captures" />
<img src="/static/images/posts/2018-09-28-regex-autocomplete.png" alt="shape key autocomplete example, showing autocomplete for named and positional captures" /></p>

<p>For the full API, see <a href="https://github.com/hhvm/hsl-experimental/blob/03daf701049172f7061d23e76a04197ca1a1be10/src/regex/regex.php">the source</a>; it will join the main HSL documentation once the feature is no longer experimental.</p>

<h3 id="limitations">Limitations</h3>

<p>For now, the prefix string is the only way to obtain a <code class="highlighter-rouge">Pattern</code>, meaning this library only works with statically known regular expressions. We will be introducing support for dynamic patterns soon.
The <code class="highlighter-rouge">Regex\</code> namespace requires limited forms of two new Hack features: prefix strings and integer keys on shapes.</p>

<ul>
  <li>For now, only regular expressions may use prefix strings. The Hack team is considering generalizing the prefix string feature, but it’s unlikely to happen this half.</li>
  <li>Because shapes are darrays under the hood, we are still disallowing user-defined shapes to define integer keys due to intish string array key coercion.</li>
</ul>

<h3 id="thanks">Thanks</h3>

<p>Thanks to Marcy Park for building this feature, and Christopher Chedeau, Fred Emmott, Robert Lynch, and Kunal Mehta for API design.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/09/26/introducing-hacktest.html">Introducing HackTest</a></h1>
    <p class="post-meta">发布于 2018 年 9 月 26 日</p>
  </header>

  <article class="post-content">
  
    
      <p>As HHVM <a href="https://hhvm.com/blog/2018/09/12/end-of-php-support-future-of-hack.html">moves away from PHP</a>, Hack projects need to be able to move away from PHP dependencies; the most common dependency is PHPUnit, by a large margin. As such, we are releasing <a href="https://github.com/hhvm/hacktest/">HackTest</a> (a framework for declaring and running unit tests) and retargetting <a href="https://github.com/hhvm/fbexpect/">fbexpect</a> (an expressive assertion library) to be a supported library for non-Facebook users.</p>

<p>These libraries provide a slightly different API to PHPUnit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="rouge-code"><pre>&lt;?hh // strict

use type Facebook\HackTest\HackTest;
use function Facebook\FBExpect\expect;

final class MyTest extends HackTest {
  &lt;&lt;__Override&gt;&gt;
  public static async function beforeFirstTestAsync(): Awaitable&lt;void&gt; {
    // this can be used to emulate setUpBeforeClass()
  }

  &lt;&lt;__Override&gt;&gt;
  public async function beforeEachTestAsync(): Awaitable&lt;void&gt; {
    // this can be used to emulate setUp()
  }

  &lt;&lt;__Override&gt;&gt;
  public async function afterEachTestAsync(): Awaitable&lt;void&gt; {
    // this can be used to emulate tearDown()
  }

  &lt;&lt;__Override&gt;&gt;
  public static async function afterLastTestAsync(): Awaitable&lt;void&gt; {
    // this can be used to emulate tearDownAfterClass()
  }

  public function testFoo(): void {
    // replaces $this-&gt;assertSame('bar', foo());
    expect(foo())-&gt;toBeSame('bar');
  }

  public function provideBars(): vec&lt;(string, int)&gt; {
    return vec[
      tuple('foo', 123),
      tuple('bar', 456),
    ];
  }

  &lt;&lt;DataProvider('provideBars')&gt;&gt; // replaces @dataProvider doccomment
  // tests can be async
  public async function testBar(string $a, int $_b): Awaitable&lt;void&gt; {
    $s = await get_message_async();
    // replaces @expectException and setExpectedException()
    expect(() ==&gt; {
      throw new \Exception($s);
    )-&gt;toThrow(\Exception::class);
  }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To make moving from PHPUnit to HackTest practical, we have extended <a href="https://github.com/hhvm/hhast">HHAST</a> to automate the required code changes - though the composer changes must be made separately.</p>

<p>We start with a Hack project that uses PHPUnit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>myproject$ hhvm vendor/bin/phpunit tests/
PHPUnit 5.7.27 by Sebastian Bergmann and contributors.

.............................................................   61 / 1309 (  4%)
.............................................................  122 / 1309 (  9%)
.............................................................  183 / 1309 ( 13%)
.............................................................  244 / 1309 ( 18%)
.............................................................  305 / 1309 ( 23%)
.............................................................  366 / 1309 ( 27%)
.............................................................  427 / 1309 ( 32%)
.............................................................  488 / 1309 ( 37%)
.............................................................  549 / 1309 ( 41%)
.............................................................  610 / 1309 ( 46%)
.............................................................  671 / 1309 ( 51%)
.............................................................  732 / 1309 ( 55%)
.............................................................  793 / 1309 ( 60%)
.............................................................  854 / 1309 ( 65%)
.............................................................  915 / 1309 ( 69%)
.............................................................  976 / 1309 ( 74%)
............................................................. 1037 / 1309 ( 79%)
............................................................. 1098 / 1309 ( 83%)
............................................................. 1159 / 1309 ( 88%)
............................................................. 1220 / 1309 ( 93%)
............................................................. 1281 / 1309 ( 97%)
............................                                  1309 / 1309 (100%)

Time: 13.95 seconds, Memory: 41.69MB

OK (1309 tests, 1310 assertions)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Then, we need to swap out the composer dependencies from PHPUnit to HackTest and FBExpect</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>myproject$ hhvm ~/composer.phar remove --dev phpunit/phpunit 91carriage/phpunit-hhi
...
myproject$ hhvm ~/composer.phar require --dev hhvm/hacktest facebook/fbexpect
...
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Then we migrate the tests with HHAST, and run them with HackTest instead of PHPUnit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>myproject$ hhvm ~/code/hhast/bin/hhast-migrate --phpunit-to-hacktest tests/
myproject$ hhvm vendor/bin/hacktest tests/
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
...............................................................................
.............................................

Summary: 1309 test(s), 1309 passed, 0 failed, 0 skipped, 0 error(s).
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Finally, you might need to update your CI systems (such as TravisCI or CircleCI) to use HackTest instead of PHPUnit.</p>

<p>If you find cases that HHAST does not migrate correctly, we welcome GitHub issues and pull requests against <a href="https://github.com/hhvm/hhast/">the HHAST project</a>.</p>

<p>Thanks to Wilson Lin, Robert Lynch, and Kunal Mehta for their work on these
projects.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/09/12/end-of-php-support-future-of-hack.html">Ending PHP Support, and The Future Of Hack</a></h1>
    <p class="post-meta">发布于 2018 年 9 月 12 日</p>
  </header>

  <article class="post-content">
  
    
      <h1 id="ending-support-for-php">Ending Support for PHP</h1>

<p>HHVM v3.30 will be the last release series where HHVM aims to support PHP. The key dates are:</p>

<ul>
  <li>2018-12-03: branch cut: expect PHP code to stop working with master and nightly builds after this date</li>
  <li>2018-12-17: expected release date for v3.30.0</li>
  <li>2019-01-28: expected release date for v4.0.0, without PHP support</li>
  <li>2019-11-19: expected end of support for v3.30</li>
</ul>

<p>Ultimately, we recommend that projects either migrate entirely to the Hack language, or entirely to PHP7 and the PHP runtime.</p>

<p>We expect support for real-world PHP code to break rapidly: for example, we are likely to replace reference parameters (<code class="highlighter-rouge">&amp;$foo</code>) to builtins with <code class="highlighter-rouge">inout</code> parameters, make <code class="highlighter-rouge">INT64_MAX + 1 === INT64_MIN</code> (instead of a float),  among other changes. In the short term, we expect it to be fairly straightforward to migrate code to deal with these changes, but this will require that any dependencies written in PHP are either forked and migrated to Hack, or migrated away from.</p>

<p>We’re extremely grateful to the users and developers of PHP, and are glad to have been part of those communities.</p>

<h1 id="the-future-of-hack">The Future Of Hack</h1>

<p>We are proud of Hack, but there are still many areas where we want to make major improvements to the language; during the next 2-3 years, we will be working towards making Hack a language that builds on the best parts of its’ heritage to produce:</p>

<ul>
  <li>a consistent, statically typed language</li>
  <li>the development speed and ease-of-use that’s traditionally associated with dynamically typed languages</li>
</ul>

<p>During these 2-3 years, aggressive growth of our user base is not a primary goal: we want most people’s first exposure to Hack to be the improved language that we are working towards. However, we will be increasing our investment in Hack/HHVM open source, to continue to support our existing users, and aim to build a community ready to support growth in the future.</p>

<p>As we expect the language to evolve rapidly, we <strong>strongly</strong> recommend using the regular releases instead of the LTS releases for large projects; while this does mean you need to upgrade more often, both us and our users have found that it is generally easier to catch up on 2 months worth of changes 3 times as often than 6 months of changes in one go. We will also be re-evaluating the length of our release cycle; one possibility is that we will move to releases every 4 weeks, with these releases being supported for 6-8 weeks.</p>

<p>For this time period, most of Facebook’s Hack libraries and tools on GitHub will only target the latest release, not LTS versions; branches and fixes will be made as-needed, but these branches will be community supported, except for security issues reported via <a href="https://www.facebook.com/whitehat">Facebook’s Whitehat Program</a>.</p>

<h1 id="open-source-hack-in-2018">Open Source Hack in 2018</h1>

<p>The priorities of the Hack/HHVM open source team are to support our existing users, and to reduce the pain of the removal of PHP support. This will involve creating additional projects, and polishing several existing projects to reach a state suitable for v1.x.</p>

<p>Currently, plans include:</p>

<ul>
  <li><a href="https://github.com/hhvm/hh-apidoc">hh-apidoc</a>: improve ease of use, integrate with existing projects, improve readability and formatting of produced documents</li>
  <li><a href="https://github.com/hhvm/hacktest">hacktest</a>: improve ease of use, documentation, and use as a replacement for PHPUnit in all our existing projects</li>
  <li><a href="https://github.com/hhvm/hack-router">hack-router</a>, <a href="https://github.com/hhvm/hack-router-codegen">hack-router-codegen</a>: <a href="https://github.com/facebookexperimental/hack-http-request-response-interfaces/">remove the dependency on PSR-7</a>, revisit the API design for current best practices, improve documentation</li>
  <li>we are investigating migrating away from Composer and Packagist; it currently seems likely that this is going to be a set of best practices or extensions to <a href="https://yarnpkg.com/">Yarn</a>, using the NPM repository, with the goal of using a single package manager for both the JS and Hack parts of web-based projects.</li>
</ul>

<p>We hope to help the community build what is needed; please get in contact via <a href="https://www.facebook.com/groups/hhvm.general/">Facebook</a>, <a href="https://www.reddit.com/r/hacklang">Reddit</a>, <a href="https://twitter.com/hacklang/">Twitter</a>, or in #hhvm on irc.freenode.net.</p>

<p>In 2019, we expect this work to continue and expand in scope, and to provide more automated migrations to update code to deal with language changes.</p>


    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/08/30/hhvm-3.28.1.html">HHVM 3.28.1</a></h1>
    <p class="post-meta">发布于 2018 年 8 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.28.1 is released! This release fixes a segmentation fault when talking to
recent MySQL server implementations.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/506756518/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Kunal Mehta</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/08/28/hhvm-3.28.0.html">HHVM 3.28.0</a></h1>
    <p class="post-meta">发布于 2018 年 8 月 28 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.28 is released! This release contains new language features, bugfixes, performance improvements, and improvements to the debugger and editor/IDE support.</p>

<h1 id="new-features">New Features</h1>

<ul>
  <li><a href="#is-and-as-expressions"><code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> expressions</a> for type refinement, providing a consistent alternative to the <code class="highlighter-rouge">is_*()</code> functions and <code class="highlighter-rouge">instanceof</code></li>
  <li>autocomplete is now supported for shape keys</li>
  <li>type constants with generics now support constraints - for example, <code class="highlighter-rouge">const type TMyVec&lt;T as Foo&gt; = vec&lt;T&gt;</code></li>
  <li><strong>Experimental</strong>: <code class="highlighter-rouge">&lt;&lt;__MemoizeLSB&gt;&gt;</code> attribute: this is like <code class="highlighter-rouge">&lt;&lt;__Memoize&gt;&gt;</code>, but the cache has Late Static Binding: subclasses have their own memoize cache</li>
  <li><strong>Experimental</strong>: <code class="highlighter-rouge">&lt;&lt;__LateInit&gt;&gt;</code> attribute: this marks a property as being initialized via a non-standard mechanism, i.e. not via standard assignment in the constructor. Reading uninitialized <code class="highlighter-rouge">&lt;&lt;__LateInit&gt;&gt;</code> properties is a runtime error</li>
</ul>

<p>The experimental <code class="highlighter-rouge">&lt;&lt;__MemoizeLSB&gt;&gt;</code> and <code class="highlighter-rouge">&lt;&lt;__LateInit&gt;&gt;</code> attributes have not been tested as thoroughly as other features, and are more likely to have correctness or stability issues, or to require BC-breaking changes in the near future.</p>

<h1 id="backwards-incompatible-changes">Backwards-Incompatible changes</h1>

<p>Language-level restrictions here only apply to Hack code, not PHP.</p>

<ul>
  <li>removed the legacy <code class="highlighter-rouge">hh_file_parse</code>, <code class="highlighter-rouge">hh_format</code>, and <code class="highlighter-rouge">format_hack</code> tools; these are replaced by <code class="highlighter-rouge">hh_parse</code> and <code class="highlighter-rouge">hackfmt</code></li>
  <li>it is now an error to declare the visibility of parameters to methods other than constructors; for constructors, this promotes the parameters to members, however it was meaningless for other methods</li>
  <li>the collection hierarchy is now sealed, and can not be extended (<code class="highlighter-rouge">sealed_classes</code> option in 3.27)</li>
  <li><code class="highlighter-rouge">Traversable</code> and <code class="highlighter-rouge">KeyedTraversable</code> are now sealed, and do not allow direct user subclasses; you most likely want to extend <code class="highlighter-rouge">Iterator</code> or <code class="highlighter-rouge">KeyedIterator</code> instead</li>
  <li>the built-in ASIO classes (<code class="highlighter-rouge">RescheduleWaitHandle</code>, <code class="highlighter-rouge">SleepWaitHandle</code>, <code class="highlighter-rouge">StaticWaitHandle</code> etc) are now sealed.</li>
  <li><code class="highlighter-rouge">$$</code> and <code class="highlighter-rouge">$this</code> can no longer be passed by reference in Hack code</li>
  <li>direct method chaining after constructor calls (<code class="highlighter-rouge">new Foo()-&gt;bar()</code>) is a parse error again; support was unintentionally added in HackC, but not wanted as it is ambiguous: <code class="highlighter-rouge">(new Foo())-&gt;bar()</code> vs <code class="highlighter-rouge">new (Foo()-&gt;bar())</code> where <code class="highlighter-rouge">Foo()-&gt;bar()</code> could return a <code class="highlighter-rouge">classname&lt;T&gt;</code></li>
  <li>spaces and comments are not permitted between the <code class="highlighter-rouge">?</code> and <code class="highlighter-rouge">:</code> in the <code class="highlighter-rouge">?:</code> operator (<code class="highlighter-rouge">disallow_elvis_space</code> in 3.27)</li>
  <li><code class="highlighter-rouge">Set</code> is now a <code class="highlighter-rouge">KeyedIterator&lt;arraykey, Tv&gt;</code> instead of <code class="highlighter-rouge">KeyedIterator&lt;mixed, Tv&gt;</code></li>
  <li><code class="highlighter-rouge">dict</code> keys are now constrained to <code class="highlighter-rouge">arraykey</code> - this was previously a runtime requirement, but not reported by the typechecker</li>
  <li>checking the truthiness of <code class="highlighter-rouge">?enum</code>, <code class="highlighter-rouge">?bool</code>, <code class="highlighter-rouge">?array</code>, <code class="highlighter-rouge">?vec</code>, <code class="highlighter-rouge">?dict</code>, <code class="highlighter-rouge">?keyset</code>, <code class="highlighter-rouge">?Map</code>, <code class="highlighter-rouge">?Set</code>, <code class="highlighter-rouge">?Vector</code>, and the immutable/const variants of these, is now a ‘sketchy null check’ error</li>
  <li>subclasses that override properties with types must also specify types (<code class="highlighter-rouge">decl_override_require_hint</code> in 3.27)</li>
  <li>use clauses are not allowed to shadow global variables</li>
  <li>non-abstract constants are required to have a value</li>
  <li>the <code class="highlighter-rouge">abstract</code> keyword is not permitted in interface declarations</li>
</ul>

<h1 id="other-changes">Other Changes</h1>

<ul>
  <li>the legacy frontend is no longer usable; HackC is the only available frontend for runtime/bytecode generation, and for FactsParse</li>
  <li>the typechecker is now using the full fidelity parser - the same parser as HackC and <code class="highlighter-rouge">hackfmt</code></li>
  <li>method search in editors/IDEs is now a substring search instead of a prefix search</li>
  <li>the debugger REPL now interprets code as Hack, not PHP, even if <code class="highlighter-rouge">force_hh</code> is not set</li>
</ul>

<h1 id="future-changes">Future Changes</h1>

<p>These changes are currently opt-in - we expect them to be mandatory in 3.29.</p>

<ul>
  <li><code class="highlighter-rouge">assume_php=false</code> : raise errors for using types/functions in partial-mode files that aren’t declared in Hack or HHI files. This was previously announced, but not actually enforced</li>
  <li><code class="highlighter-rouge">disallow_return_by_ref=true</code> : ban returning by reference</li>
  <li><code class="highlighter-rouge">disallow_array_cell_pass_by_ref=true</code> :bans <code class="highlighter-rouge">&amp;$foo[0]</code></li>
</ul>

<p>Separately, we expect to remove support for the previous approaches to type-refinement in a future version; we do not yet have a specific target version.</p>

<h1 id="is-and-as-expressions"><code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> Expressions</h1>

<h2 id="cheat-sheet">Cheat Sheet</h2>

<table>
  <thead>
    <tr>
      <th>Old</th>
      <th>New</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">is_int($x)</code></td>
      <td><code class="highlighter-rouge">$x is int</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">$x instanceof MyClass</code></td>
      <td><code class="highlighter-rouge">$x is MyClass</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">MyEnum::isValid($x)</code></td>
      <td><code class="highlighter-rouge">$x is MyEnum</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">is_int($x) || is_string($x)</code></td>
      <td><code class="highlighter-rouge">$x is arraykey</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">$x === null || is_int($x)</code></td>
      <td><code class="highlighter-rouge">$x is ?int</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">$x !== null</code></td>
      <td><code class="highlighter-rouge">$x is nonnull</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">is_vec($x)</code></td>
      <td><code class="highlighter-rouge">$x is vec&lt;_&gt;;</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">is_dict($x)</code></td>
      <td><code class="highlighter-rouge">$x is dict&lt;_, _&gt;;</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">TypeAssert\matches_type_structure(type_structure(static::class, "TFoo"), $x)</code></td>
      <td><code class="highlighter-rouge">$x as this::TFoo</code></td>
    </tr>
  </tbody>
</table>

<h2 id="introduction">Introduction</h2>

<h3 id="type-testing">Type Testing</h3>

<p>Hack previously had a collection of inconsistent APIs for type testing. For example, you currently use <code class="highlighter-rouge">instanceof</code> for classes/interfaces, the <code class="highlighter-rouge">is_int()</code> et al. functions for primitives, and the isValid static method for enums. Furthermore, it can be unclear which language constructs refine the type of a variable from the typechecker’s perspective—we often receive questions in Hacklang Support about why a particular expression didn’t refine the type of a variable. The goal of the is operator is to make type testing:</p>
<ul>
  <li><strong>Consistent</strong> - testing for all types in the type system should be done the same way.</li>
  <li><strong>Predictable</strong> - only one language construct should be able to refine the types of values.</li>
  <li><strong>Ergonomic</strong> - testing for complex types should be just as easy as testing for simple types.</li>
</ul>

<p>At runtime, the <code class="highlighter-rouge">is</code> operator determines whether a value is of a certain type and evaluates to a boolean. Statically, it refines the type of a variable when used in an if statement, invariant, or ternary expression. If the type does not exist, the expression will evaluate to false (although that will be a typechecker error).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$x is T;
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="type-assertion">Type Assertion</h3>

<p>Similarly, type assertion in Hack is suboptimal. The goal of the <code class="highlighter-rouge">as</code> operator is to make type assertion consistent, predictable, and ergonomic, as well as more performant.</p>

<p>At runtime, the <code class="highlighter-rouge">as</code> operator evaluates to the left operand if its type matches, otherwise it throws <code class="highlighter-rouge">TypeAssertionException</code>. Statically, it unconditionally refines the type of the left operand. The <code class="highlighter-rouge">as</code> operator also comes in a non-throwing variant <code class="highlighter-rouge">?as</code>, which evaluates to <code class="highlighter-rouge">null</code> if the type doesn’t match.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$x as T;
$x ?as T;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The <code class="highlighter-rouge">as</code> operator has notable benefits over the userland assertion libraries, both statically and at runtime. For example, the operator is able to refine the type of variables in the typechecker, unlike TypeAssert and others. Not only does this allow you to write better, more natural code, but it also enables HHVM to better optimize during compilation, which makes it faster than the userland implementations!</p>

<h2 id="supported-types">Supported Types</h2>

<p>Aside from the typehints discussed in the “Limitations” section below, the <code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> operators can be used with any type in the Hack language!</p>

<p>For primitives and primitive unions, the operators work as you’d expect.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>1 is int; // true
1 as int; // 1

'foo' is int; // false
'foo' as int; // TypeAssertionException

1 is num; // true
1 as num; // 1

1.5 is num; // true
1.5 as num; // 1.5

'foo' is num; // false
'foo' as num; // TypeAssertionException
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For enums, the operators will validate that the value is in the given enum. <strong>CAUTION: the operators will perform integral key coercion to preserve compatibility with <code class="highlighter-rouge">BuiltinEnum::isValid</code></strong>. We will fix this separately in the future.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>enum MyEnum: int {
  FOO = 1;
}

1 is MyEnum; // true
1 as MyEnum; // 1

42 is MyEnum; // false
42 as MyEnum; // TypeAssertionException

'foo' is MyEnum; // false
'foo' as MyEnum; // TypeAssertionException

'1' is MyEnum; // CAUTION - true
'1' as MyEnum; // CAUTION - '1'
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For generic types, you must use the <code class="highlighter-rouge">_</code> (wildcard) placeholder for the type parameters. This is discussed in more detail in the <a href="#generics">“Generics” subsection</a> of the “Limitations” section below.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>interface MyInterface&lt;T&gt; {}

$x is MyInterface&lt;_&gt;;
$x as dict&lt;_, _&gt;;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For structural types (i.e. tuples and shapes), the operators will validate the size and recursively validate every field in the value. <strong>This means you should be mindful of using them with enormous structural types</strong>*.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>$x is (int, ?string, bool); // OK
$x as shape(
  'foo' =&gt; int,
  ?'bar' =&gt; (int, ?string, MyEnum),
  ...
); // OK
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For type aliases and type constants, the operators will test the value against the underlying runtime type.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>type Foo = (int, ?string, bool);

tuple(1, null, false) is Foo; // true
varray[1, null, false] is Foo; // true
dict[0 =&gt; 1, 1 =&gt; null, 2 =&gt; false] is Foo; // false

abstract class C {
  const type T as num = int;

  public function isT(mixed $x): void {
    $x is this::T; // OK
  }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="the-nonnull-type">The <code class="highlighter-rouge">nonnull</code> Type</h3>

<p>Hack refines the <code class="highlighter-rouge">nonnull</code> type specially - if the input variable of <code class="highlighter-rouge">is nonnull</code> or <code class="highlighter-rouge">as nonnull</code> is known to be of type <code class="highlighter-rouge">?T</code>, it is refined to <code class="highlighter-rouge">T</code>, instead of simply to <code class="highlighter-rouge">nonnull</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>function foo(?string $x): void {
  $y = $x as nonnull; // $y has type `string`
}
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="limitations">Limitations</h2>

<p>Types that cannot be properly tested at runtime are not supported. <strong>*Use of the <code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> operators with an unsupported type will raise an unfixmeable typechecker error and will potentially raise a fatal runtime error.</strong></p>

<h3 id="generics">Generics</h3>

<p>The use of generics with the <code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> operators is unsupported, because generics are erased at runtime.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>final class Foo&lt;Tu&gt; {
  public function bar&lt;Tv&gt;(mixed $x) {
    if ($x is Tu) {...} // UNSUPPORTED
    $x as Tv; // UNSUPPORTED
  }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Similarly, using the <code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> operators on generic classes and type aliases is unsupported.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>final class Bar&lt;T&gt; {}
type Baz = Bar&lt;int&gt;;

if ($x is Bar&lt;int&gt;) {...} // UNSUPPORTED
if ($x is Baz) {...} // UNSUPPORTED

$x as Bar&lt;int&gt;; // UNSUPPORTED
$x as Baz; // UNSUPPORTED
</pre></td></tr></tbody></table></code></pre></div></div>

<p>However, you can use the wildcard typehint in place of generics, and the typechecker will infer the type to the best of its ability. For now, the wildcard can only be used in <code class="highlighter-rouge">is</code> and <code class="highlighter-rouge">as</code> expressions. In the following example, we know that <code class="highlighter-rouge">vec&lt;T&gt;</code> is a <code class="highlighter-rouge">Container&lt;T&gt;</code>, so this code is valid:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>function f(Container&lt;int&gt; $x): void {
  if ($x is vec&lt;_&gt;) {
    expect_vec_of_int($x); // OK
  }
  expect_vec_of_int($x as vec&lt;_&gt;); // OK
}

function expect_vec_of_int(vec&lt;int&gt; $y): void {}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In this example, we know that the type parameter of <code class="highlighter-rouge">keyset</code>s must be <code class="highlighter-rouge">arraykey</code>s, so this code is valid:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>function f(mixed $x): void {
  if ($x is keyset&lt;_&gt;) {
    expect_keyset_of_arraykey($x); // OK
  }
  expect_keyset_of_arraykey($x as keyset&lt;_&gt;); // OK
}

function expect_keyset_of_arraykey(keyset&lt;arraykey&gt; $y): void {}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You may be asking, “The wildcard is ugly! Why do we have to use it when we don’t have to use it for <code class="highlighter-rouge">instanceof</code>?” In strict mode, we require all typehints to have their type parameters specified. If type parameters are not specified, the typechecker assumes that they are the “any” type, an extremely permissive type that provides very poor typechecking. The instanceof operator is an exception to this rule—instead of the “any” type, we assume that each type parameter is some type for which we have no information, which allows us to infer its constraints. The wildcard makes this behavior explicit in syntax and allows us to consistently require that typehints have type parameters.</p>

<h3 id="functions">Functions</h3>

<p>Because we cannot verify the input/output types of a function at runtime, they are unsupported.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>if ($x is (function(string): int)) {...} // UNSUPPORTED
$x as (function(string): int); // UNSUPPORTED
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="php-arrays">PHP Arrays</h3>

<p>PHP arrays and the aliases are unsupported:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>$x is array&lt;_&gt;; // UNSUPPORTED
$x is varray&lt;_&gt;; // UNSUPPORTED
$x as darray&lt;_, _&gt;; // UNSUPPORTED
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="opaque-type-aliases">Opaque Type Aliases</h3>

<p>Because opaque type aliases would require additional validation in Hack code, they are unsupported. For example, in the following code, we only know that IDs are ints at runtime—how would we know that the operand is a valid ID?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>newtype ID as int = int;

if ($x is ID) {...} // UNSUPPORTED
$x as ID; // UNSUPPORTED
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="complex-expressions">Complex Expressions</h3>

<p>Similarly to <code class="highlighter-rouge">instanceof</code>, we don’t support complex expressions when refining types. For example, we’d expect that the following example would refine the type of <code class="highlighter-rouge">$x to Foo | Bar</code>, but it currently does not refine the type at all.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>function f(mixed $x): void {
  if ($x is Foo || $x is Bar) {
    // $x is of type mixed
  }
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In the future, once we converge on only one operator that performs type testing, we can begin to invest in supporting more complex expressions and more intelligently refine types of local variables.</p>


    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/08/15/hhvm-3.27.2.html">HHVM 3.27.2</a></h1>
    <p class="post-meta">发布于 2018 年 8 月 15 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.27.2 is released! This release contains several bugfixes:</p>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/05f97eb0388d84ba2e0685c2715582c3a41dd3d1">Fix various crashes on MacOS due to differing assembler conventions</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/4089ed8b5042b2b1781b833653472b48acc6f07f">Fix deadlock when calling <code class="highlighter-rouge">HH\facts_parse</code> in multiple simultaneous requests</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/bbba234980bc183ddb3c6300c04fff8a18ae6915">Fix conditional breakpoints in debugger</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/a8fd6b8d1c47d24f8cbbfe887642c45688c418d3">Fix hang in debugger shutdown</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/62a30953b2ffba94f0aeb21a3ee30a71d17e2527">Fix IDE symbol search for namespaced symbols that start with a lowercase letter</a>; this usually means namespaced functions.</li>
  <li><a href="https://github.com/facebook/hhvm/commit/67aa074dc9d7cc40342d55f3df2195cb97cdc7f8">Fix <code class="highlighter-rouge">hh_client</code> crash on shutdown in some situations</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/9ee09d4e654852135a0595285f44fca66841b5dd">Fix crash when an unsupported experimental feature was enabled</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/07/19/hhvm-3.27.1.html">HHVM 3.27.1 and 3.24.8</a></h1>
    <p class="post-meta">发布于 2018 年 7 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.27.1 and 3.24.8 are released! The releases contain several bugfixes:</p>

<h1 id="3271">3.27.1</h1>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/9db89dc930f3d0d0b1f765535032a05eb8846312">Fix stability issues when async if HHVM is linked against libevent2</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/17fd9d0f9bc07e5d1af9046c3e53e3826acb9de2">Fix overly-strict parameter type variance for implementations of abstract methods</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/15109e45914442fcd28d57b0061724d6f1f2c3c6">Fix as-you-type formatting when using recent versions of Nuclide</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/ced95a0aa74d2978f9f24d34f3eb098a393bf561">Fix formatting of comments that include tabs</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/572d75b337e9c9b2c75b5de72689826110f573a3">Support debugging xbox requests</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/e539f3254db8bd2da0f27bb25593208b91b5e5f4">Regression: Support <code class="highlighter-rouge">"{$$foo}"</code> in PHP files</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/1ec607a55ef78e3d0b898e793370f73c035c2228">Regression: Support closures in anonymous classes</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/101d32457e8bcf12a761fe2e0331aa57d071edc5">Regression: Fix typechecker hangs/crashes if there are many <code class="highlighter-rouge">if (Shape::keyExists())</code> refinements</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/16a87033933457bdc77b8249dbaa9b30b4f9e098">Regression: Remove special meanings of some Hack keywords when file is PHP</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/65b0276a7feb8e2cf208ac33c4e4c01387402062">Autocomplete: Remove ‘namespace fallback’ behavior for functions, which is no longer part of Hack</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/ff979c963a8cf6c507233cae176b279a05f74380">Autocomplete: Don’t trigger autocomplete after colons in case statements in namespaces</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/7726f1da0aa37796dc35be45f98d20e8e5d1193f">Autocomplete: Don’t trigger autocomplete after user attributes</a></li>
</ul>

<h2 id="3248">3.24.8</h2>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/46e5dff56d0d9c0dd296b9f36615e1756bc07c07">Fix stability issues when using async if HHVM is linked against libevent2</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/2e1ded3341a9298de688bdc9a9f73065373523f9">Fix overly-strict parameter type variance for implementations of abstract methods</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/06/18/hhvm-3.27.0.html">HHVM 3.27.0</a></h1>
    <p class="post-meta">发布于 2018 年 6 月 18 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.27 is released! This version has long-term support, and contains performance, IDE, typechecker, and other improvements:</p>

<ul>
  <li>HackC is now the only supported frontend; the legacy parser is still included, but it is unsupported, and we expect it to be removed in 3.28</li>
  <li><code class="highlighter-rouge">Shapes::removeKey()</code> now takes the shape as an <code class="highlighter-rouge">inout</code> parameter instead of by reference</li>
  <li><code class="highlighter-rouge">await</code> and <code class="highlighter-rouge">yield</code> are now permitted in <code class="highlighter-rouge">finally</code> blocks</li>
  <li>key types for Generators are now covariant instead of invariant</li>
  <li>removed XDebug support. The VSCode Debug Protocol should be used instead</li>
  <li>removed the ODBC extension</li>
  <li>added <code class="highlighter-rouge">forward_compatibility_level</code> option to <code class="highlighter-rouge">.hhconfig</code> to make managing upgrades easier.</li>
  <li>improved PHP support in HackC</li>
  <li>support sealed interfaces and classes, and seal the collection hierarchy when when <code class="highlighter-rouge">enable_experimental_tc_features</code> in <code class="highlighter-rouge">.hhconfig</code> contains <code class="highlighter-rouge">sealed_clases</code>. This bans extending the built-in Container and KeyedContainer classes, and we expect this to be required in 3.28</li>
  <li>disallow comparisons between incompatible types in Hack code when <code class="highlighter-rouge">disallow_unsafe_comparisons=true</code> is set in <code class="highlighter-rouge">.hhconfig</code>. We expect this to be required in 3.28</li>
  <li>enforce that container keys are <code class="highlighter-rouge">arraykeys</code> in Hack code when <code class="highlighter-rouge">disallow_non_arraykey_keys=true</code> is set in <code class="highlighter-rouge">.hhconfig</code>. We expect this to be required in 3.28, and was already a runtime error if non-array keys were actually used.</li>
  <li>require that subclasses in partial files specify the types of properties that override parent classes properties with types when <code class="highlighter-rouge">decl_override_require_hint=true</code> is set in <code class="highlighter-rouge">.hhconfig</code></li>
  <li>ban always-true and always-false <code class="highlighter-rouge">Shapes::keyExists()</code> checks when <code class="highlighter-rouge">enable_experimental_tc_features</code> in <code class="highlighter-rouge">.hhconfig</code> contains <code class="highlighter-rouge">shape_field_check</code>.</li>
  <li><code class="highlighter-rouge">Shapes::keyExist()</code> now refines the type when used as a condition</li>
  <li>improved detection of sketchy null checks (for example, <code class="highlighter-rouge">$nullable_string ? $foo : $bar</code> is now detected), and always-false identity checks (e.g. <code class="highlighter-rouge">$not_nullable === null</code> or <code class="highlighter-rouge">$int === $string</code>).</li>
  <li>add <code class="highlighter-rouge">varray&lt;T&gt;</code> and <code class="highlighter-rouge">darray&lt;Tk, Tv&gt;</code> types; these should be considered aliases for <code class="highlighter-rouge">array&lt;T&gt;</code> and <code class="highlighter-rouge">array&lt;Tk, Tv&gt;</code>, and are used as an implementation detail of some internals. Hack code should continue to use the <code class="highlighter-rouge">vec&lt;T&gt;</code>, <code class="highlighter-rouge">keyset&lt;T&gt;</code>, and <code class="highlighter-rouge">dict&lt;Tk, Tv&gt;</code> types instead.</li>
  <li>the new LSP standard <code class="highlighter-rouge">relatedInformation</code> field is now used for Hack errors, providing more detailed diagnostic information in editors such as Visual Studio Code</li>
  <li>support renaming symbols in LSP editors via <code class="highlighter-rouge">textDocument/rename</code></li>
  <li>support symbol lists in LSP editors via <code class="highlighter-rouge">textDocument/documentSymbol</code></li>
  <li>fixed several edge cases for PHP7 <code class="highlighter-rouge">strict_types</code> leading to crashes or unexpected TypeErrors</li>
  <li>add <code class="highlighter-rouge">untrusted_mode</code> option to <code class="highlighter-rouge">.hhconfig</code>. When <code class="highlighter-rouge">true</code>, it is intended to be safe to run <code class="highlighter-rouge">hh_client</code> or <code class="highlighter-rouge">hh_server --check $(pwd)</code> on potentially malicious code: <code class="highlighter-rouge">hh_server</code> will fail early if dangerous options are also set. If you find issues with this feature, or any other security issue in HHVM or Hack, please report them via <a href="https://www.facebook.com/whitehat">Facebook’s Whitehat (Bug Bounty) Program</a>.</li>
</ul>

<h2 id="lifecycle-and-release-schedule">Lifecycle and Release Schedule</h2>

<p>We have released 3.27 <a href="https://docs.hhvm.com/hhvm/installation/release-schedule">two weeks ahead of schedule</a> - we expect future releases to follow the original schedule. To reduce issues:</p>

<ul>
  <li>3.27’s end of support is not changing: it will end support when 3.33 is released (expected 2019-09-05). This means that it is supported for approximately 50 weeks instead of the usual 48</li>
  <li>3.26 will remain supported until the original expected release date of 3.27 in two weeks (2018-07-02)</li>
  <li>3.28 is still expected on 2018-08-27 - in ~ 10 weeks.</li>
</ul>

<h2 id="sealed-classes-and-interfaces">Sealed Classes and Interfaces</h2>

<p>This feature is currently opt-in, though we expect it to be mandatory in 3.28.</p>

<p>Sealed classes/interfaces are only able to be directly extended/implemented by a whitelist of classes and/or interfaces - though, those subclasses can be extended arbitrarily unless they are final or also sealed. In this way, sealing provides a single-level restraint on inheritance.</p>

<p>Classes/interfaces are sealed by providing a whitelist of <code class="highlighter-rouge">classname</code>s to the <code class="highlighter-rouge">__Sealed</code> attribute:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>&lt;&lt;__Sealed(Some::class, None::class)&gt;&gt;
abstract class Option&lt;T&gt; {
  abstract function get(): T;
}

final class Some&lt;T&gt; extends Option&lt;T&gt; {
  public function __construct(
    private T $value,
  ) {}
  public function get(): T {
    return $this-&gt;value;
  }
}

final class None&lt;T&gt; extends Option&lt;T&gt; {
  public function get(): T {
    invariant_violation('none');
  }
}

// ERROR
final class Few&lt;T&gt; extends Option&lt;T&gt; {}
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="how-do-i-use-the-__sealed-attribute">How do I use the <code class="highlighter-rouge">__Sealed</code> attribute?</h3>

<p>Attach it to a class/interface and specify classnames that may extend/implement it. These must be of the form <code class="highlighter-rouge">Foo::class</code>.</p>

<h3 id="what-is-the-typecheckerruntime-behavior">What is the typechecker/runtime behavior?</h3>

<p>Extending/implementing a sealed class/interface with a class/interface not in the whitelist will raise both a typechecker and runtime error.</p>

<p>There is no runtime enforcement for sealing of the collection interfaces in 3.27, in order to keep sealed classes opt-in in this release. We expect runtime enforcement for these collection interfaces in 3.28.</p>

<h3 id="what-can-i-seal">What can I seal?</h3>

<p>Only classes and interfaces may be sealed — traits and enums may not. Further, traits may presently not implement sealed interfaces. We expect full support for traits in the future, both for sealing them and for implementing/using sealed interfaces/traits.</p>

<h3 id="can-i-seal-final-classes">Can I seal final classes?</h3>

<p>Sealing a final class will raise a typechecker error and parse error at runtime, as that would be redundant.</p>

<h3 id="can-i-extend-non-final-classes-that-extend-a-sealed-class-or-implement-a-sealed-interface">Can I extend non-final classes that extend a sealed class (or implement a sealed interface)?</h3>

<p>Yes. Sealing only applies to direct extension.</p>

<h3 id="when-should-i-use-this-feature">When should I use this feature?</h3>

<p>Sparingly, if ever—your classes should be final whenever possible! Potential use cases for this feature include preventing new instances of a deprecated class from being added, or for simulating ADTs as demonstrated above.</p>

<h3 id="why-was-this-feature-added">Why was this feature added?</h3>

<p>The collection interfaces were only intended for internal implementations, and it has been unsafe to create custom implementations of the collection interfaces since they were introduced; however, users have implemented them, leading to unexpected and undefined behavior.</p>

<h2 id="forward_compatibility_level">forward_compatibility_level</h2>

<p>This option exists to make it easier to upgrade to new versions of HHVM and Hack, however it is only a temporary migration aid - it does not allow permanently opting out of changes, and decreases the safety of your code.</p>

<p><code class="highlighter-rouge">forward_compatibility_level</code> can be set to a valid release number (such as <code class="highlighter-rouge">3.27</code>), a date as an integer (e.g. <code class="highlighter-rouge">20180618</code>), or omitted. Dates are intended to be used for incrementally supporting features as they’re added to nightly builds. For each release, the branch cut date is equivalent; for example, “<code class="highlighter-rouge">forward_compatibility_level=3.27</code>” is equivalent to “<code class="highlighter-rouge">forward_compatibility_level=20180604</code>”.</p>

<h3 id="behavior">Behavior</h3>

<p>This option <em>suppresses</em> errors - it does not restore old behavior, and <strong>may raise fewer errors</strong>. This means that:</p>

<ul>
  <li>code that typechecks on 3.26 should typecheck on 3.27 if <code class="highlighter-rouge">forward_compatibility_level=3.26</code></li>
  <li>code that typechecks on 3.27 with <code class="highlighter-rouge">forward_compatibility_level=3.26</code> <strong>might be invalid</strong> under 3.26</li>
</ul>

<h3 id="lifecycle">Lifecycle</h3>

<p>If set to the current release or newer, there is no change in behavior.</p>

<p>If set to older than the current release, a warning will be reported, but the exit status of hh_client and hh_server will be 0. Some other Hack errors might not be raised that would be without this warning. For example, hh_client in 3.27 reports a warning if set to 3.26.</p>

<p>If set to older than the previous release, an error will be reported, and hh_client and hh_server will exit with non-zero status, like any other error. For example, hh_client in 3.28 will report an error if set to 3.26.</p>

<h3 id="intended-use">Intended Use</h3>

<p>This option is intended for short-term use, to allow resolving issues when new releases raise errors with circular dependencies, or when doing a staged roll-out of a new version. The option should be removed as soon as possible.</p>

<p>Additionally, it can be used to detect unintentional backwards-incompatible changes in Hack, especially when testing against nightly builds.</p>

<h2 id="summary-of-opt-in-features">Summary of Opt-In Features</h2>

<p>The following <code class="highlighter-rouge">.hhconfig</code> features are opt-in, and we expect them to be required behavior in 3.28:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>disallow_elvis_space=true
disallow_non_arraykey_keys=true
disallow_unsafe_comparisons=true
decl_override_require_hint=true
enable_experimental_tc_features=shape_field_check,sealed_classes
</pre></td></tr></tbody></table></code></pre></div></div>


    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/05/24/hhvm-3.26.3.html">HHVM 3.26.3</a></h1>
    <p class="post-meta">发布于 2018 年 5 月 24 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.26.3 is released! This release contains several bugfixes, and improvements to IDE support:</p>
<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/e2d10a1e32d01f71aaadd81169bcb9ae86c5d6b8">CVE-2018-6337: clear <code class="highlighter-rouge">folly::secureRandom</code> (<code class="highlighter-rouge">random_bytes()</code> and <code class="highlighter-rouge">random_int()</code>) buffer on fork</a>. This does not affect 3.25 or below.</li>
  <li><a href="https://github.com/facebook/hhvm/commit/1ef6d97af2cb12c83dedb9aa0aaf21bd53770f9d">HackC: narrower parsing of bracketed expressions as casts</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/dd720bec27cdc90ba56c3f6b3fc6f3af7a38efa7">HackC: fix PHP classes with the same name as special Hack classes</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/45e90b056b9337cf64d5bc6af8a9e9023a0214e6">LSP: use <code class="highlighter-rouge">hackfmt</code> instead of <code class="highlighter-rouge">hh_format</code> for IDE code formatting features</a> (<code class="highlighter-rouge">hh_format</code> fails on most modern Hack code)</li>
  <li><a href="https://github.com/facebook/hhvm/commit/a7cdefc35ed43cd40640ae91eed89b33e8c8542a">LSP: respect IDE-provided indent width and tabs-or-spaces preferences when formatting code</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/2760d8639821b2c3105b2a0a3af7a437bed5f83b">LSP: fix support for as-you-type formatting in VSCode</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/a4da482a6084d68fa9020a83b2e1f034733bc04e">LSP: <code class="highlighter-rouge">use</code> statements in classes autocomplete should only suggest traits</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/2760d8639821b2c3105b2a0a3af7a437bed5f83b">Improve detection, handling, and errors for magic functions where <code class="highlighter-rouge">yield</code> and <code class="highlighter-rouge">await</code> are unsupported</a>; this improves handling of <code class="highlighter-rouge">IDisposable</code>, <code class="highlighter-rouge">IAsyncDisposable</code>, <code class="highlighter-rouge">__callStatic</code>, and increases PHP compatibility.</li>
  <li><a href="https://github.com/facebook/hhvm/commit/1574fa14e907399c9d3085686533c3eb7109dcfc">Add an <code class="highlighter-rouge">extra_paths=</code> option to <code class="highlighter-rouge">.hhconfig</code> to include dependencies outside of the project root</a>. This is experimental, and may be removed at any time.</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/05/15/hhvm-3.26.2.html">HHVM 3.26.2</a></h1>
    <p class="post-meta">发布于 2018 年 5 月 15 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.26.2 is released! This release contains several bugfixes and improvements:</p>
<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/07761fc44f12deea14898cb4afcece371e02c6d6">HackC: support files/directories containing backslashes</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/cc441f67d0cacad31a28318671979ae484a39613">HackC: fix support for type constants in shape definitions when using namespaces</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/cdc91d7ea11d8360591db1b73708967dcce3d3dd">HackC: fix support for PHP files using Hack reserved words as class names</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/7874525f86ad1621d5f8e5a5f23d318b861ebc46">LSP: add support for <code class="highlighter-rouge">textDocument/signatureHelp</code></a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/05/11/hhvm-3.26.1.html">HHVM 3.26.1</a></h1>
    <p class="post-meta">发布于 2018 年 5 月 11 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.26.1 is released! This release contains several bugfixes, primarily improving support for PHP code when using HackC:</p>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/f58f112975fc4ce8401d737ff8b57cde248e8e1f"><code class="highlighter-rouge">ext_factparse</code>: return empty lists instead of null for empty files</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/f6396127d2037883f8717b884fecff738ec4725b">HackC: fix <code class="highlighter-rouge">is_array()</code> and similar checks for superglobals</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/950b326f6dbe036a89ab7c227c3f2ecc2689af81">HackC: fix <code class="highlighter-rouge">isset()</code> for superglobals</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/94e18795f021193431ef3c687868a3dd245440a5">HackC: fix <code class="highlighter-rouge">if</code> statements with empty bodies when using the <code class="highlighter-rouge">if(0): endif;</code> syntax</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/ca147be12943b2ea4ad5715fe0a367552d346ffb">HackC: fix support for nested array elements as <code class="highlighter-rouge">inout</code> parameters</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/3336daa921e45d43ef4a2254b85f87b97883ab65">HackC: fix support for unicode identifiers (e.g. property names)</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/6272f6655338dabcec0dcc17e57490325c5df058">HackC: fix support for class/enum constants as shape keys in namespaces</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/27854f21176054bf83b437c5f295b804326d2b82">HackC: fix case-insensitivity of PHP keywords</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/05/07/hhvm-3.26.html">HHVM 3.26 - Introducing HackC</a></h1>
    <p class="post-meta">发布于 2018 年 5 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.26 is released! Highlights include a new frontend, relicensing of the typechecker and related tools and libraries to MIT, and support for Ubuntu 18.04. Packages have been published in the usual places.</p>

<h2 id="hackc-the-hack-compiler">HackC: The Hack Compiler</h2>

<p>The Hack &amp; HHVM team is excited to announce that HackC — the new front-end for HHVM — is now on by default in this release, after about a year of work by many. This includes a full-fidelity parser (FFP) and bytecode emitter for the Hack and PHP languages. The FFP already powered several tools, such as Hack’s IDE integration via the Language Server Protocol, <code class="highlighter-rouge">hackfmt</code>, and <code class="highlighter-rouge">hhast</code>; in addition to the runtime, we expect the typechecker (<code class="highlighter-rouge">hh_client</code> and <code class="highlighter-rouge">hh_server</code>) to use the FFP in the future, leading to a single unified parser for typechecking, execution, IDE services, and other tools.</p>

<p>HackC passes all of HHVM’s tests - including the PHP specification tests - and <a href="https://github.com/facebook/hhvm/blob/master/hphp/hack/doc/semdiff-description.txt">produces semantically equivalent bytecode</a>. That said, if you encounter problems:</p>

<ul>
  <li>you can <em>temporarily</em> revert to the legacy frontend with the <code class="highlighter-rouge">hhvm.hack_compiler_default=false</code> INI setting</li>
  <li>please <a href="https://github.com/facebook/hhvm/issues/">file a GitHub issue</a> including minimal example code to reproduce the problem; this is extremely important as <strong>we plan to remove the legacy frontend in 3.27</strong></li>
</ul>

<p>You can verify which frontend is being used by inspecting the <code class="highlighter-rouge">__COMPILER_FRONTEND__</code> magic constant.</p>

<h2 id="hack-relicensing">Hack Relicensing</h2>

<p><a href="https://hhvm.com/blog/2018/04/11/relicensing-hack.html">As previously announced</a>, Hack is now available under the MIT license. 3.26 is the first stable release to include Hack under these terms.</p>

<h2 id="other-highlights">Other Highlights</h2>

<ul>
  <li>added the <code class="highlighter-rouge">nonnull</code> type, allowing more thorough and consistent typing - e.g.
  <code class="highlighter-rouge">function nullthrows&lt;T as nonnull&gt;(?T $in): T</code></li>
  <li>added the <code class="highlighter-rouge">dynamic</code> type to allow safer dynamic code, as an alternative to untyped or <code class="highlighter-rouge">mixed</code></li>
  <li>improved handling of STDOUT with a Debug Adapter Protocol debugger attached</li>
  <li><code class="highlighter-rouge">hh_parse</code> now can produce dot (Graphviz) representations of the AST - e.g. <code class="highlighter-rouge">hh_parse --full-fidelity-dot test.hh | dot -Tpng ast.png; open ast.png</code></li>
  <li>legacy IDE support (<code class="highlighter-rouge">hh_client ide</code>) has been removed; the VSCode Language Server Protocol (<code class="highlighter-rouge">hh_client lsp</code>) should be used instead</li>
  <li>many improvements to LSP-based IDE features, such as autocomplete and function hover information</li>
  <li>several Hack changes that were opt-in <a href="https://hhvm.com/blog/2018/03/15/hhvm-3.25.html">in HHVM 3.25</a> are no longer optional. PHP code is unaffected. These changes include:
    <ul>
      <li>namespace fallback is no longer supported for functions or constants (e.g. ‘<code class="highlighter-rouge">FOO</code>’ is always equivalent to ‘<code class="highlighter-rouge">namespace\FOO</code>’)</li>
      <li>array unpacking will raise errors if there are potentially unmet requirements for the number of unpacked values</li>
      <li>destructors are no longer supported. Use <code class="highlighter-rouge">using</code> blocks and <code class="highlighter-rouge">Disposable</code>s instead.</li>
      <li>arrays can no longer include references. This also means it’s not possible to make references to array elements, or pass by array elements by reference.</li>
      <li>untyped lambdas can not be passed as non-function types (e.g. to functions that accept <code class="highlighter-rouge">mixed</code>)</li>
    </ul>
  </li>
  <li>opt-in: ban whitespace and comments in the ‘elvis’ (<code class="highlighter-rouge">?:</code>) operator - e.g. <code class="highlighter-rouge">$foo = bar() ? /* hello, world */ : baz();</code>. To ban this syntax, set <code class="highlighter-rouge">disallow_elvis_space=true</code> in your <code class="highlighter-rouge">.hhconfig</code>. We expect this to be required in 3.27.</li>
</ul>

<h2 id="the-dynamic-type">The dynamic Type</h2>

<p><code class="highlighter-rouge">dynamic</code> is a new type we’ve added to Hack’s type system. The dynamic type is a special type in Hack used to help capture dynamism in our codebase in typed code, in a more manageable manner than <code class="highlighter-rouge">mixed</code>. With the <code class="highlighter-rouge">dynamic</code> type, the presence of dynamism in a function is <em>local to the function,</em> and dynamic behaviors cannot leak into code that doesn’t know about it.</p>

<p>For example, this untyped code will not raise type errors, as the typechecker assumes any use of untyped variables (<code class="highlighter-rouge">$x</code>) is valid:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>function takesInt(int $x) : int {
  //...
}

function f($x) {
  $id = $x-&gt;getInt();
  $y = takesInt($id);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>With <code class="highlighter-rouge">dynamic</code>, the local usage is allowed, but dynamism must be removed at the function boundaries:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>function takesInt(int $x) : int {
  //...
}

function f(dynamic $x) : void {
  // Calling a method on a dynamic type is allowed,
  //  and will result in another dynamic 
  $id = $x-&gt;getInt(); 
   // error! id is type dynamic, not compatible with int
  $y = takesInt($id); 
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Finally, with <code class="highlighter-rouge">mixed</code>, the type must be refined before use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>function takesInt(int $x) : int {
  //...
}

function f(mixed $x) : void {
  $id = $x-&gt;getInt(); // error! $x is mixed, cannot call getInt()
  $y = takesInt($id);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="details">Details</h3>

<ul>
  <li>A value of type <code class="highlighter-rouge">dynamic</code> is permissive of most local operations: like untyped expressions, you can treat it like an integer and add it, or a string and concatenate it, or call any methods on it.</li>
  <li>When using a dynamic type in an operation, the typechecker will infer the <em>best possible type</em> with the information it has. For example, using a <code class="highlighter-rouge">dynamic</code> in an arithmetic operation like “+” or “-” will result in a num, using a <code class="highlighter-rouge">dynamic</code> in a string operation will result in a string, but calling a method on a <code class="highlighter-rouge">dynamic</code> will result in another <code class="highlighter-rouge">dynamic</code>:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>function f(dynamic $x) : void {
  $y = $x + 5; // $y is a num
  $y = $x . "hello!"; // $y is a string 
  $y = $x-&gt;anyMethod(); // $y is dynamic
}
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>In the type hierarchy, <code class="highlighter-rouge">dynamic</code> is a supertype of all types(including mixed, though this might change). If a function accepts or returns a <code class="highlighter-rouge">dynamic</code> type any value can be used without performing a cast. We may limit or change this behavior in the future based on feedback and usage.</li>
  <li><code class="highlighter-rouge">dynamic</code> is permissive locally, so you don’t have to null check it. That said, this means there are no guarantees by the typechecker that your type is actually <code class="highlighter-rouge">nonnull</code>. We also may change this behavior in the future.</li>
  <li><em>Unlike</em> untyped expressions, <code class="highlighter-rouge">dynamic</code> is not a subtype of any regular type. That is, you cannot pass it to a function that expects a nondynamic type, or return it from a function that returns a nondynamic type (besides <code class="highlighter-rouge">mixed</code>) without casting.</li>
  <li>Certain dynamic behaviors, (like dynamic method calls) are allowed on dynamic types, even in strict mode. These operations result in another dynamic type.</li>
</ul>


    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/05/04/hhvm-3.25.3.html">HHVM 3.25.3, HHVM 3.24.7, and 3.21.11</a></h1>
    <p class="post-meta">发布于 2018 年 5 月 4 日</p>
  </header>

  <article class="post-content">
  
    
      <p>These releases contain several bugfixes:</p>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/4cb57dd753a339654ca464c139db9871fe961d56">CVE-2018-6335: potential DoS in Proxygen’s handling of HTTP2 header padding</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/2e4b6edb6a4eada13ccc5d5f024df300017982ca">CVE-2018-5711: PHP Bug #75571: Potential infinite loop in gdImageCreateFromGifCtx()</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/5d0afa03d246fcbbccccd813cb9cd727e8d04f47">PHP Bug #73957: signed integer conversion in imagescale()</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/6261025f7a4002cb2dc212d3c45786884fbabcfc">CVE-2017-10989, CVE-2017-13685, CVE-2017-15286, CVE-2018-8740: multiple issues in SQLite</a></li>
</ul>

<p>Additionally:</p>

<ul>
  <li>several portability improvements have been backported to ease building LTS branches on MacOS</li>
  <li>we are now packaging 3.24 and 3.25 for Ubuntu 18.04 (Bionic Beaver)</li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/04/11/relicensing-hack.html">Relicensing Hack</a></h1>
    <p class="post-meta">发布于 2018 年 4 月 11 日</p>
  </header>

  <article class="post-content">
  
    
      <p>This morning, <a href="https://github.com/facebook/hhvm/commit/17db24dcadf0f82f8832c46fb8ed7ab69cbc20ac">we re-licensed Hack itself</a>
under the MIT license, and we will be doing the same for most of our Hack
libraries and tools over the next few days, including the Hack Standard
Library.</p>

<p>We’re relicensing Hack, these tools, and these libraries to a license that
is broadly used in the community to ease concerns about compatibility, and
to avoid holding back adoption for non-technical reasons.</p>

<p>HHVM itself remains under the PHP and Zend licenses.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/03/30/hhvm-3.25.2.html">HHVM 3.25.2, HHVM 3.24.6, and 3.21.10 (CVE-2018-6334)</a></h1>
    <p class="post-meta">发布于 2018 年 3 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p>These releases contains several bugfixes:</p>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/6937de5544c3eead3466b75020d8382080ed0cff">CVE-2018-6334: ability to override global variables and members of <code class="highlighter-rouge">$GLOBALS</code> via file uploads</a></li>
  <li>Linux packaging: fix a regression in our packaging environment that prevented our binary packages from using system time zone databases</li>
  <li>Mac packaging: add support for the system time zone database</li>
  <li>3.25 and 3.24: <a href="https://github.com/facebook/hhvm/commit/305fa864ac6ad012bed1ab80d1854c371c0dbb06">stop raising incorrect warnings about PHP4-style constructors in interfaces</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/03/22/hhvm-3.25.1.html">HHVM 3.25.1, HHVM 3.24.5, and 3.21.9</a></h1>
    <p class="post-meta">发布于 2018 年 3 月 22 日</p>
  </header>

  <article class="post-content">
  
    
      <p>These releases contains several bugfixes:</p>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/5434132a5a25f2be3c1783abcae5d02cfc545496">Fix a potential DoS in Proxygen’s handling of HTTP2 frame size limits</a></li>
  <li>3.25.1 only: <a href="https://github.com/facebook/hhvm/commit/9235b1f388d754a9e5e72fff88590ec602bfe6e0">typechecker support for <code class="highlighter-rouge">throw</code>/<code class="highlighter-rouge">catch</code> of <code class="highlighter-rouge">Throwable</code>s that are not <code class="highlighter-rouge">Exception</code>s</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/03/15/hhvm-3.25.html">HHVM 3.25.0, 3.24.4, and 3.21.8</a></h1>
    <p class="post-meta">发布于 2018 年 3 月 15 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.25 is released! This release contains new features, bug fixes, performance improvements, and supporting work for future improvements. Packages have been published in the usual places.</p>

<p>Additionally, we are releasing 3.24.4 and 3.21.8 which address CVE-2018-6332, but do not include the other changes listed below.</p>

<p>Highlights of 3.25 include:</p>

<ul>
  <li>CVE-2018-6332: A potential denial-of-service issue in the Proxygen handling of invalid HTTP2 settings which can cause the server to spend disproportionate resources. This affects all supported versions of HHVM (3.24.3 and 3.21.7 and below) when using the proxygen server to handle HTTP2 requests.</li>
  <li>The PHP7 <code class="highlighter-rouge">Throwable</code>, <code class="highlighter-rouge">Error</code>, and <code class="highlighter-rouge">Exception</code> hierarchy is now always present, including in Hack and in PHP5 mode - however, internals will not raise instances of  <code class="highlighter-rouge">Error</code> or subclasses if PHP5 mode is enabled.</li>
  <li>We intend to remove the ODBC extension in the next release - it has previously only been available when building HHVM from source. Please let us know via GitHub issues if this is important to you.</li>
  <li>Fixed a crash when closing cURL handles from inside a cURL callback</li>
  <li>The Visual Studio Code Debug Adapter Protocol is now supported in addition to hphpd and XDebug, and is our recommended debug interface. Support for the XDebug protocol will be removed in a future release.</li>
  <li>PHP7: PHP7 mode is now the default; PHP5 mode is still available, but unsupported.</li>
  <li>PHP7: Visibility modifiers on constants (PHP 7.1) will no longer raise a parse error, however they will be ignored</li>
  <li>PHP7 and Hack: <a href="https://3v4l.org/3mAJV">Several more kinds of expressions</a> are now permitted as callable; these were previously understood by the Hack typechecker, but not supported by the runtime.</li>
  <li>Hack: <code class="highlighter-rouge">inout</code> function parameters are now supported, to replace references.</li>
  <li>Hack: typechecker errors are no longer converted to runtime errors by default, as it creates problems for tools that aim to resolve typechecker errors. For code that has typechecker errors, the behavior of the runtime remains undefined. You can restore the previous behavior with the <code class="highlighter-rouge">hhvm.hack.lang.auto_typecheck=1</code> ini setting.</li>
  <li>Hack: variadics without a variable name (e.g. <code class="highlighter-rouge">foo(...) { bar(func_get_args()); }</code>) are no longer supported in strict mode. Use named variadics and splats instead (e.g. <code class="highlighter-rouge">foo(string ...$args) { bar(...$args); }</code>).</li>
  <li>Hack: variable variables (<code class="highlighter-rouge">$$foo</code>) are no longer supported in decl mode.</li>
  <li>Hack: fixed several cases of double-nullable types (<code class="highlighter-rouge">??T</code>) being inferred when using <code class="highlighter-rouge">await</code>.</li>
  <li>Hack: user-land implementations of Awaitable are no longer possible; this was previously undocumented and unsupported.</li>
  <li>Hack: the <code class="highlighter-rouge">array</code>, <code class="highlighter-rouge">array&lt;Tv&gt;</code>, and <code class="highlighter-rouge">array&lt;Tk, Tv&gt;</code> types are no longer interchangeable. To ease migration, you can currently opt-out of this by setting <code class="highlighter-rouge">safe_array=false</code> and <code class="highlighter-rouge">safe_vector_array=false</code> in your <code class="highlighter-rouge">.hhconfig</code>, however we expect to remove this option in a future release.</li>
  <li>Hack: several additional features are available as opt-in, which we expect to be mandatory in 3.26; see the “Opt-In Typechecker Features” section below for details.</li>
  <li>Hack: an HHI file has been added for the PostgreSQL extension.</li>
  <li>Mac: resolved several race conditions that could lead to <code class="highlighter-rouge">hh_client</code> hanging after spawning a server, or if it ran shortly after a server was started.</li>
  <li>Mac: the PostgreSQL extension is now included in our binaries.</li>
</ul>

<h2 id="inout-parameters">inout Parameters</h2>

<p>Hack <code class="highlighter-rouge">inout</code> parameters are a replacement for PHP references, aiming to remove confusing corner-cases and make additional performance improvements possible.</p>

<p><code class="highlighter-rouge">inout</code> parameters allow local data to flow <em>in</em> and <em>out</em> of a function call. Changes to the data in the body of the function become visible to the caller <strong><em>after</em></strong> control returns.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>function f(inout int $var): void {
  var_dump($var);
  $var = 42;
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Calling <code class="highlighter-rouge">f()</code> as follows,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>$x = 0;
f(inout $x);
var_dump($x);
</pre></td></tr></tbody></table></code></pre></div></div>

<p>will result in the output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>int(0)
int(42)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In the scope containing <code class="highlighter-rouge">$x</code>, the call to <code class="highlighter-rouge">f()</code> causes <code class="highlighter-rouge">$x</code> to be overwritten with a new value immediately after the call finishes execution.</p>

<h3 id="how-can-i-use-it">HOW CAN I USE IT?</h3>

<p>To declare a parameter as inout, add the <code class="highlighter-rouge">inout</code> keyword before the type annotation. If there is no type annotation, add it before the variable name.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>function g(int $x, inout string $y): void {...}
// Untyped - invalid in strict mode, discouraged in other modes:
function h(inout $z) {...}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>When calling a function with one or more inout parameters, the corresponding arguments also need to be preceded by the <code class="highlighter-rouge">inout</code> keyword so that the calling convention is apparent.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$s = 'foo';
g(42, inout $s);
h(inout $s[1]);
h($s[1]); // typechecker error, inout expected
</pre></td></tr></tbody></table></code></pre></div></div>

<p>When designing <code class="highlighter-rouge">inout</code> we wanted to ensure the feature is performant and behaves intuitively, so we added some additional restrictions:</p>

<ul>
  <li>Arguments for <code class="highlighter-rouge">inout</code> parameters are local variables with an arbitrary number of index expressions allowed.
    <ul>
      <li>In other words, they should be local variables (<code class="highlighter-rouge">$x</code>) or indexed elements contained inside a local (<code class="highlighter-rouge">$vec[$y][z()][2]</code>).</li>
      <li>The local cannot be a global or static.</li>
      <li>Every intermediate base in the index chain should also be a value-typed container (e.g. vec, dict, keyset, or array).</li>
    </ul>
  </li>
  <li>Some types of functions cannot have <code class="highlighter-rouge">inout</code> parameters, though support might be added in the future. Right now, these include class constructors, async functions, and generators.</li>
  <li>You cannot mix <code class="highlighter-rouge">inout</code> parameters and PHP references (<code class="highlighter-rouge">&amp;</code>) when defining or calling a function.</li>
  <li><code class="highlighter-rouge">inout</code> parameters cannot have default values or be variadic.</li>
  <li>Currently, functions with <code class="highlighter-rouge">inout</code> parameters cannot be memoized.</li>
  <li>If two expressions alias each other or otherwise refer to shared state, and one of those appears as an <code class="highlighter-rouge">inout</code> argument, the other should not be used in a write context within the same statement.
    <ul>
      <li>Examples are <code class="highlighter-rouge">swap(inout $a, inout $a[0])</code> and <code class="highlighter-rouge">$a = h(inout $a[0])</code>.</li>
      <li>This is unsupported and we leave its behavior undefined.</li>
    </ul>
  </li>
</ul>

<h3 id="what-are-the-semantics">WHAT ARE THE SEMANTICS?</h3>

<p><code class="highlighter-rouge">inout</code> parameters have “<strong><em>copy-in copy-out</em></strong>” behavior.</p>

<ol>
  <li>The argument’s value is copied into the function when it is called.</li>
  <li>The body of the function can make arbitrary changes to the copy.</li>
  <li>As the function returns, the value of the copy is assigned back to the argument from 1).</li>
</ol>

<p><code class="highlighter-rouge">inout</code> parameters look a lot like PHP references, but there are some key differences.</p>

<ul>
  <li>Mutating an <code class="highlighter-rouge">inout</code> parameter within a function <strong><em>does not instantly update the variable that was passed into the call</em></strong>.
    <ul>
      <li>Those changes cannot be observed <em>unless</em> and <em>until</em> the call terminates normally.</li>
      <li><em>If an exception is thrown and not caught by the function</em>, no values for any <code class="highlighter-rouge">inout</code> parameters are copied out.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">inout</code> parameters are designed to be sound in Hack from day 1. They are fully supported in strict mode.
    <ul>
      <li>With <code class="highlighter-rouge">&amp;</code> references, the type checker is ignorant of their semantics. It cannot warn if types become fluid as a result of multiple references to the same variable.</li>
      <li>Many syntactical constructs in PHP implicitly contain referencing mechanisms; however, all uses of <code class="highlighter-rouge">inout</code> are required to be explicit, at both the declaration as well as the callsite.</li>
    </ul>
  </li>
</ul>

<h3 id="syntactic-sugar">SYNTACTIC SUGAR</h3>

<p>Any function definition with <code class="highlighter-rouge">inout</code> parameters is transformed by the compiler so that it returns the final values of its <code class="highlighter-rouge">inout</code> parameters in addition to the function’s return value (if any). At the callsite, the new values returned for the <code class="highlighter-rouge">inout</code> parameters are assigned back to their initial arguments.</p>

<p>A function <code class="highlighter-rouge">bar</code> taking one or more <code class="highlighter-rouge">inout</code> parameters, and corresponding call to <code class="highlighter-rouge">bar()</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>function bar(inout Ta $a, Tb $b, ..., inout Tz $z, ...): Tr {
  ... // implementation, possibly changing $a and/or $z
  return $ret;
}
$bar = bar(inout &lt;A&gt;, &lt;B&gt;, ..., inout &lt;Z&gt;, ...);
</pre></td></tr></tbody></table></code></pre></div></div>

<p>(with <code class="highlighter-rouge">&lt;A&gt;</code> etc. representing expressions) is roughly equivalent to:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>function bar(Ta $a, Tb $b, ..., Tz $z, ...): Tr {
  ... // implementation, as above
  return tuple($a, $z, $ret);
}
list(&lt;A&gt;, &lt;Z&gt;, $bar) = bar(&lt;A&gt;, &lt;B&gt;, ..., &lt;Z&gt;, ...);
</pre></td></tr></tbody></table></code></pre></div></div>

<p>where <code class="highlighter-rouge">&lt;A&gt;</code> and <code class="highlighter-rouge">&lt;Z&gt;</code> are only evaluated <em>once</em> to compute parameter names and offsets for read/write.</p>

<h3 id="i-want-a-real-world-example">I WANT A REAL-WORLD EXAMPLE!</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>/**
 * Extends a vec by appending the elements of the Traversable in-place.
 */
function extend&lt;Tv&gt;(
  inout vec&lt;Tv&gt; $vec,
  Traversable&lt;Tv&gt; $traversable,
): void {
  foreach ($traversable as $value) {
    $vec[] = $value;
  }
}
$v = vec[3, 2, 1];
extend(inout $v, keyset[4, 5]);
var_dump($v);  // vec[3, 2, 1, 4, 5]
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="visual-studio-code-debug-adapter-protocol-support">Visual Studio Code Debug Adapter Protocol Support</h2>

<p>HHVM now supports debugging via the Visual Studio Code Debug Adapter Protocol, which will be replacing use of XDebug for debugging in the next release. The VS Code protocol offers a more modern and extensible feature set and the switch allowed us to fix several significant issues in the HHVM debugger back-end that were fundamentally broken due to use of XDebug. Documentation for this protocol can be found here: https://code.visualstudio.com/docs/extensionAPI/api-debugging</p>

<p>With this, HHVM now offers a completely new debugging engine back-end, which will prove to be faster, more reliable, and will allow us to iterate and build better debugging experiences much more effectively. Switching to the VS Code protocol aligns with our new support for Hack language services via the VS Code Language Server Protocol. Additionally, the VS Code debug protocol is part of a sizable and growing ecosystem that is well supported by several great open source projects.</p>

<p>The new HHVM debugger is compatible with IDEs that speak the VS Code Debug Adapter protocol including Nuclide and Visual Studio Code.  This debugger will be replacing the existing XDebug-based HHVM debugger. **Note that this means support for the XDebug protocol is now deprecated, and will be removed completely in the next release of HHVM. **We are currently planning to replace hphpd in the near future with a new CLI debugging experience that is compatible with all VS Code debuggers, including HHVM, but will keep hphpd in place and supported until the replacement is ready.</p>

<h3 id="enabling-the-new-debugger">Enabling The New Debugger</h3>

<p>Like HHVM’s other debuggers, this new debugger is disabled by default when HHVM is running in server mode. To enable it, set vs_debug_enable = true in your config file:</p>

<p><code class="highlighter-rouge">hhvm.debugger.vs_debug_enable=1</code></p>

<p>When enabled, in server mode the debugger will listen for incoming connections on TCP port 8999 by default. This can be overridden in your config file as well:</p>

<p>``hhvm.debugger.vs_debug_listen_port=<code class="highlighter-rouge">&lt;port&gt;</code></p>

<p>To support debugging scripts, HHVM now accepts some new command line parameters:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>hhvm --mode vsdebug --vsDebugPort &lt;port&gt; &lt;... other args&gt;  &lt;your_script.php&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This will execute the specified script with the new debugger enabled. On startup, HHVM will stop and wait for a debugger to connect on the specified port before beginning execution of the script. Compatible IDEs such as Nuclide will offer a way to attach to hhvm on the specified port and begin execution and debugging of the script.</p>

<p>It is also possible to begin running a script in a mode that allows the debugger to attach and break in later:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>hhvm --mode vsdebug --vsDebugPort &lt;port&gt; --vsDebugNoWait true &lt;...&gt;  &lt;your_script.php&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This command is similar to the previous one, except HHVM will not wait for the debugger on startup. Instead it will begin executing your script immediately as normal, but it will accept a connection from your debugger on the specified port. The debugger can attach later and break into the target.  This is useful for being able to break into long-running scripts that need to be debugged after executing for a while. Nuclide will offer a mechanism to list scripts started in this fashion and break in to them.</p>

<p>Support for connecting to the new HHVM debugger via Visual Studio Code is available via open source VS Code extensions, such as https://github.com/PranayAgarwal/vscode-hack</p>

<h2 id="upcoming-hack-language-changes">Upcoming Hack Language Changes</h2>

<p>These features are opt-in in 3.25, but we expect them to be mandatory in HHVM 3.26. These are all supported by the active libraries and tools available on https://github.com/hhvm/.</p>

<h3 id="removing-namespace-fallback-for-functions-and-constants">Removing Namespace Fallback for Functions and Constants</h3>

<p>To improve consistency and remove ambiguity, we are removing the root-namespace fallback for functions and constants:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>&lt;?hh

namespace MyNS;

function main(): void {
  // Always refers to \MyNS\MyClass();
  new MyClass();
  // Currently may refer to either \MyNS\my_func() or \my_func(), depending on what's
  // available at runtime; in 3.26 and above, it will always refer to \MyNS\my_func()
  my_func();
  // Explicitly reference \MyNS\my_func():
  namespace\my_func();
  // Explicitly reference \my_func();
  \my_func();
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To enable this behavior in 3.25, set <code class="highlighter-rouge">enable_experimental_tc_features = no_fallback_in_namespaces</code> in your project <code class="highlighter-rouge">.hhconfig</code> file.</p>

<p><a href="https://github.com/hhvm/hhast">HHAST</a> is able to automatically migrate codebases that have no other typechecker errors:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>hhast$ bin/hhast-migrate --no-namespace-fallback /path/to/your/project/
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="verifying-arity-of-variadic-function-calls">Verifying Arity of Variadic Function Calls</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>&lt;?hh

function foo(int $first, int...$rest): void {}

// In 3.25, this is permitted, however it is unsafe as $args may be empty. We expect
// to ban this in 3.26.
function bar(int ...$args): void {
  foo(...$args);
}

// Instead:
function bar(int $first, int ...$rest): void {
  foo($first, ...$rest);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Tuples are still permitted if they have sufficient elements of the correct types, for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>function bar((int, int) $args): void {
  foo(...$args);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To enable this behavior in 3.25, set <code class="highlighter-rouge">enable_experimental_tc_features = unpacking_check_arity</code> in your project <code class="highlighter-rouge">.hhconfig</code> file.</p>

<h3 id="banning-destructors">Banning Destructors</h3>

<p>We are removing destructors from Hack to simplify behavior and remove the need for strict reference counting in the runtime; common approaches to replace them include:</p>

<ul>
  <li><a href="https://docs.hhvm.com/hack/disposables/introduction">Disposables</a> (introduced in HHVM 3.24)</li>
  <li>try/catch/finally constructs</li>
  <li><code class="highlighter-rouge">register_shutdown_function()</code></li>
</ul>

<p>To enable this behavior in 3.25, set <code class="highlighter-rouge">disallow_destruct = true</code> in your project <code class="highlighter-rouge">.hhconfig</code> file.</p>

<p>Destructors can also be banned at runtime by setting the <code class="highlighter-rouge">hhvm.allow_object_destructors</code><code class="highlighter-rouge"></code><code class="highlighter-rouge">=</code><code class="highlighter-rouge"> false</code> HHVM INI setting, though this will also affect PHP files.</p>

<h3 id="banning-references-into-arrays">Banning References In/To Arrays</h3>

<p>PHP references are completely banned in strict mode, however they’re currently permitted in partial mode. While we’re not yet changing that, we are banning them inside arrays:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>&lt;?hh

function foo(): void {
  $x = array(42);
  // Will be banned in 3.26:
  $z = &amp;$x[0];
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To enable this behavior in 3.25, set <code class="highlighter-rouge">enable_experimental_tc_features = disallow_refs_in_array</code> in your project <code class="highlighter-rouge">.hhconfig</code> file.</p>

<h3 id="banning-passing-untyped-lambdas-as-non-function-types-in-strict-mode">Banning Passing Untyped Lambdas As Non-Function Types In Strict Mode</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>&lt;?hh // strict

function foo(mixed $f): void {}

function bar(): void {
  // Inference can't be used if passing untyped, so this is unsafe, and will be
  // banned in 3.26
  foo($a ==&gt; $a);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To enable this behavior in 3.25, set <code class="highlighter-rouge">enable_experimental_tc_features = disallow_untyped_lambda_as_non_function_type</code> in your project <code class="highlighter-rouge">.hhconfig</code> file.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/03/02/hhvm-3.24.3.html">HHVM 3.24.3 and 3.21.7</a></h1>
    <p class="post-meta">发布于 2018 年 3 月 2 日</p>
  </header>

  <article class="post-content">
  
    
      <p>These releases contains several bugfixes:</p>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/798604c98fad31229cd703727204fbde009002af">Fix a crash when closing a cURL handle from inside a cURL callback on the same handle</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/1ec4511fee3100fd769b8332414ec281f3665253">Fix an IPC issue leading to <code class="highlighter-rouge">hh_client</code> hanging on Mac when spawning the server, or when the server was recently started</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/65a0e9da47f7e0e7248c26af5dfbe98eb96c2d9f">Improve behavior of <code class="highlighter-rouge">--retries</code> option for <code class="highlighter-rouge">hh_client</code></a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/02/07/hhvm-3.24.2.html">HHVM 3.24.2</a></h1>
    <p class="post-meta">发布于 2018 年 2 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p>This release contains several bugfixes:</p>

<ul>
  <li><a href="https://github.com/facebook/mysql-5.6/commit/b4ae418dbbd4913cbf0d523569a3d4ec9ba85343">Fix crashes when connecting to some recent MySQL servers such as MariaDB 10</a></li>
  <li><a href="https://github.com/facebook/wangle/commit/ab7a6f191c1150fb4aa95f325023b88ae4201850">Fix crashes when SSL is enabled, but certificates and keys are not correctly configured</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/43edcb457094afe511d7da9abf72817f548902e0">If SSL is configured but the port is unavailable, exit cleanly instead of crashing</a></li>
</ul>

<p>Additionally, we have rebuilt the HHVM 3.21 MacOS binaries to be compatible with updates to other Homebrew packages.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/01/30/hhvm-3.24.1.html">HHVM 3.24.1, 3.21.6, and 3.18.8</a></h1>
    <p class="post-meta">发布于 2018 年 1 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p>These releases contains several bugfixes:</p>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/71cf8e593a1999c09892713d5dec4e1536de5b9c">Re-sync <code class="highlighter-rouge">parse_url()</code> with upstream (PHP7), fixing support for URLs containing usernames and passwords that contain unusual characters</a> (3.24.1, 3.21.6, 3.18.8).</li>
  <li><a href="https://github.com/facebook/hhvm/commit/fb70e3599df2173c5d7791b44f6280983ac58853">Support the <code class="highlighter-rouge">JSON_FB_HACK_ARRAYS</code> flag for <code class="highlighter-rouge">json_decode()</code> when HHVM is built against the json-c library</a> (3.24.1, 3.21.6).</li>
  <li><a href="https://github.com/facebook/hhvm/commit/864c84c890ff58a6a396d33a1ce999e07ada7aac">Fix an ordering issue that indirectly led to incorrect or incomplete IDE autocompletion results in some situations</a> (3.24.1, 3.21.6)</li>
</ul>

<p><strong>HHVM 3.18 <a href="https://docs.hhvm.com/hhvm/installation/release-schedule">is unsupported</a>, and we recommend migrating to 3.21 or 3.24 as soon as possible.</strong> We are making an exception by releasing 3.18.8 as it fixes a regression we recently introduced in 3.18.7 - we are not expecting to release any further 3.18 updates.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/01/16/hhvm-3.24.html">HHVM 3.24</a></h1>
    <p class="post-meta">发布于 2018 年 1 月 16 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.24 is released! This release contains new features, bug fixes, performance improvements, and supporting work for future improvements. Packages have been published in the usual places.</p>

<p>Highlights include:</p>

<ul>
  <li>In Hack code, reference arguments must now be marked at the call site, e.g. <code class="highlighter-rouge">$foo = [3, 1, 2]; sort(&amp;$foo);</code></li>
  <li>Support for <code class="highlighter-rouge">using</code> blocks - an alternative to destructors</li>
  <li>Improved type inference and type checking for lambdas</li>
  <li>Added the XHP attribute spread operator</li>
  <li>Improved the typing of XHP attributes and children</li>
  <li>Clearer error messages for constraint errors on generic methods</li>
  <li>Improved handling of multiple debuggers (e.g. hphpd + xdebug)</li>
  <li><code class="highlighter-rouge">hh_parse</code> now offers a <code class="highlighter-rouge">--full-fidelity-text-json</code> option, which includes node content in the output</li>
  <li>In partial mode, Hack no longer assumes that any unknown definitions must be defined in PHP</li>
</ul>

<p>As a release with long-term support, 3.24 is supported through 2018-12-17; it also marks the end of support for HHVM 3.18.</p>

<h2 id="end-of-support-for-php5">End Of Support For PHP5</h2>

<p><a href="https://hhvm.com/blog/2017/09/18/the-future-of-hhvm.html">3.24 is the final release targeting PHP5</a>; this includes source-level compatibility for PHP5 extensions (<code class="highlighter-rouge">ext_zend_compat</code>). We recommend migrating to Hack or PHP7.</p>

<p>As 3.24 is supported though 2018-12-17, this means that support will end at roughly the same time as PHP5 itself is scheduled to become unsupported (2018-12-31).</p>

<h2 id="end-of-support-for-debian-7-wheezy-and-ubuntu-1704-zesty">End Of Support For Debian 7 Wheezy and Ubuntu 17.04 Zesty</h2>

<p>The Debian project <a href="https://wiki.debian.org/DebianReleases">is scheduled</a> to end support for Wheezy in May 2018, and the Ubuntu project <a href="https://wiki.ubuntu.com/Releases">is scheduled</a> to end support for Ubuntu Zesty in January 2018; as such:</p>

<ul>
  <li>HHVM 3.24 will be the last release to support Wheezy and Zesty.</li>
  <li>HHVM support for Wheezy and Zesty will end when the distributions themselves become unsupported; this includes ending support for the 3.21 and 3.24 HHVM releases.</li>
</ul>

<h2 id="reference-arguments">Reference Arguments</h2>

<p>In Hack code, by-ref function arguments must now be marked at the callsite, not just at the function declaration. We have <a href="https://github.com/hhvm/hhast/releases/tag/v0.6">extended HHAST</a> to automate migrations; for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre>$ bin/hhast-migrate --help
Usage: bin/hhast-migrate [OPTIONS] PATH [PATH ...]

Options:
  --implicit-shape-subtypes
    Allow implicit structural subtyping of all shapes
  --optional-shape-fields
    Migrate nullable shape fields to be both nullable and optional
  --hhvm-3.22-to-3.23
    Apply all migrations for moving from 3.22 to 3.23
  --ctpbr
    Add required ampersands at call sites for byref arguments
  --hhvm-3.23-to-3.24
    Apply all migrations for moving from 3.23 to 3.24
  --include-vendor
    Also migrate files in vendor/ subdirectories
  -v, --verbose
    Increase output verbosity
  -h, --help
    display this text and exit
$ bin/hhast-migrate --ctpbr $HOME/code/fbmarkdown/src/
$ cd $HOME/code/fbmarkdown/src/
$ git diff
diff --git a/src/_Private/decode_html_entity.php b/src/_Private/decode_html_entity.php
index 7891b57..a44b441 100644
--- a/src/_Private/decode_html_entity.php
+++ b/src/_Private/decode_html_entity.php
@@ -25,7 +25,7 @@ function decode_html_entity(string $string): ?(string, string, string) {
     \preg_match(
       '/^&amp;(#[0-9]{1,8}|#X[0-9a-f]{1,8}|[a-z][a-z0-9]*);/i',
       $string,
-      $matches,
+      &amp;$matches,
     ) !== 1
   ) {
     return null;
...
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This is not required for PHP code.</p>

<h2 id="using-blocks">Using Blocks</h2>

<p>“Using” blocks provide a mechanism to limit an object to a particular scope, invoking code on scope exit, without using destructors.
This is done by implementing either <code class="highlighter-rouge">IDisposable</code> or <code class="highlighter-rouge">IAsyncDisposable</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>/**
  * Objects that implement IDisposable must be constructed in using statements
  */
interface IDisposable {
  /**
   * This method is invoked exactly once at the end of the scope of the
   * using statement, unless the program terminates with a fatal error.
   */
  public function __dispose(): void;
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>class Handle implements IDisposable {
  public function __dispose(): void {}
  public function foo(): void {}
}

function disposable_example(): void {
  // Block scope
  using ($x = new Handle()) {
    $x-&gt;foo();
  } // $x-&gt;__dispose() is implicitly called here

  // Function scope
  using new Handle();
  // handle still exists here
} // __dispose() is now called on the anonymous handle
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Further details are available in <a href="https://docs.hhvm.com/hack/disposables/introduction">the documentation</a>.</p>

<h2 id="xhp-attribute-spread-operator">XHP Attribute Spread Operator</h2>

<p>Many XHP elements currently implicitly copy attributes to the root XHP element they produce; this silently overrides elements that are declared on the root element, and is hard to reason about in large codebases.</p>

<p>We have added an attribute spread operator to explicitly copy attributes, and will be removing implicit copying from xhp-lib in the near future:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>class :foo-old extends :x:element {
  use XHPHelpers;
  
  attribute string color, int age;
  public function render(): XHPChild {
    return &lt;bar color="red" /&gt;;
  }

class :foo-new {
  attribute string color, int age;
  public function render(): XHPCHild {
    return &lt;bar {...$this} color="red" /&gt;;
  }
}

class :bar extends :x:element {
  attribute string color, int age;
}

$xhp = &lt;foo-old color="blue" /&gt;;
$xhp2 = &lt;foo-new color="blue" /&gt;;
// Old: this XHP renders to &lt;bar color="blue" /&gt;.
// New: Spread position matters, so the XHP renders to &lt;bar color="red" /&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="xhp-attribute-and-child-improvements">XHP Attribute and Child Improvements</h2>

<ul>
  <li><code class="highlighter-rouge">@required</code> attributes can no longer be nullable</li>
  <li><code class="highlighter-rouge">@required</code> attributes can no longer have a default value</li>
  <li><code class="highlighter-rouge">Stringish</code> now extends <code class="highlighter-rouge">XHPChild</code></li>
  <li>XHP child expressions are now required to be of type <code class="highlighter-rouge">?XHPChild</code></li>
  <li>Attribute literals can now contain colons - e.g. <code class="highlighter-rouge">&lt;foo bar:baz="foo"&gt;</code></li>
</ul>

<h2 id="unknown-definitions-in-partial-hack">Unknown Definitions in Partial Hack</h2>

<p>In previous releases, Hack has assumed that if a partial file references an unknown definition (e.g. classes, functions, or constants), that it exists in a PHP file. This is no longer the case. We recommend adding HHI files for PHP libraries that are directly used in Hack code. Alternatively, <code class="highlighter-rouge">HH_FIXME</code> comments can be used to suppress these errors.</p>

<p>It is currently also possible to enable the old behavior by setting <code class="highlighter-rouge">assume_php=true</code> in your project’s <code class="highlighter-rouge">.hhconfig</code> file - however this is no longer a supported configuration, may be buggy, and will be removed from a future release (potentially 3.25). It should be considered a temporary migration aid only.</p>

<p>We are doing this change to:</p>

<ul>
  <li>detect more errors; for example, when <code class="highlighter-rouge">assume_php=true</code>, Hack is unable to raise errors for typos in function, class, or constant names except in strict files</li>
  <li>increase soundness</li>
  <li>reduce the number of options available in Hack</li>
</ul>


    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/01/12/hhvm-3.23.4.html">HHVM 3.23.4, 3.21.5, and 3.18.7</a></h1>
    <p class="post-meta">发布于 2018 年 1 月 12 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Today we’re releasing HHVM 3.23.4, 3.21.5, and 3.18.7. These releases contain security improvements:</p>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/80855dc1f2fe4d9de6bf4a4207ba88fbf7933b94">Ensure url parsing complies with rfc3986 to get the right hostname</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/b0c2d0114a47079819566afcc17467b0a92cefde">Prevent illegal write/read access caused by gdImageAALine overflow</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/0b9e2f89da2b2d3270b6958731a3140a9845f22d"><code class="highlighter-rouge">preg_quote()</code> does not quote # control character</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/c5efa1557cb43aa5a0732cd87bc0167b963f04af">Fix memory leak in libgd</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/7c61f20a51e476398f4d5a2b779ec53a06faa59c">Accelerated Thrift: Protect against infinte loop in deserialization</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/9942bdb63fddd01f835451e0d96768b622df9ae0"><code class="highlighter-rouge">ext_zend_compat</code>: Fix potential memory issue with <code class="highlighter-rouge">USE_ZEND_ALLOC=0</code></a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2018/01/02/hhvm-3.23.3.html">HHVM 3.23.3, 3.21.4, and 3.18.6</a></h1>
    <p class="post-meta">发布于 2018 年 1 月 2 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Today we’re releasing HHVM 3.23.3, 3.21.4, and 3.18.6. These releases contain:</p>

<ul>
  <li>security improvements (listed below)</li>
  <li><a href="https://github.com/facebook/hhvm/commit/b5e6a3275cefe2afc56e730cfa6cb8fec737bf9a">a fix for several MacOS crashes</a>  (3.23.3 and 3.21.4 only)</li>
</ul>

<h2 id="security-improvements">Security Improvements</h2>

<ul>
  <li><a href="https://github.com/facebook/hhvm/commit/9de2e69ef51bf40f66b4ad8b3f927f3e97ccaeb6">Prevent write out of bounds at <code class="highlighter-rouge">number_format</code></a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/bc4a1a8663f45b3a776f8f4102aa17cd4c587539">memcpy negative parameter in _bc_new_num_ex</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/e33bffbb787855d29480d8f43c5523036f9657d8">Fix PHP #75075 unpack with X* causes infinite loop</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/31c7a8102956db036d8961357029d8e69fb92b22">Fix PHP #75139 suspicious ternary</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/54aeb01fb1c9d63504b3c97bcfd33a45c28f2c3f">Fix PHP 74435 - Buffer over-read into uninitialized memory</a></li>
  <li><a href="https://github.com/facebook/hhvm/commit/a2b685b13618e662443e39070d167863fe036a96">Fix PHP 74651 - EVP_SealInit can return -1</a></li>
</ul>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/11/17/hhvm-3-23.html">HHVM 3.23</a></h1>
    <p class="post-meta">发布于 2017 年 11 月 17 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.23 is released! This release contains new features, bug fixes, performance improvements, and supporting work for future improvements. Packages have been published in the usual places, however we have rotated the GPG key used to sign packages; see the <a href="https://docs.hhvm.com/hhvm/installation/introduction">installation instructions</a> for more information.</p>

<p>Highlights include:</p>

<ul>
  <li>optional shape fields are now distinct from nullable shape fields, and structural subtyping is now opt-in per shape. For details and tooling to help migrate, see <a href="https://hhvm.com/blog/2017/09/26/hhvm-3-22.html">the 3.22 release announcement</a>.</li>
  <li>support for the VSCode Language Server Protocol, which will shortly be used by Nuclide’s Hack integration.</li>
  <li>functions may no longer be named <code class="highlighter-rouge">using()</code>, as this will conflict with the upcoming <code class="highlighter-rouge">using</code> feature</li>
  <li>support for making the typechecker entirely ignore certain files; this is via the <code class="highlighter-rouge">ignored_paths</code> .<code class="highlighter-rouge">hhconfig</code> option, which contains an array of regular expressions - for example, <code class="highlighter-rouge">ignored_paths = [ "vendor/.*tests?/" ]</code>.</li>
  <li>tuple constants are now supported.</li>
  <li>method calls are now supported against parenthesized expressions.</li>
  <li>fixed some situations where it would be necessary to interrupt (Ctrl-C) hh_client.</li>
  <li>support for building against OpenSSL 1.1, e.g. Debian Stretch, Ubuntu Zesty, and Ubuntu Artful.</li>
  <li>an experimental alternative bytecode emitter for Hack</li>
</ul>

<h2 id="packaging-changes">Packaging Changes</h2>

<h3 id="gpg-key-rotation">GPG Key Rotation</h3>

<p>We have <a href="https://hhvm.com/blog/2017/11/14/gpg-key-migration.html">rotated the GPG key</a> we use to sign our apt repositories; you will need to install the new key before installing updates:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xB4112585D386EB94
# or
curl https://dl.hhvm.com/conf/hhvm.gpg.key | sudo apt-key add -
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="https-repositories">HTTPS Repositories</h3>

<p>Our downloads (including repositories) are now available via HTTPS, and distributed via CDN. You can migrate by running  <code class="highlighter-rouge">apt-get install apt-transport-https</code>, then editing your apt sources (either <code class="highlighter-rouge">/etc/apt/sources.list</code>, or a file in <code class="highlighter-rouge">/etc/apt/sources.list.d/</code>) to use <code class="highlighter-rouge">https://dl.hhvm.com/</code> instead of <code class="highlighter-rouge">http://dl.hhvm.com/</code></p>

<h3 id="binary-packages-for-macos">Binary Packages for MacOS</h3>

<p>Binary packages are now available for MacOS Sierra and High Sierra. They can be installed by <a href="https://brew.sh/">installing Homebrew</a>, then:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>brew tap hhvm/hhvm
brew install hhvm
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="nightly-builds">Nightly Builds</h3>

<p>We are now publishing nightly builds for Debian, Ubuntu, and Docker. For apt, these are available in the main repository as the <code class="highlighter-rouge">hhvm-nightly</code> package, and for Docker, they’re available as the <code class="highlighter-rouge">hhvm/hhvm:nightly</code> and <code class="highlighter-rouge">hhvm/hhvm-proxygen:nightly</code> tags.</p>

<h3 id="distribution-support">Distribution Support</h3>

<p>This release adds support for Debian 9 (Stretch), Ubuntu 17.04 (Zesty), and Ubuntu 17.10 (Artful).</p>

<p>The next release - 3.24 - will be the last release with support for Debian 7 (Wheezy). All HHVM support for Wheezy will end on the 31st of May, 2018, including for the 3.21 and 3.24 LTS releases. This is the same date that <a href="https://wiki.debian.org/LTS/Wheezy">Wheezy itself becomes unsupported</a>.</p>

<h2 id="language-server-protocol">Language Server Protocol</h2>

<p>The language server protocol is a standard for languages to integrate with editors and IDEs. If you wish to create or contribute to on an integration, use <code class="highlighter-rouge">hh_client lsp</code> to launch an LSP server.</p>

<p>Editors and IDEs should consider the language server protocol usable if <code class="highlighter-rouge">hh_client --json --version</code> reports an API version &gt;= 5, and prefer the LSP over previous approaches.</p>

<h2 id="upcoming-changes">Upcoming Changes</h2>

<h3 id="call-time-pass-by-reference">Call-Time Pass-By-Reference</h3>

<p>HHVM 3.24 will require that reference arguments are marked at the callsite - for example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>function foo(array&lt;string&gt; $bar): void {
  sort(&amp;$bar);
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Hack in 3.23 allows this syntax, but does not require it. You can opt-in to the requirement by adding <code class="highlighter-rouge">safe_pass_by_ref</code> to <code class="highlighter-rouge">enable_experimental_tc_features</code> in your <code class="highlighter-rouge">.hhconfig</code>.</p>

<p>We are <a href="https://github.com/hhvm/hhast/issues/21">planning on extending HHAST</a> to automate this migration.</p>

<h3 id="lambda-type-inference">Lambda Type Inference</h3>

<p>In HHVM 3.24, the expected types of lambdas will be used to refine them; for example, this currently has no errors:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre>&lt;?hh // strict

class MyClass {}

class MyClosureRunner&lt;-T&gt; {
  public function __construct(private (function(T): string) $closure) {}
}

function expectsMyClosureRunnerMyClass(
  MyClosureRunner&lt;MyClass&gt; $x,
): MyClosureRunner&lt;MyClass&gt; {
  return $x;
}

function getThing1(): MyClosureRunner&lt;MyClass&gt; {
  $var = expectsMyClosureRunnerMyClass(
    new MyClosureRunner(
      function(/* MyClass */ $arg) {
        $arg-&gt;missing_method();
        return "ok";
      },
    ),
  );
  return $var;
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In  3.24, or with <code class="highlighter-rouge">enable_experimental_tc_features=contextual_inference</code> in your <code class="highlighter-rouge">.hhconfig</code>, the following error will be raised by the typechecker:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>test.php:19:15,28: Could not find method missing_method in an object of type MyClass (Typing[4053])
  test.php:10:19,25: This is why I think it is an object of type MyClass
  test.php:3:7,13: Declaration of MyClass is here
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="removing-support-for-undefined-references-in-non-strict-files">Removing Support For Undefined References In Non-Strict Files</h3>

<p>In non-strict Hack code, the typechecker assumes that references to classes, functions, and so on that it doesn’t know about are references to PHP code, so they are ignored. We will be removing this behavior in 3.24. You can experiment with this by adding <code class="highlighter-rouge">assume_php=false</code> to your <code class="highlighter-rouge">.hhconfig</code>.</p>

<p>If your Hack code depends on PHP code, there are several options:</p>

<ul>
  <li>migrate to pure Hack</li>
  <li>create an hhi file describing the API for Hack</li>
  <li>use <code class="highlighter-rouge">HH_FIXME</code> comments in wrappers to suppress the errors</li>
</ul>

<h3 id="opt-in-runtime-ban-of-destructors">Opt-in Runtime ban Of Destructors</h3>

<p>Adding <code class="highlighter-rouge">hhvm.allow_object_destructors</code><code class="highlighter-rouge"> </code><code class="highlighter-rouge">=</code><code class="highlighter-rouge"> false</code> to your HHVM configuration will cause runtime errors whenever a class with a destructor is instantiated. We have done this as many libraries use destructors, but only in components that appear to be very rarely used; this allows experimenting to determine what destructors actually are in use in your codebase.</p>

<p>You can whitelist a destructor by adding the <code class="highlighter-rouge">&lt;&lt;__OptionalDestruct&gt;&gt;</code> attribute to the method; HHVM does not guarantee  whether a destructor marked with this attribute will be called or not, regardless of the value of the  <code class="highlighter-rouge">hhvm.allow_object_destructors</code> setting. This can be useful where the inheritance hierarchy requires the presence of a destructor, but invoking it is not actually necessary for program correctness.</p>

<p>We are expecting to ban destructors in Hack in one of the next few releases, however they will still be supported in 3.24, and we currently have no timeline for removing them from our PHP support.</p>

<h3 id="using-statements">“using” statements</h3>

<p>We are working on a <code class="highlighter-rouge">using</code> statement, which limits a variable either to a specific block, or to the function as a whole. We provide interfaces for user-specified code to be executed on these objects when they are about to leave the scope.</p>

<p>This is still a work in progress, and we expect it to be ready for experimentation in 3.24.</p>

<h3 id="experimental-bytecode-emitter-for-hack-hackc">Experimental bytecode emitter for Hack (HackC)</h3>

<p>We are working on replacing the parser and bytecode emitter used for Hack, with the goal of using a single parser for execution, typechecking, formatting, linting, and all other tooling surrounding Hack.</p>

<p>While this is not yet ready for production use, you can experiment with it on Linux by setting the following options in your HHVM ini file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>hhvm.hack_compiler_default=true
hhvm.hack_compiler_command=/path/to/hh_single_compile --daemon
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We <strong>strongly</strong> recommend only testing on Linux for now: there are known issues on other platforms which may affect overall system stability, especially on MacOS.</p>

<p>When these options are set, HackC will only be used for Hack files, unless the <code class="highlighter-rouge">hhvm.force_hh</code> ini setting is turned on, in which case it will also be used for PHP files. You can check which emitter is being used for a particular file with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>&lt;?hh

var_dump(__COMPILER_FRONTEND__);
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Currently, this will either output <code class="highlighter-rouge">string(4) "hhvm"</code> for the old frontend, or <code class="highlighter-rouge">string(5) "hackc"</code> if using <code class="highlighter-rouge">hh_single_compile</code>. This constant is also supported in PHP code, which will always contain <code class="highlighter-rouge">string(4) "hhvm"</code> unless  both <code class="highlighter-rouge">hackc</code> and <code class="highlighter-rouge">force_hh</code> are enabled..</p>

<p>We would particularly appreciate bug reports related to namespaces, or interactions between Hack and PHP code that are only reproducible with the new emitter.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/11/14/gpg-key-migration.html">GPG Key Migration</a></h1>
    <p class="post-meta">发布于 2017 年 11 月 14 日</p>
  </header>

  <article class="post-content">
  
    
      <p>As part of modernizing and automating our binary packaging infrastructure, we’re rotating the GPG key we use to sign our apt repositories; we will also be signing our source tarballs in the future. We expect to switch the key later this week.</p>

<p>The new key can be installed with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xB4112585D386EB94
# or...
curl https://dl2.hhvm.com/conf/hhvm.gpg.key | sudo apt-key add
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The full public key is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre>-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBFn8koEBEAC2tPtkphj8gZYHI9mTNUHfQalDo+MNWTGUTNB42asjhTNjipzM
VSxjaZSl5cMLg5YCRuT0AbSIe529FH23yEElc03cGVGgoEnmXtE4+2v7Xa30wCGO
5oUxKfbVatsxEs1y8QEr5Gt+CUFmsApOKgiZq0MsPYmFAuC9CbWdXYa8+E00bXOa
cHCpe+GncCxQmExm7TlrUnURnf3RnNWSEkuPKED/aVggzxNVN6RgRRm4ssZJasM3
TwoI1nVysO5jMfPClvupYscoktO44HBZzH2EeEdpjSV+toD3aZCbmWzXyZjogrFN
j4k5Mme0Xqr4DvRPk5M9SxcQASsCQ8VTyu+ZBUG6zJbddLDEA1BMNIZOG5MyX58O
zed255Q85SAyjHu8pltkfGLd56+MYsckpHaBPMFoCFM4iPcpXOlgcU96pdXJbrR2
mjYI4Le9qRJYYP2kGPkopPwK8nbZJ5Wr7xaclxEc/ODH3mv57KJD7lzmwpnvvmsn
kR/wUHOqwrXojp/oZCUK8KembLiT+MMkY3bne+IY9ef/1qwu4flVBP1CpoaMQEwh
dqzihfwyQ+57ATZHJaj8V9pKAxWh/Df4iFN5mMWA15eBLhRMbAWKJIoLQLcCYwBF
gH3HiO34/uQUHaX6VhRHllA38WUoZNhKmw/Kcd/FDQWlbzbgmI89LJEJuwARAQAB
tC1ISFZNIFBhY2thZ2UgU2lnbmluZyA8b3BlbnNvdXJjZStoaHZtQGZiLmNvbT6J
Ak4EEwEIADgWIQQFg0HGj8jeYBfXdaG0ESWF04brlAUCWfySgQIbAwULCQgHAgYV
CAkKCwIEFgIDAQIeAQIXgAAKCRC0ESWF04brlMp8D/4ia7wLi6OQEtR8uPIrtCdg
ClHvXTX0zihHPDomn77lRSfqEVapKcsvpyc9YTjv27EuRvymUG+o7971RY+rYes4
+POdsjlxJF5ZkNi8YxpUNEw2hTWC66o6vd4Gv4dJgugkZ5dvHKEwec7+mQna9O/p
F4rY/VVmh+4YJUzuuKMb2ZLHsZ3LJv/WBL9Ps+sRFHUN5lDfV00wAsfzEW+dxyh1
kkqXwTk70r8m5m+nCdf0z+giAU7XWRkbJV2HTatSgY1ozOYARe4v0MGyLwp74I6R
lrWPY97C9k4emF7WP2mglcBu+Eg2Q6A0Y3OgEiGnqkgRJEnrfpHa4wXM1sEUf4MV
5FQgyroZg45c375okr/RLP/pC4/x8ZM6GqLv4qTEOk6qWM7hWXhPRJ1TSVgCHv19
jki5AkwV4EcROpFmJzfW6V9i4swJKJvYXLr58W0vogsUc8zqII4Sl7JUKZ/oN4jQ
QX138r85fLawla/R0i30njmY7fJYKRwHeshgwHg6vqKobTiPuLarwn0Arv7G7ILP
RjbH/8Pi+U2l8Fm/SjHMZA6gcJteRHjTgjkxSAZ19MyA08YqahJafRUVDY9QhUJb
FkHhptZRf9qRji3+Njhog6s8EGACJSEOwmngAViFVz+UUyOXY94yoHvb19meNecj
ArL3604gOqX3TSSWD1Dcu4kBMwQTAQgAHRYhBDau9k0CB+fu41LUh1oW5ygb56RJ
BQJZ/JVnAAoJEFoW5ygb56RJ15oH/0g4hrylc79TD9xA1vEUexyOdWniY4lwH9yI
/DaFznIMsE1uxmZ0FE9VX5Ks8IFR+3P9mNDQVf9xlVhnR7N597aKtU5GrpbvtlJy
CoQVtzBqYKcuLC4ZFRiB33HwZrZIxTPH27UUaj1QBz748zIMC6wvtldshjNAAeRr
Jz28twPO2D7svNIaPt2+OXAuRs2yUhitcsDLBV0UlOQ8xH+hzWANyhaJAS7p0k35
kyFOG+n6+2qQkGdlHHuqEzdCL3EiOiK6RrvbWNUnwiG3BdZWgs43hZZBAseX3CHu
MM3vIX/Fc/kuuaCWi2ysyKf7jyi/RiVIAKuLbxAB8eHsyo2G5lA=
=3DTP
-----END PGP PUBLIC KEY BLOCK-----
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="verifying-this-post">Verifying This Post</h1>

<p>This key is signed with the previous key; if you have both keys added, you can verify this with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>gpg --keyring /etc/apt/trusted.gpg --list-sigs
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Alternatively, this message is signed by both keys:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

In November 2017, the HHVM project will be migrating from GPG key 0x1BE7A449, with fingerprint:

36AE F64D 0207 E7EE E352  D487 5A16 E728 1BE7 A449

to GPG key 0xD386EB94, with fingerprint:

0583 41C6 8FC8 DE60 17D7  75A1 B411 2585 D386 EB94
-----BEGIN PGP SIGNATURE-----

iQE+BAEBCAAoFiEENq72TQIH5+7jUtSHWhbnKBvnpEkFAloLG/wKHHB0QGZiLmNv
bQAKCRBaFucoG+ekSe/ZB/4tuH5ZgV1whKPgZIlhi9iDdqTEbANT2nuCaCQuSupU
Dfha1KiYYqnZraw2EBDs0Ve6xrfIdhMKEoF7L2yRsWq/2i490Tf1Ug28MWaLiI23
ZqBpmv9djA9l/xi4CjWWjJaI60kZOL4WUzXrwlU6g6GwcObJweBjrZgA0NMrZwQP
F3Ll0czrxXxUS4ujpv5wSwYVGpJ0zZik8krFzb80Ttkum6icYJuTV8/85VEh8qHo
0557G94w8p5iAUNIdYbG510A0WfKe9s/5CEFCDyYuo3igFYipFWPy5/jK2j7F3VU
4LaWbSfzMMyVI746AMr5LJeFFTRi9YhQg9nnwgay+/yNiQJLBAEBCAA1FiEEBYNB
xo/I3mAX13WhtBElhdOG65QFAloLG/wXHG9wZW5zb3VyY2UraGh2bUBmYi5jb20A
CgkQtBElhdOG65R+ag//SVhZyYiJj35UK8rdKe9y53VdJtDQdD4GGJk/Y52c2pAi
xgs5AdHuTwVb+OzPJMUf/HpBFfNR6Ny86LlFEGqJvnWTJ5gVM6iN+UhPqgFBviqN
Xc6U+Ix3XF0vx6fQSNtK8YSP201psV7d7QKvDTaIEt0pm5JkrCp4VCwwiEAK/R0S
RcFh3cghSzCrdYbmr5lX4I6jkjEw/DyjqGsM9ctldNmqxGC55MfYMrx3tw+PiHTx
eivtw6L0X9z4mRJ0ONs9ULjtamurQbHWyVw8CA/BJ89X/1B9mNyLCxJlT5vrlb6a
ctzbowOFH9IviKFMxIqdRdenDOjIvWdvIf6jloT8ibt5s+ZGixf/0rWYzCTdi+fS
cjbuc7DW4Aru2i6DdQb63mXCjhpmEnkX3gvq1b2TYYQSCm7bd6vSwEQmoTUGOkDZ
Jm7sH97WgiOOBw5EmyBM1Coa5OaOq8qWghE5buzFpONA9gBXTxgJRS8lxswC0K5o
od+AhGTEuecVCEl7lIP/N5ASjrEBkEVKsFaGCX0tSDfgqCZW1JJ+WPD+TllUoEfd
m9jEaNjiApKSOxYg94+1M5Mv+BWh3AoEwz5Jm1xFnVhEocPqhX5Bh53OEfVWoPNX
Po7IgHHd574CLddZrzCslCsnhISm/ARHA2MZBLhfgl71eqz4nqiSwQ4IkUHEMGQ=
=WORw
-----END PGP SIGNATURE-----
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you have either, you can verify this message by copying the above into a file, then</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>gpg --keyring /etc/apt/trusted.gpg --verify &lt; file_containing_message_above
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you have either existing key, you will see at least 1 “gpg: Good signature” line in the output; unless you have both keys, you will also see “gpg: Can’t check signature: public key not found” for whichever key you do not have installed.</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/10/26/the-hack-standard-library-1-0.html">The Hack Standard Library: v1.0</a></h1>
    <p class="post-meta">发布于 2017 年 10 月 26 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Today, <a href="https://github.com/hhvm/hsl/releases/tag/v1.0.0">we’re releasing</a> the first stable version of the Hack Standard Library. The Hack Standard Library addresses several issues:</p>

<ul>
  <li>existing collection functionality (such as filtering and mapping) either returns PHP arrays, or <a href="https://docs.hhvm.com/hack/collections/introduction">Hack Collection objects</a>; we needed support for <a href="https://docs.hhvm.com/hack/collections/hack-arrays">the new <code class="highlighter-rouge">dict</code>, <code class="highlighter-rouge">keyset</code>, and <code class="highlighter-rouge">vec</code> types</a> (Hack Arrays).</li>
  <li>we want Hack to have a standard library that is internally consistent.</li>
  <li>many PHP builtins can not be typed in Hack, due to intentional restrictions in the type system: parameters that accept multiple types (e.g. <code class="highlighter-rouge">string | object</code>) can only be typed as taking <code class="highlighter-rouge">mixed</code>, and while nullable types are supported (<code class="highlighter-rouge">?sometype</code>), falseable types aren’t - so anything that returns <code class="highlighter-rouge">sometype | false</code> must be typed as returning <code class="highlighter-rouge">mixed</code> in Hack.</li>
  <li>we wanted users to be able to add functionality in a manner consistent with the standard library; this wasn’t possible with Hack Collections where the functionality was defined as methods on builtin objects - any extensions needed to be committed to HHVM.</li>
</ul>

<p>Since v0.1, our priority has been finding and addressing inconsistencies in our API; we’re grateful to our community for helping us with this, and are proud to release v1.0 without any known issues.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/10/26/the-hack-standard-library-1-0.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/09/26/hhvm-3-22.html">HHVM 3.22</a></h1>
    <p class="post-meta">发布于 2017 年 9 月 26 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.22 is released! This release primarily contains bug fixes, performance improvements, and supporting work for future improvements. Packages have been published in the usual places; see the <a href="https://docs.hhvm.com/hhvm/installation/introduction">installation instructions</a> for more information.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/09/26/hhvm-3-22.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/687420433/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Max Wang</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/09/18/the-future-of-hhvm.html">The Future of HHVM</a></h1>
    <p class="post-meta">发布于 2017 年 9 月 18 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Several months ago, PHP <a href="http://php.net/supported-versions.php">officially announced</a> the end-of-life for
PHP5.</p>

<p>The HHVM team is happy about the direction PHP has taken with PHP7, and we’re
proud of the role we’ve played in pushing the language and runtime to where
they are today.  Since the PHP community is finally saying goodbye to PHP5,
we’ve decided to do so as well.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/09/18/the-future-of-hhvm.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/08/02/hhvm-3-21.html">HHVM 3.21</a></h1>
    <p class="post-meta">发布于 2017 年 8 月 2 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.21 is released! As this is an LTS release, it will be supported until HHVM 3.27, expected in 48 weeks. This release improves PHP7 compatibility, and adds several new features. Packages have been published in the usual places; see the
<a href="https://docs.hhvm.com/hhvm/installation/introduction">installation instructions</a> for more information.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/08/02/hhvm-3-21.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/1466307364/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Michael O'Farrell</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/06/07/hhvm-3-20.html">HHVM 3.20</a></h1>
    <p class="post-meta">发布于 2017 年 6 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.20 is released!  This release improves compatibility with PHP7, and
adds a couple new features.  Packages have been published in the usual places;
see the
<a href="https://docs.hhvm.com/hhvm/installation/introduction">installation
instructions</a> for more
information.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/06/07/hhvm-3-20.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/1466307364/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Michael O'Farrell</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/04/13/hhvm-3-19.html">HHVM 3.19</a></h1>
    <p class="post-meta">发布于 2017 年 4 月 13 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.19 is released!  This release has some exciting new experimental
features.  Packages have been published in the usual places; see the
<a href="https://docs.hhvm.com/hhvm/installation/introduction">installation
instructions</a> for more
information.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/04/13/hhvm-3-19.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/4807028/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Brett Simmers</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/03/23/concurrent-jit-compilation.html">Concurrent JIT Compilation</a></h1>
    <p class="post-meta">发布于 2017 年 3 月 23 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM’s JIT is responsible for translating sequences of <a href="https://github.com/facebook/hhvm/blob/436a0ea3bc07475fe66764a12f43b9706aace56a/hphp/doc/bytecode.specification">HipHop Bytecode (HHBC)</a> into equivalent sequences of machine code in order to execute PHP code as efficiently as possible. When running in server mode, HHVM shares this generated code across the many different threads executing PHP requests. Up until about a year ago, the JIT had a global “write lease,” which prevented multiple threads from running the JIT concurrently. This decision was made primarily to improve the layout of the generated code, but also to reduce implementation complexity. The project was still unproven, and we had to balance between shipping a perfect system and never shipping anything.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/03/23/concurrent-jit-compilation.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/687420433/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Max Wang</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/03/09/how-the-cyber-elephant-got-his-arm.html">How the Cyber-Elephant Got His ARM</a></h1>
    <p class="post-meta">发布于 2017 年 3 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM is now fully-functional on ARM hardware!  This post tells the story of how
our ARM port came to be.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/03/09/how-the-cyber-elephant-got-his-arm.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/565323207/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Guilherme Ottoni</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/02/17/region-jit.html">HHVM's Profile-guided Region JIT</a></h1>
    <p class="post-meta">发布于 2017 年 2 月 17 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Our initial version of the HHVM JIT didn’t use profile-guided
optimizations, and we suspected that we were leaving performance on
the table because of that. After <a href="http://hhvm.com/blog/2027/faster-and-cheaper-the-evolution-of-the-hhvm-jit">adding HHIR and beefing up the JIT
backend</a>
in 2013, a couple of us embarked on the journey of building a
profiling mechanism and leveraging it to improve the JIT’s
optimizations and HHVM’s performance. 
</p>

      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/02/17/region-jit.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/1466307364/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Michael O'Farrell</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/02/15/hhvm-3-18.html">HHVM 3.18</a></h1>
    <p class="post-meta">发布于 2017 年 2 月 15 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.18 LTS is released!   This version will be the last to support GCC 4.8 and Ubuntu 14.04 Trusty.  Packages have been published; see the <a href="https://docs.hhvm.com/hhvm/installation/introduction">installation instructions</a> for more information.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/02/15/hhvm-3-18.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/1466307364/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Michael O'Farrell</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2017/01/26/new-year-new-me.html">New Year, New Me</a></h1>
    <p class="post-meta">发布于 2017 年 1 月 26 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We recently finished our start-of-the-year planning, and here are some of the HHVM open source goals for the first half of 2017. Want to influence our priorities for the coming months? Fill out this <a href="https://www.surveymonkey.com/r/FZH7YY5">survey</a> .</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2017/01/26/new-year-new-me.html" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/843172280/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Bissonette</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/11711/hhvm-3-15">HHVM 3.15</a></h1>
    <p class="post-meta">发布于 2016 年 9 月 15 日</p>
  </header>

  <article class="post-content">
  
    
      <p>The next LTS release of HHVM has been cut and packages are now available for Ubuntu 14.04, 15.04, 15.10, and 16.04; and Debian 7 and 8. This release replaces the 3.9 LTS and brings with it a host of improvements and new features.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/11711/hhvm-3-15" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/10925/improved-user-documentation">Improved User Documentation</a></h1>
    <p class="post-meta">发布于 2015 年 12 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We are happy to announce our next generation of Hack and HHVM user documentation available at <a href="http://docs.hhvm.com">http://docs.hhvm.com</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/10925/improved-user-documentation" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/10859/php-7-support">PHP 7 Support</a></h1>
    <p class="post-meta">发布于 2015 年 12 月 4 日</p>
  </header>

  <article class="post-content">
  
    
      <p>For those that haven’t been following along, the next version of the PHP language, version 7.0.0, <a href="http://php.net/archive/2015.php#id2015-12-03-1">was very recently released</a>. Those of us working on HHVM offer our congratulations to all the contributors to this latest release! We’re all really excited to see this release come out the door, and for what it means for the future of PHP.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/10859/php-7-support" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/712073/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Dwayne Reeves</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/10649/improving-arrays-in-hack">Improving Arrays in Hack</a></h1>
    <p class="post-meta">发布于 2015 年 10 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <blockquote>
  <p>“<em>…use collections whenever and wherever possible. However, 100% usage of collections is obviously not realistic given how much arrays are used in various codebases …there just may be legitimate use cases for an array</em>”</p>
</blockquote>

<p>This is the guidance given to Hack developers on using arrays. While we still advise using collections whenever possible, in hindsight there are more “legitimate use cases” for arrays than we first believed. With that in mind, the team is planning on improving arrays so they are better supported in Hack. We’ve opened a number of issues on GitHub (<a href="https://github.com/facebook/hhvm/issues/6451">#6451</a>, <a href="https://github.com/facebook/hhvm/issues/6452">#6452</a>, <a href="https://github.com/facebook/hhvm/issues/6453">#6453</a>, <a href="https://github.com/facebook/hhvm/issues/6454">#6454</a>, <a href="https://github.com/facebook/hhvm/issues/6455">#6455</a>) with our initial plans. Since this would be a significant change in the language we are looking for feedback from the community. Before diving into what we are thinking of building, let’s take some time to examine the problem we want to solve.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/10649/improving-arrays-in-hack" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/4807028/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Brett Simmers</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/10205/llvm-code-generation-in-hhvm">LLVM Code Generation in HHVM</a></h1>
    <p class="post-meta">发布于 2015 年 10 月 23 日</p>
  </header>

  <article class="post-content">
  
    
      <p>One of the most common questions we get about HHVM is why we don’t use LLVM for code generation. The primary reason has always been that while LLVM is great at optimizing C, C++, Objective-C, and other similar statically-typed languages, PHP is dynamically typed. The kinds of optimizations that provide huge performance benefits for static languages tend to be less useful in dynamic languages, or at least overshadowed by all the dynamic dispatching that’s done based on runtime types. We knew that there was probably something to be gained from using LLVM as a backend, but there were many larger opportunities go after first.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/10205/llvm-code-generation-in-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/10379/hhvm-3-10-0">HHVM 3.10.0</a></h1>
    <p class="post-meta">发布于 2015 年 10 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM 3.10.0 is out! You can <a href="https://github.com/facebook/hhvm/wiki/Prebuilt-Packages-for-HHVM">get it from the usual places</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/10379/hhvm-3-10-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/10043/experimental-mac-os-x-support">Experimental Mac OS X Support</a></h1>
    <p class="post-meta">发布于 2015 年 8 月 31 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We’re happy to announce official Mac OS X support in HHVM, with version 3.9! If you use <a href="http://brew.sh/">Homebrew</a> and want to get started now, the steps to use our <a href="https://github.com/hhvm/homebrew-hhvm">official tap</a> are really simple:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="rougeHighlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>brew tap hhvm/hhvm
<span class="nv">$ </span>brew install hhvm
</pre></td></tr></tbody></table></code></pre></div></div>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/10043/experimental-mac-os-x-support" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/843172280/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Bissonette</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/9995/hhvm-3-9-0">HHVM 3.9.0</a></h1>
    <p class="post-meta">发布于 2015 年 8 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We’re happy to announce that <a href="https://github.com/facebook/hhvm/tree/HHVM-3.9.0">HHVM 3.9.0</a> is now available. You can try one of our <a href="https://github.com/facebook/hhvm/wiki/Prebuilt-Packages-for-HHVM">prebuilt packages for Ubuntu and Debian</a>, or <a href="https://github.com/facebook/hhvm/wiki/Building-and-Installing-HHVM">build from source</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/9995/hhvm-3-9-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/9803/hhvm-3-8-0">HHVM 3.8.0</a></h1>
    <p class="post-meta">发布于 2015 年 7 月 13 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We’re happy to announce that <a href="https://github.com/facebook/hhvm/tree/HHVM-3.8.0">HHVM 3.8.0</a> is finally available. You can, as always, try one of our <a href="https://github.com/facebook/hhvm/wiki/Prebuilt-Packages-for-HHVM">prebuilt packages for Ubuntu and Debian</a>, or <a href="https://github.com/facebook/hhvm/wiki/Building-and-Installing-HHVM">build from source</a>. (As of this writing, the packages are still building, so if a 3.8.0 package isn’t available for your supported distro, hold tight!)</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/9803/hhvm-3-8-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/9773/cve-2015-4663">CVE-2015-4663</a></h1>
    <p class="post-meta">发布于 2015 年 7 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We just released HHVM versions 3.3.7, 3.6.5, and 3.7.3 which <a href="https://github.com/facebook/hhvm/commit/e282a459188a472e177b45ad2d2989289294df74">fix CVE-2015-4663</a>, a serious issue affecting SSL/TLS certificate validation. Note that the issue affects <code class="highlighter-rouge">file_get_contents</code>, the stream API, etc, but does <em>not</em> affect anything using the cURL API directly.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/9773/cve-2015-4663" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/100001715741794/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Kasper Kopec</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/9581/trait-and-interface-requirements-in-hack">Trait and interface requirements in Hack</a></h1>
    <p class="post-meta">发布于 2015 年 6 月 16 日</p>
  </header>

  <article class="post-content">
  
    
      <p>In PHP, <a href="http://docs.hhvm.com/manual/en/hack.traits.php">traits</a> are a mechanism of code reuse that, while very powerful, are also difficult to type check both efficiently and exhaustively. In this post we’ll dive more deeply into the reasons for that and see how Hack solves those problems, allowing you to use traits in a safe way without limiting their expressiveness.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/9581/trait-and-interface-requirements-in-hack" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/843172280/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Bissonette</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/9293/lockdown-results-and-hhvm-performance">Lockdown Results and HHVM Performance</a></h1>
    <p class="post-meta">发布于 2015 年 6 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>The HHVM team has concluded its first ever open source performance lockdown, and we’re very excited to share the results with you. During our two week lockdown, we’ve made strides optimizing builtin functions, dynamic properties, string concatenation, and the file cache. In addition to improving HHVM, we also looked for places in the open source frameworks where we could contribute patches that would benefit all engines. Our efforts centered around maximizing requests per second (RPS) with Wordpress, Drupal 7, and MediaWiki, using our <a href="https://github.com/hhvm/oss-performance">oss-performance</a> benchmarking tool.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/9293/lockdown-results-and-hhvm-performance" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/713515/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Jez Ng</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/9215/covariance-contravariance-and-super-type-constraints">Covariance, Contravariance, and super Type Constraints</a></h1>
    <p class="post-meta">发布于 2015 年 5 月 28 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Hack has recently enhanced its generics with two features: variance annotations and <code class="highlighter-rouge">super</code> type constraints. In this post, I’ll explain how they work and why they were added.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/9215/covariance-contravariance-and-super-type-constraints" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/843172280/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Bissonette</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/9089/hhvm-lockdown">HHVM Lockdown</a></h1>
    <p class="post-meta">发布于 2015 年 5 月 8 日</p>
  </header>

  <article class="post-content">
  
    
      <p><img src="/static/images/posts/10537187_10152729686506660_886816697495269948_o-1.jpg" alt="Neon Lockdown Sign" /></p>

<p>It’s that time of year again! Next week the HHVM Open Source team is beginning a lockdown. The next two weeks will feature beards, long hours, and performance wins. We’re excited to announce that this will be our first ever open source performance lockdown.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/9089/hhvm-lockdown" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/9059/hhvm-3-7-0">HHVM 3.7.0</a></h1>
    <p class="post-meta">发布于 2015 年 5 月 4 日</p>
  </header>

  <article class="post-content">
  
    
      <p>As some of you have no doubt noticed, <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">HHVM 3.7.0</a> has been out now for a few days. It comprises the internal “Earle”, “Fry”, “Gadd”, and “Harris” releases.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/9059/hhvm-3-7-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/4807591/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Owen Yamauchi</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/8981/announcing-our-book-hack-hhvm">Announcing our book: “Hack & HHVM”</a></h1>
    <p class="post-meta">发布于 2015 年 4 月 23 日</p>
  </header>

  <article class="post-content">
  
    
      <p><img src="/static/images/posts/rc_cat.gif" alt="Book cover" /></p>

<p>We’d like to get more developers in the community using Hack. But we know there’s been something lacking: a good, consolidated resource for learning Hack and getting the most use out of it. We have documentation online, but it’s more of a reference than a tutorial.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/8981/announcing-our-book-hack-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/8939/etsys-transition-to-hhvm">Etsy's Transition to HHVM</a></h1>
    <p class="post-meta">发布于 2015 年 4 月 6 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Dan Miller, an engineer at Etsy, wrote an <a href="https://codeascraft.com/2015/04/06/experimenting-with-hhvm-at-etsy/">extensive blog post detailing Etsy’s transition to HHVM</a> on some of their production servers.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/8939/etsys-transition-to-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/8849/hhvm-3-6-0">HHVM 3.6.0</a></h1>
    <p class="post-meta">发布于 2015 年 3 月 11 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Announcing the immediate release of <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">HHVM 3.6.0</a>. built upon our internal “Ballmer”, “Colbert”, and “Ditko” releases. This represents our second official LTS release following 6 months after the release of <a href="http://hhvm.com/blog/6239/hhvm-3-3-0">HHVM 3.3</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/8849/hhvm-3-6-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/8537/announcing-a-specification-for-hack">Announcing a Specification for Hack</a></h1>
    <p class="post-meta">发布于 2015 年 2 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p><img src="/static/images/posts/Screenshot-2015-02-18-10.07.47.png" alt="Hack Logo" /></p>

<p>Today we are excited to announce the availability of the <a href="https://github.com/hhvm/hack-langspec/blob/master/spec/00-specification-for-hack.md">initial specification for the Hack programming language</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/8537/announcing-a-specification-for-hack" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/8405/coming-soon-in-hhvm">Coming Soon in HHVM</a></h1>
    <p class="post-meta">发布于 2015 年 2 月 17 日</p>
  </header>

  <article class="post-content">
  
    
      <p>The next HHVM release, 3.6, is on the horizon. We expect it to be released <a href="https://github.com/facebook/hhvm/wiki/Release%20Schedule">at the very end of February or in early March</a>. It’s going to be a big release. Not only will it be our second release with <a href="https://github.com/facebook/hhvm/wiki/Long-term-support-%28LTS%29">long-term support</a>, but it will contain several exciting new features – and lay the groundwork for continued development later this year.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/8405/coming-soon-in-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/7637/hhvm-3-5-0">HHVM 3.5.0</a></h1>
    <p class="post-meta">发布于 2015 年 1 月 20 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We have released <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">HHVM 3.5.0</a> – get it while it’s hot! It contains updates from the “Xzibit”, “Yelawolf”, and “Z*” internal branches – the last of the 2014 rapper theme. It also contains updates from the “Austin” internal branch, the first of the new 2015 theme. (Anyone want to guess at what the new theme is?)</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/7637/hhvm-3-5-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/4807028/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Brett Simmers</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/7205/wikipedia-on-hhvm">Wikipedia on HHVM</a></h1>
    <p class="post-meta">发布于 2015 年 1 月 6 日</p>
  </header>

  <article class="post-content">
  
    
      <p>If you’ve been watching our <a href="https://github.com/facebook/hhvm/wiki/Users">GitHub wiki</a>, <a href="https://twitter.com/HipHopVM/status/542386731300163585">following us on Twitter</a>, or reading the wikitech-l <a href="https://lists.wikimedia.org/pipermail/wikitech-l/2014-December/079720.html">mailing</a> <a href="https://lists.wikimedia.org/pipermail/wikitech-l/2014-December/079795.html">list</a>, you’ve probably known for a while that <a href="http://www.wikipedia.org/">Wikipedia</a> has been transitioning to HHVM. This has been a long process involving lots of work from many different people, and as of a few weeks ago, all non-cached API and web traffic is being served by HHVM. <a href="https://blog.wikimedia.org/2014/12/29/how-we-made-editing-wikipedia-twice-as-fast/">This blog post</a> from the Wikimedia Foundation contains some details about the switch, as does their <a href="https://www.mediawiki.org/wiki/HHVM">page about HHVM</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/7205/wikipedia-on-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/7349/lts-updates">LTS Updates</a></h1>
    <p class="post-meta">发布于 2015 年 1 月 6 日</p>
  </header>

  <article class="post-content">
  
    
      <p>I just pushed HHVM 3.3.2 (and 3.4.2) onto the Debian and Ubuntu repositories. It contains fixes backported from PHP for several security issues that HHVM was also vulnerable to, as well as a fix for CVE-2014-9370, which is a header injection issue affecting only the deprecated built-in webserver. Most users of HHVM use FastCGI, which was not affected by CVE-2014-9370.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/7349/lts-updates" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/7091/async-cooperative-multitasking-for-hack">Async - Cooperative Multitasking for Hack</a></h1>
    <p class="post-meta">发布于 2014 年 12 月 5 日</p>
  </header>

  <article class="post-content">
  
    
      <p>For several months now, Hack has had a feature available called <code class="highlighter-rouge">async</code> which enables writing code that cooperatively multitasks. This is somewhat similar to threading, in that multiple code paths are executed in parallel, however it avoids the lock contention issues common to multithreaded code by only actually executing one section at any given moment.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/7091/async-cooperative-multitasking-for-hack" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6989/wp-engine-and-box-now-use-hhvm">WP Engine and Box now use HHVM</a></h1>
    <p class="post-meta">发布于 2014 年 11 月 20 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Two big announcements back to back.</p>

<p><a href="http://tech.blog.box.com/2014/11/box-on-hhvm/">Box announced</a> that they did their cutover to HHVM yesterday seeing their latency drop by <strong>3x</strong>. I did a <a href="https://tech.blog.box.com/2014/11/hhvm-q-and-a/">Q &amp; A about HHVM</a> today.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6989/wp-engine-and-box-now-use-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6899/hhvm-3-4-0">HHVM 3.4.0</a></h1>
    <p class="post-meta">发布于 2014 年 11 月 20 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We have released <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">HHVM 3.4.0</a>, the first minor point release after our HHVM 3.3.0 LTS. This branch contains updates from our T-Pain, Ultramagnetic, Vanilla Ice and Will.i.am internal releases.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6899/hhvm-3-4-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6863/announcing-the-hack-transpiler">Announcing the Hack Transpiler</a></h1>
    <p class="post-meta">发布于 2014 年 11 月 11 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We’re proud to announce the first experimental release of the Hack Transpiler, a tool which allows projects that have converted from PHP to Hack to still make releases that target the PHP language. <a href="https://code.facebook.com/posts/398235553660954/announcing-the-hack-transpiler/">You can read the full announcement at code.facebook.com</a>, or <a href="http://docs.hhvm.com/manual/en/install.hack.h2tp.php">take a look at the documentation for the tool</a>. It’s available in any <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">nightly package</a> dated today or later. It’s still experimental, so try it out and let us know how it goes!</p>

    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6473/hack-overriding-constructors-new-static-and-__consistentconstruct">Hack: Overriding Constructors, "new static", and __ConsistentConstruct</a></h1>
    <p class="post-meta">发布于 2014 年 10 月 29 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A recent addition to Hack is the <code class="highlighter-rouge">__ConsistentConstruct</code> attribute, which allows <code class="highlighter-rouge">new static()</code> to be safely, properly typed. The need for this special attribute first requires some background in how method overriding and polymorphism normally work, and how constructors are special.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6473/hack-overriding-constructors-new-static-and-__consistentconstruct" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6767/hhvm-3-3-1">HHVM 3.3.1</a></h1>
    <p class="post-meta">发布于 2014 年 10 月 28 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Today we released <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">HHVM 3.3.1</a>, our first update to our <a href="http://hhvm.com/blog/6083/hhvm-long-term-support">long term support</a> release. This includes <a href="https://github.com/facebook/hhvm/compare/HHVM-3.3.0...HHVM-3.3.1">30 commits</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6767/hhvm-3-3-1" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6515/using-xhp-with-bootstrap">Using XHP with Bootstrap</a></h1>
    <p class="post-meta">发布于 2014 年 10 月 23 日</p>
  </header>

  <article class="post-content">
  
    
      <p><img src="/static/images/posts/xhpbootstrap_logo_blacktext.png" alt="xhpbootstrap_logo_blacktext" /></p>

<p><a href="https://github.com/facebook/xhp">XHP</a> is a great way to safely create HTML user interfaces from PHP or Hack. We love how extensible it is, allowing you to create your own pseudo-elements that are composed of more basic building blocks - ultimately a series of HTML tags. This solves a similar problem to partial templates in other systems. At its most basic level, XHP provides an XML-like syntax for creating stringable objects representing markup:</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6515/using-xhp-with-bootstrap" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6443/hack-recent-updates">Hack: Recent Updates</a></h1>
    <p class="post-meta">发布于 2014 年 10 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A lot has happened since we announced Hack. We’ve already highlighted our <a href="https://www.youtube.com/playlist?list=PLb0IAmt7-GS2fdbb1vVdP8Z8zx1l2L8YS">Hack developer day</a>, as well as posting a series of community roundups (<a href="http://hhvm.com/blog/4811/hack-community-roundup">one</a>, <a href="http://hhvm.com/blog/5429/hack-community-roundup-2">two</a>, <a href="http://hhvm.com/blog/6005/hack-community-roundup-3">three</a>) highlighting the projects that our amazing Hack community have been building.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6443/hack-recent-updates" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6323/the-journey-of-a-thousand-bytecodes">The Journey of a Thousand Bytecodes</a></h1>
    <p class="post-meta">发布于 2014 年 10 月 3 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Compilers are fun.  They take nice, human readable languages like PHP or Hack and turn them into lean, mean, CPU executin’ turing machines.  Some of these are simple enough a CS student can write one up in a weekend, some are the products of decades of fine tuning and careful architecting.  Somewhere in that proud tradition stands HHVM; In fact it’s several compilers stacked in an ever-growing chain of logic manipulation and abstractions.  This article will attempt to take the reader through the HHVM compilation process from PHP-script to x86 machine code, one step at a time.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6323/the-journey-of-a-thousand-bytecodes" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6239/hhvm-3-3-0">HHVM 3.3.0</a></h1>
    <p class="post-meta">发布于 2014 年 9 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Today we released <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">HHVM 3.3.0</a>, the first of our releases with <a href="http://hhvm.com/blog/6083/hhvm-long-term-support">long term support</a> (until the August 13th 2015 release - potentially 3.9); some of the highlights:</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6239/hhvm-3-3-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/637610358/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">David Martinez</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6083/hhvm-long-term-support">HHVM Long Term Support</a></h1>
    <p class="post-meta">发布于 2014 年 9 月 2 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM is known for its very intense and quick development pace: currently we ship to GitHub the exact same code we use to run the Facebook site within minutes of every commit, and we release a full version every 8 weeks. That is great and at the same time scary if you are trying to build a business or infrastructure around it.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6083/hhvm-long-term-support" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/6005/hack-community-roundup-3">Hack Community Roundup #3</a></h1>
    <p class="post-meta">发布于 2014 年 8 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p>As always, I’m really excited to see what our community has been building and saying, and really exited to share what I’ve seen with everyone!</p>

<p><img src="/static/logo.svg" alt="Hack Logo" style="width: 200px;" /></p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/6005/hack-community-roundup-3" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/5723/announcing-a-specification-for-php">Announcing a specification for PHP</a></h1>
    <p class="post-meta">发布于 2014 年 7 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p><img src="/static/images/posts/PHP-logo2.png" alt="PHP-logo" /></p>

<p>The PHP language has been around for over 20 years and is clearly one of the most popular programming languages in the world. PHP is definitely the <a href="http://php.net/usage.php">lingua-franca <del>of the internet</del> for server-side web programming</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/5723/announcing-a-specification-for-php" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/5609/hhvm-3-2-0">HHVM 3.2.0</a></h1>
    <p class="post-meta">发布于 2014 年 7 月 23 日</p>
  </header>

  <article class="post-content">
  
    
      <p>The <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">next version of HHVM</a> is out (well it came out 6 days ago, I’ve just been at <a href="http://www.oscon.com/oscon2014/public/schedule/detail/34640">OSCON</a> all week and haven’t had a chance to do this post).</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/5609/hhvm-3-2-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/5399/faster-github-commits">Faster GitHub Commits</a></h1>
    <p class="post-meta">发布于 2014 年 7 月 8 日</p>
  </header>

  <article class="post-content">
  
    
      <p>The HHVM community is awesome, particularly when it comes to directly helping us fix HHVM through <a href="https://github.com/facebook/hhvm/pulls?direction=desc&amp;page=1&amp;sort=created&amp;state=closed">pull requests</a>. Until now, the actual pushing of commits (both our internal code and your pull requests) back to the <a href="https://github.com/facebook/hhvm/commits/master">master HHVM branch on GitHub</a> has been a manual process, and takes more time than we would prefer (and I am sure may have frustrated you from time to time).</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/5399/faster-github-commits" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/5429/hack-community-roundup-2">Hack Community Roundup #2</a></h1>
    <p class="post-meta">发布于 2014 年 6 月 25 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Since the <a href="http://hhvm.com/blog/4811/hack-community-roundup">last roundup</a>, our community has continued to produce some really cool projects using Hack. I’m really excited to have another long list to share with all of you!</p>

<p><img src="/static/logo.svg" alt="Hack Logo" style="width: 200px;" /></p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/5429/hack-community-roundup-2" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/5195/hhvm-3-1-0">HHVM 3.1.0</a></h1>
    <p class="post-meta">发布于 2014 年 5 月 29 日</p>
  </header>

  <article class="post-content">
  
    
      <p>The <a href="https://github.com/facebook/hhvm/wiki/Prebuilt%20Packages%20for%20HHVM">next version of HHVM</a> is hot off the press. After a few delays, we finally tracked down the <a href="https://github.com/facebook/hhvm/commit/be654dd35a50b0c5a6918b376b5d168fdd00be25">segfault</a>. We fixed it in master, but turning off the optimizations was safer for the release. Thanks for your patience.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/5195/hhvm-3-1-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/730116970/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Josh Watzman</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4811/hack-community-roundup">Hack Community Roundup</a></h1>
    <p class="post-meta">发布于 2014 年 5 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>In the weeks since the Hack open source launch and the Hack developer day, there has been a lot of information, code, blog posts, etc coming from our nascent community. To us on the team, it’s been incredible and encouraging to see the community reception to Hack. Here are some of the highlights of the things we’ve seen come out of our community. (And we almost certainly haven’t seen everything, so please let us know in the comments what we’ve missed!)</p>

<p><img src="/static/logo.svg" alt="Hack Logo" style="width: 200px;" /></p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4811/hack-community-roundup" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4841/compatibility-update">Compatibility Update</a></h1>
    <p class="post-meta">发布于 2014 年 4 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p><a href="http://hhvm.com/blog/3743/hhvm-the-next-six-months">Earlier this year</a> we set an ambitious goal of passing the PHPUnit test suites of 20 popular frameworks by the end of June; at the time, we were passing on only 6! With a huge amount of help from the community (especially our <a href="https://www.facebook.com/OpenAcademyProgram">OpenAcademy</a> students), we’re proud to have hit this goal more than 2 months early, and we have more frameworks expected to reach 100% shortly.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4841/compatibility-update" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4685/hack-developer-day-2014-keep-hacking">Hack Developer Day 2014: Keep Hacking</a></h1>
    <p class="post-meta">发布于 2014 年 4 月 10 日</p>
  </header>

  <article class="post-content">
  
    
      <p>A few weeks ago, the Hack language was <a href="http://hhvm.com/blog/4223/introducing-hack-a-programming-language-for-hhvm">launched to the world</a>. Yesterday, we held the first <a href="https://www.facebook.com/groups/hackdevday14/">Hack Developer Day</a> in Menlo Park, California. 150+ Members of the PHP and developer community came to Facebook headquarters and joined over 2000 people online for presentations by the engineers of Hack and HHVM. Afterwards we held a five hour hackathon, where the attendees worked with those engineers to write Hack code, either by converting current codebases or writing new code from scratch. By the way, bonus points to anyone who can decrypt the <a href="https://github.com/facebook/hhvm/commit/d50dd15bc34c60a4bcc02dc6bd95fdf32effc54b">commit message</a> used when <a href="https://github.com/jwatzman">Josh</a> originally pushed Hack to open source.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4685/hack-developer-day-2014-keep-hacking" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4601/debug-packages">Debug Packages</a></h1>
    <p class="post-meta">发布于 2014 年 4 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p><img src="/static/images/posts/1218.png" alt="" /></p>

<p>We try our best to be a stable dependable runtime, but if you are reaching into the deep dark abyss of the PHP language, you might stumble upon a dark corner where we segfault or assert. First of all, we are sorry. Secondly, we would love you to <a href="https://github.com/facebook/hhvm/issues">report the issue</a>, and if you can put together a small test case that is best. If it only reproduces under the full moon when you hold your head to the side and hop on one leg, then a stacktrace would be next best.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4601/debug-packages" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4349/hhvm-3-0-0">HHVM 3.0.0</a></h1>
    <p class="post-meta">发布于 2014 年 3 月 28 日</p>
  </header>

  <article class="post-content">
  
    
      <p>This is a fun one! :)</p>

<p>At our last major version bump (2.0.0), we basically became a whole new project. We switched from a “PHP -&gt; C++” translator to a virtual machine. This version bump (3.0.0) is a much less dramatic code shift (we’re still a VM, don’t worry), but this time the big announcement is that we support a new language, <a href="http://hacklang.org/">Hack</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4349/hhvm-3-0-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4325/hacking-hack-on-heroku">Hacking Hack on Heroku</a></h1>
    <p class="post-meta">发布于 2014 年 3 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Yesterday, after our <a href="http://hhvm.com/blog/4223/introducing-hack-a-programming-language-for-hhvm">Hack announcement,</a> we sat down with the heroku team to get Hack working on Heroku. And success! Read all about it over on the <a href="https://blog.heroku.com/archives/2014/3/21/hacking_hack_on_heroku">heroku blog</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4325/hacking-hack-on-heroku" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/1007146370/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Julien Verlaguet</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4223/introducing-hack-a-programming-language-for-hhvm">Introducing Hack - A Programming Language for HHVM</a></h1>
    <p class="post-meta">发布于 2014 年 3 月 20 日</p>
  </header>

  <article class="post-content">
  
    
      <p>As you <a href="https://code.facebook.com/posts/264544830379293/hack-a-new-programming-language-for-hhvm/">may have heard or seen already</a>, the <a href="http://hacklang.org">Hack programming language</a> has been released for HHVM. Hack reconciles the fast development cycle of PHP with the discipline provided by static typing, while adding many features commonly found in other modern programming languages.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4223/introducing-hack-a-programming-language-for-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4103/hhvm-2-4-2">HHVM 2.4.2</a></h1>
    <p class="post-meta">发布于 2014 年 3 月 8 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We haven’t done posts for point releases since our normal <a href="https://github.com/facebook/hhvm/wiki/Release-Schedule">release schedule</a> is so quick, but when there is a security fix we thought you should know as soon as possible.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4103/hhvm-2-4-2" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/509801880/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Fred Emmott</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/3611/tracking-parity">Tracking Parity</a></h1>
    <p class="post-meta">发布于 2014 年 3 月 3 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM has a <a href="https://github.com/facebook/hhvm/tree/master/hphp/test">large suite of unit tests</a> that must pass in several build configurations before a commit reaches master. Unfortunately, this test suite passing doesn’t tell you if HHVM can be used for anything useful - so we periodically run the test suites for popular, open source frameworks.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/3611/tracking-parity" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/690267162/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Emil Hesslow</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/3689/implementing-mysqli">Implementing MySQLi</a></h1>
    <p class="post-meta">发布于 2014 年 2 月 26 日</p>
  </header>

  <article class="post-content">
  
    
      <p>I joined the HHVM team right before Christmas for a <a href="https://www.facebook.com/notes/facebook-engineering/hackamonth-mixing-things-up/10150161285048920">hackamonth</a> (or, in my case, a hack-a-two-months).</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/3689/implementing-mysqli" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/632326971/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Pobar</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/3743/hhvm-the-next-six-months">HHVM: The Next Six Months</a></h1>
    <p class="post-meta">发布于 2014 年 2 月 25 日</p>
  </header>

  <article class="post-content">
  
    
      <p>The HHVM team has just wrapped up its planning for the first half of 2014. We’d like to share our plans, providing you a bit of context.</p>

<p><strong>2014 Themes:</strong></p>

<ul>
  <li>
    <p>Open Source</p>
  </li>
  <li>
    <p>Increase Web Efficiency</p>
  </li>
  <li>
    <p>Make HHVM Hackable</p>
  </li>
</ul>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/3743/hhvm-the-next-six-months" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/3287/hhvm-2-4-0">HHVM 2.4.0</a></h1>
    <p class="post-meta">发布于 2014 年 2 月 1 日</p>
  </header>

  <article class="post-content">
  
    
      <p>It is that wonderful time again for an HHVM release. We’re sticking to our <a href="https://github.com/facebook/hhvm/wiki/Release-Schedule">8 week release</a> cadence to keep everything fresh and in your hands. Also, remember you can run the <a href="http://www.hhvm.com/blog/3203/nightly-packages">nightly packages</a> if you want a bleeding edge feature.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/3287/hhvm-2-4-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/3203/nightly-packages">Nightly Packages</a></h1>
    <p class="post-meta">发布于 2014 年 1 月 21 日</p>
  </header>

  <article class="post-content">
  
    
      <p>If you just can’t wait to get your hands on the latest HHVM code, but you don’t want to spend the time to compile it, we have a present for you.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/3203/nightly-packages" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2813/we-are-the-98-5-and-the-16">We are the 98.5% (and the 16%)</a></h1>
    <p class="post-meta">发布于 2013 年 12 月 19 日</p>
  </header>

  <article class="post-content">
  
    
      <p>On November 4th, the HHVM team went on a <a href="http://www.hhvm.com/blog/1499/locking-down-for-performance-and-parity">3-week performance and parity lockdown</a>. The lockdown officially ended on November 22nd. Overall, this lockdown was a qualified success. Success was measured on 3 vectors:</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2813/we-are-the-98-5-and-the-16" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/659488068/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Julek Kopczewski</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/1817/fastercgi-with-hhvm">FasterCGI with HHVM</a></h1>
    <p class="post-meta">发布于 2013 年 12 月 17 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Today, we are happy to announce <a href="http://www.fastcgi.com/drupal/">FastCGI</a> support for HHVM. FastCGI is a popular protocol for communication between an application server (e.g. running your PHP code) and a webserver. With support for FastCGI, you will be able to run HHVM behind any <a href="http://en.wikipedia.org/wiki/FastCGI#Web_Servers_that_implement_FastCGI">popular web server</a> (Apache, Nginx, Lighttpd, etc). The webserver is in charge of handling all the intricate details of the HTTP protocol. HHVM is in charge of what it does best, running PHP code blazingly fast.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/1817/fastercgi-with-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2393/hhvm-2-3-0-and-travis-ci">HHVM 2.3.0 and Travis CI</a></h1>
    <p class="post-meta">发布于 2013 年 12 月 13 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We released a new version of HHVM today. This one includes all the hard work from our lockdown (detailed post to follow) and the ability to use <a href="http://www.hhvm.com/blog/1817/fastercgi-with-hhvm">HHVM with FastCGI</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2393/hhvm-2-3-0-and-travis-ci" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/4807028/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Brett Simmers</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/2027/faster-and-cheaper-the-evolution-of-the-hhvm-jit">Faster and Cheaper: The Evolution of the hhvm JIT</a></h1>
    <p class="post-meta">发布于 2013 年 12 月 11 日</p>
  </header>

  <article class="post-content">
  
    
      <p>When the hhvm project was started almost 4 years ago, it had a two-part mandate: First, create a PHP <a href="http://en.wikipedia.org/wiki/Just-in-time_compilation">JIT</a> that could serve <a href="https://www.facebook.com/">facebook.com</a> at least as efficiently as <a href="http://en.wikipedia.org/wiki/HipHop_for_PHP#History_Before_HHVM">hphpc</a>, the PHP execution engine we were using at the time. Second, replace hphpi, the interpreter our PHP developers were using in their daily work. hphpc and hphpi were independent pieces of software with unintentional subtle differences in behavior and a significant maintenance burden. Unifying the execution engines used in production and development would make our jobs easier while giving the PHP devs a nicer experience at the same time. We had to find a balance between reaching these goals as quickly as possible and designing a system that could be extended and improved for many years after it replaced hphpc and hphpi. There were also concerns that just in time compilation might not be fast enough to keep up with Facebook’s aggressive deployment process. We were pushing a new version of the site to our fleet of web servers once every weekday, and the whole process took less than 20 minutes. We had to maintain that ability for hhvm to be a viable option. Taking all this into account, the initial JIT design was the simplest and fastest one that we thought had a good chance of succeeding.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/2027/faster-and-cheaper-the-evolution-of-the-hhvm-jit" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/1499/locking-down-for-performance-and-parity">Locking Down for Performance and Parity </a></h1>
    <p class="post-meta">发布于 2013 年 11 月 7 日</p>
  </header>

  <article class="post-content">
  
    
      <p>The HHVM team, along with our wonderful <a href="https://github.com/facebook/hhvm">open source</a> contributors, is constantly trying to <a href="http://www.hhvm.com/blog/1301/hhvm-2-2-0">improve the runtime</a>. We know, however, that there is work to do to <a href="http://www.hhvm.com/blog/875/wow-hhvm-is-fast-too-bad-it-doesnt-run-my-code">run the world’s PHP code reliably and consistently</a>.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/1499/locking-down-for-performance-and-parity" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/1379/hhvm-on-heroku">HHVM on Heroku</a></h1>
    <p class="post-meta">发布于 2013 年 10 月 30 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Do you use <a href="http://heroku.com">heroku</a> to host your PHP app and want to save 2x-10x dynos? Or serve user requests 2x-10x faster? I’m happy to announce that you can now use HHVM on heroku. You should clone your app and try it out before pushing to production as HHVM doesn’t support <a href="http://www.hhvm.com/blog/875/wow-hhvm-is-fast-too-bad-it-doesnt-run-my-code">every possible use of PHP</a> (yet).</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/1379/hhvm-on-heroku" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/1301/hhvm-2-2-0">HHVM 2.2.0</a></h1>
    <p class="post-meta">发布于 2013 年 10 月 18 日</p>
  </header>

  <article class="post-content">
  
    
      <p>We released a new version of HHVM today. A big change is that we are now packaging for many of the popular distros.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/1301/hhvm-2-2-0" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/611217057/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Joel Marcey</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/875/wow-hhvm-is-fast-too-bad-it-doesnt-run-my-code">Wow HHVM is fast...too bad it doesn’t run my code</a></h1>
    <p class="post-meta">发布于 2013 年 9 月 12 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM is a highly performant PHP runtime. In fact, it is nearly 40% faster than <a href="http://en.wikipedia.org/wiki/HipHop_for_PHP#History_Before_HHVM">HPHPc</a>, and only getting faster. For example, the HHVM team just rewrote the JIT to use an <a href="https://github.com/facebook/hiphop-php/blob/master/hphp/doc/ir.specification">SSA intermediate representation (IR)</a>. HHIR (HipHop Intermediate Representation) is a strongly typed, SSA-form intermediate representation, positioned between HHBC (HipHop Bytecode) and machine code. It allows HHVM to perform optimizations that were very difficult to perform with the old JIT, using the context of the current runtime environment (e.g., reference counting elision).</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/875/wow-hhvm-is-fast-too-bad-it-doesnt-run-my-code" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/4807591/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Owen Yamauchi</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/713/hhvm-optimization-tips">HHVM Optimization Tips</a></h1>
    <p class="post-meta">发布于 2013 年 5 月 29 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HHVM’s JIT compiler allows it to execute PHP faster than Zend PHP in most cases, unmodified. However, we’ve gotten some interest from the community in HipHop-specific optimization tips, so I put together a few for this post.</p>

<p>The principle that underlies all of these tips is: write code that HHVM can <em>understand without running</em>. The more HHVM knows before the code runs, the more it can optimize.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/713/hhvm-optimization-tips" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/218471/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Paul Tarjan</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/575/joining-retirement-testing-and-bankruptcy">Joining, Retirement, Testing, and Bankruptcy</a></h1>
    <p class="post-meta">发布于 2013 年 5 月 13 日</p>
  </header>

  <article class="post-content">
  
    
      <p>First of all, hi. I recently joined the team as you could probably see from my <a href="https://github.com/facebook/hiphop-php/graphs/contributors">plethora</a> of commits to github. I first fixed up <a href="https://github.com/facebook/hiphop-php/commit/4d7004e955c764c5e7474c4b366d3606348f61eb">closures a bit</a> and moved our “PHP tests in C++” <a href="https://github.com/facebook/hiphop-php/commit/eca135cb31b54c4e69fc09f73c8756846f18b935">to have one fewer language</a>. I’ll be doing many exciting things for hiphop but I’ll be mostly caring about making it incredibly easy for anyone to use for any PHP code. So please bug me if it doesn’t run your favorite piece of code.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/575/joining-retirement-testing-and-bankruptcy" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/521/the-adminserver">The AdminServer</a></h1>
    <p class="post-meta">发布于 2012 年 12 月 11 日</p>
  </header>

  <article class="post-content">
  
    
      <p>HipHop, if properly configured [1], will actually startup not one, but two http servers.  The first, on port 80 by default, you’re already familiar with.  Requests are translated to filesystem paths, and PHP files are executed to generate content.  The other one, however, you might not have come across yet.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/521/the-adminserver" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/4807591/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Owen Yamauchi</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/431/on-garbage-collection">On Garbage Collection</a></h1>
    <p class="post-meta">发布于 2012 年 11 月 29 日</p>
  </header>

  <article class="post-content">
  
    
      <p>In this post, I’ll expand on a topic that I briefly mentioned in the footnote to my <a href="/wp/?p=311">previous post</a>: memory management.</p>

<p>Most modern programming languages, including PHP, have automatic memory management. Programmers don’t explicitly free the memory they allocate, and the language runtime does that for them. There are a variety of approaches that language runtimes can take to implement this, and they lie on a spectrum.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/431/on-garbage-collection" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/401/spammers-are-still-a-thing-it-seems">Spammers are still a thing, it seems</a></h1>
    <p class="post-meta">发布于 2012 年 11 月 12 日</p>
  </header>

  <article class="post-content">
  
    
      <p>Been getting two or three spam comments/day.  They don’t get through because moderation is enabled.  They are an annoyance however, so I’ll be passing the annoyance on to you, dear reader, in the form of a very simple CAPTCHA.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/401/spammers-are-still-a-thing-it-seems" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/4807591/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Owen Yamauchi</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/311/adding-an-opcode-to-hhbc">Adding an opcode to HHBC</a></h1>
    <p class="post-meta">发布于 2012 年 11 月 9 日</p>
  </header>

  <article class="post-content">
  
    
      <p>As part of our drive to improve HHVM’s performance, I started looking into the general topic of builtin functions. Currently, HHVM is calling implementations of builtin functions that were originally written for HPHPc, the static compiler. We wrote compatibility wrappers around them for HHVM, to get it up and running as quickly as possible. We have evidence that this compatibility layer is hurting HHVM’s performance, so we’re looking at ways to reduce or eliminate its impact.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/311/adding-an-opcode-to-hhbc" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/4061/go-faster">Go Faster!</a></h1>
    <p class="post-meta">发布于 2012 年 10 月 22 日</p>
  </header>

  <article class="post-content">
  
    
      <p>If you’ve looked at my previous entry <a href="http://www.hiphop-php.com/wp/?p=113">Getting Wordpress Running on HHVM</a>, you’ve already got a general idea for how to create a <em>config.hdf</em> file and get a web server up and running. Now you want to make sure it’s running as quickly, and efficiently as possible. But first, it’s worth understanding how HHVM runs your PHP scripts.</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/4061/go-faster" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/3095/getting-wordpress-running-on-hhvm">Getting WordPress running on HHVM</a></h1>
    <p class="post-meta">发布于 2012 年 9 月 24 日</p>
  </header>

  <article class="post-content">
  
    
      <p>This article aims to walk through the installation process for getting WordPress running on HHVM (HipHop Virtual Machine).</p>


      <div class="read-more">
        <a href="http://hhvm-cn.com/blog/3095/getting-wordpress-running-on-hhvm" >
          Read More
        </a>
      </div>
    
  
  </article>
</div>

  
    <div class="post">
  
  <header class="post-header">
    
    <div class="authorPhoto">
      <img src="https://graph.facebook.com/622128601/picture/" alt="" title="" />
    </div>
    
    
    <p class="post-authorName">Sara Golemon</p>
    
    <h1 class="post-title"><a href="http://hhvm-cn.com/blog/3089/wordpress-3-4-2-running-on-hiphop-hhvm">WordPress 3.4.2 running on HHVM</a></h1>
    <p class="post-meta">发布于 2012 年 9 月 22 日</p>
  </header>

  <article class="post-content">
  
    
      <p><img src="/static/images/posts/dough_burn-300x200.jpg" alt="Heated seats" /></p>
<center><i>While you wait, here's my sister's cat.</i></center>

<p>Welcome to the inaugural post on the HipHop for PHP blog.  In the coming days, weeks, months, and (dare I predict) years, we’ll be creating posts about the inner workings of HipHop, the practical implementation details of running it, and whatever else manages to fit on this site.</p>

<p>So sit back, add us to your RSS reader, and enjoy.</p>

    
  
  </article>
</div>

  
</div>

  </div>
</div>


      </div>
      <div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <div class="footerBlocks">
      <div id="fb_oss" class="footerSection fbOpenSourceFooter">
          <svg class="facebookOSSLogoSvg" viewBox="0 0 1133.9 1133.9" x="0px" y="0px">
            <g>
              <path class="logoRing outerRing" d="M 498.3 3.7 c 153.6 88.9 307.3 177.7 461.1 266.2 c 7.6 4.4 10.3 9.1 10.3 17.8 c -0.3 179.1 -0.2 358.3 0 537.4 c 0 8.1 -2.4 12.8 -9.7 17.1 c -154.5 88.9 -308.8 178.1 -462.9 267.5 c -9 5.2 -15.5 5.3 -24.6 0.1 c -153.9 -89.2 -307.9 -178 -462.1 -266.8 C 3 838.8 0 833.9 0 825.1 c 0.3 -179.1 0.2 -358.3 0 -537.4 c 0 -8.6 2.6 -13.6 10.2 -18 C 164.4 180.9 318.4 92 472.4 3 C 477 -1.5 494.3 -0.7 498.3 3.7 Z M 48.8 555.3 c 0 79.9 0.2 159.9 -0.2 239.8 c -0.1 10 3 15.6 11.7 20.6 c 137.2 78.8 274.2 157.8 411 237.3 c 9.9 5.7 17 5.7 26.8 0.1 c 137.5 -79.8 275.2 -159.2 412.9 -238.5 c 7.4 -4.3 10.5 -8.9 10.5 -17.8 c -0.3 -160.2 -0.3 -320.5 0 -480.7 c 0 -8.8 -2.8 -13.6 -10.3 -18 C 772.1 218 633.1 137.8 494.2 57.4 c -6.5 -3.8 -11.5 -4.5 -18.5 -0.5 C 336.8 137.4 197.9 217.7 58.8 297.7 c -7.7 4.4 -10.2 9.2 -10.2 17.9 C 48.9 395.5 48.8 475.4 48.8 555.3 Z" />
              <path class="logoRing middleRing" d="M 184.4 555.9 c 0 -33.3 -1 -66.7 0.3 -100 c 1.9 -48 24.1 -86 64.7 -110.9 c 54.8 -33.6 110.7 -65.5 167 -96.6 c 45.7 -25.2 92.9 -24.7 138.6 1 c 54.4 30.6 108.7 61.5 162.2 93.7 c 44 26.5 67.3 66.8 68 118.4 c 0.9 63.2 0.9 126.5 0 189.7 c -0.7 50.6 -23.4 90.7 -66.6 116.9 c -55 33.4 -110.8 65.4 -167.1 96.5 c -43.4 24 -89 24.2 -132.3 0.5 c -57.5 -31.3 -114.2 -64 -170 -98.3 c -41 -25.1 -62.9 -63.7 -64.5 -112.2 C 183.5 621.9 184.3 588.9 184.4 555.9 Z M 232.9 556.3 c 0 29.5 0.5 59.1 -0.1 88.6 c -0.8 39.2 16.9 67.1 50.2 86.2 c 51.2 29.4 102.2 59.2 153.4 88.4 c 31.4 17.9 63.6 18.3 95 0.6 c 53.7 -30.3 107.1 -61.2 160.3 -92.5 c 29.7 -17.5 45 -44.5 45.3 -78.8 c 0.6 -61.7 0.5 -123.5 0 -185.2 c -0.3 -34.4 -15.3 -61.5 -44.9 -79 C 637.7 352.6 583 320.8 527.9 290 c -27.5 -15.4 -57.2 -16.1 -84.7 -0.7 c -56.9 31.6 -113.4 64 -169.1 97.6 c -26.4 15.9 -40.7 41.3 -41.1 72.9 C 232.6 491.9 232.9 524.1 232.9 556.3 Z" />
              <path class="logoRing innerRing" d="M 484.9 424.4 c 69.8 -2.8 133.2 57.8 132.6 132 C 617 630 558.5 688.7 484.9 689.1 c -75.1 0.4 -132.6 -63.6 -132.7 -132.7 C 352.1 485 413.4 421.5 484.9 424.4 Z M 401.3 556.7 c -3.4 37.2 30.5 83.6 83 84.1 c 46.6 0.4 84.8 -37.6 84.9 -84 c 0.1 -46.6 -37.2 -84.4 -84.2 -84.6 C 432.2 472.1 397.9 518.3 401.3 556.7 Z" />
            </g>
          </svg>
        <h2>Facebook Open Source</h2>
      </div>
      <div class="footerSection">
        <a class="footerLink" href="https://code.facebook.com/projects/" target="_blank">开源项目</a>
        <a class="footerLink" href="https://github.com/facebook/" target="_blank">GitHub</a>
        <a class="footerLink" href="https://twitter.com/fbOpenSource" target="_blank">Twitter</a>
      </div>
      <div class="footerSection rightAlign">
        <a class="footerLink" href="https://github.com/hhvm-cn/hhvm-cn.com" target="_blank">帮助我们翻译</a>
      </div>
    </div>
  </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-166019294-2', 'auto');
  ga('send', 'pageview');
</script>

    </div>
  </body>
</html>
